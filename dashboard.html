<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Ministry Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="/assets/LOGO.png">
    <link rel="shortcut icon" type="image/x-icon" href="/assets/LOGO.png">
    <link rel="apple-touch-icon" href="assets/LOGO.png">
    <style>
    :root {
        --primary: #926C15;
        --secondary: #C9980B;
        --accent: #FFC300;
        --light-yellow: #FFD235;
        --bright-yellow: #FFE169;
        --light: #f8f9fa;
        --dark: #343a40;
        --success: #28a745;
        --danger: #dc3545;
        --border-radius: 12px;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s ease;
        --sidebar-width: 280px;
        --header-height: 80px;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
        background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
        min-height: 100vh;
        overflow-x: hidden;
    }

    .dashboard-container {
        display: flex;
        min-height: 100vh;
        position: relative;
    }

    /* Sidebar Styles */
    .sidebar {
        width: var(--sidebar-width);
        background: white;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        transition: var(--transition);
        z-index: 1000;
    }

    .sidebar-header {
        background: linear-gradient(135deg, var(--accent), var(--primary));
        padding: 20px 15px;
        text-align: center;
        color: white;
    }

    .logo {
        width: 80px;
        height: 80px;
        background-image: url('assets/LOGO.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        margin: 0 auto 10px;
        filter: drop-shadow(0px 4px 10px rgba(0,0,0,0.6));
    }

    .church-name {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 5px;
        font-family: 'Montserrat', sans-serif;
        text-shadow: 2px 2px 5px rgba(0,0,0,0.25);
    }

    .church-subtitle {
        font-size: 0.7rem;
        opacity: 0.9;
        font-family: 'Montserrat', sans-serif;
        letter-spacing: 5px;
        text-shadow: 2px 2px 5px rgba(0,0,0,0.25);
    }

    .user-info {
        background: rgba(255, 255, 255, 0.2);
        padding: 12px;
        border-radius: var(--border-radius);
        margin-top: 15px;
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .user-avatar-container {
        position: relative;
        width: 70px;
        height: 70px;
        flex-shrink: 0;
    }

    .user-avatar {
        width: 100%;
        height: 100%;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--primary);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .user-details {
        flex: 1;
    }

    .user-name {
        font-size: 1rem;
        font-weight: 600;
        color: white;
        margin: 0 0 3px 0;
    }

    .user-ministry {
        font-size: 0.75rem;
        opacity: 0.9;
        color: white;
        margin: 0;
    }

    .status-indicator {
        position: absolute;
        bottom: -2px;
        right: -2px;
        z-index: 10;
    }

    .status-circle {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        border: 2px solid white;
        position: relative;
        cursor: pointer;
        transition: var(--transition);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .status-circle:hover {
        transform: scale(1.2);
    }

    .status-circle.verified {
        background-color: var(--success);
    }

    .status-circle.unverified {
        background-color: var(--danger);
    }

    .status-tooltip {
        position: absolute;
        bottom: 100%;
        right: 0;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 6px 10px;
        border-radius: 6px;
        font-size: 0.7rem;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transition: var(--transition);
        z-index: 100;
        margin-bottom: 5px;
    }

    .status-circle:hover .status-tooltip {
        opacity: 1;
        transform: translateY(-3px);
    }

    .sidebar-menu {
        padding: 15px 0;
    }

    .menu-item {
        display: flex;
        align-items: center;
        padding: 12px 20px;
        color: var(--dark);
        text-decoration: none;
        transition: var(--transition);
        cursor: pointer;
        border-left: 4px solid transparent;
        font-size: 0.9rem;
    }

    .menu-item:hover {
        background: #f8f9fa;
        border-left-color: var(--primary);
    }

    .menu-item.active {
        background: linear-gradient(90deg, rgba(146, 108, 21, 0.1), transparent);
        border-left-color: var(--primary);
        color: var(--primary);
        font-weight: 600;
    }

    .menu-item.disabled {
        opacity: 0.5;
        cursor: not-allowed;
        pointer-events: none;
    }

    .menu-item.disabled:hover {
        background: transparent;
        border-left-color: transparent;
    }

    .menu-icon {
        font-size: 1.1rem;
        margin-right: 12px;
        width: 20px;
        text-align: center;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        color: transparent;
    }

    .logout-btn {
        position: absolute;
        bottom: 20px;
        left: 20px;
        right: 20px;
        padding: 10px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'Montserrat', sans-serif;
        font-size: 0.9rem;
    }

    .logout-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(146, 108, 21, 0.4);
    }

    /* Main Content Styles */
    .main-content {
        flex: 1;
        margin-left: var(--sidebar-width);
        padding: 20px;
        transition: var(--transition);
        overflow-x: hidden;
        width: 100%;
        box-sizing: border-box;
    }

    .content-header {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        margin-bottom: 20px;
    }

    .content-header h1 {
        color: var(--primary);
        margin-bottom: 5px;
        font-family: 'Montserrat', sans-serif;
        font-size: 1.5rem;
    }

    .content-header p {
        color: #6c757d;
        font-family: 'Montserrat', sans-serif;
        font-size: 0.9rem;
    }

    /* Common Card Styles */
    .card {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }

    .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(90deg, var(--primary), var(--accent));
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    .stat-card {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(90deg, var(--primary), var(--accent));
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .stat-icon {
        font-size: 2rem;
        margin-bottom: 10px;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        color: transparent;
    }

    .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 5px;
    }

    .stat-label {
        color: #6c757d;
        font-size: 0.85rem;
    }

    .content-section {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        margin-bottom: 15px;
        display: none;
        width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
        min-height: auto;
    }

    .content-section.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .section-title {
        color: var(--primary);
        font-size: 1.3rem;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #e0e0e0;
        font-family: 'Montserrat', sans-serif;
    }

    .section-title i {
        background: linear-gradient(135deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        color: transparent;
        margin-right: 10px;
    }

    .welcome-message {
        padding: 15px;
        background: linear-gradient(135deg, rgba(146, 108, 21, 0.1), rgba(255, 195, 0, 0.1));
        border-radius: 8px;
        margin-bottom: 15px;
    }

    .welcome-message h2 {
        color: var(--primary);
        margin-bottom: 8px;
        font-family: 'Montserrat', sans-serif;
        font-size: 1.3rem;
    }

    .first-time-welcome {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: var(--border-radius);
        margin-bottom: 20px;
        box-shadow: var(--shadow);
        text-align: center;
        animation: slideInUp 0.6s ease;
    }

    .first-time-welcome h2 {
        font-size: 1.5rem;
        margin-bottom: 10px;
        font-family: 'Montserrat', sans-serif;
    }

    .first-time-welcome p {
        font-size: 0.95rem;
        margin-bottom: 8px;
        opacity: 0.95;
    }

    @keyframes slideInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Verification Banner */
    .verification-banner {
        background: linear-gradient(135deg, #ffc107, #ff8c00);
        color: white;
        padding: 15px;
        border-radius: var(--border-radius);
        margin-bottom: 20px;
        text-align: center;
        box-shadow: var(--shadow);
    }

    .verification-banner h3 {
        margin-bottom: 8px;
        font-size: 1.1rem;
    }

    .verification-banner p {
        margin-bottom: 10px;
        opacity: 0.9;
        font-size: 0.9rem;
    }

    .refresh-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid white;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
        font-size: 0.85rem;
    }

    .refresh-btn:hover {
        background: white;
        color: #ff8c00;
    }

    /* Bible Verse Section */
    .bible-verse-container {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 20px;
        border-radius: var(--border-radius);
        margin-bottom: 20px;
        box-shadow: var(--shadow);
        position: relative;
        overflow: hidden;
    }

    .bible-verse-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.1"><text x="50%" y="50%" font-size="80" text-anchor="middle" dominant-baseline="middle" font-family="serif">✝</text></svg>');
        background-size: 150px;
        background-repeat: no-repeat;
        background-position: center;
    }

    .verse-of-the-day {
        font-size: 1rem;
        font-style: italic;
        margin-bottom: 10px;
        line-height: 1.5;
        position: relative;
        z-index: 1;
    }

    .verse-reference {
        font-size: 0.85rem;
        text-align: right;
        font-weight: 600;
        position: relative;
        z-index: 1;
    }

    .verse-explanation {
        margin-top: 10px;
        font-size: 0.85rem;
        opacity: 0.9;
        position: relative;
        z-index: 1;
    }

    .verse-language {
        margin-top: 8px;
        font-size: 0.8rem;
        opacity: 0.8;
        position: relative;
        z-index: 1;
    }

    /* Verse Controls - Version and Language Selector */
    .verse-controls {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        position: relative;
        z-index: 2;
    }

    .version-selector,
    .language-selector {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .version-selector label,
    .language-selector label {
        font-weight: 600;
        font-size: 0.9rem;
        color: white;
    }

    .version-btn,
    .language-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        font-size: 0.85rem;
        transition: all 0.3s ease;
    }

    .version-btn:hover,
    .language-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: white;
        transform: translateY(-2px);
    }

    .version-btn.active,
    .language-btn.active {
        background: white;
        color: var(--primary);
        border-color: white;
    }

    /* Inspiring Words Section - LIVE AI */
    .inspiring-words-section {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.3);
        font-size: 0.95rem;
        font-weight: 500;
        font-style: italic;
        position: relative;
        z-index: 1;
        min-height: 30px;
        transition: opacity 0.3s ease-in-out;
        opacity: 1;
    }

    /* Pulse animation for LIVE indicator */
    @keyframes pulse {
        0%, 100% { opacity: 0.8; }
        50% { opacity: 1; }
    }

    /* Fade in/out for word transitions */
    @keyframes fadeInOut {
        0%, 100% { opacity: 1; }
        45%, 55% { opacity: 0.7; }
    }

    /* Birthday Today Section Styles */
    .birthday-today-section {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        padding: 25px;
        margin-top: 25px;
        border-top: 5px solid #FF69B4;
    }

    .birthday-header {
        margin-bottom: 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }

    .birthday-header h2 {
        margin: 0;
        color: var(--dark);
        font-size: 1.4rem;
    }

    .birthday-greeting-box {
        background: linear-gradient(135deg, #FF69B4, #FF1493);
        color: white;
        padding: 12px 20px;
        border-radius: 25px;
        font-weight: 600;
        font-size: 0.95rem;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    .birthday-celebrants {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
    }

    .birthday-card {
        background: linear-gradient(135deg, #FFE5F0, #FFCCEB);
        border: 2px solid #FF69B4;
        border-radius: var(--border-radius);
        padding: 20px;
        text-align: center;
        transition: var(--transition);
        cursor: pointer;
    }

    .birthday-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(255, 105, 180, 0.3);
    }

    .birthday-card-icon {
        font-size: 2.5rem;
        margin-bottom: 10px;
    }

    .birthday-card-name {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 5px;
    }

    .birthday-card-date {
        font-size: 0.85rem;
        color: #FF1493;
        font-weight: 600;
    }

    .no-birthday-celebrants {
        text-align: center;
        padding: 30px;
        color: #6c757d;
    }

    .no-birthday-celebrants i {
        font-size: 2rem;
        margin-bottom: 10px;
        opacity: 0.5;
    }

    .upcoming-birthdays-section {
        border-top: 2px solid #e0e0e0;
        padding-top: 25px;
    }

    .upcoming-birthdays-section h3 {
        margin: 0 0 15px 0;
        color: var(--dark);
        font-size: 1.2rem;
    }

    .upcoming-birthdays {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 12px;
    }

    .upcoming-birthday-item {
        background: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 12px;
        text-align: center;
        transition: var(--transition);
    }

    .upcoming-birthday-item:hover {
        background: #fff;
        border-color: #FF69B4;
        box-shadow: 0 4px 12px rgba(255, 105, 180, 0.15);
    }

    .upcoming-birthday-name {
        font-weight: 700;
        color: var(--dark);
        font-size: 0.95rem;
        margin-bottom: 5px;
    }

    .upcoming-birthday-date {
        font-size: 0.8rem;
        color: #FF69B4;
        font-weight: 600;
    }

    .upcoming-birthday-days {
        font-size: 0.75rem;
        color: #6c757d;
        margin-top: 3px;
    }

    .no-upcoming-birthdays {
        text-align: center;
        padding: 20px;
        color: #6c757d;
        font-size: 0.9rem;
    }

    
    .mobile-menu-toggle {
        display: none;
        position: fixed;
        top: 15px;
        left: 15px;
        z-index: 1001;
        background: var(--primary);
        color: white;
        border: none;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        font-size: 1.3rem;
        cursor: pointer;
        box-shadow: var(--shadow);
    }

    .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
    }

    .table-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        min-width: 500px;
    }

    table th {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 10px;
        text-align: left;
        font-weight: 600;
        font-family: 'Montserrat', sans-serif;
        font-size: 0.9rem;
    }

    table td {
        padding: 10px;
        border-bottom: 1px solid #e0e0e0;
        font-family: 'Montserrat', sans-serif;
        font-size: 0.85rem;
    }

    table tr:hover {
        background: #f8f9fa;
    }

    .badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .badge-success {
        background: rgba(40, 167, 69, 0.1);
        color: var(--success);
    }

    .badge-warning {
        background: rgba(255, 193, 7, 0.1);
        color: #ffc107;
    }

    .badge-danger {
        background: rgba(220, 53, 69, 0.1);
        color: var(--danger);
    }

    /* Schedule Styles */
    .schedule-container {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
    }

    .schedule-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
    }

    .week-navigation {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .nav-btn {
        background: var(--primary);
        color: white;
        border: none;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        cursor: pointer;
        transition: var(--transition);
    }

    .nav-btn:hover {
        background: var(--secondary);
    }

    .schedule-actions {
        display: flex;
        gap: 10px;
    }

    .action-btn {
        background: white;
        border: 1px solid #ddd;
        padding: 8px 15px;
        border-radius: 6px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .action-btn:hover {
        background: #f8f9fa;
    }

    .schedule-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 15px;
        padding: 20px;
    }

    .day-card {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
    }

    .day-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 12px;
        font-weight: 600;
        text-align: center;
    }

    .day-events {
        padding: 15px;
    }

    .event-item {
        display: flex;
        gap: 10px;
        padding: 10px 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .event-item:last-child {
        border-bottom: none;
    }

    .event-time {
        font-weight: 600;
        color: var(--primary);
        min-width: 70px;
    }

    .event-details {
        flex: 1;
    }

    .event-title {
        font-weight: 600;
        margin-bottom: 3px;
    }

    .event-location {
        font-size: 0.85rem;
        color: #6c757d;
    }

    /* Announcement Styles */
    .announcements-container {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .announcement-card {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
        transition: var(--transition);
    }

    .announcement-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .announcement-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
    }

    .announcement-title {
        font-weight: 600;
        color: var(--primary);
        font-size: 1.1rem;
    }

    .announcement-date {
        color: #6c757d;
        font-size: 0.85rem;
    }

    .announcement-content {
        padding: 20px;
    }

    .announcement-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 20px;
        background: #f8f9fa;
        border-top: 1px solid #e0e0e0;
    }

    .announcement-author {
        font-weight: 600;
        color: var(--primary);
    }

    .announcement-priority {
        padding: 4px 10px;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .high-priority {
        background: rgba(220, 53, 69, 0.1);
        color: var(--danger);
    }

    .medium-priority {
        background: rgba(255, 193, 7, 0.1);
        color: #ffc107;
    }

    /* Ministry Specific Styles */
    .ministry-welcome {
        background: linear-gradient(135deg, rgba(146, 108, 21, 0.1), rgba(255, 195, 0, 0.1));
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .ministry-welcome h3 {
        color: var(--primary);
        margin-bottom: 8px;
    }

    .ministry-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    /* Worship Sets Styles */
    .worship-sets {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
    }

    .set-card {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
        margin-top: 15px;
    }

    .set-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
    }

    .set-date {
        font-weight: 600;
        color: var(--primary);
    }

    .set-team {
        background: var(--primary);
        color: white;
        padding: 4px 10px;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .set-songs {
        padding: 15px;
    }

    .song-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .song-item:last-child {
        border-bottom: none;
    }

    .song-title {
        font-weight: 600;
    }

    .song-key {
        color: #6c757d;
        font-size: 0.85rem;
    }

    /* Media Tasks Styles */
    .media-tasks {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
    }

    .task-list {
        margin-top: 15px;
    }

    .task-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        border-bottom: 1px solid #f0f0f0;
    }

    .task-item:last-child {
        border-bottom: none;
    }

    .task-info {
        flex: 1;
    }

    .task-title {
        font-weight: 600;
        margin-bottom: 3px;
    }

    .task-details {
        font-size: 0.85rem;
        color: #6c757d;
    }

    .task-status {
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .confirmed {
        background: rgba(40, 167, 69, 0.1);
        color: var(--success);
    }

    .pending {
        background: rgba(255, 193, 7, 0.1);
        color: #ffc107;
    }

    .in-progress {
        background: rgba(0, 123, 255, 0.1);
        color: #007bff;
    }

    /* Rehearsal Styles */
    .rehearsal-schedule {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
    }

    .rehearsal-card {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
    }

    .rehearsal-date {
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 5px;
    }

    .rehearsal-time, .rehearsal-location {
        margin-bottom: 3px;
        color: #6c757d;
    }

    .rehearsal-focus {
        margin-top: 8px;
        font-weight: 600;
    }

    /* Usher Assignments Styles */
    .usher-assignments {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
    }

    .assignment-card {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
    }

    .assignment-location {
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 10px;
    }

    .assignment-team {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .team-member {
        background: #f8f9fa;
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 0.85rem;
    }

    .church-logo-section {
        text-align: center;
        margin-bottom: 30px;
        padding: 30px;
        background: linear-gradient(135deg, rgba(146, 108, 21, 0.1), rgba(255, 195, 0, 0.1));
        border-radius: var(--border-radius);
    }

    .church-logo-large {
        width: 300px;
        height: 300px;
        background-image: url('assets/LOGO2.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        margin: 0 auto 10px;
        filter: drop-shadow(0px 4px 15px rgba(0,0,0,0.3));
    }

    .church-background {
        max-width: 800px;
        margin: 0 auto;
        text-align: center;
    }

    .church-background h2 {
        color: var(--primary);
        margin-bottom: 15px;
        font-family: 'Montserrat', sans-serif;
    }

    .church-background p {
        color: #6c757d;
        line-height: 1.6;
        font-size: 1.1rem;
    }

    .pastors-section {
        margin: 40px 0;
        text-align: center;
    }

    .pastors-section h2 {
        color: var(--primary);
        margin-bottom: 30px;
        font-family: 'Montserrat', sans-serif;
    }

    .pastors-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 30px;
        margin-bottom: 20px;
    }

    .pastor-card {
        text-align: center;
    }

    .pastor-photo {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        margin: 0 auto 15px;
        background-size: cover;
        background-position: center;
        border: 4px solid var(--primary);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        transition: var(--transition);
    }

    .pastor-photo:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(146, 108, 21, 0.4);
    }

    .pastor-name {
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 5px;
        font-size: 0.95rem;
    }

    .pastor-title {
        color: #6c757d;
        font-size: 0.85rem;
    }

    .pastors-description {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        max-width: 600px;
        margin: 0 auto;
    }

    .pastors-description p {
        color: #6c757d;
        line-height: 1.6;
        margin: 0;
        font-style: italic;
    }

    /* Church Family Section */
    .church-family-section {
        margin: 40px 0;
        text-align: center;
    }

    .church-family-section h2 {
        color: var(--primary);
        margin-bottom: 20px;
        font-family: 'Montserrat', sans-serif;
    }

    .family-gathering-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
        margin-top: 20px;
    }

    .gathering-card {
        background: white;
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--shadow);
        transition: var(--transition);
        position: relative;
    }

    .gathering-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
    }

    .gathering-photo {
        width: 100%;
        height: 200px;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        transition: var(--transition);
    }

    .gathering-card:hover .gathering-photo {
        transform: scale(1.05);
    }

    .gathering-info {
        padding: 20px;
        text-align: left;
    }

    .gathering-title {
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 8px;
        font-size: 1.1rem;
        font-family: 'Montserrat', sans-serif;
    }

    .gathering-description {
        color: #6c757d;
        font-size: 0.9rem;
        line-height: 1.5;
        margin: 0;
    }

    /* Add overlay effect for better text readability */
    .gathering-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(to bottom, transparent 60%, rgba(0,0,0,0.1));
        opacity: 0;
        transition: var(--transition);
        pointer-events: none;
    }

    .gathering-card:hover::before {
        opacity: 1;
    }

    /* Profile Styles */
    .profile-container {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
        width: 100%;
        box-sizing: border-box;
        position: relative;
        z-index: 1;
        margin-bottom: 20px;
        display: block;
    }

    .profile-header {
        display: flex;
        align-items: center;
        padding: 30px;
        background: linear-gradient(135deg, rgba(146, 108, 21, 0.1), rgba(255, 195, 0, 0.1));
        gap: 25px;
        flex-wrap: wrap; /* ⬅️ Added for mobile responsiveness */
    }
    .profile-avatar {
        position: relative;
        flex-shrink: 0;
    }

    .avatar-large {
        width: 100px;
        height: 100px;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: bold;
        color: white;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }

    .avatar-status {
        position: absolute;
        bottom: 5px;
        right: 5px;
    }

    .profile-info h3 {
        color: var(--primary);
        font-size: 1.5rem;
        margin-bottom: 5px;
        font-family: 'Montserrat', sans-serif;
    }

    .profile-info p {
        color: #6c757d;
        margin-bottom: 3px;
    }

    .profile-tabs {
        display: flex;
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
    }

    .tab-btn {
        padding: 15px 25px;
        background: none;
        border: none;
        cursor: pointer;
        font-weight: 600;
        color: #6c757d;
        transition: var(--transition);
        border-bottom: 3px solid transparent;
    }

    .tab-btn:hover {
        color: var(--primary);
        background: rgba(146, 108, 21, 0.05);
    }

    .tab-btn.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
        background: white;
    }

    .profile-tab-content {
        display: none;
        padding: 30px;
        width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
    }

    .profile-tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
        width: 100%;
        box-sizing: border-box;
    }

    .profile-form,
    .password-form {
        width: 100%;
        box-sizing: border-box;
        max-width: 100%;
        overflow-x: hidden;
    }

    .form-group {
        margin-bottom: 20px;
        position: relative;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--dark);
    }

    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1rem;
        transition: var(--transition);
        background: white;
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(146, 108, 21, 0.1);
    }

    .form-control:disabled {
        background-color: #f8f9fa;
        color: #6c757d;
        cursor: not-allowed;
    }

    .password-toggle {
        position: absolute;
        right: 15px;
        top: 40px;
        cursor: pointer;
        color: #6c757d;
        transition: var(--transition);
    }

    .password-toggle:hover {
        color: var(--primary);
    }

    .form-actions {
        display: flex;
        gap: 15px;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #e0e0e0;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        flex: 1;
    }

    .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(146, 108, 21, 0.4);
    }

    .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }

    .btn-secondary {
        background: #6c757d;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        flex: 1;
    }

    .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
    }

    .password-strength {
        margin: 20px 0;
    }

    .strength-bar {
        width: 100%;
        height: 6px;
        background: #e0e0e0;
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 8px;
    }

    .strength-fill {
        height: 100%;
        width: 0%;
        border-radius: 3px;
        transition: var(--transition);
    }

    .strength-text {
        font-size: 0.85rem;
        color: #6c757d;
        text-align: center;
    }

    .password-requirements {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
    }

    .password-requirements p {
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--dark);
    }

    .password-requirements ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .password-requirements li {
        padding: 5px 0;
        color: #6c757d;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
    }

    .password-requirements li:before {
        content: '✗';
        margin-right: 8px;
        color: var(--danger);
    }

    .password-requirements li.valid:before {
        content: '✓';
        color: var(--success);
    }

    /* Create Lineup Styles */
    .lineup-container {
        background: white;
        padding: 30px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
    }

    .form-section {
        margin-bottom: 40px;
        padding-bottom: 30px;
        border-bottom: 2px solid #f0f0f0;
        display: flow-root;
        width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
    }

    .form-section:last-child {
        border-bottom: none;
    }

    .form-section h3 {
        color: var(--primary);
        margin-bottom: 20px;
        font-family: 'Montserrat', sans-serif;
        font-size: 1.2rem;
    }

    .form-section h3 i {
        margin-right: 10px;
    }

    /* Two-column layout for form inputs */
    .profile-form {
        width: 100%;
    }

    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 0;
        flex-wrap: wrap;
        width: 100%;
        box-sizing: border-box;
    }

    .form-column {
        flex: 1;
        min-width: 0;
    }

    .form-column.full-width {
        flex: 0 0 100%;
    }

    .song-row {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 4px solid var(--primary);
    }

    .backup-row {
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .backup-row select {
        flex: 1;
    }

    .btn-remove-backup {
        background: var(--danger);
        color: white;
        border: none;
        border-radius: 4px;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: var(--transition);
        flex-shrink: 0;
    }

    .btn-remove-backup:hover:not(:disabled) {
        background: #c82333;
        transform: translateY(-2px);
    }

    .btn-remove-backup:disabled {
        background: #6c757d;
        cursor: not-allowed;
        opacity: 0.6;
    }

    .preserve-formatting {
        white-space: pre-wrap;
        word-wrap: break-word;
        font-family: inherit;
        line-height: 1.5;
    }

    .youtube-preview {
        margin-top: 10px;
        border-radius: 8px;
        overflow: hidden;
        display: none;
    }

    .youtube-preview iframe {
        width: 100%;
        height: 200px;
        border: none;
    }

    .form-text {
        font-size: 0.85rem;
        color: #6c757d;
        margin-top: 5px;
    }

    .btn-danger {
        background: var(--danger);
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
        transition: var(--transition);
    }

    /* Receipt Modal Styles */
    .receipt-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 2000;
        backdrop-filter: blur(5px);
    }

    .receipt-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 20px;
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: modalSlideIn 0.4s ease-out;
    }

    @keyframes modalSlideIn {
        from {
            opacity: 0;
            transform: translate(-50%, -60%);
        }
        to {
            opacity: 1;
            transform: translate(-50%, -50%);
        }
    }

    .receipt-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary)) !important;
        background-image: linear-gradient(135deg, #926C15, #C9980B) !important;
        color: white;
        padding: 30px;
        text-align: center;
        border-radius: 20px 20px 0 0;
        position: relative;
    }

    [class*="gradient"] {
        background-image: inherit !important;
    }

    /* Ensure text contrast */
    .receipt-title,
    .receipt-subtitle,
    .receipt-section-title {
        color: inherit !important;
        text-shadow: inherit !important;
    }

    /* Remove any animations/transitions during capture */
    .html2canvas-container * {
        animation: none !important;
        transition: none !important;
    }

    .receipt-logo {
        width: 80px;
        height: 80px;
        background-image: url('assets/LOGO.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        margin: 0 auto 15px;
        filter: drop-shadow(0px 4px 10px rgba(0,0,0,0.6));
    }

    .receipt-title {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 5px;
        font-family: 'Montserrat', sans-serif;
        text-shadow: 2px 2px 5px rgba(0,0,0,0.25);
    }

    .receipt-subtitle {
        font-size: 1rem;
        opacity: 0.9;
        font-family: 'Montserrat', sans-serif;
        letter-spacing: 3px;
        text-shadow: 2px 2px 5px rgba(0,0,0,0.25);
    }

    .receipt-content {
        padding: 30px;
    }

    .receipt-section {
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 2px solid #f0f0f0;
    }

    .receipt-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }

    .receipt-section-title {
        color: var(--primary);
        font-size: 1.2rem;
        font-weight: 700;
        margin-bottom: 15px;
        font-family: 'Montserrat', sans-serif;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .receipt-section-title i {
        background: linear-gradient(135deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        color: transparent;
    }

    .receipt-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 10px;
    }

    .receipt-info-item {
        display: flex;
        flex-direction: column;
    }

    .receipt-label {
        font-size: 0.85rem;
        color: #6c757d;
        font-weight: 600;
        margin-bottom: 5px;
    }

    .receipt-value {
        font-size: 1rem;
        color: var(--dark);
        font-weight: 600;
    }

    .receipt-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .receipt-list-item {
        padding: 8px 0;
        border-bottom: 1px solid #f8f9fa;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .receipt-list-item:last-child {
        border-bottom: none;
    }

    .receipt-number {
        background: var(--primary);
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        font-weight: 700;
        flex-shrink: 0;
    }

    .receipt-song-title {
        font-weight: 600;
        color: var(--dark);
    }

    .receipt-note {
        background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 195, 0, 0.05));
        border-left: 4px solid #ffc107;
        padding: 20px;
        border-radius: 8px;
        margin-top: 20px;
    }

    .receipt-note-title {
        color: #856404;
        font-weight: 700;
        margin-bottom: 8px;
        font-size: 1rem;
    }

    .receipt-note-text {
        color: #856404;
        font-size: 0.9rem;
        line-height: 1.5;
        margin: 0;
    }

    .receipt-footer {
        background: #f8f9fa;
        padding: 25px 30px;
        border-radius: 0 0 20px 20px;
        border-top: 2px solid #e9ecef;
    }

    .receipt-actions {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 12px;
    }

    .receipt-btn {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        font-size: 0.9rem;
        -webkit-appearance: none !important;
        -moz-appearance: none !important;
        appearance: none !important;
    }

    .receipt-btn-edit {
        background: #6c757d;
        color: white;
    }

    .receipt-btn-edit:hover {
        background: #5a6268;
        transform: translateY(-2px);
    }

    .receipt-btn-save {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
    }

    .receipt-btn-save:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(146, 108, 21, 0.4);
    }

    .receipt-btn-confirm {
        background: var(--success);
        color: white;
    }

    .receipt-btn-confirm:hover {
        background: #218838;
        transform: translateY(-2px);
    }

    /* Calendar Styles */
    .calendar-container {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
        margin-top: 15px;
    }

    .calendar-header {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        font-weight: 600;
        text-align: center;
    }

    .calendar-day-header {
        padding: 12px 5px;
        font-size: 0.9rem;
        border-right: 1px solid rgba(255, 255, 255, 0.2);
    }

    .calendar-day-header:last-child {
        border-right: none;
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        grid-auto-rows: 1fr;
        min-height: 400px;
    }

    .calendar-day {
        border: 1px solid #e0e0e0;
        padding: 8px 5px;
        min-height: 80px;
        position: relative;
        cursor: pointer;
        transition: var(--transition);
        background: white;
    }

    .calendar-day:hover {
        background: #f8f9fa;
    }

    .calendar-day.other-month {
        background: #f8f9fa;
        color: #adb5bd;
    }

    .calendar-day.has-schedule {
        background: linear-gradient(135deg, rgba(146, 108, 21, 0.1), rgba(255, 195, 0, 0.1));
        border-left: 4px solid var(--primary);
    }

    .calendar-day.has-schedule::after {
        content: '';
        position: absolute;
        top: 5px;
        right: 5px;
        width: 8px;
        height: 8px;
        background: var(--primary);
        border-radius: 50%;
    }

    .calendar-day.selected {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        font-weight: bold;
    }

    .calendar-day.disabled {
        background: #f8f9fa;
        color: #adb5bd;
        cursor: not-allowed;
    }

    .calendar-day.disabled:hover {
        background: #f8f9fa;
    }

    .calendar-day-number {
        font-weight: 600;
        margin-bottom: 5px;
        font-size: 0.9rem;
    }

    .calendar-day-events {
        font-size: 0.7rem;
        color: var(--primary);
        font-weight: 500;
    }

    .calendar-type-selector {
        display: flex;
        gap: 5px;
    }

    .calendar-type-selector .action-btn {
        padding: 8px 12px;
        font-size: 0.85rem;
    }

    .calendar-type-selector .action-btn.active {
        background: var(--primary);
        color: white;
    }

    /* Schedule Modal Styles */
    .schedule-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        backdrop-filter: blur(5px);
    }

    .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 15px;
        width: 90%;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: modalSlideIn 0.4s ease-out;
    }

    .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 15px 15px 0 0;
        }
    .modal-header h3 {
            margin: 0;
            font-size: 1.3rem;
        }
    .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }
    .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

    .modal-body {
            padding: 25px;
        }
     .schedule-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .schedule-card-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .schedule-card-title {
            margin: 0 0 5px 0;
            font-size: 1.2rem;
        }

        .schedule-card-subtitle {
            margin: 0;
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .schedule-card-body {
            padding: 20px;
        }

        .schedule-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-size: 0.85rem;
            color: #6c757d;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1rem;
            color: var(--dark);
            font-weight: 600;
        }

    /* Upcoming Schedule Cards Styles */
    .upcoming-schedule-cards {
        padding: 20px;
        background: #f8f9fa;
    }

    .schedule-cards-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 12px;
    }

    .upcoming-card {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
        transition: var(--transition);
        border-left: 5px solid var(--primary);
        cursor: pointer;
    }

    .upcoming-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        border-left-color: var(--secondary);
    }

    .upcoming-card-date {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 10px 12px;
        text-align: center;
        font-weight: 600;
    }

    .upcoming-card-date-day {
        font-size: 1.4rem;
        font-weight: 700;
        line-height: 1;
    }

    .upcoming-card-date-time {
        font-size: 0.7rem;
        opacity: 0.9;
    }

    .upcoming-card-content {
        padding: 10px;
    }

    .upcoming-card-label {
        font-size: 0.65rem;
        color: #6c757d;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 3px;
    }

    .upcoming-card-title {
        font-size: 0.9rem;
        color: var(--dark);
        font-weight: 700;
        margin-bottom: 8px;
    }

    .upcoming-card-item {
        margin-bottom: 6px;
        padding-bottom: 6px;
        border-bottom: 1px solid #e0e0e0;
    }

    .upcoming-card-item:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
    }

    .upcoming-card-item-label {
        font-size: 0.65rem;
        color: #6c757d;
        font-weight: 600;
        margin-bottom: 2px;
    }

    .upcoming-card-item-value {
        font-size: 0.8rem;
        color: var(--dark);
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .upcoming-card-empty {
        text-align: center;
        padding: 40px 20px;
        color: #6c757d;
    }

    .upcoming-card-empty i {
        font-size: 2.5rem;
        color: #ddd;
        margin-bottom: 10px;
    }

    /* Schedule History Styles */
    .schedule-history-section {
        padding: 20px;
        background: #f0f0f0;
        border-top: 3px solid #e0e0e0;
    }

    .schedule-history-title {
        font-size: 1.3rem;
        color: var(--dark);
        font-weight: 700;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .schedule-history-cards {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .history-card {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
        transition: var(--transition);
        border-left: 5px solid #999;
        cursor: pointer;
        opacity: 0.85;
        display: grid;
        grid-template-columns: 140px 1fr;
    }

    .history-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        opacity: 1;
        border-left-color: var(--primary);
    }

    .history-card-date {
        background: linear-gradient(135deg, #8b8b8b, #6b6b6b);
        color: white;
        padding: 10px 12px;
        text-align: center;
        font-weight: 600;
    }

    .history-card-date-day {
        font-size: 1.4rem;
        font-weight: 700;
        line-height: 1;
    }

    .history-card-date-time {
        font-size: 0.7rem;
        opacity: 0.9;
    }

    .history-card-content {
        padding: 12px 15px;
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }

    .history-card-label {
        font-size: 0.65rem;
        color: #888;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0;
    }

    .history-card-title {
        font-size: 1rem;
        color: var(--primary);
        font-weight: 700;
        margin-bottom: 0;
    }

    .history-card-item {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
        display: flex;
        gap: 8px;
        align-items: center;
        flex: 1;
        min-width: 120px;
    }

    .history-card-item:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
    }

    .history-card-item-label {
        font-size: 0.65rem;
        color: #888;
        font-weight: 600;
        margin-bottom: 0;
    }

    .history-card-item-value {
        font-size: 0.85rem;
        color: var(--dark);
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .schedule-history-empty {
        text-align: center;
        padding: 40px 20px;
        color: #999;
    }

    .schedule-history-empty i {
        font-size: 2.5rem;
        color: #ddd;
        margin-bottom: 10px;
    }

    



    /* Network Status Indicator */
    .network-status {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 2000;
        padding: 12px 20px;
        border-radius: 8px;
        font-weight: 600;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
        display: none;
    }
    
    .network-status.online {
        background: #28a745;
        color: white;
    }
    
    .network-status.offline {
        background: #dc3545;
        color: white;
    }
    
    .network-status.slow {
        background: #ffc107;
        color: #212529;
    }
    
    /* Improved Song Layout Styles */
    .song-item {
        display: flex;
        flex-direction: column;
        gap: 15px;
        padding: 15px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        margin-bottom: 15px;
        background: #f8f9fa;
    }
    
    .song-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0;
    }
    
    .song-title {
        font-weight: 600;
        color: var(--primary);
        font-size: 1.1rem;
        margin: 0;
    }
    
    .youtube-preview-container {
        width: 100%;
        border-radius: 8px;
        overflow: hidden;
        margin: 10px 0;
    }
    
    .youtube-preview-container iframe {
        width: 100%;
        height: 200px;
        border: none;
    }
    
    .song-details {
        display: none;
        width: 100%;
    }
    
    .song-details.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }
    
    .details-section {
        margin-bottom: 15px;
    }
    
    .details-section:last-child {
        margin-bottom: 0;
    }
    
    .details-label {
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 5px;
        font-size: 0.9rem;
    }
    
    .details-content {
        background: white;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #e0e0e0;
        font-size: 0.9rem;
        line-height: 1.5;
        white-space: pre-line;
    }
    
    /* YouTube Placeholder for Slow/No Connection */
    .youtube-placeholder {
        width: 100%;
        height: 200px;
        background: #e9ecef;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #6c757d;
    }
    
    .youtube-placeholder i {
        font-size: 2rem;
        margin-bottom: 10px;
    }

    /* Calendar Modal Styles */
    .calendar-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        backdrop-filter: blur(5px);
    }

    .calendar-modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 15px;
        width: 90%;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: modalSlideIn 0.4s ease-out;
    }

    .calendar-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 25px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border-radius: 15px 15px 0 0;
    }

    .calendar-modal-header h3 {
        margin: 0;
        font-size: 1.3rem;
    }

    .calendar-close-btn {
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: var(--transition);
    }

    .calendar-close-btn:hover {
        background: rgba(255, 255, 255, 0.2);
    }

    .calendar-modal-body {
        padding: 25px;
    }

    /* Calendar Navigation */
    .calendar-navigation {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
    }

    .calendar-nav-btn {
        background: var(--primary);
        color: white;
        border: none;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        cursor: pointer;
        transition: var(--transition);
    }

    .calendar-nav-btn:hover {
        background: var(--secondary);
    }

    .calendar-nav-btn:disabled {
        background: #adb5bd;
        cursor: not-allowed;
    }

    .calendar-current-month {
        font-weight: 600;
        color: var(--primary);
        font-size: 1.1rem;
    }

    /* Date Input with Calendar Icon */
    .date-input-container {
        position: relative;
    }

    .date-input-container .calendar-icon {
        position: absolute;
        right: 15px;
        top: 40px;
        color: var(--primary);
        cursor: pointer;
        font-size: 1.1rem;
        transition: var(--transition);
    }

    .date-input-container .calendar-icon:hover {
        color: var(--secondary);
    }

    /* Schedule Details Styles */
    .schedule-details {
        margin-top: 20px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: var(--border-radius);
        display: none;
    }

    .schedule-details.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    .schedule-details-title {
        color: var(--primary);
        font-weight: 600;
        margin-bottom: 15px;
        font-size: 1.1rem;
    }

    .schedule-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 15px;
    }

    .schedule-info-item {
        display: flex;
        flex-direction: column;
    }

    .schedule-info-label {
        font-size: 0.85rem;
        color: #6c757d;
        font-weight: 600;
        margin-bottom: 5px;
    }

    .schedule-info-value {
        font-size: 1rem;
        color: var(--dark);
        font-weight: 600;
    }

    /* Form Fields Layout */
    .form-fields {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    /* Logout Modal Styles */
        .logout-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .logout-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.4s ease-out;
            overflow: hidden;
        }

        .logout-modal-header {
            padding: 25px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            text-align: center;
        }

        .logout-modal-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }

        .logout-modal-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 5px;
            font-family: 'Montserrat', sans-serif;
        }

        .logout-modal-subtitle {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .logout-modal-body {
            padding: 25px;
            text-align: center;
        }

        .logout-modal-message {
            color: #6c757d;
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 25px;
        }

        .logout-modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .logout-modal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            min-width: 120px;
            font-size: 0.95rem;
        }

        .logout-modal-cancel {
            background: #6c757d;
            color: white;
        }

        .logout-modal-cancel:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .logout-modal-confirm {
            background: linear-gradient(135deg, var(--danger), #c82333);
            color: white;
        }

        .logout-modal-confirm:hover {
            background: linear-gradient(135deg, #c82333, #a71e2a);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

    /* Print styles for receipt */
    @media print {
        body * {
            visibility: hidden;
        }
        .receipt-container,
        .receipt-container * {
            visibility: visible;
        }
        .receipt-container {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            max-width: 100%;
            box-shadow: none;
            margin: 0;
            padding: 0;
        }
        .receipt-actions {
            display: none;
        }
        .receipt-header {
            padding: 20px;
        }
        .receipt-content {
            padding: 20px;
        }
        .receipt-footer {
            padding: 20px;
        }
    }

    .btn-danger:hover {
        background: #c82333;
        transform: translateY(-2px);
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .sidebar {
            width: 250px;
        }
        
        .main-content {
            margin-left: 250px;
            width: 100%;
        }
    }

    @media (max-width: 900px) {
        .stats-container {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 768px) {
        .sidebar {
            transform: translateX(-100%);
            width: 280px;
        }

        .sidebar.active {
            transform: translateX(0);
        }

        .main-content {
            margin-left: 0;
            width: 100%;
            padding: 70px 15px 15px;
        }

        .mobile-menu-toggle {
            display: block;
        }

        .overlay.active {
            display: block;
        }

        .stats-container {
            grid-template-columns: 1fr;
        }

        .logout-btn {
            position: relative;
            bottom: auto;
            left: auto;
            right: auto;
            margin: 15px;
        }
        
        .content-header h1 {
            font-size: 1.3rem;
        }
        
        .content-header p {
            font-size: 0.85rem;
        }
        
        .section-title {
            font-size: 1.2rem;
        }
        
        .schedule-header {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }
        
        .schedule-grid {
            grid-template-columns: 1fr;
        }
        
        .announcement-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .announcement-footer {
            flex-direction: column;
            gap: 10px;
            align-items: flex-start;
        }
        
        .task-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .assignment-team {
            flex-direction: column;
            gap: 8px;
        }

        .content-layout {
            grid-template-columns: 1fr;
        }
        
        .pastors-grid {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }
        
        .pastor-photo {
            width: 100px;
            height: 100px;
        }
        
        .church-logo-large {
            width: 150px;
            height: 150px;
        }

        .family-gathering-grid {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .gathering-photo {
            height: 180px;
        }
        
        .gathering-info {
            padding: 15px;
        }

        /* Verse Controls Responsive */
        .verse-controls {
            flex-direction: column;
            gap: 12px;
        }

        .version-selector,
        .language-selector {
            flex-wrap: wrap;
        }

        .version-btn,
        .language-btn {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        /* Profile Responsive */
        .profile-header {
            flex-direction: column;
            text-align: center;
            padding: 20px;
        }
        
        .profile-tabs {
            flex-direction: column;
        }
        
        .tab-btn {
            padding: 12px 20px;
            text-align: center;
        }
        
        .profile-tab-content {
            padding: 20px;
        }
        
        .form-actions {
            flex-direction: column;
        }

        /* Form responsive */
        .form-row {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .form-column {
            flex: 0 0 100%;
            width: 100%;
            padding: 0;
            margin-bottom: 15px;
        }

        .form-column.full-width {
            flex: 0 0 100%;
            width: 100%;
        }

        /* Schedule History Responsive */
        .history-card {
            grid-template-columns: 1fr;
        }

        .history-card-content {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .history-card-item {
            flex-direction: column;
            align-items: flex-start;
            min-width: 100%;
        }

        /* Create Lineup Responsive */
        .lineup-container {
            padding: 20px;
        }
        
        .song-row {
            padding: 15px;
        }
        
        .form-section h3 {
            font-size: 1.1rem;
        }
        
        .backup-row {
            flex-direction: column;
            align-items: stretch;
        }
        
        .backup-row .btn-danger {
            align-self: flex-start;
        }

        .receipt-container {
            width: 95%;
            max-height: 95vh;
        }
        
        .receipt-header {
            padding: 20px;
        }
        
        .receipt-content {
            padding: 20px;
        }
        
        .receipt-info {
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .receipt-actions {
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .receipt-btn {
            padding: 15px 20px;
        }
        
        .form-fields {
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .calendar-day {
            min-height: 60px;
            padding: 5px 3px;
        }

        .calendar-day-number {
            font-size: 0.8rem;
        }

        .calendar-day-events {
            font-size: 0.65rem;
        }

        .modal-content {
            width: 95%;
        }

        .modal-header {
            padding: 15px 20px;
        }

        .modal-body {
            padding: 20px;
        }

        .schedule-info {
            grid-template-columns: 1fr;
        }

        .song-header {
            flex-direction: column;
            gap: 10px;
        }

        .song-actions {
            align-self: flex-start;
        }

        /* Calendar Modal Responsive */
        .calendar-modal-content {
            width: 95%;
        }

        .calendar-modal-header {
            padding: 15px 20px;
        }

        .calendar-modal-body {
            padding: 20px;
        }

        .calendar-navigation {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }

        .schedule-info-grid {
            grid-template-columns: 1fr;
        }

        .logout-modal-content {
        max-width: 350px;
        width: 85%;
        }

        .logout-modal-header {
            padding: 20px;
        }

        .logout-modal-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }

        .logout-modal-title {
            font-size: 1.2rem;
        }

        .logout-modal-subtitle {
            font-size: 0.85rem;
        }

        .logout-modal-body {
            padding: 20px;
        }

        .logout-modal-message {
            font-size: 0.95rem;
            margin-bottom: 20px;
        }

        .logout-modal-actions {
            flex-direction: column;
            gap: 10px;
        }

        .logout-modal-btn {
            min-width: 100%;
            padding: 14px 20px;
            font-size: 0.9rem;
        }
    }

    @media (max-width: 767px) {
        .lineup-container {
            padding: 15px;
        }
        
        .form-section {
            padding-bottom: 20px;
            margin-bottom: 25px;
        }
        
        .form-fields {
            grid-template-columns: 1fr !important;
            gap: 15px;
        }
        
        .song-row {
            padding: 15px;
        }
        
        .backup-row {
            flex-direction: column;
            align-items: stretch;
            gap: 8px;
        }
        
        .btn-remove-backup {
            align-self: flex-start;
            margin-top: 5px;
        }
        
        .form-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .form-actions button {
            width: 100%;
        }
        
        /* Ensure form controls are properly sized on mobile */
        .form-control {
            padding: 14px 12px;
            font-size: 16px; /* Prevents zoom on iOS */
        }
        
        /* Improve spacing for better mobile experience */
        .form-group {
            margin-bottom: 15px;
        }
        
        /* Make sure labels are properly sized */
        .form-group label {
            font-size: 0.9rem;
            margin-bottom: 6px;
        }
        
        /* Adjust section titles for mobile */
        .form-section h3 {
            font-size: 1.1rem;
            margin-bottom: 15px;
        }
        
        /* Improve button spacing */
        .btn-secondary, .btn-primary {
            padding: 14px 20px;
            font-size: 0.9rem;
        }
        
        /* Adjust YouTube preview for mobile */
        .youtube-preview iframe {
            height: 180px;
        }
    }

    @media (max-width: 480px) {
        .main-content {
            padding: 60px 10px 10px;
        }
        
        .content-header {
            padding: 15px;
        }
        
        .content-section {
            padding: 15px;
        }
        
        .first-time-welcome {
            padding: 20px;
        }
        
        .first-time-welcome h2 {
            font-size: 1.3rem;
        }
        
        .bible-verse-container {
            padding: 15px;
        }
        
        .verse-of-the-day {
            font-size: 0.95rem;
        }
        
        .stat-card {
            padding: 15px;
        }
        
        .stat-value {
            font-size: 1.3rem;
        }
        
        .welcome-message h2 {
            font-size: 1.2rem;
        }
        
        .family-gathering-grid {
            grid-template-columns: 1fr;
        }
        
        .gathering-photo {
            height: 160px;
        }
        
        .calendar-day {
            min-height: 50px;
        }

        .calendar-day-number {
            font-size: 0.75rem;
        }

        .calendar-day-events {
            display: none;
        }

        .schedule-header {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }

        .calendar-type-selector {
            width: 100%;
        }

        .calendar-type-selector .action-btn {
            flex: 1;
            text-align: center;
        }

        .lineup-container {
            padding: 12px;
        }
        
        .song-row {
            padding: 12px;
        }
        
        .form-section h3 {
            font-size: 1rem;
        }
        
        .form-control {
            padding: 12px 10px;
        }
        
        /* Stack the form actions more tightly */
        .form-actions {
            gap: 8px;
        }

        .logout-modal-content {
        max-width: 300px;
        width: 90%;
        }

        .logout-modal-header {
            padding: 18px;
        }

        .logout-modal-icon {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        .logout-modal-title {
            font-size: 1.1rem;
        }

        .logout-modal-subtitle {
            font-size: 0.8rem;
        }

        .logout-modal-body {
            padding: 18px;
        }

        .logout-modal-message {
            font-size: 0.9rem;
            margin-bottom: 18px;
        }

        .logout-modal-btn {
            padding: 12px 18px;
            font-size: 0.85rem;
        }

    }

    /* Spiritual Assistant Chat Styling */
    .disclaimer-banner {
        background: linear-gradient(135deg, #FFF3CD, #FFE5A3);
        border-left: 5px solid #FFC107;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 2px 8px rgba(255, 193, 7, 0.2);
    }

    .disclaimer-header {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 700;
        color: #856404;
        margin-bottom: 10px;
        font-size: 1.05rem;
    }

    .disclaimer-header i {
        font-size: 1.3rem;
        color: #FFC107;
    }

    .disclaimer-banner p {
        color: #856404;
        margin: 0;
        font-size: 0.95rem;
        line-height: 1.6;
    }

    .chat-container {
        display: flex;
        flex-direction: column;
        height: 100%;
        background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%);
        border-radius: 12px;
        box-shadow: var(--shadow);
        overflow: hidden;
        min-height: 600px;
    }

    .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%);
    }

    .chat-message {
        display: flex;
        flex-direction: column;
        gap: 5px;
        max-width: 80%;
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .chat-message.user-message {
        align-self: flex-end;
    }

    .chat-message.ai-message {
        align-self: flex-start;
    }

    .message-content {
        padding: 14px 18px;
        border-radius: 16px;
        line-height: 1.7;
        word-wrap: break-word;
        font-size: 0.95rem;
    }

    .user-message .message-content {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border-bottom-right-radius: 4px;
        box-shadow: 0 2px 8px rgba(146, 108, 21, 0.15);
    }

    .ai-message .message-content {
        background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
        color: var(--dark);
        border: 1px solid #e0e7ff;
        border-bottom-left-radius: 4px;
        box-shadow: 0 4px 12px rgba(99, 110, 250, 0.12);
        border-left: 4px solid var(--primary);
    }

    .message-content p {
        margin: 0;
        font-size: 0.95rem;
    }

    .message-content p:not(:last-child) {
        margin-bottom: 8px;
    }

    .scripture-reference {
        background: linear-gradient(135deg, rgba(184, 134, 11, 0.12) 0%, rgba(139, 69, 19, 0.08) 100%);
        padding: 12px 15px;
        border-left: 4px solid #b8860b;
        margin-top: 12px;
        margin-bottom: 12px;
        border-radius: 6px;
        font-style: italic;
        color: #5d4e37;
        font-size: 0.93rem;
        line-height: 1.7;
        box-shadow: inset 0 1px 3px rgba(184, 134, 11, 0.1);
    }

    body.dark-mode .scripture-reference {
        background: linear-gradient(135deg, rgba(184, 134, 11, 0.2) 0%, rgba(139, 69, 19, 0.15) 100%);
        color: #daa520;
        border-left-color: #d4af37;
        box-shadow: inset 0 1px 3px rgba(184, 134, 11, 0.2);
    }

    .message-time {
        font-size: 0.75rem;
        color: #999;
        padding: 0 5px;
    }

    .user-message .message-time {
        text-align: right;
    }

    .ai-message .message-time {
        text-align: left;
    }

    .chat-input-area {
        padding: 16px 20px 20px;
        background: #ffffff;
        border-top: 1px solid #e8e8e8;
    }

    .input-group {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        margin-bottom: 8px;
    }

    .chat-input {
        flex: 1;
        padding: 12px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 24px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-size: 0.95rem;
        resize: none;
        transition: var(--transition);
        max-height: 120px;
    }

    .chat-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(146, 108, 21, 0.1);
    }

    .send-button {
        padding: 10px 16px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        border-radius: 50%;
        width: 44px;
        height: 44px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        white-space: nowrap;
        flex-shrink: 0;
    }

    .send-button:hover:not(:disabled) {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(146, 108, 21, 0.3);
    }

    .send-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .send-button i {
        font-size: 1rem;
    }

    .input-hint {
        font-size: 0.8rem;
        color: #999;
        padding: 0 5px;
    }

    .typing-indicator {
        display: flex;
        gap: 4px;
        padding: 15px 18px;
    }

    .typing-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #ccc;
        animation: typingAnimation 1.4s infinite;
    }

    .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
    }

    .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
    }

    @keyframes typingAnimation {
        0%, 60%, 100% {
            opacity: 0.5;
            transform: translateY(0);
        }
        30% {
            opacity: 1;
            transform: translateY(-10px);
        }
    }

    /* Responsive Chat */
    @media (max-width: 768px) {
        .chat-container {
            height: calc(100vh - 300px);
            min-height: 400px;
            border-radius: 8px;
        }

        .chat-message {
            max-width: 90%;
        }

        .disclaimer-banner {
            padding: 12px 15px;
            margin: 0;
            border-radius: 8px;
        }

        .chat-messages {
            padding: 12px;
            gap: 12px;
        }

        .message-content {
            padding: 10px 14px;
            font-size: 0.9rem;
        }

        .chat-input-area {
            padding: 12px 12px 16px;
        }

        .input-group {
            gap: 8px;
            margin-bottom: 8px;
        }

        .chat-input {
            padding: 10px 14px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .send-button {
            width: 40px;
            height: 40px;
            padding: 8px 12px;
        }

        .send-button i {
            font-size: 0.9rem;
        }

        .input-hint {
            font-size: 0.75rem;
        }
    }

    @media (max-width: 480px) {
        .chat-container {
            height: calc(100vh - 280px);
            min-height: 350px;
        }

        .chat-message {
            max-width: 95%;
        }

        .chat-messages {
            padding: 10px;
            gap: 10px;
        }

        .message-content {
            padding: 9px 12px;
            font-size: 0.85rem;
        }

        .message-time {
            font-size: 0.7rem;
        }

        .chat-input-area {
            padding: 10px 10px 14px;
        }

        .input-group {
            gap: 6px;
        }

        .chat-input {
            padding: 9px 12px;
            font-size: 0.85rem;
        }

        .send-button {
            width: 38px;
            height: 38px;
        }

        .input-hint {
            display: none;
        }
    }

    /* Flowise-style Chatbot Button */
    .flowise-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border: none;
        cursor: grab;
        z-index: 1500;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(146, 108, 21, 0.3);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        user-select: none;
        touch-action: none;
    }
    
    .flowise-button:active {
        cursor: grabbing;
    }

    .flowise-button:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(146, 108, 21, 0.4);
    }

    .flowise-button img {
        width: 32px;
        height: 32px;
        border-radius: 50%;
    }

    /* Flowise Tooltip */
    .flowise-tooltip {
        position: fixed;
        bottom: 90px;
        right: 20px;
        background: black;
        color: white;
        padding: 10px 16px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        opacity: 0;
        pointer-events: none;
        z-index: 1499;
        transition: opacity 0.3s ease;
        white-space: nowrap;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .flowise-tooltip::after {
        content: '';
        position: absolute;
        bottom: -5px;
        right: 15px;
        width: 0;
        height: 0;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        border-top: 5px solid black;
    }

    .flowise-button:hover + .flowise-tooltip,
    .flowise-tooltip:hover {
        opacity: 1;
    }

    /* Flowise Chat Window */
    .flowise-chat-window {
        position: fixed;
        bottom: auto;
        right: auto;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 400px;
        height: 600px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        z-index: 1500;
        display: none;
        flex-direction: column;
        overflow: hidden;
        animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        user-select: none;
    }

    .flowise-chat-window.open {
        display: flex;
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Chat Header */
    .flowise-chat-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: move;
        user-select: none;
        touch-action: none;
    }

    .flowise-chat-header-content {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
    }

    .flowise-chat-header-content img {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        border: 2px solid white;
    }

    .flowise-chat-header-text h3 {
        margin: 0;
        font-size: 15px;
        font-weight: 600;
    }

    .flowise-chat-header-text p {
        margin: 0;
        font-size: 12px;
        opacity: 0.9;
    }

    .flowise-close-btn {
        background: none;
        border: none;
        color: white;
        font-size: 20px;
        cursor: pointer;
        padding: 0;
        transition: transform 0.2s ease;
    }

    .flowise-close-btn:hover {
        transform: scale(1.2);
    }

    /* Chat Messages */
    .flowise-messages {
        flex: 1;
        overflow-y: auto;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        background: #f8f9fa;
    }

    .flowise-message {
        display: flex;
        gap: 8px;
        animation: messageSlide 0.3s ease;
    }

    @keyframes messageSlide {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .flowise-message.user {
        justify-content: flex-end;
    }

    .flowise-message-bubble {
        max-width: 75%;
        padding: 10px 14px;
        border-radius: 12px;
        font-size: 14px;
        line-height: 1.4;
        word-wrap: break-word;
    }

    .flowise-message.ai .flowise-message-bubble {
        background: #e8eef7;
        color: #303235;
    }

    .flowise-message.user .flowise-message-bubble {
        background: var(--primary);
        color: white;
    }

    /* Chat Input */
    .flowise-input-area {
        padding: 12px;
        border-top: 1px solid #e0e0e0;
        display: flex;
        gap: 8px;
        background: white;
    }

    .flowise-input-area input {
        flex: 1;
        border: 1px solid #e0e0e0;
        border-radius: 20px;
        padding: 10px 16px;
        font-size: 14px;
        outline: none;
        transition: border-color 0.2s ease;
    }

    .flowise-input-area input:focus {
        border-color: var(--primary);
    }

    .flowise-send-btn {
        background: var(--primary);
        border: none;
        color: white;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        flex-shrink: 0;
    }

    .flowise-send-btn:hover {
        background: var(--secondary);
        transform: scale(1.05);
    }

    /* Responsive */
    @media (max-width: 768px) {
        .flowise-chat-window {
            width: 90vw;
            height: 80vh;
            max-width: 100%;
            bottom: auto;
            right: auto;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .flowise-button {
            bottom: 20px;
            right: 20px;
        }

        .flowise-tooltip {
            display: none;
        }
    }

    /* Floating Chatbot Widget */
    .floating-chatbot {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 350px;
        height: 500px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        z-index: 1500;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transition: width 0.35s cubic-bezier(0.4, 0, 0.2, 1), height 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .floating-chatbot.collapsed {
        width: 80px;
        height: 80px;
        border-radius: 50%;
    }

    .floating-chatbot-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 16px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        transition: padding 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .floating-chatbot.collapsed .floating-chatbot-header {
        padding: 8px;
        border-radius: 50%;
        justify-content: center;
        align-items: center;
    }

    .floating-chatbot-title {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
        font-size: 0.95rem;
    }

    .floating-chatbot-title i {
        font-size: 1.2rem;
    }

    .floating-chatbot-close {
        background: none;
        border: none;
        color: white;
        font-size: 1.2rem;
        cursor: pointer;
        transition: transform 0.3s ease;
    }

    .floating-chatbot-close:hover {
        transform: scale(1.2);
    }

    .floating-chatbot.collapsed .floating-chatbot-title,
    .floating-chatbot.collapsed .floating-chatbot-close {
        display: none;
    }

    .floating-chatbot-content {
        display: flex;
        flex-direction: column;
        flex: 1;
        overflow: hidden;
        transition: opacity 0.3s ease;
    }

    .floating-chatbot.collapsed .floating-chatbot-content {
        display: none;
    }

    .floating-chatbot-messages {
        flex: 1;
        overflow-y: auto;
        padding: 15px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        background: #f8f9fa;
    }

    .floating-chatbot.collapsed .floating-chatbot-messages {
        display: none;
    }

    .floating-chatbot.collapsed .floating-chatbot-input-area {
        display: none;
    }

    .floating-chatbot-collapsed-content {
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 6px;
        padding: 0;
        width: 100%;
        height: 100%;
        transition: opacity 0.3s ease 0.05s;
    }

    .floating-chatbot.collapsed .floating-chatbot-collapsed-content {
        display: flex;
        opacity: 1;
    }

    .floating-chatbot.collapsed .floating-chatbot-header {
        width: 100%;
        height: 100%;
        padding: 0;
    }

    .floating-chatbot-collapsed-content img {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid white;
        transition: transform 0.3s ease;
    }

    .floating-chatbot.collapsed:hover .floating-chatbot-collapsed-content img {
        transform: scale(1.05);
    }

    .floating-chatbot-collapsed-message {
        font-size: 0.65rem;
        text-align: center;
        color: white;
        line-height: 1.1;
        font-weight: 600;
        max-width: 70px;
        opacity: 0;
        transition: opacity 0.3s ease 0.1s;
    }

    .floating-chatbot.collapsed .floating-chatbot-collapsed-message {
        opacity: 1;
    }

    .floating-chatbot-message {
        display: flex;
        flex-direction: column;
        gap: 4px;
        animation: slideIn 0.3s ease;
    }

    .floating-chatbot-message.user {
        align-self: flex-end;
        max-width: 80%;
    }

    .floating-chatbot-message.ai {
        align-self: flex-start;
        max-width: 80%;
    }

    .floating-chatbot-message-content {
        padding: 9px 12px;
        border-radius: 12px;
        font-size: 0.85rem;
        line-height: 1.4;
    }

    .floating-chatbot-message.user .floating-chatbot-message-content {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border-bottom-right-radius: 2px;
    }

    .floating-chatbot-message.ai .floating-chatbot-message-content {
        background: #e8e8e8;
        color: #333;
        border-bottom-left-radius: 2px;
    }

    .floating-chatbot-input-area {
        padding: 12px;
        background: white;
        border-top: 1px solid #e0e0e0;
        display: flex;
        gap: 8px;
    }

    .floating-chatbot.collapsed .floating-chatbot-input-area {
        display: none;
    }

    .floating-chatbot-input {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 16px;
        font-size: 0.85rem;
        resize: none;
        height: 36px;
        font-family: inherit;
    }

    .floating-chatbot-input:focus {
        outline: none;
        border-color: var(--primary);
    }

    .floating-chatbot-send {
        width: 36px;
        height: 36px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.3s ease;
    }

    .floating-chatbot-send:hover {
        transform: scale(1.05);
    }

    .floating-chatbot-send:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .floating-chatbot-toggle-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        z-index: 1400;
        display: none;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        box-shadow: 0 4px 12px rgba(146, 108, 21, 0.3);
        transition: all 0.3s ease;
    }

    .floating-chatbot-toggle-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 16px rgba(146, 108, 21, 0.4);
    }

    .floating-chatbot-toggle-btn.active {
        display: flex;
    }

    /* Mobile Chatbot */
    @media (max-width: 768px) {
        .floating-chatbot {
            width: 300px;
            height: 450px;
            bottom: 10px;
            left: 10px;
        }

        .floating-chatbot-messages {
            padding: 12px;
            gap: 10px;
        }

        .floating-chatbot-message {
            font-size: 0.8rem;
        }

        .floating-chatbot-message-content {
            padding: 8px 10px;
            font-size: 0.8rem;
        }
    }

    @media (max-width: 480px) {
        .floating-chatbot {
            width: 280px;
            height: 400px;
            bottom: 10px;
            left: 10px;
        }

        .floating-chatbot-header {
            padding: 12px;
        }

        .floating-chatbot-title {
            font-size: 0.85rem;
            gap: 8px;
        }

        .floating-chatbot-messages {
            padding: 10px;
        }

        .floating-chatbot-message-content {
            padding: 7px 9px;
            font-size: 0.75rem;
        }

        .floating-chatbot-input {
            font-size: 0.8rem;
        }
    }

    /* ===== DARK MODE STYLES ===== */
    body.dark-mode {
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        color: #e0e0e0;
    }

    body.dark-mode .sidebar {
        background: #1e1e1e;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
    }

    body.dark-mode .main-content {
        background: #0f0f0f;
    }

    body.dark-mode .content-section {
        background: #1a1a1a;
        color: #e0e0e0;
    }

    body.dark-mode .menu-item {
        color: #b0b0b0;
    }

    body.dark-mode .menu-item:hover {
        background: #2a2a2a;
        color: #ffffff;
    }

    body.dark-mode .menu-item.active {
        background: var(--primary);
        color: white;
    }

    body.dark-mode .form-control,
    body.dark-mode textarea {
        background: #2a2a2a;
        color: #e0e0e0;
        border-color: #404040;
    }

    body.dark-mode .form-control::placeholder {
        color: #808080;
    }

    body.dark-mode .form-section {
        background: #252525;
        border-color: #404040;
    }

    body.dark-mode .form-section h3 {
        color: #ffffff;
    }

    body.dark-mode .chat-container {
        background: #1a1a1a;
    }

    body.dark-mode .chat-messages {
        background: #0f0f0f;
    }

    body.dark-mode .chat-message {
        background: #2a2a2a;
        color: #e0e0e0;
    }

    body.dark-mode .chat-message.ai-message {
        background: linear-gradient(135deg, #1f3a3a 0%, #1a2f3f 100%);
        color: #b0e8e8;
        border: 1px solid #2a5a5a;
        border-left-color: var(--primary);
        box-shadow: 0 4px 12px rgba(99, 110, 250, 0.2);
    }

    body.dark-mode .chat-message.user-message {
        background: #1a2a3a;
        color: #a0c0e0;
    }

    body.dark-mode .flowise-chat-window {
        background: #1a1a1a;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.7);
    }

    body.dark-mode .flowise-chat-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
    }

    body.dark-mode .flowise-messages {
        background: #0f0f0f;
    }

    body.dark-mode .flowise-message {
        background: #2a2a2a;
        color: #e0e0e0;
    }

    body.dark-mode .flowise-message.user {
        background: #1a3a4a;
        color: #a0d0e0;
    }

    body.dark-mode .btn-primary {
        background: var(--primary);
        color: white;
    }

    body.dark-mode .btn-primary:hover {
        background: #a67c1f;
    }

    body.dark-mode .btn-secondary {
        background: #3a3a3a;
        color: #e0e0e0;
        border-color: #555;
    }

    body.dark-mode .btn-secondary:hover {
        background: #4a4a4a;
    }

    body.dark-mode .profile-tab-content {
        background: #1a1a1a;
    }

    body.dark-mode .profile-header {
        background: linear-gradient(135deg, rgba(146, 108, 21, 0.2), rgba(201, 152, 11, 0.2));
        border-color: #404040;
    }

    body.dark-mode .profile-tabs {
        border-bottom-color: #404040;
    }

    body.dark-mode .tab-btn {
        color: #b0b0b0;
        border-color: #404040;
    }

    body.dark-mode .tab-btn.active {
        color: var(--primary);
        border-color: var(--primary);
    }

    body.dark-mode .section-title {
        color: #ffffff;
    }

    body.dark-mode .card,
    body.dark-mode .worship-set,
    body.dark-mode .media-task {
        background: #252525;
        border-color: #404040;
    }

    body.dark-mode .status-circle {
        background: #3a3a3a;
    }

    body.dark-mode .status-circle.verified {
        background: #2a4a2a;
    }

    body.dark-mode .settings-toggle {
        background: #3a3a3a;
        border-color: #555;
    }

    body.dark-mode .settings-toggle input:checked + .toggle-slider {
        background: var(--primary);
    }

    body.dark-mode label {
        color: #e0e0e0;
    }

    /* Settings Toggle Switch Styles */
    .settings-toggle {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
    }

    .settings-toggle input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 24px;
    }

    .toggle-slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
    }

    input:checked + .toggle-slider {
        background-color: var(--primary);
    }

    input:checked + .toggle-slider:before {
        transform: translateX(26px);
    }

    .settings-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background: white;
        border-radius: 8px;
        margin-bottom: 12px;
        border: 1px solid #e0e0e0;
        transition: var(--transition);
    }

    body.dark-mode .settings-row {
        background: #252525;
        border-color: #404040;
    }

    .settings-row:hover {
        box-shadow: var(--shadow);
    }

    body.dark-mode .settings-row:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .settings-label {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .settings-label-title {
        font-weight: 600;
        font-size: 1rem;
    }

    .settings-label-desc {
        font-size: 0.85rem;
        color: #666;
    }

    body.dark-mode .settings-label-desc {
        color: #999;
    }

    /* ===== COMPREHENSIVE DARK MODE STYLING ===== */

    /* Text and Typography */
    body.dark-mode {
        color: #e0e0e0;
    }

    body.dark-mode h1, body.dark-mode h2, body.dark-mode h3, body.dark-mode h4, body.dark-mode h5, body.dark-mode h6 {
        color: #ffffff;
    }

    body.dark-mode p, body.dark-mode span, body.dark-mode div {
        color: #e0e0e0;
    }

    /* Input Fields and Form Elements */
    body.dark-mode input[type="text"],
    body.dark-mode input[type="email"],
    body.dark-mode input[type="password"],
    body.dark-mode input[type="number"],
    body.dark-mode input[type="date"],
    body.dark-mode input[type="time"],
    body.dark-mode input[type="search"],
    body.dark-mode textarea,
    body.dark-mode select {
        background-color: #2a2a2a;
        color: #e0e0e0;
        border-color: #404040;
    }

    body.dark-mode input::placeholder,
    body.dark-mode textarea::placeholder {
        color: #808080;
    }

    body.dark-mode input:focus,
    body.dark-mode textarea:focus,
    body.dark-mode select:focus {
        background-color: #2a2a2a;
        color: #e0e0e0;
        border-color: var(--primary);
        box-shadow: 0 0 5px rgba(146, 108, 21, 0.3);
    }

    body.dark-mode input:disabled,
    body.dark-mode textarea:disabled,
    body.dark-mode select:disabled {
        background-color: #1a1a1a;
        color: #666;
        border-color: #333;
        opacity: 0.6;
    }

    /* Buttons */
    body.dark-mode .btn-primary {
        background: var(--primary);
        color: #ffffff;
        border-color: var(--primary);
    }

    body.dark-mode .btn-primary:hover {
        background: #a67c1f;
        border-color: #a67c1f;
    }

    body.dark-mode .btn-primary:active {
        background: #8a6218;
    }

    body.dark-mode .btn-secondary {
        background: #3a3a3a;
        color: #e0e0e0;
        border-color: #555;
    }

    body.dark-mode .btn-secondary:hover {
        background: #4a4a4a;
        border-color: #666;
    }

    body.dark-mode .btn-success {
        background: #28a745;
        color: white;
    }

    body.dark-mode .btn-success:hover {
        background: #218838;
    }

    body.dark-mode .btn-danger {
        background: #dc3545;
        color: white;
    }

    body.dark-mode .btn-danger:hover {
        background: #c82333;
    }

    body.dark-mode .btn-warning {
        background: #ffc107;
        color: #333;
    }

    body.dark-mode .btn-warning:hover {
        background: #ffb300;
    }

    body.dark-mode button {
        color: #e0e0e0;
    }

    body.dark-mode button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Containers and Cards */
    body.dark-mode .container,
    body.dark-mode .card {
        background: #252525;
        border-color: #404040;
        color: #e0e0e0;
    }

    body.dark-mode .card-header {
        background: #1a1a1a;
        border-bottom-color: #404040;
        color: #ffffff;
    }

    body.dark-mode .card-body {
        background: #252525;
        color: #e0e0e0;
    }

    body.dark-mode .card-footer {
        background: #1a1a1a;
        border-top-color: #404040;
        color: #e0e0e0;
    }

    /* Modals */
    body.dark-mode .modal,
    body.dark-mode .logout-modal,
    body.dark-mode .calendar-modal {
        background: rgba(0, 0, 0, 0.8);
    }

    body.dark-mode .modal-content,
    body.dark-mode .logout-modal-content,
    body.dark-mode .calendar-modal-content {
        background: #1a1a1a;
        border-color: #404040;
        color: #e0e0e0;
    }

    body.dark-mode .modal-header,
    body.dark-mode .logout-modal-header,
    body.dark-mode .calendar-modal-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border-bottom-color: #404040;
        color: #ffffff;
    }

    body.dark-mode .modal-body,
    body.dark-mode .logout-modal-body,
    body.dark-mode .calendar-modal-body {
        background: #252525;
        color: #e0e0e0;
    }

    body.dark-mode .modal-footer,
    body.dark-mode {
        background: #1a1a1a;
        border-top-color: #404040;
    }

    body.dark-mode .close,
    body.dark-mode .calendar-close-btn {
        color: #e0e0e0;
    }

    body.dark-mode .close:hover,
    body.dark-mode .calendar-close-btn:hover {
        color: #ffffff;
    }

    /* Tables */
    body.dark-mode table {
        background: #252525;
        color: #e0e0e0;
    }

    body.dark-mode thead {
        background: #1a1a1a;
        color: #ffffff;
    }

    body.dark-mode tbody tr {
        border-bottom-color: #404040;
    }

    body.dark-mode tbody tr:hover {
        background: #2a2a2a;
    }

    body.dark-mode td, body.dark-mode th {
        border-color: #404040;
        color: #e0e0e0;
    }

    /* Lists and List Items */
    body.dark-mode ul, body.dark-mode ol {
        color: #e0e0e0;
    }

    body.dark-mode li {
        color: #e0e0e0;
    }

    body.dark-mode .list-group-item {
        background: #252525;
        border-color: #404040;
        color: #e0e0e0;
    }

    body.dark-mode .list-group-item:hover {
        background: #2a2a2a;
    }

    body.dark-mode .list-group-item.active {
        background: var(--primary);
        border-color: var(--primary);
        color: white;
    }

    /* Links */
    body.dark-mode a {
        color: var(--accent);
    }

    body.dark-mode a:hover {
        color: var(--secondary);
    }

    body.dark-mode a:visited {
        color: #d4a574;
    }

    /* Badges */
    body.dark-mode .badge {
        background: var(--primary);
        color: white;
    }

    body.dark-mode .badge-secondary {
        background: #3a3a3a;
        color: #e0e0e0;
    }

    body.dark-mode .badge-success {
        background: #28a745;
        color: white;
    }

    body.dark-mode .badge-danger {
        background: #dc3545;
        color: white;
    }

    body.dark-mode .badge-warning {
        background: #ffc107;
        color: #333;
    }

    body.dark-mode .badge-info {
        background: #17a2b8;
        color: white;
    }

    /* Alerts */
    body.dark-mode .alert {
        background: #252525;
        border-color: #404040;
        color: #e0e0e0;
    }

    body.dark-mode .alert-success {
        background: #1a3a1a;
        border-color: #28a745;
        color: #90ee90;
    }

    body.dark-mode .alert-danger {
        background: #3a1a1a;
        border-color: #dc3545;
        color: #ff6b6b;
    }

    body.dark-mode .alert-warning {
        background: #3a3a1a;
        border-color: #ffc107;
        color: #ffeb99;
    }

    body.dark-mode .alert-info {
        background: #1a2a3a;
        border-color: #17a2b8;
        color: #64b5f6;
    }

    /* Dropdowns */
    body.dark-mode .dropdown-menu {
        background: #252525;
        border-color: #404040;
    }

    body.dark-mode .dropdown-item {
        color: #e0e0e0;
    }

    body.dark-mode .dropdown-item:hover,
    body.dark-mode .dropdown-item:focus {
        background: #3a3a3a;
        color: #ffffff;
    }

    body.dark-mode .dropdown-item.active {
        background: var(--primary);
        color: white;
    }

    body.dark-mode .dropdown-divider {
        border-color: #404040;
    }

    /* Tabs */
    body.dark-mode .nav-tabs {
        border-bottom-color: #404040;
    }

    body.dark-mode .nav-tabs .nav-link {
        color: #b0b0b0;
    }

    body.dark-mode .nav-tabs .nav-link:hover {
        border-color: #404040;
        color: #ffffff;
    }

    body.dark-mode .nav-tabs .nav-link.active {
        background: #252525;
        border-color: #404040 #404040 #252525 #404040;
        color: var(--primary);
    }

    /* Pagination */
    body.dark-mode .pagination .page-link {
        background: #252525;
        border-color: #404040;
        color: #e0e0e0;
    }

    body.dark-mode .pagination .page-link:hover {
        background: #3a3a3a;
        border-color: #404040;
        color: #ffffff;
    }

    body.dark-mode .pagination .page-item.active .page-link {
        background: var(--primary);
        border-color: var(--primary);
        color: white;
    }

    body.dark-mode .pagination .page-item.disabled .page-link {
        background: #1a1a1a;
        border-color: #404040;
        color: #666;
    }

    /* Progress Bars */
    body.dark-mode .progress {
        background: #3a3a3a;
    }

    body.dark-mode .progress-bar {
        background: var(--primary);
    }

    body.dark-mode .progress-bar-success {
        background: #28a745;
    }

    body.dark-mode .progress-bar-danger {
        background: #dc3545;
    }

    body.dark-mode .progress-bar-warning {
        background: #ffc107;
    }

    body.dark-mode .progress-bar-info {
        background: #17a2b8;
    }

    /* Navbar */
    body.dark-mode .navbar {
        background: #1a1a1a;
        border-bottom-color: #404040;
    }

    body.dark-mode .navbar-brand {
        color: #ffffff;
    }

    body.dark-mode .navbar-brand:hover {
        color: var(--accent);
    }

    body.dark-mode .navbar-text {
        color: #b0b0b0;
    }

    body.dark-mode .navbar-nav .nav-link {
        color: #b0b0b0;
    }

    body.dark-mode .navbar-nav .nav-link:hover {
        color: #ffffff;
    }

    body.dark-mode .navbar-nav .nav-link.active {
        color: var(--primary);
    }

    /* Icons */
    body.dark-mode i {
        color: inherit;
    }

    body.dark-mode .fa-primary {
        color: var(--primary);
    }

    body.dark-mode .fa-secondary {
        color: var(--secondary);
    }

    body.dark-mode .fa-accent {
        color: var(--accent);
    }

    body.dark-mode .fa-success {
        color: #28a745;
    }

    body.dark-mode .fa-danger {
        color: #dc3545;
    }

    body.dark-mode .fa-warning {
        color: #ffc107;
    }

    body.dark-mode .fa-info {
        color: #17a2b8;
    }

    /* Borders and Dividers */
    body.dark-mode .border {
        border-color: #404040;
    }

    body.dark-mode .border-primary {
        border-color: var(--primary);
    }

    body.dark-mode .border-secondary {
        border-color: var(--secondary);
    }

    body.dark-mode .border-danger {
        border-color: #dc3545;
    }

    body.dark-mode .border-success {
        border-color: #28a745;
    }

    body.dark-mode .border-warning {
        border-color: #ffc107;
    }

    body.dark-mode .border-info {
        border-color: #17a2b8;
    }

    body.dark-mode hr {
        border-color: #404040;
    }

    /* Shadows */
    body.dark-mode .shadow {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    }

    body.dark-mode .shadow-sm {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    body.dark-mode .shadow-lg {
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
    }

    /* Verification Banner */
    body.dark-mode .verification-banner {
        background: #1a2a2a;
        border-left-color: #ffc107;
        color: #e0e0e0;
    }

    body.dark-mode .verification-banner h3 {
        color: #ffc107;
    }

    /* Content Sections */
    body.dark-mode .content-section {
        background: #0f0f0f;
        color: #e0e0e0;
    }

    body.dark-mode .content-header {
        background: linear-gradient(135deg, rgba(146, 108, 21, 0.1), rgba(201, 152, 11, 0.1));
        color: #ffffff;
    }

    body.dark-mode .content-header h1 {
        color: #ffffff;
    }

    body.dark-mode .content-header p {
        color: #b0b0b0;
    }

    /* Stat Cards */
    body.dark-mode .stat-card {
        background: #252525;
        border-color: #404040;
        color: #e0e0e0;
    }

    body.dark-mode .stat-card:hover {
        background: #2a2a2a;
    }

    body.dark-mode .stat-icon {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
    }

    body.dark-mode .stat-value {
        color: var(--primary);
    }

    body.dark-mode .stat-label {
        color: #999;
    }

    /* Ministry Cards */
    body.dark-mode .ministry-welcome {
        background: linear-gradient(135deg, rgba(146, 108, 21, 0.1), rgba(201, 152, 11, 0.1));
        color: #e0e0e0;
    }

    body.dark-mode .ministry-welcome h3 {
        color: #ffffff;
    }

    body.dark-mode .ministry-welcome p {
        color: #b0b0b0;
    }

    /* Worship Sets and Media Tasks */
    body.dark-mode .worship-set,
    body.dark-mode .media-task {
        background: #252525;
        border-color: #404040;
    }

    body.dark-mode .worship-set:hover,
    body.dark-mode .media-task:hover {
        background: #2a2a2a;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    }

    /* Schedule Items */
    body.dark-mode .schedule-item {
        background: #252525;
        border-color: #404040;
        color: #e0e0e0;
    }

    body.dark-mode .schedule-item:hover {
        background: #2a2a2a;
    }

    /* Receipts */
    body.dark-mode .receipt-container {
        background: #252525;
        color: #e0e0e0;
    }

    body.dark-mode .receipt-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
    }

    body.dark-mode .receipt-content {
        background: #1a1a1a;
    }

    body.dark-mode .receipt-section {
        border-color: #404040;
    }

    body.dark-mode .receipt-list li {
        color: #e0e0e0;
    }

    /* Calendar */
    body.dark-mode .calendar-container {
        background: #252525;
    }

    body.dark-mode .calendar-day {
        background: #1a1a1a;
        border-color: #404040;
        color: #e0e0e0;
    }

    body.dark-mode .calendar-day:hover {
        background: #2a2a2a;
    }

    body.dark-mode .calendar-day.selected {
        background: var(--primary);
        color: white;
    }

    body.dark-mode .calendar-day.other-month {
        color: #666;
    }

    /* Scrollbar */
    body.dark-mode ::-webkit-scrollbar {
        width: 10px;
    }

    body.dark-mode ::-webkit-scrollbar-track {
        background: #1a1a1a;
    }

    body.dark-mode ::-webkit-scrollbar-thumb {
        background: #404040;
        border-radius: 5px;
    }

    body.dark-mode ::-webkit-scrollbar-thumb:hover {
        background: #555;
    }

    /* Tooltip */
    body.dark-mode .tooltip {
        background: #2a2a2a;
    }

    body.dark-mode .tooltip-inner {
        background: #3a3a3a;
        color: #e0e0e0;
    }

    /* Popover */
    body.dark-mode .popover {
        background: #252525;
        border-color: #404040;
    }

    body.dark-mode .popover-header {
        background: #1a1a1a;
        border-color: #404040;
        color: #ffffff;
    }

    body.dark-mode .popover-body {
        color: #e0e0e0;
    }

    /* Code and Pre */
    body.dark-mode code {
        background: #2a2a2a;
        color: #b0d4d4;
        padding: 2px 6px;
        border-radius: 3px;
    }

    body.dark-mode pre {
        background: #1a1a1a;
        border-color: #404040;
        color: #e0e0e0;
    }

    body.dark-mode pre code {
        background: transparent;
        color: #e0e0e0;
        padding: 0;
    }

    /* Misc Utilities */
    body.dark-mode .bg-light {
        background: #1a1a1a !important;
    }

    body.dark-mode .bg-white {
        background: #252525 !important;
    }

    body.dark-mode .text-muted {
        color: #999 !important;
    }

    body.dark-mode .text-secondary {
        color: #b0b0b0 !important;
    }

    body.dark-mode .text-danger {
        color: #ff6b6b !important;
    }

    body.dark-mode .text-success {
        color: #90ee90 !important;
    }

    body.dark-mode .text-warning {
        color: #ffeb99 !important;
    }

    body.dark-mode .text-info {
        color: #64b5f6 !important;
    }

    /* ===== COMPLETE DARK MODE FOR ALL CUSTOM ELEMENTS ===== */

    /* Birthday Section */
    body.dark-mode .birthday-today-section {
        background: #1a1a1a;
    }

    body.dark-mode .birthday-card {
        background: #252525;
        border-color: #404040;
    }

    body.dark-mode .birthday-today-section h3 {
        color: var(--primary);
    }

    body.dark-mode .birthday-today-section p {
        color: #e0e0e0;
    }

    /* Church Family Section */
    body.dark-mode .church-family-section {
        background: #1a1a1a;
    }

    body.dark-mode .church-family-section h3 {
        color: var(--primary);
    }

    body.dark-mode .church-family-section p {
        color: #e0e0e0;
    }

    body.dark-mode .family-member {
        background: #252525;
        border-color: #404040;
        color: #e0e0e0;
    }

    body.dark-mode .family-member:hover {
        background: #2a2a2a;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    }

    body.dark-mode .family-member h4 {
        color: #ffffff;
    }

    body.dark-mode .family-member p {
        color: #b0b0b0;
    }

    /* Bible Verse Container */
    body.dark-mode .bible-verse-container {
        background: linear-gradient(135deg, rgba(146, 108, 21, 0.1), rgba(201, 152, 11, 0.1));
        border-color: #404040;
    }

    body.dark-mode .bible-verse-container h3 {
        color: #ffffff;
    }

    body.dark-mode .bible-verse-container p {
        color: #e0e0e0;
    }

    body.dark-mode .verse-text {
        color: #b0d4d4;
        background: rgba(255, 255, 255, 0.05);
    }

    body.dark-mode .verse-reference {
        color: var(--accent);
    }

    /* Schedule Container */
    body.dark-mode .schedule-container {
        background: #1a1a1a;
    }

    body.dark-mode .schedule-day {
        background: #252525;
        border-color: #404040;
    }

    body.dark-mode .schedule-day h3 {
        color: #ffffff;
    }

    body.dark-mode .schedule-day-content {
        background: #1a1a1a;
        border-color: #404040;
    }

    body.dark-mode .schedule-event {
        background: #2a2a2a;
        border-left-color: var(--primary);
        color: #e0e0e0;
    }

    body.dark-mode .schedule-event:hover {
        background: #3a3a3a;
    }

    body.dark-mode .schedule-event-title {
        color: #ffffff;
    }

    body.dark-mode .schedule-event-time {
        color: #999;
    }

    /* Modal Related */
    body.dark-mode .schedule-modal {
        background: rgba(0, 0, 0, 0.8);
    }

    body.dark-mode .schedule-modal-content {
        background: #1a1a1a;
        border-color: #404040;
    }

    body.dark-mode .schedule-modal-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
    }

    body.dark-mode .schedule-modal-close {
        color: #e0e0e0;
    }

    body.dark-mode .schedule-modal-close:hover {
        color: #ffffff;
    }

    /* Form Elements Advanced */
    body.dark-mode .form-row {
        background: transparent;
    }

    body.dark-mode .form-column {
        background: transparent;
    }

    body.dark-mode .form-group label {
        color: #ffffff;
    }

    body.dark-mode .form-group small {
        color: #999;
    }

    body.dark-mode .form-text {
        color: #999;
    }

    body.dark-mode input[type="checkbox"],
    body.dark-mode input[type="radio"] {
        accent-color: var(--primary);
    }

    /* Checkbox and Radio Custom */
    body.dark-mode .custom-checkbox .custom-control-label {
        color: #e0e0e0;
    }

    body.dark-mode .custom-radio .custom-control-label {
        color: #e0e0e0;
    }

    /* Profile Container */
    body.dark-mode .profile-container {
        background: #1a1a1a;
    }

    body.dark-mode .profile-form {
        background: #1a1a1a;
    }

    body.dark-mode .profile-info {
        color: #e0e0e0;
    }

    body.dark-mode .profile-info h3 {
        color: #ffffff;
    }

    body.dark-mode .profile-info p {
        color: #b0b0b0;
    }

    /* Avatar Styles */
    body.dark-mode .avatar-large {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
    }

    body.dark-mode .avatar {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
    }

    /* Chart/Graph Elements */
    body.dark-mode .chart-container {
        background: #252525;
        border-color: #404040;
    }

    body.dark-mode canvas {
        filter: invert(0.8) hue-rotate(180deg);
    }

    /* Worship Set Specific */
    body.dark-mode .worship-set-title {
        color: #ffffff;
    }

    body.dark-mode .worship-set-date {
        color: #999;
    }

    body.dark-mode .worship-set-stats {
        background: rgba(255, 255, 255, 0.05);
    }

    body.dark-mode .worship-set-stat {
        color: #e0e0e0;
    }

    body.dark-mode .worship-set-stat-value {
        color: var(--primary);
    }

    /* Media Task Specific */
    body.dark-mode .media-task-title {
        color: #ffffff;
    }

    body.dark-mode .media-task-status {
        background: rgba(255, 255, 255, 0.05);
    }

    body.dark-mode .media-task-status.completed {
        background: rgba(40, 167, 69, 0.2);
        color: #90ee90;
    }

    body.dark-mode .media-task-status.pending {
        background: rgba(255, 193, 7, 0.2);
        color: #ffeb99;
    }

    /* Receipt Modal Specific */
    body.dark-mode .receipt-modal {
        background: rgba(0, 0, 0, 0.8);
    }

    body.dark-mode .receipt-container {
        background: #1a1a1a;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
    }

    body.dark-mode .receipt-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
    }

    body.dark-mode .receipt-title, body.dark-mode .receipt-subtitle {
        color: white;
    }

    body.dark-mode .receipt-section-title {
        color: var(--accent);
    }

    body.dark-mode .receipt-info {
        background: rgba(255, 255, 255, 0.05);
        color: #e0e0e0;
    }

    body.dark-mode .receipt-list {
        color: #e0e0e0;
    }

    body.dark-mode .receipt-note {
        background: rgba(146, 108, 21, 0.1);
        border-color: #404040;
    }

    body.dark-mode .receipt-note-title {
        color: var(--primary);
    }

    body.dark-mode .receipt-note-text {
        color: #e0e0e0;
    }

    /* Receipt Buttons */
    body.dark-mode .receipt-btn {
        background: #3a3a3a;
        color: #e0e0e0;
        border-color: #555;
    }

    body.dark-mode .receipt-btn:hover {
        background: #4a4a4a;
        border-color: #666;
    }

    body.dark-mode .receipt-btn-primary,
    body.dark-mode .receipt-btn-edit {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    body.dark-mode .receipt-btn-primary:hover,
    body.dark-mode .receipt-btn-edit:hover {
        background: #a67c1f;
        border-color: #a67c1f;
    }

    body.dark-mode .receipt-btn-confirm {
        background: #28a745;
        color: white;
        border-color: #28a745;
    }

    body.dark-mode .receipt-btn-confirm:hover {
        background: #218838;
        border-color: #218838;
    }

    body.dark-mode .receipt-btn-save {
        background: var(--secondary);
        color: white;
        border-color: var(--secondary);
    }

    body.dark-mode .receipt-btn-save:hover {
        background: #a67c1f;
        border-color: #a67c1f;
    }

    /* Calendar Navigation */
    body.dark-mode .calendar-navigation {
        background: #252525;
        border-color: #404040;
    }

    body.dark-mode .calendar-nav-btn {
        background: #3a3a3a;
        color: #e0e0e0;
        border-color: #555;
    }

    body.dark-mode .calendar-nav-btn:hover {
        background: #4a4a4a;
    }

    body.dark-mode .calendar-current-month {
        color: #ffffff;
    }

    /* Calendar Days */
    body.dark-mode .calendar-day {
        background: #2a2a2a;
        border-color: #404040;
        color: #e0e0e0;
    }

    body.dark-mode .calendar-day:hover {
        background: #3a3a3a;
        cursor: pointer;
    }

    body.dark-mode .calendar-day.selected {
        background: var(--primary);
        color: white;
    }

    body.dark-mode .calendar-day.today {
        border-color: var(--accent);
        font-weight: bold;
    }

    body.dark-mode .calendar-day.other-month {
        color: #666;
        opacity: 0.5;
    }

    /* Disclaimer Banner */
    body.dark-mode .disclaimer-banner {
        background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 193, 7, 0.05));
        border-left-color: #ffc107;
        border-color: #404040;
    }

    body.dark-mode .disclaimer-banner p {
        color: #e0e0e0;
    }

    body.dark-mode .disclaimer-header {
        color: #ffeb99;
    }

    /* Chat Container Advanced */
    body.dark-mode .chat-container {
        background: #1a1a1a;
        border-color: #404040;
    }

    body.dark-mode .chat-messages {
        background: #0f0f0f;
    }

    body.dark-mode .chat-input-area {
        background: #252525;
        border-top-color: #404040;
    }

    body.dark-mode .chat-input-area textarea {
        background: #2a2a2a;
        color: #e0e0e0;
        border-color: #404040;
    }

    body.dark-mode .chat-input-area textarea::placeholder {
        color: #808080;
    }

    body.dark-mode .chat-input-area button {
        background: var(--primary);
        color: white;
    }

    body.dark-mode .chat-input-area button:hover {
        background: #a67c1f;
    }

    /* Auto Lyrics Panel */
    body.dark-mode .auto-lyrics-panel {
        background: linear-gradient(135deg, rgba(146, 108, 21, 0.2), rgba(201, 152, 11, 0.2));
        border-color: #404040;
    }

    body.dark-mode .auto-lyrics-panel h4 {
        color: var(--accent);
    }

    body.dark-mode .auto-lyrics-panel p {
        color: #e0e0e0;
    }

    body.dark-mode .lyrics-container {
        background: rgba(255, 255, 255, 0.03);
        border-color: #404040;
    }

    body.dark-mode .lyrics-text {
        color: #e0e0e0;
    }

    /* Loading and Spinner */
    body.dark-mode .spinner {
        border-color: #404040;
        border-top-color: var(--primary);
    }

    body.dark-mode .loader {
        border-color: #404040;
        border-top-color: var(--primary);
    }

    /* Empty State */
    body.dark-mode .empty-state {
        background: #252525;
        color: #b0b0b0;
    }

    body.dark-mode .empty-state-icon {
        color: #3a3a3a;
    }

    /* Status Badges */
    body.dark-mode .status-badge {
        background: #3a3a3a;
        color: #e0e0e0;
    }

    body.dark-mode .status-badge.verified {
        background: rgba(40, 167, 69, 0.2);
        color: #90ee90;
        border-color: #28a745;
    }

    body.dark-mode .status-badge.unverified {
        background: rgba(255, 193, 7, 0.2);
        color: #ffeb99;
        border-color: #ffc107;
    }

    body.dark-mode .status-badge.pending {
        background: rgba(23, 162, 184, 0.2);
        color: #64b5f6;
        border-color: #17a2b8;
    }

    /* Network Status */
    body.dark-mode .network-status {
        background: #252525;
        border-color: #404040;
        color: #e0e0e0;
    }

    body.dark-mode .network-status.online {
        background: linear-gradient(135deg, rgba(40, 167, 69, 0.2), rgba(40, 167, 69, 0.1));
        color: #90ee90;
    }

    body.dark-mode .network-status.offline {
        background: linear-gradient(135deg, rgba(220, 53, 69, 0.2), rgba(220, 53, 69, 0.1));
        color: #ff6b6b;
    }

    /* Mobile Menu Toggle */
    body.dark-mode .mobile-menu-toggle {
        background: #3a3a3a;
        color: #e0e0e0;
        border-color: #555;
    }

    body.dark-mode .mobile-menu-toggle:hover {
        background: #4a4a4a;
    }

    /* Overlay */
    body.dark-mode .overlay {
        background: rgba(0, 0, 0, 0.6);
    }

    /* Refresh Button */
    body.dark-mode .refresh-btn {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    body.dark-mode .refresh-btn:hover {
        background: #a67c1f;
    }

    /* Password Strength Indicator */
    body.dark-mode .password-strength {
        background: #2a2a2a;
    }

    body.dark-mode .strength-fill {
        background: linear-gradient(90deg, #ffc107, var(--primary));
    }

    body.dark-mode .strength-text {
        color: #e0e0e0;
    }

    body.dark-mode .password-requirements {
        background: rgba(255, 255, 255, 0.05);
        border-color: #404040;
    }

    body.dark-mode .password-requirements li {
        color: #e0e0e0;
    }

    body.dark-mode .password-requirements i {
        color: #999;
    }

    body.dark-mode .password-requirements i.fa-check {
        color: #90ee90;
    }

    body.dark-mode .password-toggle {
        color: var(--primary);
        cursor: pointer;
    }

    body.dark-mode .password-toggle:hover {
        color: var(--accent);
    }

    /* Announcement Container */
    body.dark-mode .announcements-container {
        background: #1a1a1a;
    }

    body.dark-mode .announcement {
        background: #252525;
        border-left-color: var(--primary);
        border-color: #404040;
    }

    body.dark-mode .announcement h4 {
        color: #ffffff;
    }

    body.dark-mode .announcement p {
        color: #e0e0e0;
    }

    body.dark-mode .announcement-date {
        color: #999;
    }

    /* Stats Container */
    body.dark-mode .stats-container {
        background: #1a1a1a;
    }

    /* Lineup Container */
    body.dark-mode .lineup-container {
        background: #1a1a1a;
    }

    body.dark-mode .lineup-form {
        background: #252525;
        border-color: #404040;
    }

    /* Ministry Stats */
    body.dark-mode .ministry-stats {
        background: #1a1a1a;
    }

    body.dark-mode .stat-card {
        background: #252525;
        border-color: #404040;
    }

    body.dark-mode .stat-card:hover {
        background: #2a2a2a;
    }

    /* Rehearsal Schedule */
    body.dark-mode .rehearsal-schedule {
        background: #1a1a1a;
    }

    body.dark-mode .rehearsal-item {
        background: #252525;
        border-color: #404040;
        color: #e0e0e0;
    }

    body.dark-mode .rehearsal-item:hover {
        background: #2a2a2a;
    }

    /* Usher Assignments */
    body.dark-mode .usher-assignments {
        background: #1a1a1a;
    }

    body.dark-mode .usher-assignment-item {
        background: #252525;
        border-color: #404040;
        color: #e0e0e0;
    }

    body.dark-mode .usher-assignment-item:hover {
        background: #2a2a2a;
    }

    /* Sidebar Additional Styles */
    body.dark-mode .sidebar {
        background: #1e1e1e;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
    }

    body.dark-mode .sidebar-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
    }

    body.dark-mode .logout-btn {
        background: #3a3a3a;
        color: #e0e0e0;
        border-color: #555;
    }

    body.dark-mode .logout-btn:hover {
        background: #4a4a4a;
        color: #ffffff;
    }

    /* Main Content */
    body.dark-mode .main-content {
        background: #0f0f0f;
    }

    /* Active Menu Item */
    body.dark-mode .menu-item.active {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
    }

    body.dark-mode .menu-item.active i {
        color: white;
    }

    /* Focus States for Better Accessibility */
    body.dark-mode input:focus-visible,
    body.dark-mode textarea:focus-visible,
    body.dark-mode select:focus-visible,
    body.dark-mode button:focus-visible {
        outline: 2px solid var(--primary);
        outline-offset: 2px;
    }

    /* Schedule History Cards - Enhanced Dark Mode */
    body.dark-mode .schedule-history-section {
        background: #1a1a1a;
        border-color: #404040;
    }

    body.dark-mode .schedule-history-title {
        color: #ffffff;
    }

    body.dark-mode .schedule-history-cards {
        background: #1a1a1a;
    }

    body.dark-mode .schedule-history-card {
        background: linear-gradient(135deg, #252525, #2a2a2a);
        border: 2px solid #404040;
        color: #e0e0e0;
        transition: all 0.3s ease;
    }

    body.dark-mode .schedule-history-card:hover {
        background: linear-gradient(135deg, #2a2a2a, #303030);
        border-color: var(--primary);
        box-shadow: 0 4px 12px rgba(146, 108, 21, 0.3);
        transform: translateY(-2px);
    }

    body.dark-mode .schedule-history-card h4 {
        color: #ffffff;
        font-weight: 600;
    }

    body.dark-mode .schedule-history-card p {
        color: #b0b0b0;
    }

    body.dark-mode .schedule-history-card .date-badge {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border-radius: 20px;
        padding: 4px 10px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    body.dark-mode .schedule-history-empty {
        background: #1a1a1a;
        border: 2px dashed #404040;
        color: #888;
        padding: 40px;
        text-align: center;
        border-radius: 8px;
    }

    body.dark-mode .schedule-history-empty i {
        color: #555;
    }

    /* Upcoming Schedule Cards - Enhanced Dark Mode */
    body.dark-mode .upcoming-schedule-cards {
        display: grid;
        gap: 15px;
    }

    body.dark-mode .upcoming-schedule-card {
        background: linear-gradient(135deg, #252525, #2a2a2a);
        border: 2px solid #404040;
        padding: 15px;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    body.dark-mode .upcoming-schedule-card:hover {
        background: linear-gradient(135deg, #2a2a2a, #303030);
        border-color: var(--accent);
        box-shadow: 0 4px 12px rgba(255, 195, 0, 0.3);
        transform: translateY(-2px);
    }

    body.dark-mode .upcoming-schedule-card h3 {
        color: #ffffff;
        margin-bottom: 10px;
    }

    body.dark-mode .upcoming-schedule-card p {
        color: #b0b0b0;
        margin: 5px 0;
    }

    body.dark-mode .schedule-time {
        color: var(--accent);
        font-weight: 600;
    }

    body.dark-mode .schedule-ministry {
        color: var(--secondary);
        font-weight: 500;
    }

    /* Spiritual Assistant Chat - Enhanced Dark Mode */
    body.dark-mode .spiritual-assistant {
        background: #1a1a1a;
    }

    body.dark-mode .disclaimer-banner {
        background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 195, 0, 0.05));
        border: 2px solid rgba(255, 195, 0, 0.3);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
    }

    body.dark-mode .disclaimer-header {
        color: #ffeb99;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 10px;
    }

    body.dark-mode .disclaimer-banner p {
        color: #d0d0d0;
        margin: 5px 0;
    }

    /* Chat Container - Enhanced for Chat Interface */
    body.dark-mode .chat-container {
        background: #1a1a1a;
        border: 2px solid #404040;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    }

    body.dark-mode .chat-messages {
        background: #0f0f0f;
        height: 400px;
        overflow-y: auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    /* Chat Message Styling */
    body.dark-mode .chat-message {
        padding: 12px 15px;
        border-radius: 8px;
        word-wrap: break-word;
        max-width: 80%;
        animation: slideIn 0.3s ease;
    }

    body.dark-mode .chat-message.ai-message {
        background: linear-gradient(135deg, #1e3a3a, #1f4a4a);
        color: #b0d4d4;
        border-left: 4px solid var(--primary);
        align-self: flex-start;
    }

    body.dark-mode .chat-message.ai-message p {
        color: #b0d4d4;
        margin: 0;
    }

    body.dark-mode .chat-message.user-message {
        background: linear-gradient(135deg, #1a2a3a, #2a3a4a);
        color: #a0c0e0;
        border-right: 4px solid var(--secondary);
        align-self: flex-end;
        margin-left: auto;
    }

    body.dark-mode .chat-message.user-message p {
        color: #a0c0e0;
        margin: 0;
    }

    body.dark-mode .message-time {
        color: #777;
        font-size: 0.75rem;
        margin-top: 5px;
        display: block;
    }

    body.dark-mode .chat-message.ai-message .message-time {
        color: #666;
    }

    /* Chat Input Area - Enhanced */
    body.dark-mode .chat-input-area {
        background: #252525;
        border-top: 2px solid #404040;
        padding: 15px;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    body.dark-mode .input-group {
        display: flex;
        gap: 10px;
        align-items: flex-end;
    }

    body.dark-mode .chat-input {
        flex: 1;
        background: #2a2a2a;
        color: #e0e0e0;
        border: 2px solid #404040;
        border-radius: 6px;
        padding: 12px;
        font-family: inherit;
        font-size: 0.95rem;
        resize: none;
        transition: all 0.3s ease;
    }

    body.dark-mode .chat-input:focus {
        outline: none;
        border-color: var(--primary);
        background: #303030;
        box-shadow: 0 0 8px rgba(146, 108, 21, 0.3);
    }

    body.dark-mode .chat-input::placeholder {
        color: #808080;
    }

    body.dark-mode .send-button {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        border-radius: 6px;
        padding: 12px 20px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 50px;
        height: 50px;
    }

    body.dark-mode .send-button:hover {
        background: linear-gradient(135deg, #a67c1f, #b8860b);
        box-shadow: 0 4px 12px rgba(146, 108, 21, 0.4);
        transform: translateY(-2px);
    }

    body.dark-mode .send-button:active {
        transform: translateY(0);
    }

    body.dark-mode .input-hint {
        color: #888;
        font-size: 0.85rem;
        font-style: italic;
    }

    /* Schedule Container Enhancements */
    body.dark-mode .schedule-container {
        background: #1a1a1a;
    }

    body.dark-mode .schedule-header {
        background: #252525;
        border-bottom: 2px solid #404040;
    }

    body.dark-mode .week-navigation {
        color: #e0e0e0;
    }

    body.dark-mode .week-navigation h3 {
        color: #ffffff;
    }

    body.dark-mode .schedule-actions {
        gap: 10px;
    }

    body.dark-mode .action-btn {
        background: #2a2a2a;
        color: #e0e0e0;
        border: 2px solid #404040;
        padding: 8px 15px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
    }

    body.dark-mode .action-btn:hover {
        background: #353535;
        border-color: var(--primary);
        color: var(--accent);
    }

    body.dark-mode .action-btn.active {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border-color: var(--primary);
    }

    body.dark-mode .nav-btn {
        background: #2a2a2a;
        color: #e0e0e0;
        border: 2px solid #404040;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    body.dark-mode .nav-btn:hover {
        background: #353535;
        border-color: var(--primary);
    }

    /* Schedule Calendar */
    body.dark-mode .schedule-calendar {
        background: #1a1a1a;
        border: 2px solid #404040;
        border-radius: 8px;
    }

    body.dark-mode .schedule-day {
        background: #252525;
        border: 1px solid #404040;
        color: #e0e0e0;
        padding: 10px;
        border-radius: 4px;
        min-height: 60px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    body.dark-mode .schedule-day:hover {
        background: #2a2a2a;
        border-color: var(--primary);
    }

    body.dark-mode .schedule-day.has-event {
        border-left: 4px solid var(--secondary);
        background: linear-gradient(135deg, #252525, #2a2a2a);
    }

    body.dark-mode .schedule-event {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 6px;
        border-radius: 3px;
        font-size: 0.75rem;
        margin: 2px 0;
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* Schedule Modal */
    body.dark-mode .schedule-modal {
        background: rgba(0, 0, 0, 0.7);
    }

    body.dark-mode .modal-content {
        background: #1a1a1a;
        border: 2px solid #404040;
        border-radius: 12px;
    }

    body.dark-mode .modal-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border-bottom: 2px solid #404040;
    }

    body.dark-mode .modal-header h3 {
        color: white;
    }

    body.dark-mode .close-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: none;
        font-size: 24px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    body.dark-mode .close-btn:hover {
        background: rgba(255, 255, 255, 0.4);
    }

    body.dark-mode .modal-body {
        background: #1a1a1a;
        color: #e0e0e0;
        padding: 20px;
    }

    body.dark-mode .modal-body p {
        color: #d0d0d0;
    }

    /* YouTube Player & Lyrics Container */
    body.dark-mode #youtubePlayer {
        background: #0f0f0f;
        border: 2px solid #404040;
    }

    body.dark-mode #lyricsContainer {
        background: #252525;
        border: 2px solid #404040;
        color: #e0e0e0;
    }

    body.dark-mode #lyricsContainer .lyrics-text {
        color: #e0e0e0;
    }

    /* Gathering Cards Dark Mode */
    body.dark-mode .gathering-card,
    body.dark-mode .event-card,
    body.dark-mode .church-event-card {
        background: #252525;
        border: 2px solid #404040;
        color: #e0e0e0;
    }

    body.dark-mode .gathering-card h3,
    body.dark-mode .event-card h3,
    body.dark-mode .church-event-card h3 {
        color: #ffffff;
    }

    body.dark-mode .gathering-card p,
    body.dark-mode .event-card p,
    body.dark-mode .church-event-card p {
        color: #d0d0d0;
    }

    body.dark-mode .gathering-card .event-time,
    body.dark-mode .event-card .event-time,
    body.dark-mode .church-event-card .event-time {
        color: #FFD235;
    }

    body.dark-mode .gathering-card .event-location,
    body.dark-mode .event-card .event-location,
    body.dark-mode .church-event-card .event-location {
        color: #b0b0b0;
    }

    /* Pastor Description Dark Mode */
    body.dark-mode .pastor-description,
    body.dark-mode .pastor-bio {
        background: #252525;
        border-left: 4px solid var(--primary);
        color: #e0e0e0;
    }

    body.dark-mode .pastor-description p,
    body.dark-mode .pastor-bio p {
        color: #d0d0d0;
        line-height: 1.6;
    }

    body.dark-mode .pastor-description h3,
    body.dark-mode .pastor-bio h3,
    body.dark-mode .pastor-description h4,
    body.dark-mode .pastor-bio h4 {
        color: #ffffff;
    }

    /* Message Contents Dark Mode */
    body.dark-mode .message-content,
    body.dark-mode .sermon-content,
    body.dark-mode .message-body {
        background: #1a1a1a;
        border: 2px solid #404040;
        color: #e0e0e0;
    }

    body.dark-mode .message-content h2,
    body.dark-mode .sermon-content h2,
    body.dark-mode .message-body h2,
    body.dark-mode .message-content h3,
    body.dark-mode .sermon-content h3,
    body.dark-mode .message-body h3 {
        color: #ffffff;
    }

    body.dark-mode .message-content p,
    body.dark-mode .sermon-content p,
    body.dark-mode .message-body p {
        color: #d0d0d0;
    }

    body.dark-mode .message-content li,
    body.dark-mode .sermon-content li,
    body.dark-mode .message-body li {
        color: #d0d0d0;
    }

    body.dark-mode .message-date,
    body.dark-mode .sermon-date,
    body.dark-mode .message-speaker {
        color: #FFD235;
    }

    /* Profile Tabs Dark Mode */
    body.dark-mode .profile-tabs {
        background: #1a1a1a;
        border-bottom: 2px solid #404040;
    }

    body.dark-mode .profile-tabs .tab-btn {
        background: transparent;
        color: #b0b0b0;
        border-bottom: 3px solid transparent;
    }

    body.dark-mode .profile-tabs .tab-btn:hover {
        color: #FFD235;
        border-bottom-color: #FFD235;
    }

    body.dark-mode .profile-tabs .tab-btn.active {
        color: #ffffff;
        border-bottom-color: var(--primary);
        background: rgba(146, 108, 21, 0.1);
    }

    body.dark-mode .tab-content,
    body.dark-mode .profile-tab-content {
        background: #1a1a1a;
        color: #e0e0e0;
    }

    body.dark-mode .tab-content h3,
    body.dark-mode .profile-tab-content h3,
    body.dark-mode .tab-content h4,
    body.dark-mode .profile-tab-content h4 {
        color: #ffffff;
    }

    body.dark-mode .tab-content p,
    body.dark-mode .profile-tab-content p {
        color: #d0d0d0;
    }

    /* "What to Expect" Section Dark Mode */
    body.dark-mode [style*="background: white"] {
        background: #252525 !important;
        color: #e0e0e0;
    }

    body.dark-mode .expectation-box,
    body.dark-mode [style*="background: white"] h4 {
        color: #ffffff;
    }

    body.dark-mode [style*="background: white"] ul {
        color: #d0d0d0;
    }

    body.dark-mode [style*="background: white"] li {
        color: #d0d0d0;
    }

    body.dark-mode [style*="color: #6c757d"] {
        color: #b0b0b0 !important;
    }

    /* Schedule Cards Container Dark Mode */
    body.dark-mode .schedule-cards-container,
    body.dark-mode .schedule-grid,
    body.dark-mode .schedules-list {
        background: #1a1a1a;
    }

    body.dark-mode .schedule-card,
    body.dark-mode .schedule-item {
        background: #252525;
        border: 2px solid #404040;
        color: #e0e0e0;
    }

    body.dark-mode .schedule-card h3,
    body.dark-mode .schedule-item h3,
    body.dark-mode .schedule-card h4,
    body.dark-mode .schedule-item h4 {
        color: #ffffff;
    }

    body.dark-mode .schedule-card p,
    body.dark-mode .schedule-item p {
        color: #d0d0d0;
    }

    body.dark-mode .schedule-time {
        color: #FFD235;
        font-weight: 600;
    }

    body.dark-mode .schedule-status {
        color: #51cf66;
    }

    /* History Card Contents Dark Mode */
    body.dark-mode .history-card,
    body.dark-mode .card-history,
    body.dark-mode .activity-card {
        background: #252525;
        border: 2px solid #404040;
        color: #e0e0e0;
        margin-bottom: 12px;
    }

    body.dark-mode .history-card h4,
    body.dark-mode .card-history h4,
    body.dark-mode .activity-card h4 {
        color: #ffffff;
    }

    body.dark-mode .history-card p,
    body.dark-mode .card-history p,
    body.dark-mode .activity-card p {
        color: #d0d0d0;
        margin: 5px 0;
    }

    body.dark-mode .history-date,
    body.dark-mode .card-date,
    body.dark-mode .activity-date {
        color: #FFD235;
        font-size: 0.85rem;
    }

    body.dark-mode .history-details,
    body.dark-mode .card-details,
    body.dark-mode .activity-details {
        color: #b0b0b0;
    }

    /* Schedule Card Body Dark Mode */
    body.dark-mode .schedule-card-body,
    body.dark-mode .card-body {
        background: #1a1a1a;
        color: #e0e0e0;
    }

    body.dark-mode .schedule-card-body h3,
    body.dark-mode .card-body h3 {
        color: #ffffff;
        border-bottom: 2px solid #404040;
        padding-bottom: 10px;
    }

    body.dark-mode .schedule-card-body p,
    body.dark-mode .card-body p {
        color: #d0d0d0;
    }

    body.dark-mode .schedule-card-body .badge,
    body.dark-mode .card-body .badge {
        background: rgba(146, 108, 21, 0.3);
        color: #FFD235;
    }

    body.dark-mode .schedule-card-body .icon,
    body.dark-mode .card-body .icon {
        color: var(--primary);
    }

    /* Upcoming Schedule Cards Dark Mode */
    body.dark-mode .upcoming-schedule-cards,
    body.dark-mode .upcoming-cards-section {
        background: #1a1a1a;
    }

    body.dark-mode .upcoming-card {
        background: #252525;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
        transition: var(--transition);
        border-left: 5px solid var(--primary);
        cursor: pointer;
    }

    body.dark-mode .upcoming-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        border-left-color: var(--secondary);
    }

    body.dark-mode .upcoming-card-date {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 10px 12px;
        text-align: center;
        font-weight: 600;
    }

    body.dark-mode .upcoming-card-date-day {
        font-size: 1.4rem;
        font-weight: 700;
        line-height: 1;
        color: white;
    }

    body.dark-mode .upcoming-card-date-time {
        font-size: 0.7rem;
        opacity: 0.9;
        color: white;
    }

    body.dark-mode .upcoming-card-content {
        padding: 10px;
        background: #252525;
    }

    body.dark-mode .upcoming-card-label {
        font-size: 0.65rem;
        color: #b0b0b0;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 3px;
    }

    body.dark-mode .upcoming-card-title {
        font-size: 0.9rem;
        color: #ffffff;
        font-weight: 700;
        margin-bottom: 8px;
    }

    body.dark-mode .upcoming-card-item {
        margin-bottom: 6px;
        padding-bottom: 6px;
        border-bottom: 1px solid #3a3a3a;
    }

    body.dark-mode .upcoming-card-item:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
    }

    body.dark-mode .upcoming-card-item-label {
        font-size: 0.65rem;
        color: #b0b0b0;
        font-weight: 600;
        margin-bottom: 2px;
    }

    body.dark-mode .upcoming-card-item-value {
        font-size: 0.8rem;
        color: #d0d0d0;
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    body.dark-mode .schedule-cards-container {
        background: #1a1a1a;
    }

    /* Pastor Description Dark Mode */
    body.dark-mode .pastor-description-section,
    body.dark-mode .pastor-section {
        background: #1a1a1a;
    }

    body.dark-mode .pastor-description-section h2,
    body.dark-mode .pastor-section h2 {
        color: #ffffff;
        border-bottom: 2px solid #404040;
    }

    body.dark-mode .pastor-description-section p,
    body.dark-mode .pastor-section p,
    body.dark-mode .pastor-intro {
        color: #d0d0d0;
        line-height: 1.6;
    }

    
    body.dark-mode .pastor-card h3,
    body.dark-mode .pastor-card h4 {
        color: #ffffff;
    }

    body.dark-mode .pastor-card p {
        color: #d0d0d0;
    }

    /* Text Color Overrides for Dark Mode */
    body.dark-mode p {
        color: #d0d0d0;
    }

    body.dark-mode span {
        color: inherit;
    }

    body.dark-mode div[style*="color: var(--primary)"] {
        color: #FFD235 !important;
    }

    body.dark-mode div[style*="color: #6c757d"] {
        color: #b0b0b0 !important;
    }

    body.dark-mode [style*="color: white"] {
        color: #ffffff !important;
    }

    body.dark-mode [style*="background: white"] {
        background: #252525 !important;
        color: #e0e0e0 !important;
    }

    /* Inline Style Text Fixes */
    body.dark-mode [style*="color: #333"] {
        color: #e0e0e0 !important;
    }

    body.dark-mode [style*="color: #666"] {
        color: #b0b0b0 !important;
    }

    body.dark-mode [style*="color: #999"] {
        color: #808080 !important;
    }

    body.dark-mode [style*="color: #333333"] {
        color: #e0e0e0 !important;
    }

    /* Bible Reader - Light Mode */
    .bible-reader-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
    }

    .bible-controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .bible-version-selector,
    .bible-book-selector,
    .bible-chapter-selector {
        display: flex;
        flex-direction: column;
    }

    .bible-controls label {
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
        font-size: 0.9rem;
    }

    .bible-controls select {
        padding: 10px;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        font-size: 0.9rem;
        background: white;
        color: #333;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .bible-controls select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 5px rgba(146, 108, 21, 0.2);
    }

    .bible-content {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 30px;
        min-height: 400px;
        box-shadow: var(--shadow);
    }

    .bible-header {
        border-bottom: 2px solid #e0e0e0;
        padding-bottom: 15px;
        margin-bottom: 20px;
    }

    .bible-header h3 {
        color: var(--primary);
        margin: 0 0 5px 0;
        font-size: 1.3rem;
    }

    .bible-version-label {
        color: #999;
        font-size: 0.85rem;
        margin: 0;
    }

    .bible-text {
        line-height: 1.8;
        color: #333;
        font-size: 0.95rem;
        user-select: text;
    }

    .bible-text p {
        margin-bottom: 12px;
    }

    .bible-verse {
        margin-bottom: 15px;
        padding: 10px;
        border-left: 3px solid #e0e0e0;
        transition: all 0.2s ease;
    }

    .bible-verse:hover {
        border-left-color: var(--primary);
        background: #f8f9fa;
    }

    .bible-verse-ref {
        font-weight: 600;
        color: var(--primary);
        font-size: 0.85rem;
        display: block;
        margin-bottom: 5px;
    }

    .bible-verse-text {
        color: #333;
        line-height: 1.6;
    }

    .bible-ai-assistant {
        background: #f8f9fa;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
    }

    .bible-ai-assistant h4 {
        color: var(--primary);
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 1rem;
    }

    .bible-question-input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        font-size: 0.9rem;
        margin-bottom: 10px;
        box-sizing: border-box;
        transition: all 0.3s ease;
    }

    .bible-question-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 5px rgba(146, 108, 21, 0.2);
    }

    .bible-ask-btn {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
    }

    .bible-ask-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(146, 108, 21, 0.3);
    }

    .bible-ai-response {
        background: white;
        border-left: 4px solid var(--primary);
        padding: 15px;
        border-radius: 6px;
        color: #333;
        line-height: 1.6;
    }

    /* Bible Reader - Dark Mode */
    body.dark-mode .bible-controls {
        background: #1a1a1a;
        border: 2px solid #404040;
    }

    body.dark-mode .bible-controls label {
        color: #e0e0e0;
    }

    body.dark-mode .bible-controls select {
        background: #2a2a2a;
        color: #e0e0e0;
        border-color: #404040;
    }

    body.dark-mode .bible-controls select:focus {
        border-color: var(--primary);
        box-shadow: 0 0 5px rgba(146, 108, 21, 0.3);
    }

    /* Daily Quote - Light Mode */
    .quote-container {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .quote-card {
        text-align: center;
        position: relative;
        padding: 30px 20px;
    }

    .quote-mark-open, .quote-mark-close {
        font-size: 4rem;
        color: #926C15;
        opacity: 0.3;
        line-height: 0.5;
    }

    .quote-mark-open {
        display: block;
        text-align: left;
        margin-bottom: -20px;
    }

    .quote-mark-close {
        display: block;
        text-align: right;
        margin-top: -20px;
    }

    .quote-text {
        font-size: 1.3rem;
        font-style: italic;
        color: #333;
        margin: 20px 0;
        line-height: 1.8;
        font-weight: 500;
    }

    .quote-author {
        font-size: 1rem;
        color: #666;
        margin-top: 20px;
        font-weight: 600;
    }

    .quote-controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 25px;
        flex-wrap: wrap;
    }

    .quote-controls .btn-primary,
    .quote-controls .btn-secondary {
        padding: 10px 20px;
        font-size: 0.95rem;
        min-width: 150px;
    }

    .quote-metadata {
        color: #666;
        font-size: 0.85rem;
    }

    /* Daily Quote - Dark Mode */
    body.dark-mode .quote-container {
        background: linear-gradient(135deg, #1a1a1a 0%, #252525 100%);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
    }

    body.dark-mode .quote-mark-open,
    body.dark-mode .quote-mark-close {
        color: #FFD235;
    }

    body.dark-mode .quote-text {
        color: #e0e0e0;
    }

    body.dark-mode .quote-author {
        color: #b0b0b0;
    }

    body.dark-mode .quote-metadata {
        color: #808080;
    }

    /* Mobile Responsive - Daily Quote */
    @media (max-width: 768px) {
        .quote-container {
            padding: 20px;
        }

        .quote-card {
            padding: 20px 15px;
        }

        .quote-mark-open, .quote-mark-close {
            font-size: 2.5rem;
        }

        .quote-text {
            font-size: 1.1rem;
        }

        .quote-controls {
            gap: 8px;
        }

        .quote-controls .btn-primary,
        .quote-controls .btn-secondary {
            min-width: 130px;
            padding: 8px 15px;
            font-size: 0.85rem;
        }
    }

    body.dark-mode .bible-content {
        background: #252525;
        border-color: #404040;
    }

    body.dark-mode .bible-header {
        border-bottom-color: #404040;
    }

    body.dark-mode .bible-header h3 {
        color: #FFD235;
    }

    body.dark-mode .bible-version-label {
        color: #b0b0b0;
    }

    body.dark-mode .bible-text {
        color: #d0d0d0;
    }

    body.dark-mode .bible-verse {
        border-left-color: #3a3a3a;
    }

    body.dark-mode .bible-verse:hover {
        border-left-color: var(--primary);
        background: #2a2a2a;
    }

    body.dark-mode .bible-verse-ref {
        color: #FFD235;
    }

    body.dark-mode .bible-verse-text {
        color: #d0d0d0;
    }

    body.dark-mode .bible-ai-assistant {
        background: #1a1a1a;
        border-color: #404040;
    }

    body.dark-mode .bible-ai-assistant h4 {
        color: #FFD235;
    }

    body.dark-mode .bible-ai-assistant p {
        color: #b0b0b0;
    }

    body.dark-mode .bible-question-input {
        background: #2a2a2a;
        border-color: #404040;
        color: #e0e0e0;
    }

    body.dark-mode .bible-question-input::placeholder {
        color: #808080;
    }

    body.dark-mode .bible-question-input:focus {
        border-color: var(--primary);
        box-shadow: 0 0 5px rgba(146, 108, 21, 0.3);
    }

    body.dark-mode .bible-ai-response {
        background: #2a2a2a;
        border-left-color: var(--primary);
        color: #d0d0d0;
    }

    /* Mobile Responsive Bible Reader */
    @media (max-width: 768px) {
        .bible-controls {
            grid-template-columns: 1fr !important;
            padding: 15px !important;
        }

        .bible-content {
            padding: 15px !important;
            min-height: 300px !important;
        }

        .bible-text {
            font-size: 0.9rem !important;
        }
    }

    /* Responsive Dark Mode */
    /* Change Password Form - Dark Mode */
    body.dark-mode .change-password-form,
    body.dark-mode .password-form {
        background: #1a1a1a;
        border: 2px solid #404040;
        border-radius: 8px;
        padding: 20px;
    }

    body.dark-mode .change-password-form h3,
    body.dark-mode .password-form h3 {
        color: #ffffff;
        border-bottom-color: #404040;
    }

    body.dark-mode .change-password-form .form-group label,
    body.dark-mode .password-form .form-group label {
        color: #e0e0e0;
    }

    body.dark-mode .change-password-form .form-control,
    body.dark-mode .password-form .form-control {
        background: #2a2a2a;
        color: #e0e0e0;
        border-color: #404040;
    }

    body.dark-mode .change-password-form .form-control:focus,
    body.dark-mode .password-form .form-control:focus {
        border-color: var(--primary);
        box-shadow: 0 0 8px rgba(146, 108, 21, 0.3);
    }

    body.dark-mode .change-password-form .form-control::placeholder,
    body.dark-mode .password-form .form-control::placeholder {
        color: #808080;
    }

    /* Personal Information Form - Dark Mode */
    body.dark-mode .personal-info-form,
    body.dark-mode .info-form {
        background: #1a1a1a;
        border: 2px solid #404040;
        border-radius: 8px;
        padding: 20px;
    }

    body.dark-mode .personal-info-form h3,
    body.dark-mode .info-form h3 {
        color: #ffffff;
        border-bottom-color: #404040;
        margin-bottom: 20px;
    }

    body.dark-mode .personal-info-form .form-group label,
    body.dark-mode .info-form .form-group label {
        color: #e0e0e0;
        font-weight: 600;
    }

    body.dark-mode .personal-info-form .form-control,
    body.dark-mode .info-form .form-control,
    body.dark-mode .personal-info-form .form-select,
    body.dark-mode .info-form .form-select {
        background: #2a2a2a;
        color: #e0e0e0;
        border: 2px solid #404040;
        border-radius: 6px;
        padding: 12px;
    }

    body.dark-mode .personal-info-form .form-control:focus,
    body.dark-mode .info-form .form-control:focus,
    body.dark-mode .personal-info-form .form-select:focus,
    body.dark-mode .info-form .form-select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 8px rgba(146, 108, 21, 0.3);
    }

    body.dark-mode .personal-info-form .form-control::placeholder,
    body.dark-mode .info-form .form-control::placeholder {
        color: #888;
    }

    body.dark-mode .personal-info-form option,
    body.dark-mode .info-form option {
        background: #2a2a2a;
        color: #e0e0e0;
    }

    /* Form Buttons - All Variants Dark Mode */
    body.dark-mode .btn,
    body.dark-mode button[type="submit"],
    body.dark-mode button[type="button"] {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        border-radius: 6px;
        padding: 12px 24px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    body.dark-mode .btn:hover,
    body.dark-mode button[type="submit"]:hover,
    body.dark-mode button[type="button"]:hover {
        background: linear-gradient(135deg, #a67c1f, #b8860b);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(146, 108, 21, 0.4);
    }

    body.dark-mode .btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
    }

    body.dark-mode .btn-primary:hover {
        background: linear-gradient(135deg, #a67c1f, #b8860b);
    }

    body.dark-mode .btn-secondary {
        background: #3a3a3a;
        color: #e0e0e0;
        border: 2px solid #404040;
    }

    body.dark-mode .btn-secondary:hover {
        background: #454545;
        border-color: var(--primary);
    }

    body.dark-mode .btn-danger {
        background: #dc3545;
    }

    body.dark-mode .btn-danger:hover {
        background: #c82333;
    }

    body.dark-mode .btn-success {
        background: #28a745;
    }

    body.dark-mode .btn-success:hover {
        background: #218838;
    }

    /* Form Sections and Divs */
    body.dark-mode .form-section {
        background: #1a1a1a;
        border: 2px solid #404040;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
    }

    body.dark-mode .form-section h2,
    body.dark-mode .form-section h3,
    body.dark-mode .form-section h4 {
        color: #ffffff;
    }

    body.dark-mode .form-section p {
        color: #b0b0b0;
    }

    body.dark-mode .info-box,
    body.dark-mode .info-card {
        background: #252525;
        border: 2px solid #404040;
        border-radius: 8px;
        padding: 15px;
    }

    body.dark-mode .info-box h4,
    body.dark-mode .info-card h4 {
        color: #ffffff;
    }

    body.dark-mode .info-box p,
    body.dark-mode .info-card p {
        color: #d0d0d0;
    }

    /* Save/Cancel Buttons */
    body.dark-mode .btn-save {
        background: linear-gradient(135deg, #28a745, #20c997);
    }

    body.dark-mode .btn-save:hover {
        background: linear-gradient(135deg, #218838, #1aa179);
    }

    body.dark-mode .btn-cancel {
        background: #3a3a3a;
        color: #e0e0e0;
    }

    body.dark-mode .btn-cancel:hover {
        background: #454545;
    }

    body.dark-mode .btn-edit {
        background: linear-gradient(135deg, #007bff, #0056b3);
    }

    body.dark-mode .btn-edit:hover {
        background: linear-gradient(135deg, #0056b3, #003d82);
    }

    body.dark-mode .btn-delete {
        background: #dc3545;
    }

    body.dark-mode .btn-delete:hover {
        background: #c82333;
    }

    /* Input Groups and Wrappers */
    body.dark-mode .input-group {
        background: #2a2a2a;
        border: 2px solid #404040;
        border-radius: 6px;
    }

    body.dark-mode .input-group-text {
        background: #252525;
        border-color: #404040;
        color: var(--primary);
    }

    /* Form Validation Feedback */
    body.dark-mode .invalid-feedback,
    body.dark-mode .valid-feedback {
        color: #888;
    }

    body.dark-mode .form-control.is-invalid {
        border-color: #ff6b6b;
    }

    body.dark-mode .form-control.is-valid {
        border-color: #51cf66;
    }

    /* Responsive Dark Mode */
    @media (max-width: 768px) {
        body.dark-mode .sidebar {
            background: #1e1e1e;
        }

        body.dark-mode .main-content {
            background: #0f0f0f;
        }

        body.dark-mode .content-section {
            background: #0f0f0f;
        }

        body.dark-mode .chat-messages {
            height: 300px;
        }

        body.dark-mode .chat-message {
            max-width: 95%;
        }

        body.dark-mode .schedule-history-card {
            font-size: 0.9rem;
        }

        body.dark-mode .upcoming-schedule-card {
            padding: 12px;
        }

        body.dark-mode .form-section,
        body.dark-mode .change-password-form,
        body.dark-mode .personal-info-form {
            padding: 15px;
        }

        body.dark-mode .btn,
        body.dark-mode button[type="submit"] {
            padding: 10px 20px;
            font-size: 0.9rem;
        }
    }

</style>

</head>
<body>
    <div id="logoutModal" class="logout-modal">
        <div class="logout-modal-content">
            <div class="logout-modal-header">
                <div class="logout-modal-icon">
                    <i class="fas fa-sign-out-alt"></i>
                </div>
                <h3 class="logout-modal-title">Confirm Logout</h3>
                <p class="logout-modal-subtitle">Ministry Portal</p>
            </div>
            <div class="logout-modal-body">
                <p class="logout-modal-message">
                    Are you sure you want to logout from your account?
                </p>
                <div class="logout-modal-actions">
                    <button class="logout-modal-btn logout-modal-cancel" onclick="closeLogoutModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="logout-modal-btn logout-modal-confirm" onclick="confirmLogout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="networkStatus" class="network-status">
        <i class="fas fa-wifi"></i> <span id="networkStatusText">Connection Status</span>
    </div>

    <button class="mobile-menu-toggle" onclick="toggleSidebar()">☰</button>
    <div class="overlay" onclick="toggleSidebar()"></div>

    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo"></div>
                <div class="church-name">JOYFUL SOUND CHURCH</div>
                <div class="church-subtitle">INTERNATIONAL</div>
                
                <div class="user-info">
                    <div class="user-avatar-container">
                        <div class="user-avatar" id="userAvatar">
                            <div class="avatar-content">FG</div>
                        </div>
                        <div class="status-indicator" id="statusIndicator">
                            <!-- Status circle will be dynamically generated -->
                        </div>
                    </div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Frank Gomez</div>
                        <div class="user-ministry" id="userMinistry">Media Ministry</div>
                    </div>
                </div>
            </div>

            <nav class="sidebar-menu" id="sidebarMenu">
                <!-- Menu items will be dynamically generated based on user's ministry and status -->
            </nav>

            <button class="logout-btn" onclick="showLogoutModal()">
                <i class="fas fa-sign-out-alt" style="margin-right: 10px;"></i>
                Logout
            </button>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-header">
                <h1 id="pageTitle">Welcome to Your Ministry Portal</h1>
                <p id="pageSubtitle">Stay connected and inspired in your service</p>
            </div>

            <!-- Verification Banner (shown only for unverified users) -->
            <div class="verification-banner" id="verificationBanner" style="display: none;">
                <h3><i class="fas fa-lock"></i> Account Pending Verification</h3>
                <p>Your account is currently under review. Please wait for administrator verification to access all features.</p>
                <p><strong>Friendly Reminder:</strong> Once an administrator verifies your account in the system, you'll gain full access to all ministry features!</p>
                <button class="refresh-btn" onclick="checkVerificationStatus()">
                    <i class="fas fa-sync-alt" style="margin-right: 5px;"></i>
                    Check Verification Status
                </button>
            </div>

            <!-- Home Section -->
            <section id="home" class="content-section active">
                <!-- First Time Welcome (shown only on first login for verified users) -->
                <div id="firstTimeWelcomeContainer" style="display: none;">
                    <div class="first-time-welcome">
                        <h2><i class="fas fa-glass-cheers"></i> Welcome to the Team, <span id="firstTimeName">Frank</span>!</h2>
                        <p>We're thrilled to have you join us in ministry!</p>
                        <p style="font-size: 0.9rem; margin-top: 15px; opacity: 0.9;">Here's your welcome verse as you begin this journey with us.</p>
                    </div>

                    <div class="bible-verse-container" id="welcomeVerseContainer">
                        <!-- Version Selector -->
                        <div class="verse-controls">
                            <div class="version-selector">
                                <label>Version:</label>
                                <button class="version-btn active" onclick="changeBibleVersion('niv')">NIV</button>
                                <button class="version-btn" onclick="changeBibleVersion('kjv')">KJV</button>
                                <button class="version-btn" onclick="changeBibleVersion('nkjv')">NKJV</button>
                                <button class="version-btn" onclick="changeBibleVersion('cev')">CEV</button>
                                <button class="version-btn" onclick="changeBibleVersion('nasb')">NASB</button>
                            </div>
                            <div class="language-selector">
                                <label>Language:</label>
                                <button class="language-btn active" onclick="changeVerseLanguage('english')">English</button>
                                <button class="language-btn" onclick="changeVerseLanguage('bisaya')">Bisaya</button>
                            </div>
                        </div>

                        <div class="verse-of-the-day" id="welcomeVerse">
                            Loading verse of the day...
                        </div>
                        <div class="verse-reference" id="welcomeVerseReference">Loading...</div>
                        <div class="verse-language" id="welcomeVerseLanguage">Language: English</div>
                    </div>
                </div>

                <!-- Regular Welcome (shown for returning verified users) -->
                <div id="regularWelcomeContainer" style="display: none;">
                    <div class="welcome-message">
                        <h2><i class="fas fa-hand-sparkles"></i> Welcome back, <span id="welcomeName">Frank</span>!</h2>
                        <p>Here's what's happening in your ministry today.</p>
                    </div>

                    <!-- Bible Verse of the Day -->
                    <div class="bible-verse-container">
                        <!-- Version Selector -->
                        <div class="verse-controls">
                            <div class="version-selector">
                                <label>Version:</label>
                                <button class="version-btn active" onclick="changeBibleVersion('niv')">NIV</button>
                                <button class="version-btn" onclick="changeBibleVersion('kjv')">KJV</button>
                                <button class="version-btn" onclick="changeBibleVersion('nkjv')">NKJV</button>
                                <button class="version-btn" onclick="changeBibleVersion('cev')">CEV</button>
                                <button class="version-btn" onclick="changeBibleVersion('nasb')">NASB</button>
                            </div>
                            <div class="language-selector">
                                <label>Language:</label>
                                <button class="language-btn active" onclick="changeVerseLanguage('english')">English</button>
                                <button class="language-btn" onclick="changeVerseLanguage('bisaya')">Bisaya</button>
                            </div>
                        </div>

                        <div class="verse-of-the-day" id="dailyVerse">
                            Loading verse of the day...
                        </div>
                        <div class="verse-reference" id="verseReference">Loading...</div>
                        <div class="verse-language" id="verseLanguage">Language: English</div>
                    </div>


                    <!-- Church Logo and Background Section -->
                    <div class="church-logo-section">
                        <div class="church-logo-large"></div>
                        <div class="church-background">
                            <h2>Joyful Sound Church International</h2>
                            <p>A vibrant community of believers dedicated to spreading God's love through worship, fellowship, and service. 
                            We are committed to ministering to hearts and transforming lives through the power of the Holy Spirit.</p>
                        </div>
                    </div>
                    <div class="content-layout">
                        <!-- Pastors Section -->
                        <div class="pastors-section">
                            <h2><i class="fas fa-crown"></i> Our Spiritual Leaders</h2>
                            <div class="pastors-grid">
                                <div class="pastor-card">
                                    <div class="pastor-photo" style="background-image: url('/assets/dr-weldon-pior.png'); background-color: #f8f9fa;"></div>
                                    <div class="pastor-name">Dr. Weldon Pior</div>
                                    <div class="pastor-title">Senior Pastor</div>
                                </div>
                                <div class="pastor-card">
                                    <div class="pastor-photo" style="background-image: url('assets/dr-dorothy-pior.png'); background-color: #f8f9fa;"></div>
                                    <div class="pastor-name">Dr. Dorothy Pior</div>
                                    <div class="pastor-title">Senior Pastor</div>
                                </div>
                                <div class="pastor-card">
                                    <div class="pastor-photo" style="background-image: url('assets/ptr-gracelyn-gambe.png'); background-color: #f8f9fa;"></div>
                                    <div class="pastor-name">Ptr. Gracelyn Gambe</div>
                                    <div class="pastor-title">Associate Pastor</div>
                                </div>
                                <div class="pastor-card">
                                    <div class="pastor-photo" style="background-image: url('assets/ptr-eldan-gambe.png'); background-color: #f8f9fa;"></div>
                                    <div class="pastor-name">Ptr. Eldan Gambe</div>
                                    <div class="pastor-title">Associate Pastor</div>
                                </div>
                                <div class="pastor-card">
                                    <div class="pastor-photo" style="background-image: url('assets/ptr-psalm-gambe.png'); background-color: #f8f9fa;"></div>
                                    <div class="pastor-name">Ptr. Psalm Gambe</div>
                                    <div class="pastor-title">Youth Pastor</div>
                                </div>
                            </div>
                            <div class="pastors-description">
                                <p>Our dedicated pastors serve with compassion and commitment, guiding our congregation with wisdom and love. They are devoted to nurturing spiritual growth and building a strong community of faith.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Church Family Section -->
                    <div class="church-family-section">
                        <h2><i class="fas fa-users"></i> Our Church Family Gatherings</h2>
                        <p style="color: #6c757d; margin-bottom: 20px;">Celebrating fellowship and community through our joyful gatherings and events</p>
                        
                        <div class="family-gathering-grid">
                            <div class="gathering-card">
                                <div class="gathering-photo" style="background-image: url('assets/worship-service.jpg'); background-color: #e9ecef;"></div>
                                <div class="gathering-info">
                                    <div class="gathering-title">Sunday Worship Service</div>
                                    <div class="gathering-description">Our church family united in powerful worship and biblical teaching every Sunday</div>
                                </div>
                            </div>
                            
                            <div class="gathering-card">
                                <div class="gathering-photo" style="background-image: url('assets/pastor-appreciation.jpg'); background-color: #e9ecef;"></div>
                                <div class="gathering-info">
                                    <div class="gathering-title">Pastor Appreciation</div>
                                    <div class="gathering-description">Honoring and celebrating our dedicated pastors for their faithful service and leadership</div>
                                </div>
                            </div>
                            
                            <div class="gathering-card">
                                <div class="gathering-photo" style="background-image: url('assets/youth-event.jpg'); background-color: #e9ecef;"></div>
                                <div class="gathering-info">
                                    <div class="gathering-title">Youth Ministry Event</div>
                                    <div class="gathering-description">Dynamic youth gatherings filled with fun, fellowship, and spiritual growth</div>
                                </div>
                            </div>
                            
                            <div class="gathering-card">
                                <div class="gathering-photo" style="background-image: url('assets/community-outreach.jpg'); background-color: #e9ecef;"></div>
                                <div class="gathering-info">
                                    <div class="gathering-title">Community Outreach</div>
                                    <div class="gathering-description">Extending God's love through practical service and evangelism in our community</div>
                                </div>
                            </div>
                            
                            <div class="gathering-card">
                                <div class="gathering-photo" style="background-image: url('assets/christian-leadership-conference.jpg'); background-color: #e9ecef;"></div>
                                <div class="gathering-info">
                                    <div class="gathering-title">Christian Leadership Conference</div>
                                    <div class="gathering-description">Equipping and empowering leaders for effective ministry and spiritual guidance</div>
                                </div>
                            </div>
                            
                            <div class="gathering-card">
                                <div class="gathering-photo" style="background-image: url('assets/baptism-service.jpg'); background-color: #e9ecef;"></div>
                                <div class="gathering-info">
                                    <div class="gathering-title">Baptism Service</div>
                                    <div class="gathering-description">Powerful moments of public declaration of faith through water baptism</div>
                                </div>
                            </div>

                            <div class="gathering-card">
                                <div class="gathering-photo" style="background-image: url('assets/friday-bible-study.jpg'); background-color: #e9ecef;"></div>
                                <div class="gathering-info">
                                    <div class="gathering-title">Friday Bible Study</div>
                                    <div class="gathering-description">In-depth Bible study and discussion for spiritual growth and deeper understanding</div>
                                </div>
                            </div>

                            <div class="gathering-card">
                                <div class="gathering-photo" style="background-image: url('assets/isom-training.jpg'); background-color: #e9ecef;"></div>
                                <div class="gathering-info">
                                    <div class="gathering-title">ISOM</div>
                                    <div class="gathering-description">International School of Ministry training for leadership development and ministry equipping</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Unverified User Content -->
                <div id="unverifiedContent" style="display: none;">
                    <div class="welcome-message">
                        <h2><i class="fas fa-hand-sparkles"></i> Welcome, <span id="unverifiedName">Frank</span>!</h2>
                        <p>Your account is currently pending verification. While you wait, here's an inspirational message for you.</p>
                    </div>

                    <div class="bible-verse-container">
                        <div class="verse-of-the-day">
                            "For I know the plans I have for you," declares the Lord, "plans to prosper you and not to harm you, plans to give you hope and a future."
                        </div>
                        <div class="verse-reference">Jeremiah 29:11</div>
                        <div class="verse-explanation">
                            God has wonderful plans for your ministry journey. While you wait for verification, trust in His timing and purpose for your life.
                        </div>
                    </div>

                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-hourglass-half"></i></div>
                            <div class="stat-value">Pending</div>
                            <div class="stat-label">Account Status</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-tasks"></i></div>
                            <div class="stat-value">1</div>
                            <div class="stat-label">Step Remaining</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-clock"></i></div>
                            <div class="stat-value">24-48h</div>
                            <div class="stat-label">Verification Time</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-phone-alt"></i></div>
                            <div class="stat-value">Contact</div>
                            <div class="stat-label">Administrator</div>
                        </div>
                    </div>

                    <div style="background: white; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow); margin-top: 20px;">
                        <h3 class="section-title"><i class="fas fa-info-circle"></i> What to Expect After Verification</h3>
                        <ul style="list-style-type: none; padding: 0;">
                            <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                <i class="fas fa-check" style="color: var(--primary); margin-right: 10px;"></i>
                                Full access to your ministry dashboard
                            </li>
                            <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                <i class="fas fa-check" style="color: var(--primary); margin-right: 10px;"></i>
                                Ability to view and manage schedules
                            </li>
                            <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                <i class="fas fa-check" style="color: var(--primary); margin-right: 10px;"></i>
                                Access to ministry resources and materials
                            </li>
                            <li style="padding: 8px 0;">
                                <i class="fas fa-check" style="color: var(--primary); margin-right: 10px;"></i>
                                Communication with your ministry team
                            </li>
                        </ul>
                    </div>
                </div>
            </section>

           <!-- Weekly Schedule Section -->
            <section id="weekly-schedule" class="content-section">
                <h2 class="section-title"><i class="fas fa-calendar-alt"></i> Weekly Schedule</h2>
                
                <div class="schedule-container">
                    <div class="schedule-header">
                        <div class="week-navigation">
                            <button class="nav-btn" onclick="changeScheduleMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                            <h3 id="currentScheduleMonth">November 2025</h3>
                            <button class="nav-btn" onclick="changeScheduleMonth(1)"><i class="fas fa-chevron-right"></i></button>
                        </div>
                        <div class="schedule-actions">
                            <div class="calendar-type-selector">
                                <button class="action-btn active" id="schedulePawBtn" onclick="switchScheduleCalendar('paw')">
                                    <i class="fas fa-music"></i> PAW
                                </button>
                                <button class="action-btn" id="scheduleMeetingsBtn" onclick="switchScheduleCalendar('meetings')">
                                    <i class="fas fa-users"></i> MEETINGS
                                </button>
                            </div>
                            <button class="action-btn" onclick="refreshScheduleData()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <!-- Loading Indicator -->
                    <div id="scheduleCalendarLoading" style="text-align: center; padding: 40px; display: none;">
                        <div style="font-size: 3rem; color: var(--primary); margin-bottom: 20px;">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                        <h3 style="color: var(--primary);">Loading Schedule Data...</h3>
                        <p style="color: #6c757d;">Please wait while we fetch the latest schedule information.</p>
                    </div>
                    
                    <!-- Error Message -->
                    <div id="scheduleCalendarError" style="text-align: center; padding: 40px; display: none;">
                        <div style="font-size: 3rem; color: var(--danger); margin-bottom: 20px;">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3 style="color: var(--danger);">Failed to Load Schedule</h3>
                        <p style="color: #6c757d; margin-bottom: 20px;">Unable to load schedule data. Please try again later.</p>
                        <button class="btn-primary" onclick="refreshScheduleData()">
                            <i class="fas fa-redo"></i> Try Again
                        </button>
                    </div>
                    
                    <!-- Schedule Calendar Container -->
                    <div class="calendar-container" id="scheduleCalendarContainer">
                        <!-- Schedule Calendar will be dynamically generated here -->
                    </div>
                    
                    <!-- Upcoming Schedule Cards -->
                    <div class="upcoming-schedule-cards" id="upcomingScheduleCards">
                        <!-- Schedule cards will be dynamically generated here -->
                    </div>
                    
                    <!-- Schedule History Cards -->
                    <div class="schedule-history-section" id="scheduleHistorySection">
                        <h3 class="schedule-history-title"><i class="fas fa-history"></i> Schedule History</h3>
                        <div class="schedule-history-cards" id="scheduleHistoryCards">
                            <!-- History cards will be dynamically generated here -->
                        </div>
                    </div>
                    
                    <!-- Schedule Details Modal -->
                    <div id="scheduleModal" class="schedule-modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3 id="modalDate">Schedule Details</h3>
                                <button class="close-btn" onclick="closeScheduleModal()">&times;</button>
                            </div>
                            <div class="modal-body" id="modalBody">
                                <!-- Schedule details will be populated here -->
                            </div>
                            
                            <!-- YouTube Player with Lyrics -->
                            <div id="youtubePlayerContainer" style="display: none; margin-top: 20px; border-top: 2px solid #e0e0e0; padding-top: 20px;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                    <!-- YouTube Player -->
                                    <div>
                                        <h4 style="margin-bottom: 10px; color: var(--primary); font-weight: 600;">
                                            <i class="fab fa-youtube"></i> Song Preview
                                        </h4>
                                        <div id="youtubePlayer" style="width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 8px; overflow: hidden;">
                                            <!-- YouTube iframe will be inserted here -->
                                        </div>
                                    </div>
                                    
                                    <!-- Lyrics Display -->
                                    <div>
                                        <h4 style="margin-bottom: 10px; color: var(--primary); font-weight: 600;">
                                            <i class="fas fa-music"></i> Song Lyrics
                                        </h4>
                                        <div id="lyricsContainer" style="
                                            background: #f8f9fa;
                                            border-radius: 8px;
                                            padding: 15px;
                                            height: 100%;
                                            max-height: 300px;
                                            overflow-y: auto;
                                            border-left: 4px solid var(--primary);
                                            font-size: 0.9rem;
                                            line-height: 1.6;
                                            color: #333;
                                        ">
                                            <div style="text-align: center; color: #999;">
                                                <i class="fas fa-music" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                                                Loading lyrics...
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Attendance Section -->
            <section id="attendance" class="content-section">
                <h2 class="section-title"><i class="fas fa-check-circle"></i> Attendance Record</h2>
                
                
            </section>

            <!-- Announcements Section -->
            <section id="announcements" class="content-section">
                <h2 class="section-title"><i class="fas fa-bullhorn"></i> Announcements</h2>
                
                <div class="announcements-container">
                    
                </div>

                <!-- Birthday Today Section -->
                <div class="birthday-today-section" id="birthdayTodaySection" style="margin-top: 30px;">
                    <div class="birthday-header">
                        <h2><i class="fas fa-birthday-cake"></i> Birthday Celebrants Today</h2>
                        <div class="birthday-greeting-box" id="birthdayGreetingBox"></div>
                    </div>
                    <div class="birthday-celebrants" id="birthdayTodayCelerants">
                        <!-- Today's birthday celebrants will be displayed here -->
                    </div>
                </div>
            </section>

             <!-- Praise and Worship Section -->
            <section id="praise-worship" class="content-section">
                <h2 class="section-title"><i class="fas fa-music"></i> Praise and Worship Ministry</h2>
                
                <div class="ministry-welcome">
                    <h3>Welcome to the Praise and Worship Team!</h3>
                    <p>Your role is vital in creating an atmosphere where people can encounter God through worship.</p>
                </div>
                
                <div class="ministry-stats">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-microphone-alt"></i></div>
                        <div class="stat-value">8</div>
                        <div class="stat-label">Vocalists</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-guitar"></i></div>
                        <div class="stat-value">6</div>
                        <div class="stat-label">Musicians</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-calendar-alt"></i></div>
                        <div class="stat-value">4</div>
                        <div class="stat-label">Upcoming Sets</div>
                    </div>
                </div>
                
                <div class="worship-sets">
                    <h3>This Week's Worship Sets</h3>
                    <div class="set-card">
                        <div class="set-header">
                            <div class="set-date">Sunday, Nov 17</div>
                            <div class="set-team">Team A</div>
                        </div>
                        <div class="set-songs">
                            <div class="song-item">
                                <span class="song-title">Goodness of God</span>
                                <span class="song-key">Key: G</span>
                            </div>
                            <div class="song-item">
                                <span class="song-title">What a Beautiful Name</span>
                                <span class="song-key">Key: D</span>
                            </div>
                            <div class="song-item">
                                <span class="song-title">Reckless Love</span>
                                <span class="song-key">Key: C</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Media Ministry Section -->
            <section id="media" class="content-section">
                <h2 class="section-title"><i class="fas fa-film"></i> Media Ministry</h2>
                
                <div class="ministry-welcome">
                    <h3>Welcome to the Media Team!</h3>
                    <p>Your technical skills help spread the gospel through various media platforms.</p>
                </div>
                
                <div class="ministry-stats">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-video"></i></div>
                        <div class="stat-value">4</div>
                        <div class="stat-label">Camera Operators</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-volume-up"></i></div>
                        <div class="stat-value">3</div>
                        <div class="stat-label">Sound Engineers</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-laptop"></i></div>
                        <div class="stat-value">2</div>
                        <div class="stat-label">Livestream Techs</div>
                    </div>
                </div>
                
                <div class="media-tasks">
                    <h3>This Week's Assignments</h3>
                    <div class="task-list">
                        <div class="task-item">
                            <div class="task-info">
                                <div class="task-title">Sunday Service Coverage</div>
                                <div class="task-details">Camera 1: John | Camera 2: Sarah | Sound: Michael</div>
                            </div>
                            <div class="task-status confirmed">Confirmed</div>
                        </div>
                        
                        <div class="task-item">
                            <div class="task-info">
                                <div class="task-title">Equipment Maintenance</div>
                                <div class="task-details">Check all mics and cables</div>
                            </div>
                            <div class="task-status pending">Pending</div>
                        </div>
                        
                        <div class="task-item">
                            <div class="task-info">
                                <div class="task-title">Social Media Content</div>
                                <div class="task-details">Prepare clips from last sermon</div>
                            </div>
                            <div class="task-status in-progress">In Progress</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Dancers Ministry Section -->
            <section id="dancers" class="content-section">
                <h2 class="section-title"><i class="fas fa-user-friends"></i> Dancers Ministry</h2>
                
                <div class="ministry-welcome">
                    <h3>Welcome to the Dance Team!</h3>
                    <p>Your movements help tell the story of God's love and grace.</p>
                </div>
                
                <div class="ministry-stats">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-value">12</div>
                        <div class="stat-label">Dancers</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-user-tie"></i></div>
                        <div class="stat-value">3</div>
                        <div class="stat-label">Choreographers</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-calendar-alt"></i></div>
                        <div class="stat-value">2</div>
                        <div class="stat-label">Upcoming Performances</div>
                    </div>
                </div>
                
                <div class="rehearsal-schedule">
                    <h3>Rehearsal Schedule</h3>
                    <div class="rehearsal-card">
                        <div class="rehearsal-date">Tuesday, Nov 19</div>
                        <div class="rehearsal-time">6:00 PM - 8:00 PM</div>
                        <div class="rehearsal-location">Fellowship Hall</div>
                        <div class="rehearsal-focus">Christmas Program Routine</div>
                    </div>
                    
                    <div class="rehearsal-card">
                        <div class="rehearsal-date">Thursday, Nov 21</div>
                        <div class="rehearsal-time">6:00 PM - 8:00 PM</div>
                        <div class="rehearsal-location">Fellowship Hall</div>
                        <div class="rehearsal-focus">Sunday Special</div>
                    </div>
                </div>
            </section>

            <!-- Ashers Ministry Section -->
            <section id="ashers" class="content-section">
                <h2 class="section-title"><i class="fas fa-door-open"></i> Ashers Ministry</h2>
                
                <div class="ministry-welcome">
                    <h3>Welcome to the Ashers Team!</h3>
                    <p>Your welcoming presence and service create a warm environment for all who enter God's house.</p>
                </div>
                
                <div class="ministry-stats">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-user-friends"></i></div>
                        <div class="stat-value">15</div>
                        <div class="stat-label">Team Members</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-door-closed"></i></div>
                        <div class="stat-value">5</div>
                        <div class="stat-label">Entrances Covered</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-clipboard-list"></i></div>
                        <div class="stat-value">2</div>
                        <div class="stat-label">Teams This Week</div>
                    </div>
                </div>
                
                <div class="usher-assignments">
                    <h3>This Sunday's Assignments</h3>
                    <div class="assignment-card">
                        <div class="assignment-location">Main Entrance</div>
                        <div class="assignment-team">
                            <span class="team-member">James Wilson</span>
                            <span class="team-member">Lisa Chen</span>
                            <span class="team-member">Robert Johnson</span>
                        </div>
                    </div>
                    
                    <div class="assignment-card">
                        <div class="assignment-location">Side Entrance</div>
                        <div class="assignment-team">
                            <span class="team-member">Maria Garcia</span>
                            <span class="team-member">David Brown</span>
                        </div>
                    </div>
                    
                    <div class="assignment-card">
                        <div class="assignment-location">Welcome Desk</div>
                        <div class="assignment-team">
                            <span class="team-member">Sarah Williams</span>
                            <span class="team-member">Thomas Anderson</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Create Lineup Section with Enhanced Calendar -->
            <section id="create-lineup" class="content-section">
                <h2 class="section-title"><i class="fas fa-plus-circle"></i> Create Worship Lineup</h2>
                
                <div class="lineup-container">
                    <!-- Date Selection -->
                    <div class="form-section">
                        <h3><i class="fas fa-calendar-day"></i> Select Schedule Date</h3>
                        <div class="form-fields">
                            <div class="form-group date-input-container">
                                <label for="scheduleDate">Schedule Day *</label>
                                <input type="text" id="scheduleDate" class="form-control" placeholder="Click calendar to select date" readonly required>
                                <i class="fas fa-calendar-alt calendar-icon" onclick="openCalendarModal()"></i>
                                <small class="form-text">Select the date for this worship lineup</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="practiceDate">Practice Day *</label>
                                <input type="date" id="practiceDate" class="form-control" required>
                                <small class="form-text">Select practice date (Saturdays or Sundays only)</small>
                            </div>
                        </div>
                        
                        <!-- Schedule Details (shown when a booked date is selected) -->
                        <div class="schedule-details" id="scheduleDetails">
                            <h4 class="schedule-details-title"><i class="fas fa-info-circle"></i> Existing Schedule Details</h4>
                            <div class="schedule-info-grid">
                                <div class="schedule-info-item">
                                    <div class="schedule-info-label">Song Leader</div>
                                    <div class="schedule-info-value" id="existingSongLeader">-</div>
                                </div>
                                <div class="schedule-info-item">
                                    <div class="schedule-info-label">Backup Singers</div>
                                    <div class="schedule-info-value" id="existingBackupSingers">-</div>
                                </div>
                            </div>
                            <p style="color: var(--danger); font-weight: 600; margin: 0;">
                                <i class="fas fa-exclamation-triangle"></i> This date is already booked. Please select a different date.
                            </p>
                        </div>
                    </div>

                    <!-- Team Selection -->
                    <div class="form-section">
                        <h3><i class="fas fa-users"></i> Team Members</h3>
                        <div class="form-group">
                            <label for="songLeader">Song Leader *</label>
                            <select id="songLeader" class="form-control" required>
                                <option value="">Select Song Leader</option>
                                <option value="Psalm Gambe">Psalm Gambe</option>
                                <option value="Geneveve España">Geneveve España</option>
                                <option value="Cathy Martinez">Cathy Martinez</option>
                                <option value="Tiffany Dañal">Tiffany Dañal</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Backup Singers (Max 5)</label>
                            <div id="backupContainer">
                                <div class="backup-row">
                                    <select class="form-control backup-select" onchange="updateBackupOptions()">
                                        <option value="">Select Backup 1</option>
                                        <!-- Options will be populated dynamically -->
                                    </select>
                                    <button type="button" class="btn-remove-backup" onclick="removeBackupField(this)" disabled>
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <button type="button" class="btn-secondary" onclick="addBackupField()" id="addBackupBtn" style="margin-top: 10px;">
                                <i class="fas fa-plus"></i> Add Backup
                            </button>
                        </div>
                    </div>

                    <!-- Slow Songs Section -->
                    <div class="form-section">
                        <h3><i class="fas fa-music"></i> Slow Songs (Max 5)</h3>
                        <div id="slowSongsContainer">
                            <div class="song-row slow-song">
                                <div class="form-group">
                                    <label>Slow Song 1 Title *</label>
                                    <input type="text" class="form-control slow-title" placeholder="Enter song title" required>
                                </div>
                                <div class="form-group">
                                    <label>YouTube Link *</label>
                                    <input type="url" class="form-control slow-link" placeholder="https://www.youtube.com/watch?v=..." required>
                                    <div class="youtube-preview"></div>
                                </div>
                                <div class="form-group">
                                    <label>Lyrics (Optional)</label>
                                    <textarea class="form-control slow-lyrics preserve-formatting" placeholder="Enter song lyrics..." onpaste="handleLyricsPaste(event)"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Instructions (Optional)</label>
                                    <textarea class="form-control slow-instructions" placeholder="Any special instructions..."></textarea>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn-secondary" onclick="addSlowSong()" id="addSlowSongBtn" style="margin-top: 10px;">
                            <i class="fas fa-plus"></i> Add Slow Song
                        </button>
                    </div>

                    <!-- Fast Songs Section -->
                    <div class="form-section">
                        <h3><i class="fas fa-bolt"></i> Fast Songs (Max 5)</h3>
                        <div id="fastSongsContainer">
                            <div class="song-row fast-song">
                                <div class="form-group">
                                    <label>Fast Song 1 Title *</label>
                                    <input type="text" class="form-control fast-title" placeholder="Enter song title" required>
                                </div>
                                <div class="form-group">
                                    <label>YouTube Link *</label>
                                    <input type="url" class="form-control fast-link" placeholder="https://www.youtube.com/watch?v=..." required>
                                    <div class="youtube-preview"></div>
                                </div>
                                <div class="form-group">
                                    <label>Lyrics (Optional)</label>
                                    <textarea class="form-control fast-lyrics preserve-formatting" placeholder="Enter song lyrics..." onpaste="handleLyricsPaste(event)"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Instructions (Optional)</label>
                                    <textarea class="form-control fast-instructions" placeholder="Any special instructions..."></textarea>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn-secondary" onclick="addFastSong()" id="addFastSongBtn" style="margin-top: 10px;">
                            <i class="fas fa-plus"></i> Add Fast Song
                        </button>
                    </div>

                    <!-- Submit Button -->
                    <div class="form-actions" style="margin-top: 30px;">
                        <button type="button" class="btn-secondary" onclick="resetLineupForm()">Reset Form</button>
                        <button type="button" class="btn-primary" onclick="submitLineup()" id="submitLineupBtn">
                            <i class="fas fa-paper-plane"></i> Submit Lineup for Approval
                        </button>
                    </div>
                </div>
            </section>

            <!-- My Profile Section - FIXED -->
            <section id="my-profile" class="content-section">
                <div class="profile-container">
                    <h2 class="section-title"><i class="fas fa-user-circle"></i> My Profile</h2>
                    
                    <!-- Profile Header -->
                    <div class="profile-header">
                        <div class="profile-avatar">
                            <div class="avatar-large" id="profileAvatar">FG</div>
                            <div class="avatar-status">
                                <div class="status-circle verified" id="profileStatus"><div class="status-tooltip">Verified</div></div>
                            </div>
                        </div>
                        <div class="profile-info">
                            <h3 id="profileName">Frank Gomez</h3>
                            <p id="profileMinistry">Media</p>
                            <p id="profileMemberId">Member ID: 872879</p>
                        </div>
                    </div>

                    <!-- Profile Tabs Navigation -->
                    <div class="profile-tabs">
                        <button class="tab-btn active" onclick="openProfileTab('personal-info')">
                            <i class="fas fa-user"></i> Personal Information
                        </button>
                        <button class="tab-btn" onclick="openProfileTab('change-password')">
                            <i class="fas fa-lock"></i> Change Password
                        </button>
                        <button class="tab-btn" onclick="openProfileTab('preferences')">
                            <i class="fas fa-sliders-h"></i> Preferences
                        </button>
                    </div>

                    <!-- Personal Information Tab Content -->
                    <div id="personal-info" class="profile-tab-content active">
                        <div class="profile-form">
                            <div class="form-section">
                                <h3><i class="fas fa-info-circle"></i> Personal Details</h3>
                                
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="firstname">First Name</label>
                                            <input type="text" id="firstname" class="form-control" placeholder="First Name">
                                        </div>
                                    </div>

                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="lastname">Last Name</label>
                                            <input type="text" id="lastname" class="form-control" placeholder="Last Name">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3><i class="fas fa-shield-alt"></i> Account Information</h3>
                                
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="username">Username</label>
                                            <input type="text" id="username" class="form-control" placeholder="Username" disabled="">
                                        </div>
                                    </div>

                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="memberId">Member ID</label>
                                            <input type="text" id="memberId" class="form-control" placeholder="Member ID" disabled="">
                                        </div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-column full-width">
                                        <div class="form-group">
                                            <label for="status">Account Status</label>
                                            <input type="text" id="status" class="form-control" placeholder="Account Status" disabled="">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3><i class="fas fa-church"></i> Ministry Information</h3>
                                
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="ministry">Ministry</label>
                                            <input type="text" id="ministry" class="form-control" placeholder="Ministry" disabled="">
                                        </div>
                                    </div>

                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="birthdate">Birthdate</label>
                                            <input type="text" id="birthdate" class="form-control" placeholder="MM/DD/YYYY" disabled="">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Form Actions -->
                            <div class="form-actions">
                                <button type="button" class="btn-secondary" onclick="resetProfileForm()">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                                <button type="button" class="btn-primary" onclick="saveProfileChanges()">
                                    <i class="fas fa-save"></i> Save Changes
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Change Password Tab Content -->
                    <div id="change-password" class="profile-tab-content">
                        <div class="password-form">
                            <div class="form-section">
                                <h3><i class="fas fa-key"></i> Update Your Password</h3>
                                
                                <div class="form-row">
                                    <div class="form-column full-width">
                                        <div class="form-group">
                                            <label for="currentPassword">Current Password</label>
                                            <div style="position: relative;">
                                                <input type="password" id="currentPassword" class="form-control" placeholder="Enter current password">
                                                <div class="password-toggle" onclick="togglePasswordVisibility('currentPassword')">
                                                    <i class="fas fa-eye"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-column full-width">
                                        <div class="form-group">
                                            <label for="newPassword">New Password</label>
                                            <div style="position: relative;">
                                                <input type="password" id="newPassword" class="form-control" placeholder="Enter new password" oninput="checkPasswordStrength(this.value)">
                                                <div class="password-toggle" onclick="togglePasswordVisibility('newPassword')">
                                                    <i class="fas fa-eye"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-column full-width">
                                        <div class="form-group">
                                            <label for="confirmPassword">Confirm New Password</label>
                                            <div style="position: relative;">
                                                <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm new password" oninput="validatePasswordMatch(document.getElementById('newPassword').value, this.value)">
                                                <div class="password-toggle" onclick="togglePasswordVisibility('confirmPassword')">
                                                    <i class="fas fa-eye"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Password Strength Indicator -->
                            <div class="form-section">
                                <h3><i class="fas fa-chart-bar"></i> Password Strength</h3>
                                
                                <div class="password-strength" id="passwordStrength">
                                    <div class="strength-bar">
                                        <div class="strength-fill" id="strengthFill"></div>
                                    </div>
                                    <div class="strength-text" id="strengthText">Password strength: Weak</div>
                                </div>

                                <div class="password-requirements">
                                    <p><strong>Password Requirements:</strong></p>
                                    <ul>
                                        <li id="reqLength"><i class="fas fa-times"></i> At least 8 characters</li>
                                        <li id="reqUppercase"><i class="fas fa-times"></i> One uppercase letter (A-Z)</li>
                                        <li id="reqLowercase"><i class="fas fa-times"></i> One lowercase letter (a-z)</li>
                                        <li id="reqNumber"><i class="fas fa-times"></i> One number (0-9)</li>
                                        <li id="reqSpecial"><i class="fas fa-times"></i> One special character (!@#$%^&amp;*)</li>
                                    </ul>
                                </div>
                            </div>

                            <!-- Form Actions -->
                            <div class="form-actions">
                                <button type="button" class="btn-secondary" onclick="resetPasswordForm()">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                                <button type="button" class="btn-primary" onclick="changePassword()">
                                    <i class="fas fa-lock"></i> Change Password
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Preferences Tab Content -->
                    <div id="preferences" class="profile-tab-content">
                        <div class="profile-form">
                            <div class="form-section">
                                <h3><i class="fas fa-paint-brush"></i> Appearance Settings</h3>
                                
                                <div class="settings-row">
                                    <div class="settings-label">
                                        <span class="settings-label-title">Dark Mode</span>
                                        <span class="settings-label-desc">Enable dark theme for easier viewing at night</span>
                                    </div>
                                    <label class="settings-toggle">
                                        <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3><i class="fas fa-comments"></i> Chatbot Settings</h3>
                                
                                <div class="settings-row">
                                    <div class="settings-label">
                                        <span class="settings-label-title">Enable Chatbot</span>
                                        <span class="settings-label-desc">Enable or disable the floating spiritual assistant chatbot</span>
                                    </div>
                                    <label class="settings-toggle">
                                        <input type="checkbox" id="chatbotToggle" onchange="toggleChatbot()" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-section" style="background: #f0f8ff; border-left: 4px solid #4169E1;">
                                <p style="font-size: 0.9rem; color: #333; margin: 0;">
                                    <i class="fas fa-info-circle" style="color: #4169E1; margin-right: 8px;"></i>
                                    Changes are saved automatically to your account preferences.
                                </p>
                            </div>

                            <style>
                                body.dark-mode .form-section[style*="#f0f8ff"] {
                                    background: #1a3a4a !important;
                                    border-left-color: #6a9fb0 !important;
                                }
                                
                                body.dark-mode .form-section[style*="#f0f8ff"] p {
                                    color: #b0d4d4 !important;
                                }
                                
                                body.dark-mode .form-section[style*="#f0f8ff"] i {
                                    color: #6a9fb0 !important;
                                }
                            </style>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Spiritual Assistant Section -->
            <!-- Bible Reader Section -->
            <section id="bible-reader" class="content-section">
                <h2 class="section-title"><i class="fas fa-book"></i> Bible Reader</h2>
                
                <div class="bible-reader-container">
                    <!-- Bible Version and Book Selection -->
                    <div class="bible-controls">
                        <div class="bible-version-selector">
                            <label>Bible Version:</label>
                            <select id="bibleVersion" onchange="changeBibleReaderVersion(this.value)">
                                <option value="niv">NIV - New International Version</option>
                                <option value="kjv">KJV - King James Version</option>
                                <option value="nkjv">NKJV - New King James Version</option>
                                <option value="nasb">NASB - New American Standard Bible</option>
                                <option value="cev">CEV - Contemporary English Version</option>
                            </select>
                        </div>
                        
                        <div class="bible-book-selector">
                            <label>Book:</label>
                            <select id="bibleBook" onchange="loadBibleChapter(this.value)">
                                <option value="">Select a Book...</option>
                                <!-- Old Testament -->
                                <optgroup label="Old Testament">
                                    <option value="Genesis">Genesis</option>
                                    <option value="Exodus">Exodus</option>
                                    <option value="Leviticus">Leviticus</option>
                                    <option value="Numbers">Numbers</option>
                                    <option value="Deuteronomy">Deuteronomy</option>
                                    <option value="Joshua">Joshua</option>
                                    <option value="Judges">Judges</option>
                                    <option value="Ruth">Ruth</option>
                                    <option value="1 Samuel">1 Samuel</option>
                                    <option value="2 Samuel">2 Samuel</option>
                                    <option value="1 Kings">1 Kings</option>
                                    <option value="2 Kings">2 Kings</option>
                                    <option value="1 Chronicles">1 Chronicles</option>
                                    <option value="2 Chronicles">2 Chronicles</option>
                                    <option value="Ezra">Ezra</option>
                                    <option value="Nehemiah">Nehemiah</option>
                                    <option value="Esther">Esther</option>
                                    <option value="Job">Job</option>
                                    <option value="Psalm">Psalm</option>
                                    <option value="Proverbs">Proverbs</option>
                                    <option value="Ecclesiastes">Ecclesiastes</option>
                                    <option value="Song of Solomon">Song of Solomon</option>
                                    <option value="Isaiah">Isaiah</option>
                                    <option value="Jeremiah">Jeremiah</option>
                                    <option value="Lamentations">Lamentations</option>
                                    <option value="Ezekiel">Ezekiel</option>
                                    <option value="Daniel">Daniel</option>
                                    <option value="Hosea">Hosea</option>
                                    <option value="Joel">Joel</option>
                                    <option value="Amos">Amos</option>
                                    <option value="Obadiah">Obadiah</option>
                                    <option value="Jonah">Jonah</option>
                                    <option value="Micah">Micah</option>
                                    <option value="Nahum">Nahum</option>
                                    <option value="Habakkuk">Habakkuk</option>
                                    <option value="Zephaniah">Zephaniah</option>
                                    <option value="Haggai">Haggai</option>
                                    <option value="Zechariah">Zechariah</option>
                                    <option value="Malachi">Malachi</option>
                                </optgroup>
                                <!-- New Testament -->
                                <optgroup label="New Testament">
                                    <option value="Matthew">Matthew</option>
                                    <option value="Mark">Mark</option>
                                    <option value="Luke">Luke</option>
                                    <option value="John">John</option>
                                    <option value="Acts">Acts</option>
                                    <option value="Romans">Romans</option>
                                    <option value="1 Corinthians">1 Corinthians</option>
                                    <option value="2 Corinthians">2 Corinthians</option>
                                    <option value="Galatians">Galatians</option>
                                    <option value="Ephesians">Ephesians</option>
                                    <option value="Philippians">Philippians</option>
                                    <option value="Colossians">Colossians</option>
                                    <option value="1 Thessalonians">1 Thessalonians</option>
                                    <option value="2 Thessalonians">2 Thessalonians</option>
                                    <option value="1 Timothy">1 Timothy</option>
                                    <option value="2 Timothy">2 Timothy</option>
                                    <option value="Titus">Titus</option>
                                    <option value="Philemon">Philemon</option>
                                    <option value="Hebrews">Hebrews</option>
                                    <option value="James">James</option>
                                    <option value="1 Peter">1 Peter</option>
                                    <option value="2 Peter">2 Peter</option>
                                    <option value="1 John">1 John</option>
                                    <option value="2 John">2 John</option>
                                    <option value="3 John">3 John</option>
                                    <option value="Jude">Jude</option>
                                    <option value="Revelation">Revelation</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <div class="bible-chapter-selector">
                            <label>Chapter:</label>
                            <select id="bibleChapter" onchange="loadBibleVerse()">
                                <option value="">Select Chapter...</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Bible Content Display -->
                    <div class="bible-content">
                        <div class="bible-header">
                            <h3 id="bibleTitle">Select a Book to Read</h3>
                            <p id="bibleVersion" class="bible-version-label"></p>
                        </div>
                        
                        <div class="bible-text" id="bibleText">
                            <p style="color: #999; text-align: center; padding: 40px 20px;">
                                <i class="fas fa-book-open"></i><br>
                                Select a book and chapter to start reading.
                            </p>
                        </div>
                    </div>
                    
                    <!-- AI Assistant for Selected Text -->
                    <div class="bible-ai-assistant">
                        <h4><i class="fas fa-lightbulb"></i> Ask AI About Selection</h4>
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">Highlight any word or phrase and ask the AI assistant for insights.</p>
                        <div class="bible-selection-display" id="bibleSelectionDisplay" style="display: none;">
                            <p><strong>Selected Text:</strong></p>
                            <p id="selectedText" style="background: #f0f0f0; padding: 10px; border-radius: 6px; border-left: 3px solid var(--primary); margin-bottom: 10px;"></p>
                        </div>
                        <input type="text" id="bibleQuestion" placeholder="Ask the AI about the highlighted text..." class="bible-question-input">
                        <button onclick="askBibleQuestion()" class="bible-ask-btn"><i class="fas fa-paper-plane"></i> Ask AI</button>
                        <div class="bible-ai-response" id="bibleAIResponse" style="display: none; margin-top: 15px;"></div>
                    </div>
                </div>
            </section>

            <!-- Daily Quote Section -->
            <section id="daily-quote" class="content-section">
                <h2 class="section-title"><i class="fas fa-lightbulb"></i> Daily Quote</h2>
                
                <div class="quote-container">
                    <div class="quote-card">
                        <div class="quote-mark-open">"</div>
                        <p class="quote-text" id="quoteText">Click "Get Daily Quote" to receive an inspirational quote...</p>
                        <p class="quote-author" id="quoteAuthor">-</p>
                        <div class="quote-mark-close">"</div>
                    </div>
                    
                    <div class="quote-controls">
                        <button onclick="fetchDailyQuote()" class="btn-primary" title="Get new quote">
                            <i class="fas fa-sync-alt"></i> Get Daily Quote
                        </button>
                        <button onclick="shareQuote()" class="btn-secondary" title="Share quote">
                            <i class="fas fa-share-alt"></i> Share Quote
                        </button>
                    </div>
                    
                    <div class="quote-metadata" id="quoteMetadata" style="display: none; margin-top: 15px; font-size: 0.9rem; color: #666; text-align: center;">
                        Quote loaded at: <span id="quoteTime"></span>
                    </div>
                </div>
            </section>

            <section id="spiritual-assistant" class="content-section">
                <h2 class="section-title"><i class="fas fa-heart"></i> Spiritual Assistant</h2>
                
                <div class="disclaimer-banner">
                    <div class="disclaimer-header">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Important Disclaimer</span>
                    </div>
                    <p>I am just your AI Spiritual Assistant. God and you between is the real communication. Please seek professional pastoral counsel for serious matters and always consult your spiritual leaders.</p>
                </div>
                
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                    <div class="chat-message ai-message" id="initialGreeting">
                                <p>Hello! 👋 I'm your Spiritual Assistant. I'm here to help you reflect on life's challenges through the lens of biblical wisdom and scripture.</p>
                                <p style="margin-top: 10px; font-size: 0.95em; color: #888;">Ask me about any situation you're facing, and I'll help you find biblical guidance and relevant scriptures.</p>
                            </div>
                            <div class="message-time">Just now</div>
                        </div>
                    </div>
                    
                    <div class="chat-input-area">
                        <div class="input-group">
                            <textarea 
                                id="userInput" 
                                class="chat-input" 
                                placeholder="Ask about your situation, concerns, or questions... (e.g., 'I'm struggling with anxiety' or 'How should I handle conflict?')"
                                rows="2"></textarea>
                            <button id="sendBtn" class="send-button" onclick="sendSpiritualQuestion()" title="Send message">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <div class="input-hint">💡 Tip: Be specific about your situation for more personalized biblical guidance</div>
                    </div>
                </div>
            </section>
        </main>    
        
        <!-- Receipt Modal -->
        <div id="receiptModal" class="receipt-modal">
            <div class="receipt-container" id="receiptContent">
                <div class="receipt-header">
                    <div class="receipt-logo"></div>
                    <div class="receipt-title">JOYFUL SOUND CHURCH</div>
                    <div class="receipt-subtitle">INTERNATIONAL</div>
                </div>
                
                <div class="receipt-content">
                    <div class="receipt-section">
                        <h3 class="receipt-section-title">
                            <i class="fas fa-file-invoice"></i>
                            Praise and Worship Lineup
                        </h3>
                        <div class="receipt-info">
                            <div class="receipt-info-item">
                                <div class="receipt-label">Schedule For</div>
                                <div class="receipt-value" id="receiptScheduleDate">-</div>
                            </div>
                            <div class="receipt-info-item">
                                <div class="receipt-label">Practice Day</div>
                                <div class="receipt-value" id="receiptPracticeDate">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="receipt-section">
                        <h3 class="receipt-section-title">
                            <i class="fas fa-users"></i>
                            Team Members
                        </h3>
                        <div class="receipt-info">
                            <div class="receipt-info-item">
                                <div class="receipt-label">Song Leader</div>
                                <div class="receipt-value" id="receiptSongLeader">-</div>
                            </div>
                            <div class="receipt-info-item">
                                <div class="receipt-label">Backup Singers</div>
                                <div class="receipt-value" id="receiptBackupCount">0</div>
                            </div>
                        </div>
                        <div id="receiptBackupList">
                            <!-- Backup list will be populated here -->
                        </div>
                    </div>
                    
                    <div class="receipt-section">
                        <h3 class="receipt-section-title">
                            <i class="fas fa-bolt"></i>
                            Fast Songs
                        </h3>
                        <ul class="receipt-list" id="receiptFastSongs">
                            <!-- Fast songs will be populated here -->
                        </ul>
                    </div>
                    
                    <div class="receipt-section">
                        <h3 class="receipt-section-title">
                            <i class="fas fa-music"></i>
                            Slow Songs
                        </h3>
                        <ul class="receipt-list" id="receiptSlowSongs">
                            <!-- Slow songs will be populated here -->
                        </ul>
                    </div>
                    
                    <div class="receipt-note">
                        <div class="receipt-note-title">
                            <i class="fas fa-exclamation-circle"></i>
                            Important Note
                        </div>
                        <p class="receipt-note-text">
                            Hello everyone! To make sure we can find a replacement, please let us know ahead of time if you can't make it to a practice or on the day of the event itself. Thanks so much!
                        </p>
                    </div>
                </div>
                
                <div class="receipt-footer">
                    <div class="receipt-actions">
                        <button class="receipt-btn receipt-btn-edit" onclick="editLineup()">
                            <i class="fas fa-edit"></i>
                            Edit
                        </button>
                        <button class="receipt-btn receipt-btn-save" onclick="saveReceiptAsImage()">
                            <i class="fas fa-download"></i>
                            Save Image
                        </button>
                        <button class="receipt-btn receipt-btn-confirm" onclick="confirmAndReset()">
                            <i class="fas fa-check"></i>
                            Confirm & Reset
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar Modal for Date Selection -->
        <div id="calendarModal" class="calendar-modal">
            <div class="calendar-modal-content">
                <div class="calendar-modal-header">
                    <h3>Select Schedule Date</h3>
                    <button class="calendar-close-btn" onclick="closeCalendarModal()">&times;</button>
                </div>
                <div class="calendar-modal-body">
                    <div class="calendar-navigation">
                        <button class="calendar-nav-btn" onclick="changeCalendarMonth(-1)">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <div class="calendar-current-month" id="calendarCurrentMonth">November 2025</div>
                        <button class="calendar-nav-btn" onclick="changeCalendarMonth(1)">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    
                    <div class="calendar-container" id="dateSelectionCalendar">
                        <!-- Calendar will be dynamically generated here -->
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn-primary" onclick="confirmDateSelection()" id="confirmDateBtn" disabled>
                            <i class="fas fa-check"></i> Confirm Date Selection
                        </button>
                        <button class="btn-secondary" onclick="closeCalendarModal()" style="margin-left: 10px;">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>

        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwXQOBKCBiRhFqI-tU440N6xysaQFjhR8Ktq5ti9Xfh8UeWRN_6yqDMUmyEccviLh8lYA/exec';

        const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
            ? 'http://localhost:3000/api' 
            : '/api';

        // STRONGER BACK BUTTON PREVENTION
        (function() {
            window.history.replaceState(null, null, window.location.href);
            window.history.pushState(null, null, window.location.href);
            window.addEventListener('popstate', function(event) {
                window.history.pushState(null, null, window.location.href);
                showAlert('You cannot go back while logged in. Please logout first.', 'warning');
            });
        })();

        // Check if user is logged in
        let userData = JSON.parse(sessionStorage.getItem('userData') || localStorage.getItem('userData') || '{}');
        
        if (!userData.firstname) {
            window.location.href = 'login.html';
        } else {
            initializeDashboard();
            // Initialize user preferences (dark mode, chatbot settings)
            setTimeout(initializeUserPreferences, 100);
        }

        // Menu items configuration
        const menuItems = {
            common: [
                { id: 'home', icon: 'fas fa-home', label: 'Home' },
                { id: 'weekly-schedule', icon: 'fas fa-calendar-alt', label: 'Weekly Schedule' },
                { id: 'attendance', icon: 'fas fa-check-circle', label: 'Attendance' },
                { id: 'announcements', icon: 'fas fa-bullhorn', label: 'Announcements' },
                { id: 'bible-reader', icon: 'fas fa-book', label: 'Bible' },
                { id: 'daily-quote', icon: 'fas fa-lightbulb', label: 'Daily Quote' },
                { id: 'spiritual-assistant', icon: 'fas fa-comments', label: 'Spiritual Assistant' },
                { id: 'my-profile', icon: 'fas fa-user-circle', label: 'My Profile' }
            ],
            "Media": [
                { id: 'media', icon: 'fas fa-film', label: 'Media' }
            ],
            "Praise And Worship": [
                { id: 'praise-worship', icon: 'fas fa-music', label: 'Praise And Worship' }
            ],
            "Dancers": [
                { id: 'dancers', icon: 'fas fa-user-friends', label: 'Dancers' }
            ],
            "Ashers": [
                { id: 'ashers', icon: 'fas fa-door-open', label: 'Ashers' }
            ]
        };

        // Create Lineup Variables
        let backupCount = 1;
        let slowSongCount = 1;
        let fastSongCount = 1;
        const backupOptions = ["Psalm", "Cathy", "Tiffany", "Geneveve", "Merianne", "Ezra", "Julie", "Jewel", "Abby", "Myka"];

        // Calendar state
        let currentDate = new Date();
        let currentCalendarType = 'paw'; // 'paw' or 'meetings'
        let scheduleData = [];

        // Live Bible Verse System with Daily Rotation
        let currentBibleVersion = 'niv'; // Default version (NIV)
        let currentVerseTranslation = 'english'; // Default language
        
        const bibleVersions = {
            'niv': 'New International Version',
            'kjv': 'King James Version',
            'nkjv': 'New King James Version',
            'cev': 'Contemporary English Version',
            'nasb': 'New American Standard Bible'
        };

        const supportedLanguages = {
            'english': 'English',
            'bisaya': 'Bisaya (Cebuano)'
        };

        // Daily verse references (will rotate based on date)
        const dailyVerseReferences = [
            'John 3:16',
            'Proverbs 3:5-6',
            'Ephesians 2:8',
            'Colossians 3:23',
            '1 Corinthians 15:58',
            'Psalm 23:1',
            'Romans 8:28',
            'Philippians 4:13',
            'Joshua 1:8',
            'Psalm 37:5'
        ];

        // Function to get verse of the day based on current date
        function getVersOfTheDayReference() {
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 86400000);
            return dailyVerseReferences[dayOfYear % dailyVerseReferences.length];
        }

        // Bible verse cache with multiple versions for AI-driven accuracy
        const bibleVerseCache = {
            'John 3:16': {
                'niv': 'For God so loved the world that he gave his one and only Son, that whoever believes in him shall not perish but have eternal life.',
                'kjv': 'For God so loved the world, that he gave his only begotten Son, that whosoever believeth in him should not perish, but have everlasting life.',
                'nkjv': 'For God so loved the world that He gave His only begotten Son, that whoever believes in Him should not perish but have everlasting life.',
                'cev': 'God loved the people of this world so much that he gave his only Son. Anyone who has faith in him will have eternal life and will never really die.',
                'nasb': 'For God so loved the world, that He gave His only begotten Son, that whoever believes in Him shall not perish, but have eternal life.'
            },
            'Proverbs 3:5-6': {
                'niv': 'Trust in the Lord with all your heart and lean not on your own understanding; in all your ways submit to him, and he will make your paths straight.',
                'kjv': 'Trust in the Lord with all thine heart; and lean not unto thine own understanding. In all thy ways acknowledge him, and he shall direct thy paths.',
                'nkjv': 'Trust in the Lord with all your heart, And lean not on your own understanding; In all your ways acknowledge Him, And He shall direct your paths.',
                'cev': 'With all your heart you must trust the Lord and not your own judgment. Always let him lead you, and he will show you which way to go.',
                'nasb': 'Trust in the Lord with all your heart And do not lean on your own understanding. In all your ways acknowledge Him, And He will make your paths straight.'
            },
            'Ephesians 2:8': {
                'niv': 'For it is by grace you have been saved, through faith—and this is not from yourselves, it is the gift of God—',
                'kjv': 'For by grace are ye saved through faith; and that not of yourselves: it is the gift of God:',
                'nkjv': 'For by grace you have been saved through faith, and that not of yourselves; it is the gift of God,',
                'cev': 'You were saved by faith in God, who treats us much better than we deserve. This is God\'s gift to you, and not anything you have done on your own.',
                'nasb': 'For by grace you have been saved through faith; and that not of yourselves, it is the gift of God;'
            },
            'Colossians 3:23': {
                'niv': 'Whatever you do, work at it with all your heart, as working for the Lord, not for human masters, since you know that you will receive an inheritance from the Lord as a reward. It is the Lord Christ you are serving.',
                'kjv': 'And whatsoever ye do, do it heartily, as to the Lord, and not unto men; Knowing that of the Lord ye shall receive the reward of the inheritance: for ye serve the Lord Christ.',
                'nkjv': 'And whatever you do, do it heartily, as to the Lord and not to men, knowing that from the Lord you will receive the reward of the inheritance; for you serve the Lord Christ.',
                'cev': 'In everything you do, work hard for your real Master, the Lord Christ. This is the best way to serve the Lord.',
                'nasb': 'Whatever you do, do your work heartily, as for the Lord rather than for men, knowing that from the Lord you will receive the reward of the inheritance. It is the Lord Christ whom you serve.'
            },
            '1 Corinthians 15:58': {
                'niv': 'Therefore, my dear brothers and sisters, stand firm. Let nothing move you. Always give yourselves fully to the work of the Lord, because you know that your labor in the Lord is not in vain.',
                'kjv': 'Therefore, my beloved brethren, be ye stedfast, unmoveable, always abounding in the work of the Lord, forasmuch as ye know that your labour is not in vain in the Lord.',
                'nkjv': 'Therefore, my beloved brethren, be steadfast, immovable, always abounding in the work of the Lord, knowing that your labor is not in vain in the Lord.',
                'cev': 'My dear friends, stand firm and don\'t be shaken. Always keep busy working for the Lord. You know that everything you do for him is worthwhile.',
                'nasb': 'Therefore, my beloved brethren, be steadfast, immovable, always abounding in the work of the Lord, knowing that your toil in the Lord is not in vain.'
            },
            'Psalm 23:1': {
                'niv': 'The Lord is my shepherd, I lack nothing. He makes me lie down in green pastures, he leads me beside quiet waters, he refreshes my soul.',
                'kjv': 'The Lord is my shepherd; I shall not want. He maketh me to lie down in green pastures: he leadeth me beside the still waters.',
                'nkjv': 'The Lord is my shepherd; I shall not want. He makes me to lie down in green pastures; He leads me beside the still waters.',
                'cev': 'You, Lord, are my shepherd. I will never be in need. You let me rest in fields of green grass. You lead me to streams of peaceful water,',
                'nasb': 'The Lord is my shepherd, I shall not want. He makes me lie down in green pastures; He leads me beside quiet waters. He restores my soul;'
            },
            'Romans 8:28': {
                'niv': 'And we know that in all things God works for the good of those who love him, who have been called according to his purpose.',
                'kjv': 'And we know that all things work together for good to them that love God, to them who are the called according to his purpose.',
                'nkjv': 'And we know that all things work together for good to those who love God, to those who are the called according to His purpose.',
                'cev': 'We know that God is always at work for the good of everyone who loves him. They are the ones God chose for his purpose,',
                'nasb': 'And we know that God causes all things to work together for good to those who love God, to those who are called according to His purpose.'
            },
            'Philippians 4:13': {
                'niv': 'I can do all this through Christ, who gives me strength.',
                'kjv': 'I can do all things through Christ which strengtheneth me.',
                'nkjv': 'I can do all things through Christ who strengthens me.',
                'cev': 'I can do everything through Christ, who gives me the strength I need.',
                'nasb': 'I can do all things through Him who strengthens me.'
            },
            'Joshua 1:8': {
                'niv': 'Keep this Book of the Law always on your lips; meditate on it day and night, so that you may be careful to do everything written in it. Then you will be prosperous and successful.',
                'kjv': 'This book of the law shall not depart out of thy mouth; but thou shalt meditate therein day and night, that thou mayest observe to do according to all that is written therein: for then thou shalt make thy way prosperous, and then thou shalt have good success.',
                'nkjv': 'This Book of the Law shall not depart from your mouth, but you shall meditate in it day and night, that you may observe to do according to all that is written in it. For then you will make your way prosperous, and then you will have good success.',
                'cev': 'Always remember what is written in the Book of the Law. Study it day and night, and make sure you follow everything that is written in it. If you do, you will be successful and prosperous.',
                'nasb': 'This book of the law shall not depart from your mouth, but you shall meditate on it day and night, so that you may be careful to do according to all that is written in it; for then you will make your way prosperous, and then you will have success.'
            },
            'Psalm 37:5': {
                'niv': 'Commit your way to the Lord; trust in him and he will do this: He will make your righteous reward shine like the dawn, your vindication like the noonday sun.',
                'kjv': 'Commit thy way unto the Lord; trust also in him; and he shall bring it to pass.',
                'nkjv': 'Commit your way to the Lord, Trust also in Him, And He shall bring it to pass.',
                'cev': 'Let the Lord have your way, and trust in him. He will help you.',
                'nasb': 'Commit your way to the Lord; Trust in Him also, And He will do it.'
            }
        };

        // Function to fetch Bible verse from cache with AI-driven version accuracy
        async function fetchBibleVerse(reference, version = 'niv') {
            try {
                // Check cache first for reliable, offline-capable access
                if (bibleVerseCache[reference] && bibleVerseCache[reference][version]) {
                    return {
                        text: bibleVerseCache[reference][version],
                        reference: reference,
                        version: bibleVersions[version] || 'Bible'
                    };
                }
                
                // Fallback to first available version if exact version not found
                if (bibleVerseCache[reference]) {
                    const availableVersion = Object.keys(bibleVerseCache[reference])[0];
                    return {
                        text: bibleVerseCache[reference][availableVersion],
                        reference: reference,
                        version: bibleVersions[availableVersion] || 'Bible'
                    };
                }
                
                // Ultimate fallback
                throw new Error('Verse not found in cache');
            } catch (error) {
                console.error('Error fetching Bible verse:', error);
                // Fallback verse - NIV version of John 3:16
                return {
                    text: 'For God so loved the world that he gave his one and only Son, that whoever believes in him shall not perish but have eternal life.',
                    reference: 'John 3:16',
                    version: 'New International Version (NIV)'
                };
            }
        }

        // Function to translate text to Bisaya using translation API
        async function translateToBisaya(text) {
            try {
                // Using Google Translate API via RapidAPI (more reliable)
                // Fallback to simple character-based approach if API fails
                const response = await fetch('https://api.mymemory.translated.net/get?q=' + encodeURIComponent(text) + '&langpair=en|ceb');
                const data = await response.json();
                
                if (data.responseStatus === 200 && data.responseData.translatedText) {
                    return data.responseData.translatedText;
                }
                
                // If translation fails, show message
                console.log('Translation service temporarily unavailable, showing original text');
                return text;
            } catch (error) {
                console.error('Error translating to Bisaya:', error);
                showAlert('⚠️ Translation service unavailable. Showing original text.', 'warning');
                return text;
            }
        }

        // Function to update verse display
        async function updateBibleVerse(elementIds = {}) {
            try {
                // Show loading state
                if (elementIds.verse && document.getElementById(elementIds.verse)) {
                    document.getElementById(elementIds.verse).textContent = '⏳ Loading verse...';
                }
                
                const verseRef = getVersOfTheDayReference();
                const verseData = await fetchBibleVerse(verseRef, currentBibleVersion);
                
                let verseText = verseData.text;
                
                // Show translation indicator
                if (currentVerseTranslation === 'bisaya') {
                    if (elementIds.verse && document.getElementById(elementIds.verse)) {
                        document.getElementById(elementIds.verse).textContent = '🔄 Translating to Bisaya...';
                    }
                    verseText = await translateToBisaya(verseText);
                }
                
                // Update all verse elements
                if (elementIds.verse && document.getElementById(elementIds.verse)) {
                    document.getElementById(elementIds.verse).textContent = '"' + verseText + '"';
                }
                if (elementIds.reference && document.getElementById(elementIds.reference)) {
                    document.getElementById(elementIds.reference).textContent = verseData.reference + ' (' + currentBibleVersion.toUpperCase() + ')';
                }
                if (elementIds.language && document.getElementById(elementIds.language)) {
                    document.getElementById(elementIds.language).textContent = 'Language: ' + supportedLanguages[currentVerseTranslation];
                }
            } catch (error) {
                console.error('Error updating Bible verse:', error);
                if (elementIds.verse && document.getElementById(elementIds.verse)) {
                    document.getElementById(elementIds.verse).textContent = '❌ Error loading verse. Please try again.';
                }
            }
        }

        // Function to change Bible version
        function changeBibleVersion(version) {
            currentBibleVersion = version;
            
            // Update active button state
            document.querySelectorAll('.version-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update both verse containers
            updateBibleVerse({ 
                verse: 'dailyVerse',
                reference: 'verseReference',
                language: 'verseLanguage'
            });
            
            // Also update welcome verse if it exists
            if (document.getElementById('welcomeVerse')) {
                updateBibleVerse({ 
                    verse: 'welcomeVerse',
                    reference: 'welcomeVerseReference',
                    language: 'welcomeVerseLanguage'
                });
            }
        }

        // Function to change verse language
        function changeVerseLanguage(language) {
            currentVerseTranslation = language;
            
            // Update active button state
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update both verse containers
            updateBibleVerse({ 
                verse: 'dailyVerse',
                reference: 'verseReference',
                language: 'verseLanguage'
            });
            
            // Also update welcome verse if it exists
            if (document.getElementById('welcomeVerse')) {
                updateBibleVerse({ 
                    verse: 'welcomeVerse',
                    reference: 'welcomeVerseReference',
                    language: 'welcomeVerseLanguage'
                });
            }
        }

        /* ===== BIBLE READER FUNCTIONS ===== */
        let currentBibleBook = '';
        let currentBibleChapter = 1;
        let currentBibleSelectedVersion = 'niv';

        // Sample Bible verses for demonstration
        const bibleBooks = {
            'Genesis': 50,
            'Exodus': 40,
            'Matthew': 28,
            'Mark': 16,
            'Luke': 24,
            'John': 21,
            'Romans': 16,
            'Revelation': 22
        };

        // Extended Bible verse cache with multiple versions
        const extendedBibleCache = {
            'John 1:1': {
                'niv': 'In the beginning was the Word, and the Word was with God, and the Word was God.',
                'kjv': 'In the beginning was the Word, and the Word was with God, and the Word was God.',
                'nkjv': 'In the beginning was the Word, and the Word was with God, and the Word was God.',
                'nasb': 'In the beginning was the Word, and the Word was with God, and the Word was God.',
                'cev': 'In the beginning was the one who is called the Word. The Word was with God and was truly God.'
            },
            'John 3:16': {
                'niv': 'For God so loved the world that he gave his one and only Son, that whoever believes in him shall not perish but have eternal life.',
                'kjv': 'For God so loved the world, that he gave his only begotten Son, that whosoever believeth in him should not perish, but have everlasting life.',
                'nkjv': 'For God so loved the world that He gave His only begotten Son, that whoever believes in Him should not perish but have everlasting life.',
                'nasb': 'For God so loved the world, that He gave His only begotten Son, that whoever believes in Him shall not perish, but have eternal life.',
                'cev': 'God loved the people of this world so much that he gave his only Son. Anyone who has faith in him will have eternal life and will never really die.'
            },
            'Romans 8:28': {
                'niv': 'And we know that in all things God works for the good of those who love him, who have been called according to his purpose.',
                'kjv': 'And we know that all things work together for good to them that love God, to them who are the called according to his purpose.',
                'nkjv': 'And we know that all things work together for good to those who love God, to those who are the called according to His purpose.',
                'nasb': 'And we know that God causes all things to work together for good to those who love God, to those who are called according to His purpose.',
                'cev': 'We know that God is always at work for the good of everyone who loves him. They are the ones God chose for his purpose,'
            }
        };

        function loadBibleChapter(book) {
            if (!book) return;
            
            currentBibleBook = book;
            const chapterSelect = document.getElementById('bibleChapter');
            chapterSelect.innerHTML = '<option value="">Select Chapter...</option>';
            
            const chapters = bibleBooks[book] || 1;
            for (let i = 1; i <= chapters; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Chapter ${i}`;
                chapterSelect.appendChild(option);
            }
        }

        function loadBibleVerse() {
            const chapterSelect = document.getElementById('bibleChapter');
            const chapter = chapterSelect.value;
            
            if (!currentBibleBook || !chapter) return;
            
            currentBibleChapter = chapter;
            const version = document.getElementById('bibleVersion').value;
            currentBibleSelectedVersion = version;
            
            // Update header
            const titleEl = document.querySelector('.bible-header h3');
            const versionEl = document.querySelector('.bible-version-label');
            
            titleEl.textContent = `${currentBibleBook} ${chapter}`;
            versionEl.textContent = `Showing ${getVersionName(version)}`;
            
            // Display sample verses
            const bibleContent = document.getElementById('bibleText');
            let html = '';
            
            for (let verse = 1; verse <= 5; verse++) {
                const verseRef = `${currentBibleBook} ${chapter}:${verse}`;
                let verseText = `This is ${currentBibleBook} ${chapter}, verse ${verse}. (Full content would load from Bible API)`;
                
                // Check if we have the verse in our cache
                if (extendedBibleCache[verseRef] && extendedBibleCache[verseRef][version]) {
                    verseText = extendedBibleCache[verseRef][version];
                }
                
                html += `
                    <div class="bible-verse">
                        <span class="bible-verse-ref">${verseRef}</span>
                        <div class="bible-verse-text" onmouseup="handleBibleTextSelection()">${verseText}</div>
                    </div>
                `;
            }
            
            bibleContent.innerHTML = html;
        }

        function changeBibleReaderVersion(version) {
            currentBibleSelectedVersion = version;
            if (currentBibleBook && currentBibleChapter) {
                loadBibleVerse();
            }
        }

        function getVersionName(code) {
            const versions = {
                'niv': 'NIV - New International Version',
                'kjv': 'KJV - King James Version',
                'nkjv': 'NKJV - New King James Version',
                'nasb': 'NASB - New American Standard Bible',
                'cev': 'CEV - Contemporary English Version'
            };
            return versions[code] || 'Bible';
        }

        function handleBibleTextSelection() {
            const selectedText = window.getSelection().toString().trim();
            if (selectedText.length > 0) {
                document.getElementById('selectedText').textContent = selectedText;
                document.getElementById('bibleSelectionDisplay').style.display = 'block';
                document.getElementById('bibleQuestion').focus();
            }
        }

        // Daily Quote Feature
        const APIVERVE_KEY = 'b6002bf5-3261-4a7a-8f0e-eda25133dd82';

        async function fetchDailyQuote() {
            try {
                const response = await fetch('https://api.apiverve.com/v1/randomquote', {
                    method: 'GET',
                    headers: {
                        'x-api-key': APIVERVE_KEY,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.data && data.data.quote && data.data.author) {
                    document.getElementById('quoteText').textContent = data.data.quote;
                    document.getElementById('quoteAuthor').textContent = `— ${data.data.author}`;
                    
                    // Update timestamp
                    const now = new Date();
                    const timeString = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
                    document.getElementById('quoteTime').textContent = timeString;
                    document.getElementById('quoteMetadata').style.display = 'block';
                } else {
                    throw new Error('Invalid API response format');
                }
            } catch (error) {
                console.error('Error fetching quote:', error);
                document.getElementById('quoteText').textContent = 'Unable to load quote. Please try again.';
                document.getElementById('quoteAuthor').textContent = '- Error';
                document.getElementById('quoteMetadata').style.display = 'none';
            }
        }

        function shareQuote() {
            const quoteText = document.getElementById('quoteText').textContent;
            const quoteAuthor = document.getElementById('quoteAuthor').textContent;
            const shareText = `${quoteText} ${quoteAuthor}`;

            if (navigator.share) {
                navigator.share({
                    title: 'Daily Quote',
                    text: shareText
                }).catch(err => console.log('Share cancelled:', err));
            } else {
                // Fallback: Copy to clipboard
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Quote copied to clipboard!');
                }).catch(err => {
                    console.error('Copy failed:', err);
                    alert('Unable to share. Please copy manually.');
                });
            }
        }

        async function askBibleQuestion() {
            const selectedText = document.getElementById('selectedText').textContent;
            const question = document.getElementById('bibleQuestion').value.trim();
            
            if (!selectedText || !question) {
                showAlert('Please select text and ask a question', 'warning');
                return;
            }
            
            try {
                const responseEl = document.getElementById('bibleAIResponse');
                responseEl.innerHTML = '<p style="text-align: center;"><i class="fas fa-spinner fa-spin"></i> Asking AI...</p>';
                responseEl.style.display = 'block';
                
                const prompt = `Based on the Bible text: "${selectedText}"\n\nUser Question: ${question}\n\nPlease provide biblical insight and wisdom in response to their question.`;
                
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer 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`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'mixtral-8x7b-32768',
                        messages: [{
                            role: 'user',
                            content: prompt
                        }],
                        max_tokens: 500,
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    throw new Error('AI response failed');
                }
                
                const data = await response.json();
                const aiAnswer = data.choices[0].message.content;
                
                responseEl.innerHTML = `
                    <p><strong><i class="fas fa-lightbulb"></i> AI Insight:</strong></p>
                    <p>${aiAnswer}</p>
                    <p style="font-size: 0.85rem; color: #999; margin-top: 10px;"><em>Note: Always consult scripture and pastoral guidance for spiritual matters.</em></p>
                `;
            } catch (error) {
                console.error('Error asking Bible question:', error);
                document.getElementById('bibleAIResponse').innerHTML = `
                    <p style="color: #dc3545;"><strong>Error:</strong> Could not get AI response. Please try again.</p>
                `;
            }
        }

        // Fetch birthdays from AppScript
        async function fetchAndDisplayBirthdays() {
            try {
                const url = SCRIPT_URL + '?action=getAllMemberBirthdates';
                console.log('Fetching birthdays from:', url);
                
                const response = await fetch(url);
                const result = await response.json();
                
                console.log('Birthday API response:', result);
                
                if (result.message === 'Ministry Portal API is running') {
                    console.warn('AppScript action not recognized. Make sure getAllMemberBirthdates is in handleGetRequest');
                    displayBirthdaySection([], []);
                    return;
                }
                
                if (result.success && result.data && Array.isArray(result.data)) {
                    const members = result.data;
                    console.log('✓ Retrieved', members.length, 'members with birthdates');
                    
                    const today = new Date();
                    const todayMonth = String(today.getMonth() + 1).padStart(2, '0');
                    const todayDay = String(today.getDate()).padStart(2, '0');
                    const todayKey = `${todayMonth}-${todayDay}`;
                    
                    // Find today's birthday celebrants
                    const todaysCelebrrants = members.filter(member => {
                        if (!member.birthdate) return false;
                        const [year, month, day] = member.birthdate.split('-');
                        const memberKey = `${month}-${day}`;
                        return memberKey === todayKey;
                    });
                    
                    // Find upcoming birthdays (next 30 days)
                    const upcomingBirthdays = getUpcomingBirthdays(members, 30);
                    
                    console.log('✓ Found', todaysCelebrrants.length, 'celebrants today');
                    console.log('✓ Found', upcomingBirthdays.length, 'upcoming birthdays');
                    
                    // Display birthdays
                    displayBirthdaySection(todaysCelebrrants, upcomingBirthdays);
                } else {
                    console.error('Invalid response format:', result);
                    displayBirthdaySection([], []);
                }
            } catch (error) {
                console.error('Error fetching birthdays:', error);
                displayBirthdaySection([], []);
            }
        }

        function getUpcomingBirthdays(members, daysAhead) {
            const today = new Date();
            const upcoming = [];

            members.forEach(member => {
                if (!member.birthdate) return;
                
                const [year, month, day] = member.birthdate.split('-');
                let birthdayThisYear = new Date(today.getFullYear(), parseInt(month) - 1, parseInt(day));
                
                // If birthday already passed this year, get next year's
                if (birthdayThisYear < today) {
                    birthdayThisYear = new Date(today.getFullYear() + 1, parseInt(month) - 1, parseInt(day));
                }
                
                const daysUntilBirthday = Math.ceil((birthdayThisYear - today) / (1000 * 60 * 60 * 24));
                
                if (daysUntilBirthday > 0 && daysUntilBirthday <= daysAhead) {
                    upcoming.push({
                        ...member,
                        daysUntilBirthday: daysUntilBirthday,
                        birthdayDate: birthdayThisYear
                    });
                }
            });
            
            return upcoming.sort((a, b) => a.daysUntilBirthday - b.daysUntilBirthday);
        }

        async function displayBirthdaySection(todaysCelebrrants, upcomingBirthdays) {
            const birthdayContainer = document.getElementById('birthdayTodayCelerants');
            if (!birthdayContainer) return;
            
            let html = '';
            
            // Display today's celebrants with AI wishes
            if (todaysCelebrrants && todaysCelebrrants.length > 0) {
                html += '<div style="margin-bottom: 25px;">';
                html += '<h3 style="color: var(--primary); margin-bottom: 15px; font-size: 1.2rem; font-weight: 700; display: flex; align-items: center; gap: 8px;"><i class="fas fa-birthday-cake"></i> Celebrating Today!</h3>';
                html += '<div style="display: grid; gap: 18px;">';
                
                todaysCelebrrants.forEach(member => {
                    const aiWish = generateBirthdayWish(member);
                    const bibleVerse = getRandomBirthdayVerse();
                    
                    html += `
                        <div style="background: white; border: 2px solid #FFD700; border-radius: 12px; padding: 18px; box-shadow: 0 2px 8px rgba(255, 215, 0, 0.2); position: relative;">
                            <div style="background: linear-gradient(135deg, #FFD700, #FFC700); padding: 12px; border-radius: 8px; margin-bottom: 15px; color: #333;">
                                <div style="display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 1.1rem;">
                                    <span style="font-size: 28px;">🎉</span>
                                    <div>
                                        <div>${member.fullName}</div>
                                        <div style="font-size: 0.85rem; font-weight: 500; opacity: 0.9;"><i class="fas fa-briefcase" style="margin-right: 5px;"></i>${member.ministry || 'Ministry Member'}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 12px;">
                                <div style="font-size: 0.85rem; color: #666; font-weight: 500; margin-bottom: 5px;">💭 Birthday Message</div>
                                <div style="color: #333; font-size: 0.95rem; line-height: 1.5; padding: 10px; background: #f8f9fa; border-radius: 6px; border-left: 3px solid var(--primary);">
                                    "${aiWish}"
                                </div>
                            </div>
                            
                            <div>
                                <div style="font-size: 0.85rem; color: #666; font-weight: 500; margin-bottom: 5px;">✨ Birthday Verse</div>
                                <div style="color: #555; font-size: 0.9rem; line-height: 1.6; padding: 10px; background: #f0f5ff; border-radius: 6px; border-left: 3px solid steelblue;">
                                    <div style="font-style: italic; margin-bottom: 6px;">"${bibleVerse.text}"</div>
                                    <div style="color: steelblue; font-weight: 500; font-size: 0.85rem;">— ${bibleVerse.reference}</div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            }
            
            // Display upcoming birthdays
            if (upcomingBirthdays && upcomingBirthdays.length > 0) {
                html += '<div>';
                html += '<h3 style="color: var(--primary); margin-bottom: 15px; font-size: 1.2rem; font-weight: 700; display: flex; align-items: center; gap: 8px;"><i class="fas fa-calendar-check"></i> Upcoming Birthdays</h3>';
                html += '<div style="display: grid; gap: 10px;">';
                
                upcomingBirthdays.forEach(member => {
                    const monthName = new Date(member.birthdayDate).toLocaleDateString('en-US', { month: 'short' });
                    const dayNum = new Date(member.birthdayDate).getDate();
                    const daysText = member.daysUntilBirthday === 1 ? '1 day away' : 'in ' + member.daysUntilBirthday + ' days';
                    
                    html += `
                        <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 12px 15px; display: grid; grid-template-columns: auto 1fr auto; gap: 12px; align-items: center; transition: all 0.3s ease;">
                            <div style="font-size: 28px;">🎂</div>
                            <div>
                                <div style="font-weight: 600; color: #333; font-size: 0.95rem;">${member.fullName}</div>
                                <div style="color: #777; font-size: 0.85rem;">
                                    <i class="fas fa-calendar-day"></i> ${monthName} ${dayNum}
                                </div>
                            </div>
                            <div style="background: linear-gradient(135deg, #e3f2fd, #f3e5f5); padding: 6px 12px; border-radius: 20px; font-weight: 600; color: var(--primary); font-size: 0.8rem; text-align: right; white-space: nowrap;">
                                ${daysText}
                            </div>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            }
            
            if ((!todaysCelebrrants || todaysCelebrrants.length === 0) && (!upcomingBirthdays || upcomingBirthdays.length === 0)) {
                html = `
                    <div style="text-align: center; padding: 30px 20px; color: #999; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;">📅</div>
                        <p style="font-size: 1rem; font-weight: 500; margin: 0;">No birthdays today or upcoming within 30 days</p>
                    </div>
                `;
            }
            
            birthdayContainer.innerHTML = html;
        }

        function generateBirthdayWish(member) {
            const wishes = [
                `Wishing ${member.firstname} a blessed birthday filled with God's grace and love. Your dedication in ${member.ministry} is truly inspiring!`,
                `Happy birthday, ${member.firstname}! May God shower you with blessings and continue to guide your ministry with wisdom and strength.`,
                `Today we celebrate ${member.firstname}! Thank you for your faithful service in ${member.ministry}. Wishing you joy, health, and God's continued blessings.`,
                `${member.firstname}, on your special day, we thank God for you and your wonderful contributions to ${member.ministry}. Have a blessed birthday!`,
                `Celebrating ${member.firstname} today! May your birthday be filled with joy, surrounded by love, as you continue serving faithfully in ${member.ministry}.`,
                `Happy birthday, ${member.firstname}! Your commitment to ${member.ministry} is a blessing to all of us. Wishing you a wonderful year ahead!`,
                `On this special day, we honor ${member.firstname} for their service in ${member.ministry}. May God bless you abundantly on your birthday!`
            ];
            return wishes[Math.floor(Math.random() * wishes.length)];
        }

        function getRandomBirthdayVerse() {
            const birthdayVerses = [
                { text: 'May the Lord bless you and protect you. May the Lord smile on you and be gracious to you. May the Lord show you his favor and give you his peace.', reference: 'Numbers 6:24-26 (NCV)' },
                { text: 'The Lord is my light and my salvation—whom shall I fear? The Lord is the stronghold of my life—of whom shall I be afraid?', reference: 'Psalm 27:1 (NIV)' },
                { text: 'You, Lord, keep my lamp burning; my God turns my darkness into light.', reference: 'Psalm 18:28 (NIV)' },
                { text: 'This is the day the Lord has made; let us rejoice and be glad.', reference: 'Psalm 118:24 (NIV)' },
                { text: 'For you created my inmost being; you knit me together in my mother\'s womb. I praise you because I am fearfully and wonderfully made.', reference: 'Psalm 139:13-14 (NIV)' },
                { text: 'I have told you these things, so that in me you may have peace. In this world you will have trouble. But take heart! I have overcome the world.', reference: 'John 16:33 (NIV)' },
                { text: 'And we know that in all things God works for the good of those who love him, who have been called according to his purpose.', reference: 'Romans 8:28 (NIV)' },
                { text: 'May you be blessed by the Lord, the Maker of heaven and earth.', reference: 'Psalm 115:15 (NIV)' }
            ];
            return birthdayVerses[Math.floor(Math.random() * birthdayVerses.length)];
        }

        async function initializeDashboard() {
            // Initialize user data display first (before checking status from server)
            const initials = (userData.firstname.charAt(0) + userData.lastname.charAt(0)).toUpperCase();
            document.getElementById('userAvatar').textContent = initials;
            document.getElementById('userName').textContent = `${userData.firstname} ${userData.lastname}`;
            document.getElementById('userMinistry').textContent = userData.ministry;
            document.getElementById('welcomeName').textContent = userData.firstname;
            document.getElementById('firstTimeName').textContent = userData.firstname;
            document.getElementById('unverifiedName').textContent = userData.firstname;
            
            // Check if this is first login
            const loginCount = parseInt(localStorage.getItem(`loginCount_${userData.username}`) || '0');
            const isFirstLogin = loginCount === 0;
            
            // Increment login count
            localStorage.setItem(`loginCount_${userData.username}`, String(loginCount + 1));
            
            // Fetch the actual status from the server BEFORE setting up the UI
            await fetchAndSetUserStatus(isFirstLogin);
            
            // Initialize Bible verse of the day
            await updateBibleVerse({ 
                verse: 'dailyVerse',
                reference: 'verseReference',
                language: 'verseLanguage'
            });
            
            // Fetch and display birthdays
            await fetchAndDisplayBirthdays();
            
            // Initialize all sections
            initializeAllSections();
        }

        // Initialize user preferences (dark mode, chatbot settings)
        function initializeUserPreferences() {
            // Load dark mode preference
            const darkModeEnabled = localStorage.getItem('darkModeEnabled') === 'true';
            if (darkModeEnabled) {
                document.body.classList.add('dark-mode');
            }
            
            // Load chatbot preference
            const chatbotEnabled = localStorage.getItem('chatbotEnabled') !== 'false';
            const chatbotButton = document.querySelector('.flowise-button');
            
            if (!chatbotEnabled && chatbotButton) {
                chatbotButton.style.display = 'none';
                console.log('Chatbot disabled by user preference');
            }
        }

        async function fetchAndSetUserStatus(isFirstLogin) {
            try {
                console.log('Fetching verification status for:', userData.username);
                
                // For demo purposes, we'll simulate a verified user
                // In a real implementation, this would call your backend API
                setTimeout(() => {
                    const serverStatus = 'verified'; // Simulated status
                    userData.status = serverStatus;
                    
                    // Save updated user data
                    sessionStorage.setItem('userData', JSON.stringify(userData));
                    localStorage.setItem('userData', JSON.stringify(userData));
                    
                    // Update UI with the correct status
                    updateUIByStatus(isFirstLogin);
                }, 500);
                
            } catch (error) {
                console.error('Error checking verification status:', error);
                userData.status = 'unverified';
                updateUIByStatus(isFirstLogin);
            }
        }

        function updateUIByStatus(isFirstLogin) {
            const status = userData.status || 'unverified';
            
            console.log('Updating UI with status:', status);
            
            // Update status indicator
            updateStatusIndicator(status);
            
            // Update verification banner
            if (status === 'verified') {
                document.getElementById('verificationBanner').style.display = 'none';
                
                // Show verified content
                document.getElementById('unverifiedContent').style.display = 'none';
                
                if (isFirstLogin) {
                    document.getElementById('firstTimeWelcomeContainer').style.display = 'block';
                    document.getElementById('regularWelcomeContainer').style.display = 'none';
                    loadWelcomeVerse(userData.ministry);
                } else {
                    document.getElementById('firstTimeWelcomeContainer').style.display = 'none';
                    document.getElementById('regularWelcomeContainer').style.display = 'block';
                    // Load daily verse from Groq API with inspiring words
                    loadDailyVerseWithGroq(userData.ministry);
                }
                
            } else {
                document.getElementById('verificationBanner').style.display = 'block';
                
                // Show unverified content
                document.getElementById('firstTimeWelcomeContainer').style.display = 'none';
                document.getElementById('regularWelcomeContainer').style.display = 'none';
                document.getElementById('unverifiedContent').style.display = 'block';
            }
            
            // Generate sidebar menu with current status
            generateSidebarMenu(userData.ministry, status);
        }

        function updateStatusIndicator(status) {
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = status === 'verified' ? 'Verified' : 'Unverified';
            const statusClass = status === 'verified' ? 'verified' : 'unverified';
            
            statusIndicator.innerHTML = `
                <div class="status-circle ${statusClass}">
                    <div class="status-tooltip">${statusText}</div>
                </div>
            `;
        }

        function generateSidebarMenu(ministry, status) {
            const sidebarMenu = document.getElementById('sidebarMenu');
            sidebarMenu.innerHTML = '';
            
            const isVerified = status === 'verified';
            const isSongLeader = userData.username && userData.username.includes('@songlead');
            
            // Add common menu items
            menuItems.common.forEach(item => {
                const menuItem = document.createElement('a');
                
                // Check if item should be disabled (only for unverified status)
                const shouldDisable = !isVerified && item.id !== 'home';
                
                menuItem.className = 'menu-item' + (item.id === 'home' ? ' active' : '');
                if (shouldDisable) {
                    menuItem.className += ' disabled';
                }
                
                menuItem.onclick = function() {
                    if (shouldDisable) {
                        showAlert('🔒 Please wait for account verification to access this feature', 'warning');
                    } else {
                        showSection(item.id);
                    }
                };
                
                menuItem.innerHTML = `
                    <span class="menu-icon"><i class="${item.icon}"></i></span>
                    <span>${item.label}</span>
                    ${shouldDisable ? '<span style="margin-left: auto; font-size: 0.7rem; color: #ffc107;"><i class="fas fa-lock"></i></span>' : ''}
                `;
                sidebarMenu.appendChild(menuItem);
            });
            
            // Add Create Lineup button for song leaders
            if (isSongLeader && isVerified) {
                const lineupItem = document.createElement('a');
                lineupItem.className = 'menu-item';
                lineupItem.onclick = function() { showSection('create-lineup'); };
                lineupItem.innerHTML = `
                    <span class="menu-icon"><i class="fas fa-plus-circle"></i></span>
                    <span>Create Lineup</span>
                `;
                sidebarMenu.appendChild(lineupItem);
            }
            
            // Add ministry-specific menu item
            if (menuItems[ministry]) {
                menuItems[ministry].forEach(item => {
                    const menuItem = document.createElement('a');
                    menuItem.className = 'menu-item' + (isVerified ? '' : ' disabled');
                    menuItem.onclick = function() {
                        if (isVerified) {
                            showSection(item.id);
                        } else {
                            showAlert('🔒 Please wait for account verification to access this feature', 'warning');
                        }
                    };
                    menuItem.innerHTML = `
                        <span class="menu-icon"><i class="${item.icon}"></i></span>
                        <span>${item.label}</span>
                        ${!isVerified ? '<span style="margin-left: auto; font-size: 0.7rem; color: #ffc107;"><i class="fas fa-lock"></i></span>' : ''}
                    `;
                    sidebarMenu.appendChild(menuItem);
                });
            }
        }

        // Load daily verse - now uses cached accurate verses
        function loadDailyVerse(ministry) {
            // This is now handled by initializeDashboard -> updateBibleVerse
            // No longer needed as verse system is unified
        }

        // Groq API configuration for daily verses and inspiring words
        const GROQ_API_KEY = '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';
        const GROQ_API_URL = 'https://api.groq.com/openai/v1/chat/completions';

        // Fetch daily verse from Groq API - LIVE AI with Context Awareness
        // **GUARANTEED FRESH VERSE EVERY DAY - NOT HARDCODED**
        async function fetchDailyVerseFromGroq() {
            try {
                // Check cache ONLY if it's the same calendar day
                const cacheKey = 'dailyVerseCache';
                const cachedData = localStorage.getItem(cacheKey);
                const today = new Date().toDateString();
                const currentHour = new Date().getHours();

                // If cache exists AND date matches AND we're not at midnight boundary, use cached
                if (cachedData) {
                    const cache = JSON.parse(cachedData);
                    // STRICT: Only use cache if exact same day AND verse exists
                    if (cache.date === today && cache.verse && cache.verse.verse) {
                        console.log('✓ Using CACHED verse from ' + cache.fetchedAt + ' (Same day)');
                        return cache.verse;
                    }
                }

                // Cache expired or doesn't match today → FETCH FRESH LIVE VERSE
                console.log('🔄 FETCHING FRESH LIVE VERSE FROM GROQ AI...');
                
                // Get user's ministry context for personalized verses
                const userMinistry = userData.ministry || 'Praise And Worship';
                const dayOfWeek = new Date().toLocaleDateString('en-US', { weekday: 'long' });
                const monthDay = new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric' });
                
                // ADVANCED PROMPT - Changes based on actual date to ensure variance
                const advancedPrompt = `TODAY IS: ${dayOfWeek}, ${monthDay} (${today})

You are a spiritual advisor providing UNIQUE daily Bible verses for ministry workers. 
This verse MUST be DIFFERENT from yesterday's verse.

CONTEXT:
- Person's Ministry: ${userMinistry}
- Day of Week: ${dayOfWeek}
- Date: ${monthDay}

GENERATE ONE FRESH Bible verse that:
1. Has NEVER been used before this date
2. Relates specifically to their ministry (${userMinistry})
3. Is perfectly encouraging for ${dayOfWeek}
4. Provides actionable inspiration for today
5. Is authentic and deeply meaningful

Format EXACTLY as: VERSE_TEXT|BOOK_CHAPTER_VERSE|PERSONAL_EXPLANATION

Be creative, authentic, and DIFFERENT. Don't repeat common verses.`;

                // Fetch BRAND NEW verse from Groq API with advanced prompting
                const response = await fetch(GROQ_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${GROQ_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'openai/gpt-oss-120b',  // Correct Groq model
                        messages: [
                            {
                                role: 'system',
                                content: 'You are a profound spiritual guide who generates UNIQUE daily Bible verses. NEVER generate the same verse twice. Be creative, authentic, and deeply inspiring. Generate real Bible verses, not made-up ones.'
                            },
                            {
                                role: 'user',
                                content: advancedPrompt
                            }
                        ],
                        temperature: 0.85,
                        max_tokens: 400
                    })
                });

                if (!response.ok) {
                    console.warn(`⚠️ Groq API returned status ${response.status}, generating new attempt...`);
                    throw new Error(`API error: ${response.statusText}`);
                }

                const data = await response.json();
                const content = data.choices[0].message.content;
                
                console.log('📖 ✨ LIVE AI GENERATED FRESH VERSE ✨');
                console.log('   ' + content.substring(0, 100) + '...');
                
                // Parse the response with better error handling
                const parts = content.split('|').map(p => p.trim());
                const verse = {
                    verse: parts[0] || 'Trust in the Lord with all your heart and lean not on your own understanding.',
                    reference: parts[1] || 'Proverbs 3:5-6',
                    explanation: parts[2] || 'Put your faith in God\'s guidance for your ministry today.',
                    isLive: true,  // Mark as live AI-generated
                    generatedDate: today,
                    generatedTime: new Date().toLocaleTimeString(),
                    isNew: true  // This is a NEW verse generated today
                };

                // Cache the verse with strict date validation
                const cacheData = {
                    date: today,
                    verse: verse,
                    fetchedAt: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' }),
                    ministry: userMinistry,
                    dayOfWeek: dayOfWeek,
                    expiresAt: new Date(new Date().getTime() + 24 * 60 * 60 * 1000).toDateString()  // Expires tomorrow
                };
                
                localStorage.setItem(cacheKey, JSON.stringify(cacheData));
                
                console.log('✅ FRESH VERSE CACHED (Expires tomorrow at midnight)');
                return verse;
            } catch (error) {
                console.error('❌ Error fetching live verse from Groq:', error);
                // Return fallback verse on error
                return {
                    verse: 'For we are God\'s handiwork, created in Christ Jesus to do good works, which God prepared in advance for us to do.',
                    reference: 'Ephesians 2:10',
                    explanation: 'You are uniquely created and equipped for your ministry role. God has prepared good works specifically for you to accomplish through your service.',
                    isLive: false
                };
            }
        }

        // Fetch inspiring words from Groq API - LIVE Dynamic AI
        // **GUARANTEED FRESH AFFIRMATIONS EVERY DAY - NOT HARDCODED**
        async function fetchInspiringWords() {
            try {
                // Check cache ONLY if it's the same calendar day
                const cacheKey = 'inspiringWordsCache';
                const cachedData = localStorage.getItem(cacheKey);
                const today = new Date().toDateString();

                if (cachedData) {
                    const cache = JSON.parse(cachedData);
                    // STRICT: Only use cache if exact same day AND words exist
                    if (cache.date === today && cache.words && cache.words.length > 0) {
                        console.log('✓ Using CACHED affirmations from ' + cache.generatedAt + ' (Same day)');
                        return cache.words;
                    }
                }

                // Cache expired or doesn't match today → FETCH FRESH LIVE WORDS
                console.log('🔄 GENERATING FRESH LIVE AFFIRMATIONS WITH AI...');

                // Get current time for time-based personalization
                const hour = new Date().getHours();
                let timePhrase = 'this morning';
                if (hour >= 12 && hour < 17) timePhrase = 'this afternoon';
                if (hour >= 17) timePhrase = 'this evening';

                const dayOfWeek = new Date().toLocaleDateString('en-US', { weekday: 'long' });
                const monthDay = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

                // DYNAMIC AI PROMPT - Includes actual date to ensure variance
                const dynamicPrompt = `TODAY IS: ${dayOfWeek}, ${monthDay} (${today})
TIME OF DAY: ${timePhrase}

You are an inspiring life coach specializing in Christian ministry encouragement.

GENERATE 5 BRAND NEW, UNIQUE affirmations for ${userData.ministry || 'a ministry worker'} ${timePhrase}.

IMPORTANT: These affirmations MUST:
1. Be COMPLETELY NEW (never used before)
2. Be DIFFERENT from typical generic quotes
3. Be SHORT (max 15 words each)
4. Be ACTIONABLE and encouraging  
5. Relate specifically to serving in ministry
6. Sound genuine, not generic or robotic
7. Vary in style and approach

Format: AFFIRMATION_1|AFFIRMATION_2|AFFIRMATION_3|AFFIRMATION_4|AFFIRMATION_5

Create fresh, authentic affirmations that will actually inspire this ministry worker TODAY.`;

                // Fetch BRAND NEW words from Groq API
                const response = await fetch(GROQ_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${GROQ_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'openai/gpt-oss-120b',  // Correct Groq model
                        messages: [
                            {
                                role: 'system',
                                content: 'You are an inspiring life coach specializing in Christian ministry encouragement. Generate UNIQUE, fresh affirmations that energize ministry workers. NEVER generate the same affirmations twice. Be creative, specific, and deeply meaningful.'
                            },
                            {
                                role: 'user',
                                content: dynamicPrompt
                            }
                        ],
                        temperature: 0.85,
                        max_tokens: 350
                    })
                });

                if (!response.ok) {
                    console.warn(`⚠️ Groq API returned status ${response.status}`);
                    throw new Error(`API error: ${response.statusText}`);
                }

                const data = await response.json();
                const content = data.choices[0].message.content;
                
                // Parse and clean the response
                const words = content
                    .split('|')
                    .map(w => w.trim())
                    .filter(w => w.length > 0 && !w.startsWith('Example') && !w.includes('AFFIRMATION') && !w.toLowerCase().includes('format'))
                    .slice(0, 5);  // Get max 5 words

                if (words.length === 0) {
                    throw new Error('No words parsed from response');
                }

                console.log(`💫 ✨ LIVE AI GENERATED ${words.length} FRESH AFFIRMATIONS ✨`);
                words.forEach((w, i) => console.log(`   ${i+1}. ${w}`));

                // Cache the words with strict date validation
                const cacheData = {
                    date: today,
                    words: words,
                    generatedAt: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' }),
                    timeOfDay: timePhrase,
                    dayOfWeek: dayOfWeek,
                    expiresAt: new Date(new Date().getTime() + 24 * 60 * 60 * 1000).toDateString()  // Expires tomorrow
                };
                
                localStorage.setItem(cacheKey, JSON.stringify(cacheData));

                console.log('✅ FRESH AFFIRMATIONS CACHED (Expires tomorrow at midnight)');
                return words;
            } catch (error) {
                console.error('❌ Error fetching inspiring words from Groq:', error);
                // Return fallback words on error
                return [
                    '🌟 Your service matters and transforms lives.',
                    '✨ God is working through you right now.',
                    '💪 Every moment of faithfulness counts forever.',
                    '🙏 You are exactly where God needs you.',
                    '⚡ Your anointing makes ordinary things extraordinary.'
                ];
            }
        }

        // Load daily verse with Groq API - now uses unified updateBibleVerse system
        async function loadDailyVerseWithGroq(ministry) {
            // Verse display is now handled by unified updateBibleVerse() function
            // which supports all versions and languages automatically
            // This function is kept for backward compatibility but does nothing
        }

        // Display rotating inspiring words with LIVE AI indicator
        async function displayInspiringWords() {
            const container = document.getElementById('dailyVerse').parentElement;
            
            // Check if inspiring words container already exists
            let inspiringWordsDiv = document.getElementById('inspiringWordsSection');
            if (!inspiringWordsDiv) {
                inspiringWordsDiv = document.createElement('div');
                inspiringWordsDiv.id = 'inspiringWordsSection';
                inspiringWordsDiv.className = 'inspiring-words-section';
                container.appendChild(inspiringWordsDiv);
            }

            // Show loading state while fetching
            inspiringWordsDiv.innerHTML = '<span style="opacity: 0.6;">✨ Loading live affirmations...</span>';
            inspiringWordsDiv.style.minHeight = '30px';

            const words = await fetchInspiringWords();
            
            // Display rotating words (change every 6 seconds with smooth transition)
            let currentWordIndex = 0;
            
            function rotateWords() {
                if (words.length > 0) {
                    // Add fade animation
                    inspiringWordsDiv.style.opacity = '0.5';
                    setTimeout(() => {
                        inspiringWordsDiv.textContent = `✨ ${words[currentWordIndex]}`;
                        inspiringWordsDiv.style.opacity = '1';
                        currentWordIndex = (currentWordIndex + 1) % words.length;
                    }, 200);
                }
            }

            // Show first word immediately
            inspiringWordsDiv.textContent = `✨ ${words[0]}`;
            inspiringWordsDiv.style.opacity = '1';
            currentWordIndex = 1;
            
            // Rotate every 6 seconds
            const rotationInterval = setInterval(() => {
                rotateWords();
            }, 6000);

            // Add indicator badge showing it's live AI
            const liveIndicator = document.createElement('span');
            liveIndicator.style.cssText = `
                font-size: 0.65rem;
                margin-left: 8px;
                padding: 2px 6px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 3px;
                vertical-align: super;
                animation: pulse 2s infinite;
            `;
            liveIndicator.textContent = '● LIVE AI';
            
            // Only add if not already present
            if (!inspiringWordsDiv.querySelector('[style*="LIVE AI"]')) {
                inspiringWordsDiv.appendChild(liveIndicator);
            }

            // Store interval ID for cleanup if needed
            inspiringWordsDiv.dataset.rotationInterval = rotationInterval;
        }

        function loadWelcomeVerse(ministry) {
            // For first-time users, the verse is now loaded via the unified updateBibleVerse system
            // which is called in initializeDashboard for both welcome and daily verses
            // This function is kept for backward compatibility but does nothing
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        // Floating Chatbot Functions
        function toggleFlowiseChat() {
            // Check if chatbot is enabled
            const chatbotEnabled = localStorage.getItem('chatbotEnabled') !== 'false';
            if (!chatbotEnabled) {
                showAlert('💬 Chatbot is disabled. Enable it in your preferences.', 'warning');
                return;
            }
            
            const chatWindow = document.getElementById('flowiseChatWindow');
            chatWindow.classList.toggle('open');
            if (chatWindow.classList.contains('open')) {
                document.getElementById('flowiseInput').focus();
                initializeChatbotDrag();
            }
        }
        
        // Chatbot Drag Functionality
        let isDraggingChatbot = false;
        let dragOffsetX = 0;
        let dragOffsetY = 0;
        
        // Detect if device is mobile
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) 
                || window.innerWidth <= 768;
        }
        
        function initializeChatbotDrag() {
            // Skip drag functionality on mobile devices
            if (isMobileDevice()) {
                console.log('Mobile device detected - drag functionality disabled');
                return;
            }
            
            const chatWindow = document.getElementById('flowiseChatWindow');
            const chatHeader = chatWindow.querySelector('.flowise-chat-header');
            
            if (!chatHeader) return;
            
            chatHeader.addEventListener('mousedown', startDragChatbot);
        }
        
        function startDragChatbot(e) {
            isDraggingChatbot = true;
            const chatWindow = document.getElementById('flowiseChatWindow');
            
            // Get current position
            const rect = chatWindow.getBoundingClientRect();
            dragOffsetX = e.clientX - rect.left;
            dragOffsetY = e.clientY - rect.top;
            
            chatWindow.classList.add('dragging');
            
            document.addEventListener('mousemove', dragChatbot);
            document.addEventListener('mouseup', stopDragChatbot);
            
            e.preventDefault();
        }
        
        function dragChatbot(e) {
            if (!isDraggingChatbot) return;
            
            const chatWindow = document.getElementById('flowiseChatWindow');
            let clientX = e.clientX;
            let clientY = e.clientY;
            
            if (!clientX || !clientY) return;
            
            // Calculate new position
            let newX = clientX - dragOffsetX;
            let newY = clientY - dragOffsetY;
            
            // Keep within viewport bounds
            const minX = -chatWindow.offsetWidth / 2 + 50;
            const maxX = window.innerWidth - chatWindow.offsetWidth / 2 - 50;
            const minY = 0;
            const maxY = window.innerHeight - 60;
            
            newX = Math.max(minX, Math.min(maxX, newX));
            newY = Math.max(minY, Math.min(maxY, newY));
            
            // Update position without transform
            chatWindow.style.left = (newX + chatWindow.offsetWidth / 2) + 'px';
            chatWindow.style.top = (newY + chatWindow.offsetHeight / 2) + 'px';
            chatWindow.style.transform = 'translate(-50%, -50%)';
            
            e.preventDefault();
        }
        
        function stopDragChatbot(e) {
            if (!isDraggingChatbot) return;
            
            isDraggingChatbot = false;
            const chatWindow = document.getElementById('flowiseChatWindow');
            chatWindow.classList.remove('dragging');
            
            document.removeEventListener('mousemove', dragChatbot);
            document.removeEventListener('mouseup', stopDragChatbot);
        }

        function closeFlowiseChat() {
            document.getElementById('flowiseChatWindow').classList.remove('open');
        }

        async function sendFlowiseMessage() {
            const input = document.getElementById('flowiseInput');
            const messagesContainer = document.getElementById('flowiseMessages');
            const message = input.value.trim();

            if (!message) return;

            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'flowise-message user';
            userMsg.innerHTML = `<div class="flowise-message-bubble">${escapeHtml(message)}</div>`;
            messagesContainer.appendChild(userMsg);

            input.value = '';
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Get AI response
            try {
                const response = await getFlowiseAIResponse(message);
                const aiMsg = document.createElement('div');
                aiMsg.className = 'flowise-message ai';
                aiMsg.innerHTML = `<div class="flowise-message-bubble">${response}</div>`;
                messagesContainer.appendChild(aiMsg);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            } catch (error) {
                console.error('Error:', error);
                const errorMsg = document.createElement('div');
                errorMsg.className = 'flowise-message ai';
                errorMsg.innerHTML = `<div class="flowise-message-bubble">I apologize, but I'm experiencing a connection issue. Please try again.</div>`;
                messagesContainer.appendChild(errorMsg);
            }
        }

        async function getFlowiseAIResponse(userMessage) {
            try {
                const response = await fetch(GROQ_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${GROQ_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'openai/gpt-oss-120b',
                        messages: [
                            {
                                role: 'system',
                                content: `You are a compassionate and scripturally-grounded Bible Assistant serving a church community. Your purpose is to provide meaningful, comprehensive spiritual guidance rooted in Christ's love and biblical truth.

YOUR APPROACH:
- Share relevant Scripture passages with context and meaning
- Explain biblical concepts in clear, accessible language
- Offer practical spiritual wisdom for daily living
- Encourage prayer, faith, and dependence on God
- Provide caring guidance on church ministries and spiritual service
- Maintain a warm, pastoral tone that reflects Christ's compassion

RESPONSE GUIDELINES:
- Provide thorough, complete responses that fully address the question
- Use clear, organized thoughts separated by line breaks
- Include relevant Bible verses with their references and context
- Focus on substance and depth
- Keep language warm, encouraging, and accessible
- Always conclude with a clear closing thought, encouragement, or invitation to prayer
- Ensure responses are complete and well-rounded with proper conclusions

ESSENTIAL: Always end your response with a meaningful conclusion that ties everything together. This could be:
- An encouraging closing statement
- A call to prayer or reflection
- A biblical promise or truth
- An invitation to take the next step in their faith journey
- A warm blessing

When discussing Scripture, explain what it means and how it applies. When discussing church roles or ministries, emphasize the joy of serving God and blessing others. Always point toward God's love, grace, and truth with complete thoughts.

You represent our church's heart - speak with wisdom, warmth, genuine spiritual care, and always provide complete, satisfying responses.`
                            },
                            { role: 'user', content: userMessage }
                        ],
                        max_tokens: 800,
                        temperature: 0.7
                    })
                });

                const data = await response.json();
                if (data.choices && data.choices.length > 0) {
                    return formatBibleResponse(data.choices[0].message.content);
                }
                return 'I apologize, but I couldn\'t generate a response at this moment. Please try again.';
            } catch (error) {
                console.error('Chatbot API error:', error);
                throw error;
            }
        }

        function formatBibleResponse(text) {
            // Handle excessive asterisks and format cleanly
            let formatted = text
                // Convert markdown-style headers (#) to clear formatting
                .replace(/^###\s+(.+)$/gm, '<div style="margin-top: 12px; font-weight: 600; color: #4a5f8f; font-size: 0.95em;">$1</div>')
                .replace(/^##\s+(.+)$/gm, '<div style="margin-top: 12px; font-weight: 600; color: #4a5f8f; font-size: 1em;">$1</div>')
                .replace(/^#\s+(.+)$/gm, '<div style="margin-top: 12px; font-weight: 700; color: #2c3e50; font-size: 1.05em; border-bottom: 1px solid #ddd; padding-bottom: 6px;">$1</div>')
                // Minimal bold usage - only for important terms
                .replace(/\*\*([^*]+)\*\*/g, '<strong style="color: #5a6f8f;">$1</strong>')
                // Remove single asterisks and replace with subtle formatting
                .replace(/\*([^*]+)\*/g, '<em style="color: #666;">$1</em>')
                // Format numbered lists
                .replace(/^\d+\.\s+(.+)$/gm, '<div style="margin: 8px 0 8px 0; padding: 8px 12px; background: rgba(99, 110, 250, 0.06); border-left: 3px solid #636efa; border-radius: 3px;">$1</div>')
                // Format bullet points
                .replace(/^[-•]\s+(.+)$/gm, '<div style="margin: 6px 0 6px 16px; position: relative;"><span style="position: absolute; left: -12px; color: #636efa;">›</span>$1</div>')
                // Add line breaks
                .replace(/\n/g, '<br>')
                // Clean up excessive line breaks
                .replace(/<br>\s*<br>\s*<br>/g, '<br><br>');
            
            return formatted;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function toggleChatbot() {
            const chatbot = document.getElementById('floatingChatbot');
            const toggleBtn = document.getElementById('chatbotToggleBtn');
            
            chatbot.classList.toggle('collapsed');
            
            if (chatbot.classList.contains('collapsed')) {
                toggleBtn.classList.add('active');
            } else {
                toggleBtn.classList.remove('active');
            }
        }

        function closeChatbot() {
            const chatbot = document.getElementById('floatingChatbot');
            const toggleBtn = document.getElementById('chatbotToggleBtn');
            
            chatbot.classList.add('collapsed');
            toggleBtn.classList.add('active');
        }

        async function sendChatbotMessage() {
            const input = document.getElementById('chatbotInput');
            const messagesContainer = document.getElementById('chatbotMessages');
            const sendBtn = document.getElementById('chatbotSendBtn');
            
            const userMessage = input.value.trim();
            if (!userMessage) return;

            // Disable send button
            sendBtn.disabled = true;

            // Add user message to chat
            const userMsgDiv = document.createElement('div');
            userMsgDiv.className = 'floating-chatbot-message user';
            userMsgDiv.innerHTML = `<div class="floating-chatbot-message-content">${escapeHtml(userMessage)}</div>`;
            messagesContainer.appendChild(userMsgDiv);

            // Clear input
            input.value = '';

            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            try {
                // Show typing indicator
                const typingDiv = document.createElement('div');
                typingDiv.className = 'floating-chatbot-message ai';
                typingDiv.id = 'typingIndicator';
                typingDiv.innerHTML = `<div class="floating-chatbot-message-content">✍️ Thinking...</div>`;
                messagesContainer.appendChild(typingDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

                // Get AI response
                const response = await getChatbotResponse(userMessage);

                // Remove typing indicator
                typingDiv.remove();

                // Add AI response
                const aiMsgDiv = document.createElement('div');
                aiMsgDiv.className = 'floating-chatbot-message ai';
                aiMsgDiv.innerHTML = `<div class="floating-chatbot-message-content">${formatBibleResponse(response)}</div>`;
                messagesContainer.appendChild(aiMsgDiv);

                // Scroll to bottom
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

            } catch (error) {
                console.error('Chatbot error:', error);
                const errorDiv = document.createElement('div');
                errorDiv.className = 'floating-chatbot-message ai';
                errorDiv.innerHTML = `<div class="floating-chatbot-message-content">I'm having trouble responding. Please try again.</div>`;
                messagesContainer.appendChild(errorDiv);
            } finally {
                sendBtn.disabled = false;
                input.focus();
            }
        }

        async function getChatbotResponse(userMessage) {
            try {
                const GROQ_API_URL = 'https://api.groq.com/openai/v1/chat/completions';

                const response = await fetch(GROQ_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${GROQ_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'openai/gpt-oss-120b',
                        messages: [
                            {
                                role: 'system',
                                content: `You are a compassionate and scripturally-grounded Bible Assistant serving a church community. Your purpose is to provide meaningful, comprehensive spiritual guidance rooted in Christ's love and biblical truth.

YOUR APPROACH:
- Share relevant Scripture passages with context and meaning
- Explain biblical concepts in clear, accessible language
- Offer practical spiritual wisdom for daily living
- Encourage prayer, faith, and dependence on God
- Provide caring guidance on church ministries and spiritual service
- Maintain a warm, pastoral tone that reflects Christ's compassion

RESPONSE GUIDELINES:
- Provide thorough, complete responses that fully address the question
- Use clear, organized thoughts separated by line breaks
- Include relevant Bible verses with their references and context
- Focus on substance and depth
- Keep language warm, encouraging, and accessible
- Always conclude with a clear closing thought, encouragement, or invitation to prayer
- Ensure responses are complete and well-rounded with proper conclusions

ESSENTIAL: Always end your response with a meaningful conclusion that ties everything together. This could be:
- An encouraging closing statement
- A call to prayer or reflection
- A biblical promise or truth
- An invitation to take the next step in their faith journey
- A warm blessing

When discussing Scripture, explain what it means and how it applies. When discussing church roles or ministries, emphasize the joy of serving God and blessing others. Always point toward God's love, grace, and truth with complete thoughts.

You represent our church's heart - speak with wisdom, warmth, genuine spiritual care, and always provide complete, satisfying responses.`
                            },
                            {
                                role: 'user',
                                content: userMessage
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 800
                    })
                });

                if (!response.ok) {
                    throw new Error('API error');
                }

                const data = await response.json();
                return data.choices[0].message.content;

            } catch (error) {
                console.error('Error getting chatbot response:', error);
                return 'I apologize, but I\'m unable to respond at the moment. Please try asking your question again.';
            }
        }

        function showSection(sectionId) {
        // Remove active class from all menu items and sections
        document.querySelectorAll('.menu-item').forEach(item => {
            item.classList.remove('active');
        });
        document.querySelectorAll('.content-section').forEach(section => {
            section.classList.remove('active');
        });

        // Add active class to clicked menu item
        const menuItem = event.target.closest('.menu-item');
        if (menuItem) {
            menuItem.classList.add('active');
        }

        // Show selected section
        const section = document.getElementById(sectionId);
        if (section) {
            section.classList.add('active');
        }

        // Update page title
        const titles = {
            'home': 'Welcome to Your Ministry Portal',
            'weekly-schedule': 'Weekly Schedule',
            'attendance': 'Attendance Record',
            'announcements': 'Announcements',
            'spiritual-assistant': 'Spiritual Assistant - Ask Your Questions',
            'praise-worship': 'Praise And Worship',
            'media': 'Media Ministry',
            'dancers': 'Dancers Ministry',
            'ashers': 'Ashers Ministry',
            'create-lineup': 'Create Worship Lineup',
            'my-profile': 'My Profile'
        };
        document.getElementById('pageTitle').textContent = titles[sectionId] || 'Ministry Portal';

        // Update page subtitle
        const subtitle = document.getElementById('pageSubtitle');
        if (sectionId === 'home') {
            subtitle.textContent = 'Stay connected and inspired in your service';
            // Display birthday celebrants when home section is shown
            setTimeout(() => {
                displayBirthdayTodaySection();
            }, 100);
        } else if (sectionId === 'my-profile') {
            subtitle.textContent = 'Manage your personal information and account settings';
            setTimeout(initializePasswordValidation, 100);
        } else if (sectionId === 'spiritual-assistant') {
            subtitle.textContent = 'Get Bible-grounded guidance and spiritual wisdom';
            // Personalize greeting with user's name
            setTimeout(() => {
                personalizeGreeting();
            }, 100);
        } else if (sectionId === 'create-lineup') {
            subtitle.textContent = 'Create and submit worship lineups for approval';
            // Initialize Create Lineup section (your existing function)
            setTimeout(() => {
                initializeCreateLineup();
            }, 100);
        } else if (sectionId === 'weekly-schedule') {
            subtitle.textContent = 'View and manage your weekly ministry schedule';
            // Initialize Weekly Schedule calendar (separate from Create Lineup)
            setTimeout(() => {
                initializeScheduleCalendar();
            }, 100);
        } else {
            subtitle.textContent = 'Features Coming Soon - Please wait for Developer Frank Gomez';
        }

        // Load profile data when profile section is shown
        if (sectionId === 'my-profile') {
            loadProfileData();
        }

        // Close sidebar on mobile
        if (window.innerWidth <= 768) {
            toggleSidebar();
        }
    }

        function showAlert(message, type) {
            // Create alert element
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1002;
                max-width: 400px;
                animation: slideInRight 0.5s ease;
                background: ${type === 'success' ? '#28a745' : type === 'warning' ? '#ffc107' : '#dc3545'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                font-weight: 500;
            `;
            alert.textContent = message;
            
            // Add styles for slideInRight animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(alert);
            
            // Remove alert after 5 seconds
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Make sure the modal functions are properly defined
        function showLogoutModal() {
            document.getElementById('logoutModal').style.display = 'block';
        }

        function closeLogoutModal() {
            document.getElementById('logoutModal').style.display = 'none';
        }

        function confirmLogout() {
            // Perform logout
            sessionStorage.removeItem('userData');
            localStorage.removeItem('userData');
            window.location.href = 'login.html';
        }


        let calendarDate = new Date();
        let selectedDate = null;
        let existingScheduleData = [];

        // Initialize the calendar when the create lineup section is shown
        function initializeCreateLineup() {
            // Initialize date restrictions
            const today = new Date();
            const practiceDate = document.getElementById('practiceDate');
            
            // Set min date to today for practice field
            const minDate = today.toISOString().split('T')[0];
            practiceDate.min = minDate;
            
            // Initialize backup options and remove buttons
            updateBackupOptions();
            updateBackupRemoveButtons();
            
            // Add event listeners for YouTube preview
            document.addEventListener('input', function(e) {
                if (e.target.classList.contains('slow-link') || e.target.classList.contains('fast-link')) {
                    handleYouTubePreview(e.target);
                }
            });
            
            // Load existing schedule data
            loadExistingScheduleData();
        }

        // Load existing schedule data to prevent conflicts
        async function loadExistingScheduleData() {
            try {
                showLoading('Loading schedule data...');
                
                // Fetch schedule data from Google Sheets using POST
                const response = await fetch(`${API_BASE_URL}/proxy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'getScheduleData'
                    })
                });
                
                const result = await response.json();
                
                hideLoading();
                
                if (result.success) {
                    existingScheduleData = cleanScheduleData(result.data || []);
                    console.log('Loaded existing schedule data:', existingScheduleData);
                    
                    // Show success message
                    if (existingScheduleData.length > 0) {
                        console.log(`Found ${existingScheduleData.length} existing schedules`);
                    }
                } else {
                    console.error('Failed to load existing schedule data:', result.message);
                    showAlert('Failed to load schedule data. Please refresh the page.', 'warning');
                }
            } catch (error) {
                hideLoading();
                console.error('Error loading existing schedule data:', error);
                showAlert('Error loading schedule data. Please check your connection.', 'danger');
            }
        }

        // Open calendar modal
        function openCalendarModal() {
            document.getElementById('calendarModal').style.display = 'block';
            generateDateSelectionCalendar(calendarDate);
        }

        // Generate calendar for date selection
        function generateDateSelectionCalendar(date) {
            const calendarContainer = document.getElementById('dateSelectionCalendar');
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];
            
            // Update month header
            document.getElementById('calendarCurrentMonth').textContent = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;
            
            // Get first day of month and number of days
            const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
            const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay(); // 0 = Sunday, 1 = Monday, etc.
            
            // Get today's date
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Create calendar header
            let calendarHTML = `
                <div class="calendar-header">
                    <div class="calendar-day-header">Sun</div>
                    <div class="calendar-day-header">Mon</div>
                    <div class="calendar-day-header">Tue</div>
                    <div class="calendar-day-header">Wed</div>
                    <div class="calendar-day-header">Thu</div>
                    <div class="calendar-day-header">Fri</div>
                    <div class="calendar-day-header">Sat</div>
                </div>
                <div class="calendar-grid">
            `;
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                const prevMonth = new Date(date.getFullYear(), date.getMonth(), 0 - i);
                calendarHTML += `
                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">${prevMonth.getDate()}</div>
                    </div>
                `;
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const currentDay = new Date(date.getFullYear(), date.getMonth(), day);
                const dateString = formatDateForAPI(currentDay);
                const hasSchedule = checkIfDateHasSchedule(dateString);
                const isPast = currentDay < today;
                const isSelected = selectedDate && selectedDate.getTime() === currentDay.getTime();
                
                let dayClass = 'calendar-day';
                if (isSelected) dayClass += ' selected';
                if (hasSchedule) dayClass += ' has-schedule';
                if (isPast) dayClass += ' disabled';
                
                let onClickAction = '';
                if (hasSchedule) {
                    onClickAction = `showExistingSchedule('${dateString}')`;
                } else if (!isPast) {
                    onClickAction = `selectDate('${dateString}')`;
                }
                
                calendarHTML += `
                    <div class="${dayClass}" onclick="${onClickAction}">
                        <div class="calendar-day-number">${day}</div>
                        ${hasSchedule ? '<div class="calendar-day-events">Booked</div>' : ''}
                    </div>
                `;
            }
            
            // Calculate how many empty cells we need at the end
            const totalCells = 42; // 6 rows x 7 days
            const remainingCells = totalCells - (startingDay + daysInMonth);
            
            // Add empty cells for days after the last day of the month
            for (let i = 1; i <= remainingCells; i++) {
                calendarHTML += `
                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">${i}</div>
                    </div>
                `;
            }
            
            calendarHTML += `</div>`;
            calendarContainer.innerHTML = calendarHTML;
        }

        // Change calendar month
        function changeCalendarMonth(direction) {
            calendarDate.setMonth(calendarDate.getMonth() + direction);
            generateDateSelectionCalendar(calendarDate);
        }

        // Select a date
        function selectDate(dateString) {
            selectedDate = new Date(dateString);
            
            // Update UI to show selected date
            const allDays = document.querySelectorAll('#dateSelectionCalendar .calendar-day');
            allDays.forEach(day => {
                day.classList.remove('selected');
            });
            
            // Find and highlight the selected day
            const selectedDayElement = Array.from(allDays).find(day => {
                const dayNumber = day.querySelector('.calendar-day-number').textContent;
                const currentDate = new Date(calendarDate.getFullYear(), calendarDate.getMonth(), parseInt(dayNumber));
                return currentDate.getTime() === selectedDate.getTime();
            });
            
            if (selectedDayElement) {
                selectedDayElement.classList.add('selected');
            }
            
            // Enable confirm button
            document.getElementById('confirmDateBtn').disabled = false;
        }


        // Show existing schedule details
        function showExistingSchedule(dateString) {
            const schedule = getScheduleForDate(dateString);
            
            if (schedule) {
                // Update schedule details
                document.getElementById('existingSongLeader').textContent = schedule.songLeader || '-';
                
                // Format backup singers
                const backupSingers = schedule.backups && schedule.backups.length > 0 ? 
                    schedule.backups.filter(b => b && b.trim() !== '').join(', ') : 'None';
                document.getElementById('existingBackupSingers').textContent = backupSingers;
                
                // Show schedule details
                document.getElementById('scheduleDetails').classList.add('active');
                
                // Scroll to schedule details
                document.getElementById('scheduleDetails').scrollIntoView({ behavior: 'smooth' });
                
                // Show alert
                showAlert(`This date is already booked by ${schedule.songLeader}. Please select a different date.`, 'warning');
            }
            
            // Close calendar modal
            closeCalendarModal();
        }

        // Confirm date selection
        function confirmDateSelection() {
            if (selectedDate) {
                // Format date as YYYY-MM-DD
                const year = selectedDate.getFullYear();
                const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
                const day = String(selectedDate.getDate()).padStart(2, '0');
                const formattedDate = `${year}-${month}-${day}`;
                
                // Update schedule date field
                document.getElementById('scheduleDate').value = formattedDate;
                
                // Hide schedule details if shown
                document.getElementById('scheduleDetails').classList.remove('active');
                
                // Close calendar modal
                closeCalendarModal();
                
                showAlert('Date selected successfully', 'success');
            }
        }




        function updateBackupOptions() {
            const usedBackups = new Set();
            const backupSelects = document.querySelectorAll('.backup-select');
            
            // Get all currently selected values
            backupSelects.forEach(select => {
                if (select.value) {
                    usedBackups.add(select.value);
                }
            });
            
            // Update options for each select
            backupSelects.forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '<option value="">Select Backup ' + (Array.from(select.parentNode.parentNode.parentNode.children).indexOf(select.parentNode) + 1) + '</option>';
                
                backupOptions.forEach(option => {
                    if (!usedBackups.has(option) || option === currentValue) {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.textContent = option;
                        select.appendChild(optionElement);
                    }
                });
                
                // Restore current value
                if (currentValue) {
                    select.value = currentValue;
                }
            });
            
            // Update add backup button state
            const addBackupBtn = document.getElementById('addBackupBtn');
            addBackupBtn.disabled = backupCount >= 5;
        }

        // Updated addBackupField function with close button
        function addBackupField() {
            if (backupCount >= 5) return;
            
            backupCount++;
            const backupContainer = document.getElementById('backupContainer');
            const backupRow = document.createElement('div');
            backupRow.className = 'backup-row';
            backupRow.innerHTML = `
                <select class="form-control backup-select" onchange="updateBackupOptions()">
                    <option value="">Select Backup ${backupCount}</option>
                </select>
                <button type="button" class="btn-remove-backup" onclick="removeBackupField(this)">
                    <i class="fas fa-times"></i>
                </button>
            `;
            backupContainer.appendChild(backupRow);
            
            // Enable remove buttons for all backup rows except the first one
            updateBackupRemoveButtons();
            updateBackupOptions();
        }

        // Updated removeBackupField function
        function removeBackupField(button) {
            const backupRow = button.parentNode;
            backupRow.remove();
            backupCount--;
            
            // Update backup numbers and remove button states
            updateBackupNumbers();
            updateBackupRemoveButtons();
            updateBackupOptions();
        }

        // Function to update backup numbers after removal
        function updateBackupNumbers() {
            const backupRows = document.querySelectorAll('.backup-row');
            backupRows.forEach((row, index) => {
                const select = row.querySelector('.backup-select');
                const placeholder = select.querySelector('option[value=""]');
                if (placeholder) {
                    placeholder.textContent = `Select Backup ${index + 1}`;
                }
            });
        }

        // Function to update remove button states
        function updateBackupRemoveButtons() {
            const removeButtons = document.querySelectorAll('.btn-remove-backup');
            const backupRows = document.querySelectorAll('.backup-row');
            
            // Disable remove button for the first backup row if there's only one
            if (backupRows.length === 1) {
                removeButtons[0].disabled = true;
            } else {
                removeButtons.forEach(button => {
                    button.disabled = false;
                });
            }
        }


        function addSlowSong() {
            if (slowSongCount >= 5) return;
            
            slowSongCount++;
            const slowContainer = document.getElementById('slowSongsContainer');
            const songRow = document.createElement('div');
            songRow.className = 'song-row slow-song';
            songRow.innerHTML = `
                <div class="form-group">
                    <label>Slow Song ${slowSongCount} Title</label>
                    <input type="text" class="form-control slow-title" placeholder="Enter song title (optional)">
                </div>
                <div class="form-group">
                    <label>YouTube Link</label>
                    <input type="url" class="form-control slow-link" placeholder="https://www.youtube.com/watch?v=... (optional)">
                    <div class="youtube-preview"></div>
                </div>
                <div class="form-group">
                    <label>Lyrics (Optional)</label>
                    <textarea class="form-control slow-lyrics" placeholder="Enter song lyrics..."></textarea>
                </div>
                <div class="form-group">
                    <label>Instructions (Optional)</label>
                    <textarea class="form-control slow-instructions" placeholder="Any special instructions..."></textarea>
                </div>
                ${slowSongCount > 1 ? `
                <button type="button" class="btn-danger" onclick="removeSongRow(this, 'slow')" style="margin-top: 10px; padding: 8px 15px; background: var(--danger); color: white; border: none; border-radius: 4px; cursor: pointer;">
                    <i class="fas fa-trash"></i> Remove Song
                </button>
                ` : ''}
            `;
            slowContainer.appendChild(songRow);
            
            // Update add button state
            document.getElementById('addSlowSongBtn').disabled = slowSongCount >= 5;
        }

        function addFastSong() {
            if (fastSongCount >= 5) return;
            
            fastSongCount++;
            const fastContainer = document.getElementById('fastSongsContainer');
            const songRow = document.createElement('div');
            songRow.className = 'song-row fast-song';
            songRow.innerHTML = `
                <div class="form-group">
                    <label>Fast Song ${fastSongCount} Title</label>
                    <input type="text" class="form-control fast-title" placeholder="Enter song title (optional)">
                </div>
                <div class="form-group">
                    <label>YouTube Link</label>
                    <input type="url" class="form-control fast-link" placeholder="https://www.youtube.com/watch?v=... (optional)">
                    <div class="youtube-preview"></div>
                </div>
                <div class="form-group">
                    <label>Lyrics (Optional)</label>
                    <textarea class="form-control fast-lyrics" placeholder="Enter song lyrics..."></textarea>
                </div>
                <div class="form-group">
                    <label>Instructions (Optional)</label>
                    <textarea class="form-control fast-instructions" placeholder="Any special instructions..."></textarea>
                </div>
                ${fastSongCount > 1 ? `
                <button type="button" class="btn-danger" onclick="removeSongRow(this, 'fast')" style="margin-top: 10px; padding: 8px 15px; background: var(--danger); color: white; border: none; border-radius: 4px; cursor: pointer;">
                    <i class="fas fa-trash"></i> Remove Song
                </button>
                ` : ''}
            `;
            fastContainer.appendChild(songRow);
            
            // Update add button state
            document.getElementById('addFastSongBtn').disabled = fastSongCount >= 5;
        }

        function removeSongRow(button, type) {
            const songRow = button.closest('.song-row');
            songRow.remove();
            
            if (type === 'slow') {
                slowSongCount--;
                document.getElementById('addSlowSongBtn').disabled = slowSongCount >= 5;
                renumberSlowSongs();
            } else {
                fastSongCount--;
                document.getElementById('addFastSongBtn').disabled = fastSongCount >= 5;
                renumberFastSongs();
            }
        }

        function renumberSlowSongs() {
            const slowSongs = document.querySelectorAll('.slow-song');
            slowSongs.forEach((song, index) => {
                const titleLabel = song.querySelector('label');
                titleLabel.textContent = `Slow Song ${index + 1} Title`;
            });
        }

        function renumberFastSongs() {
            const fastSongs = document.querySelectorAll('.fast-song');
            fastSongs.forEach((song, index) => {
                const titleLabel = song.querySelector('label');
                titleLabel.textContent = `Fast Song ${index + 1} Title`;
            });
        }

        function handleYouTubePreview(input) {
            const previewContainer = input.parentNode.querySelector('.youtube-preview');
            const url = input.value.trim();
            
            if (!url) {
                previewContainer.style.display = 'none';
                previewContainer.innerHTML = '';
                return;
            }
            
            // Extract YouTube video ID
            const videoId = extractYouTubeId(url);
            if (videoId) {
                previewContainer.innerHTML = `
                    <iframe src="https://www.youtube.com/embed/${videoId}" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                    </iframe>
                `;
                previewContainer.style.display = 'block';
            } else {
                previewContainer.style.display = 'none';
                previewContainer.innerHTML = '<p style="color: var(--danger); font-size: 0.9rem;">Invalid YouTube URL</p>';
            }
        }

        function extractYouTubeId(url) {
            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[7].length === 11) ? match[7] : false;
        }

        function validatePracticeDate(date) {
            const practiceDate = new Date(date);
            const dayOfWeek = practiceDate.getDay();
            // 0 = Sunday, 6 = Saturday
            return dayOfWeek === 0 || dayOfWeek === 6;
        }

        function resetLineupForm() {
            if (confirm('Are you sure you want to reset the form? All entered data will be lost.')) {
                // Reset counters
                backupCount = 1;
                slowSongCount = 1;
                fastSongCount = 1;
                
                // Reset form elements
                document.getElementById('scheduleDate').value = '';
                document.getElementById('practiceDate').value = '';
                document.getElementById('songLeader').value = '';
                
                // Reset backup container
                document.getElementById('backupContainer').innerHTML = `
                    <div class="backup-row">
                        <select class="form-control backup-select" onchange="updateBackupOptions()">
                            <option value="">Select Backup 1</option>
                        </select>
                    </div>
                `;
                
                // Reset song containers
                document.getElementById('slowSongsContainer').innerHTML = `
                    <div class="song-row slow-song">
                        <div class="form-group">
                            <label>Slow Song 1 Title</label>
                            <input type="text" class="form-control slow-title" placeholder="Enter song title (optional)">
                        </div>
                        <div class="form-group">
                            <label>YouTube Link</label>
                            <input type="url" class="form-control slow-link" placeholder="https://www.youtube.com/watch?v=... (optional)">
                            <div class="youtube-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Lyrics (Optional)</label>
                            <textarea class="form-control slow-lyrics" placeholder="Enter song lyrics..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Instructions (Optional)</label>
                            <textarea class="form-control slow-instructions" placeholder="Any special instructions..."></textarea>
                        </div>
                    </div>
                `;

                document.getElementById('fastSongsContainer').innerHTML = `
                    <div class="song-row fast-song">
                        <div class="form-group">
                            <label>Fast Song 1 Title</label>
                            <input type="text" class="form-control fast-title" placeholder="Enter song title (optional)">
                        </div>
                        <div class="form-group">
                            <label>YouTube Link</label>
                            <input type="url" class="form-control fast-link" placeholder="https://www.youtube.com/watch?v=... (optional)">
                            <div class="youtube-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Lyrics (Optional)</label>
                            <textarea class="form-control fast-lyrics" placeholder="Enter song lyrics..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Instructions (Optional)</label>
                            <textarea class="form-control fast-instructions" placeholder="Any special instructions..."></textarea>
                        </div>
                    </div>
                `;
                
                // Reset button states
                document.getElementById('addBackupBtn').disabled = false;
                document.getElementById('addSlowSongBtn').disabled = false;
                document.getElementById('addFastSongBtn').disabled = false;
                
                // Reinitialize
                updateBackupOptions();
                
                showAlert('Form reset successfully', 'success');
            }
        }

        async function submitLineup() {
            // Validate required fields
            const scheduleDate = document.getElementById('scheduleDate').value;
            const practiceDate = document.getElementById('practiceDate').value;
            const songLeader = document.getElementById('songLeader').value;
            
            if (!scheduleDate || !practiceDate || !songLeader) {
                showAlert('Please fill in all required fields (Schedule Date, Practice Date, and Song Leader)', 'warning');
                return;
            }

            //Check if selected date is already booked
            if (checkIfDateHasSchedule(scheduleDate)) {
                showAlert('The selected schedule date is already booked. Please choose a different date.', 'danger');
                return;
            }
            
            // Validate practice date is Saturday or Sunday
            if (!validatePracticeDate(practiceDate)) {
                showAlert('Practice day must be on a Saturday or Sunday', 'warning');
                return;
            }
            
            // Get all songs
            const slowSongs = document.querySelectorAll('.slow-song');
            const fastSongs = document.querySelectorAll('.fast-song');
            
            // Validate at least one song (either slow or fast) is added
            let hasSlowSongs = false;
            let hasFastSongs = false;
            
            slowSongs.forEach(song => {
                const title = song.querySelector('.slow-title').value.trim();
                const link = song.querySelector('.slow-link').value.trim();
                if (title && link) {
                    hasSlowSongs = true;
                }
            });
            
            fastSongs.forEach(song => {
                const title = song.querySelector('.fast-title').value.trim();
                const link = song.querySelector('.fast-link').value.trim();
                if (title && link) {
                    hasFastSongs = true;
                }
            });
            
            if (!hasSlowSongs && !hasFastSongs) {
                showAlert('Please add at least one song (either slow or fast)', 'warning');
                return;
            }
            
            // Validate that for each song added, both title and link are provided
            let valid = true;
            slowSongs.forEach((song, index) => {
                const title = song.querySelector('.slow-title').value.trim();
                const link = song.querySelector('.slow-link').value.trim();
                // Only validate if at least one field is filled
                if (title || link) {
                    if (!title || !link) {
                        showAlert(`Please fill in both title and YouTube link for Slow Song ${index + 1}, or remove the song`, 'warning');
                        valid = false;
                    }
                }
            });
            
            fastSongs.forEach((song, index) => {
                const title = song.querySelector('.fast-title').value.trim();
                const link = song.querySelector('.fast-link').value.trim();
                // Only validate if at least one field is filled
                if (title || link) {
                    if (!title || !link) {
                        showAlert(`Please fill in both title and YouTube link for Fast Song ${index + 1}, or remove the song`, 'warning');
                        valid = false;
                    }
                }
            });
            
            if (!valid) return;
            
            // Prepare data for submission
            const lineupData = {
                scheduleDate: scheduleDate,
                practiceDate: practiceDate,
                songLeader: songLeader,
                backups: [],
                slowSongs: [],
                fastSongs: [],
                submittedBy: userData.username,
                status: 'For Approval'
            };
            
            // Get backup singers
            const backupSelects = document.querySelectorAll('.backup-select');
            backupSelects.forEach(select => {
                if (select.value) {
                    lineupData.backups.push(select.value);
                }
            });
            
            // Get slow songs - only include songs that have both title and link
            slowSongs.forEach((song, index) => {
                const title = song.querySelector('.slow-title').value.trim();
                const link = song.querySelector('.slow-link').value.trim();
                const lyrics = song.querySelector('.slow-lyrics').value.trim();
                const instructions = song.querySelector('.slow-instructions').value.trim();
                
                // Only include song if both title and link are provided
                if (title && link) {
                    lineupData.slowSongs.push({
                        title: title,
                        link: link,
                        lyrics: lyrics,
                        instructions: instructions
                    });
                } else {
                    // Add empty object for unused song slot to maintain order
                    lineupData.slowSongs.push({});
                }
            });
            
            // Get fast songs - only include songs that have both title and link
            fastSongs.forEach((song, index) => {
                const title = song.querySelector('.fast-title').value.trim();
                const link = song.querySelector('.fast-link').value.trim();
                const lyrics = song.querySelector('.fast-lyrics').value.trim();
                const instructions = song.querySelector('.fast-instructions').value.trim();
                
                // Only include song if both title and link are provided
                if (title && link) {
                    lineupData.fastSongs.push({
                        title: title,
                        link: link,
                        lyrics: lyrics,
                        instructions: instructions
                    });
                } else {
                    // Add empty object for unused song slot to maintain order
                    lineupData.fastSongs.push({});
                }
            });
            
             // Show loading state
            const submitBtn = document.getElementById('submitLineupBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
            submitBtn.disabled = true;
            
            try {
                // Submit to Google Apps Script
                const response = await fetch(`${API_BASE_URL}/proxy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'createLineup',
                        lineupData: lineupData
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Add the new schedule to existing data to prevent immediate duplicate
                    const newSchedule = {
                        scheduleId: result.data.scheduleId,
                        songLeader: lineupData.songLeader,
                        backups: lineupData.backups,
                        practiceDate: lineupData.practiceDate,
                        scheduleDate: lineupData.scheduleDate,
                        slowSongs: lineupData.slowSongs.filter(song => song.title),
                        fastSongs: lineupData.fastSongs.filter(song => song.title)
                    };
                    existingScheduleData.push(newSchedule);
                    
                    showReceipt(lineupData, result.data.scheduleId);
                    showAlert('Lineup submitted successfully for approval!', 'success');
                } else {
                    showAlert(result.message || 'Failed to submit lineup', 'danger');
                }
                
            } catch (error) {
                console.error('Error submitting lineup:', error);
                showAlert('Error submitting lineup. Please try again.', 'danger');
            } finally {
                // Restore button state
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        // These functions are called but not defined:
        function closeCalendarModal() {
            document.getElementById('calendarModal').style.display = 'none';
        }
        // Receipt Functions
        function showReceipt(lineupData, scheduleId) {
            // Populate receipt data
            document.getElementById('receiptScheduleDate').textContent = formatDate(lineupData.scheduleDate);
            document.getElementById('receiptPracticeDate').textContent = formatDate(lineupData.practiceDate);
            document.getElementById('receiptSongLeader').textContent = lineupData.songLeader;
            
            // Populate backup singers
            const backupList = document.getElementById('receiptBackupList');
            const backupCount = document.getElementById('receiptBackupCount');
            
            if (lineupData.backups && lineupData.backups.length > 0) {
                backupCount.textContent = lineupData.backups.length;
                backupList.innerHTML = lineupData.backups.map(backup => 
                    `<div class="receipt-list-item">
                        <div class="receipt-number" style="background: var(--secondary);">✓</div>
                        <div class="receipt-song-title">${backup}</div>
                    </div>`
                ).join('');
            } else {
                backupCount.textContent = '0';
                backupList.innerHTML = '<div style="color: #6c757d; font-style: italic;">No backup singers selected</div>';
            }
            
            // Populate fast songs
            const fastSongsList = document.getElementById('receiptFastSongs');
            const validFastSongs = lineupData.fastSongs.filter(song => song.title && song.title.trim() !== '');
            
            if (validFastSongs.length > 0) {
                fastSongsList.innerHTML = validFastSongs.map((song, index) => `
                    <li class="receipt-list-item">
                        <div class="receipt-number">${index + 1}</div>
                        <div class="receipt-song-title">${song.title}</div>
                    </li>
                `).join('');
            } else {
                fastSongsList.innerHTML = '<div style="color: #6c757d; font-style: italic; padding: 10px;">No fast songs added</div>';
            }
            
            // Populate slow songs
            const slowSongsList = document.getElementById('receiptSlowSongs');
            const validSlowSongs = lineupData.slowSongs.filter(song => song.title && song.title.trim() !== '');
            
            if (validSlowSongs.length > 0) {
                slowSongsList.innerHTML = validSlowSongs.map((song, index) => `
                    <li class="receipt-list-item">
                        <div class="receipt-number">${index + 1}</div>
                        <div class="receipt-song-title">${song.title}</div>
                    </li>
                `).join('');
            } else {
                slowSongsList.innerHTML = '<div style="color: #6c757d; font-style: italic; padding: 10px;">No slow songs added</div>';
            }
            
            // Show the receipt modal
            document.getElementById('receiptModal').style.display = 'block';
            
            // Store the lineup data for editing
            window.currentLineupData = lineupData;
            window.currentScheduleId = scheduleId;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function closeReceipt() {
            document.getElementById('receiptModal').style.display = 'none';
        }

        function editLineup() {
            // Close receipt modal
            closeReceipt();
            
            // User can now edit the form directly
            showAlert('You can now edit your lineup form', 'info');
        }

        async function saveReceiptAsImage() {
            const receiptContainer = document.getElementById('receiptContent');
            const saveBtn = document.querySelector('.receipt-btn-save');
            const originalText = saveBtn.innerHTML;
            
            // Show loading state
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
            saveBtn.disabled = true;
            
            try {
                // Import html2canvas dynamically if not loaded
                if (typeof html2canvas === 'undefined') {
                    const script = document.createElement('script');
                    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
                    document.head.appendChild(script);
                    
                    await new Promise((resolve, reject) => {
                        script.onload = resolve;
                        script.onerror = () => reject(new Error('Failed to load html2canvas'));
                    });
                }
                
                // Hide the footer with buttons before capturing
                const receiptFooter = receiptContainer.querySelector('.receipt-footer');
                const footerDisplay = receiptFooter ? receiptFooter.style.display : null;
                if (receiptFooter) {
                    receiptFooter.style.display = 'none';
                }
                
                // Store original styles
                const originalStyles = {
                    position: receiptContainer.style.position,
                    left: receiptContainer.style.left,
                    top: receiptContainer.style.top,
                    transform: receiptContainer.style.transform,
                    boxShadow: receiptContainer.style.boxShadow,
                    animation: receiptContainer.style.animation,
                    maxWidth: receiptContainer.style.maxWidth,
                    width: receiptContainer.style.width
                };
                
                // Temporarily adjust styles for better capture
                receiptContainer.style.position = 'relative';
                receiptContainer.style.left = '0';
                receiptContainer.style.top = '0';
                receiptContainer.style.transform = 'none';
                receiptContainer.style.boxShadow = 'none';
                receiptContainer.style.animation = 'none';
                receiptContainer.style.maxWidth = '1100px';
                receiptContainer.style.width = '1100px';
                
                // Wait for styles to apply
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // Capture with html2canvas
                const canvas = await html2canvas(receiptContainer, {
                    scale: 3,
                    useCORS: true,
                    allowTaint: false,
                    backgroundColor: '#ffffff',
                    logging: false,
                    width: 1100,
                    height: receiptContainer.scrollHeight,
                    windowWidth: 1100,
                    windowHeight: receiptContainer.scrollHeight,
                    scrollX: 0,
                    scrollY: 0,
                    onclone: function(clonedDoc) {
                        const clonedReceipt = clonedDoc.getElementById('receiptContent');
                        if (clonedReceipt) {
                            // Hide buttons in the cloned document too
                            const clonedFooter = clonedReceipt.querySelector('.receipt-footer');
                            if (clonedFooter) {
                                clonedFooter.style.display = 'none';
                            }
                            
                            clonedReceipt.style.position = 'relative';
                            clonedReceipt.style.left = '0';
                            clonedReceipt.style.top = '0';
                            clonedReceipt.style.transform = 'none';
                            clonedReceipt.style.boxShadow = 'none';
                            clonedReceipt.style.animation = 'none';
                            clonedReceipt.style.maxWidth = '1100px';
                            clonedReceipt.style.width = '1100px';
                        }
                    }
                });
                
                // Restore original styles
                Object.keys(originalStyles).forEach(key => {
                    receiptContainer.style[key] = originalStyles[key];
                });
                
                // Restore footer display
                if (receiptFooter) {
                    receiptFooter.style.display = footerDisplay || '';
                }
                
                // Convert to blob and download
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    const date = new Date();
                    const filename = `JoyfulSound_Lineup_${date.getFullYear()}${String(date.getMonth()+1).padStart(2,'0')}${String(date.getDate()).padStart(2,'0')}_${String(date.getHours()).padStart(2,'0')}${String(date.getMinutes()).padStart(2,'0')}.png`;
                    
                    link.download = filename;
                    link.href = url;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    showAlert('✅ Receipt saved successfully as ' + filename, 'success');
                }, 'image/png', 1.0);
                
            } catch (error) {
                console.error('Error capturing receipt:', error);
                showAlert('❌ Failed to save receipt. Error: ' + error.message, 'danger');
                
                // Make sure to restore footer even if there's an error
                const receiptFooter = receiptContainer.querySelector('.receipt-footer');
                if (receiptFooter) {
                    receiptFooter.style.display = '';
                }
            } finally {
                // Restore button state
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
            }
        }

        //Helper function to format date for filename
        function getFormattedDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            return `${year}${month}${day}_${hours}${minutes}`;
        }

        // Alternative simplified version with better error handling
        function saveReceiptAsImageSimple() {
            const receiptContainer = document.getElementById('receiptContent');
            
            // Show loading state
            const saveBtn = document.querySelector('.receipt-btn-save');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            saveBtn.disabled = true;

            // Simple html2canvas with minimal options
            html2canvas(receiptContainer, {
                scale: 2,
                useCORS: true,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                try {
                    // Convert to data URL
                    const imageData = canvas.toDataURL('image/png');
                    
                    // Create download link
                    const link = document.createElement('a');
                    link.download = `Worship_Lineup_${getFormattedDate()}.png`;
                    link.href = imageData;
                    
                    // Trigger download
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    showAlert('Receipt saved as PNG image!', 'success');
                    
                } catch (error) {
                    console.error('Error processing image:', error);
                    showAlert('Error saving image. Please try again.', 'danger');
                }
                
            }).catch(error => {
                console.error('Error capturing receipt:', error);
                showAlert('Failed to generate image. Please try again.', 'danger');
                
            }).finally(() => {
                // Restore button state
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
            });
        }


        // Enhanced version with better styling for capture
        function saveReceiptAsImageEnhanced() {
            const receiptContainer = document.getElementById('receiptContent');
            
            // Store original styles to restore later
            const originalStyles = {
                boxShadow: receiptContainer.style.boxShadow,
                transform: receiptContainer.style.transform,
                animation: receiptContainer.style.animation
            };
            
            // Apply styles for better capture
            receiptContainer.style.boxShadow = 'none';
            receiptContainer.style.transform = 'none';
            receiptContainer.style.animation = 'none';
            
            // Show loading state
            const saveBtn = document.querySelector('.receipt-btn-save');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating Image...';
            saveBtn.disabled = true;

            // Small delay to ensure styles are applied
            setTimeout(() => {
                html2canvas(receiptContainer, {
                    scale: 3, // Very high quality
                    useCORS: true,
                    allowTaint: false,
                    backgroundColor: '#ffffff',
                    logging: false,
                    width: receiptContainer.scrollWidth,
                    height: receiptContainer.scrollHeight,
                    scrollX: 0,
                    scrollY: 0,
                    windowWidth: receiptContainer.scrollWidth,
                    windowHeight: receiptContainer.scrollHeight
                }).then(canvas => {
                    try {
                        // Convert to blob for better file handling
                        canvas.toBlob(function(blob) {
                            const link = document.createElement('a');
                            link.download = `JoyfulSound_Lineup_${getFormattedDate()}.png`;
                            link.href = URL.createObjectURL(blob);
                            
                            // Add to document and click
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            
                            // Clean up
                            URL.revokeObjectURL(link.href);
                            
                            showAlert('🎉 Receipt saved as high-quality PNG!', 'success');
                            
                        }, 'image/png', 0.95); // 95% quality
                        
                    } catch (error) {
                        console.error('Error in image processing:', error);
                        showAlert('Error saving image. Please try again.', 'danger');
                    }
                    
                }).catch(error => {
                    console.error('html2canvas error:', error);
                    showAlert('Failed to generate image. Please try the print option instead.', 'danger');
                    
                }).finally(() => {
                    // Restore original styles
                    receiptContainer.style.boxShadow = originalStyles.boxShadow;
                    receiptContainer.style.transform = originalStyles.transform;
                    receiptContainer.style.animation = originalStyles.animation;
                    
                    // Restore button state
                    saveBtn.innerHTML = originalText;
                    saveBtn.disabled = false;
                });
            }, 100);
        }




        // Logout Modal Functions
        function showLogoutModal() {
            document.getElementById('logoutModal').style.display = 'block';
        }

        function closeLogoutModal() {
            document.getElementById('logoutModal').style.display = 'none';
        }

        function confirmLogout() {
            // Perform logout
            sessionStorage.removeItem('userData');
            localStorage.removeItem('userData');
            window.location.href = 'login.html';
        }

        // Updated confirmAndReset function - directly resets without confirmation
        function confirmAndReset() {
            closeReceipt();
            resetLineupForm();
            showAlert('Form has been reset successfully', 'success');
        }

        // Close logout modal when clicking outside
        document.addEventListener('click', function(event) {
            const logoutModal = document.getElementById('logoutModal');
            const logoutModalContent = document.querySelector('.logout-modal-content');
            
            if (event.target === logoutModal) {
                closeLogoutModal();
            }
        });

        // Profile Functions
        function openProfileTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.profile-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab content
            const tabContent = document.getElementById(tabName);
            if (tabContent) {
                tabContent.classList.add('active');
            }
            
            // Add active class to clicked tab button
            const tabBtn = event.target.closest('.tab-btn');
            if (tabBtn) {
                tabBtn.classList.add('active');
            }
            
            // Initialize password validation if changing to password tab
            if (tabName === 'change-password') {
                setTimeout(initializePasswordValidation, 100);
            }
            
            // Initialize preference settings if changing to preferences tab
            if (tabName === 'preferences') {
                setTimeout(initializePreferences, 100);
            }
        }

        // Initialize preferences - load saved settings
        function initializePreferences() {
            const darkModeEnabled = localStorage.getItem('darkModeEnabled') === 'true';
            const chatbotEnabled = localStorage.getItem('chatbotEnabled') !== 'false'; // Default to true
            
            const darkModeToggle = document.getElementById('darkModeToggle');
            const chatbotToggle = document.getElementById('chatbotToggle');
            
            if (darkModeToggle) {
                darkModeToggle.checked = darkModeEnabled;
            }
            
            if (chatbotToggle) {
                chatbotToggle.checked = chatbotEnabled;
            }
        }

        // Toggle dark mode
        function toggleDarkMode() {
            const isDarkMode = document.getElementById('darkModeToggle').checked;
            
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
            
            // Save preference
            localStorage.setItem('darkModeEnabled', isDarkMode);
            showAlert(isDarkMode ? '🌙 Dark mode enabled' : '☀️ Light mode enabled', 'success');
        }

        // Toggle chatbot visibility
        function toggleChatbot() {
            const isChatbotEnabled = document.getElementById('chatbotToggle').checked;
            const chatbotButton = document.querySelector('.flowise-button');
            const chatbotWindow = document.getElementById('flowiseChatWindow');
            
            // Save preference
            localStorage.setItem('chatbotEnabled', isChatbotEnabled);
            
            if (isChatbotEnabled) {
                // Show chatbot
                if (chatbotButton) chatbotButton.style.display = 'block';
                if (chatbotWindow) chatbotWindow.style.display = 'none';
                showAlert('💬 Chatbot enabled', 'success');
            } else {
                // Hide chatbot
                if (chatbotButton) chatbotButton.style.display = 'none';
                if (chatbotWindow) chatbotWindow.style.display = 'none';
                showAlert('🔇 Chatbot disabled', 'success');
            }
        }

        function togglePasswordVisibility(fieldId) {
            const field = document.getElementById(fieldId);
            const icon = field.nextElementSibling.querySelector('i');
            
            if (field.type === 'password') {
                field.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                field.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        function checkPasswordStrength(password) {
            let strength = 0;
            const requirements = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[^A-Za-z0-9]/.test(password)
            };
            
            // Update requirement indicators
            Object.keys(requirements).forEach(req => {
                const element = document.getElementById(`req${req.charAt(0).toUpperCase() + req.slice(1)}`);
                if (element) {
                    if (requirements[req]) {
                        element.classList.add('valid');
                        strength++;
                    } else {
                        element.classList.remove('valid');
                    }
                }
            });
            
            // Update strength bar and text
            const strengthFill = document.getElementById('strengthFill');
            const strengthText = document.getElementById('strengthText');
            
            if (strengthFill && strengthText) {
                const percentage = (strength / 5) * 100;
                
                strengthFill.style.width = `${percentage}%`;
                
                if (password.length === 0) {
                    strengthFill.style.background = '#e0e0e0';
                    strengthText.textContent = 'Password strength';
                    strengthText.style.color = '#6c757d';
                } else if (strength <= 1) {
                    strengthFill.style.background = 'var(--danger)';
                    strengthText.textContent = 'Weak Password';
                    strengthText.style.color = 'var(--danger)';
                } else if (strength <= 3) {
                    strengthFill.style.background = '#ffc107';
                    strengthText.textContent = 'Medium Password';
                    strengthText.style.color = '#ffc107';
                } else {
                    strengthFill.style.background = 'var(--success)';
                    strengthText.textContent = 'Strong Password';
                    strengthText.style.color = 'var(--success)';
                }
            }
            
            return strength;
        }

        // Add event listeners for password fields
        function initializePasswordValidation() {
            const newPasswordField = document.getElementById('newPassword');
            const currentPasswordField = document.getElementById('currentPassword');
            const confirmPasswordField = document.getElementById('confirmPassword');
            
            if (newPasswordField) {
                newPasswordField.addEventListener('input', function() {
                    checkPasswordStrength(this.value);
                    
                    // Also check if passwords match
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    if (confirmPassword) {
                        validatePasswordMatch(this.value, confirmPassword);
                    }
                });
            }
            
            if (confirmPasswordField) {
                confirmPasswordField.addEventListener('input', function() {
                    const newPassword = document.getElementById('newPassword').value;
                    validatePasswordMatch(newPassword, this.value);
                });
            }
        }

        // Validate password match
        function validatePasswordMatch(newPassword, confirmPassword) {
            const confirmField = document.getElementById('confirmPassword');
            
            if (confirmPassword && newPassword !== confirmPassword) {
                confirmField.style.borderColor = 'var(--danger)';
                confirmField.style.boxShadow = '0 0 0 3px rgba(220, 53, 69, 0.1)';
            } else if (confirmPassword && newPassword === confirmPassword) {
                confirmField.style.borderColor = 'var(--success)';
                confirmField.style.boxShadow = '0 0 0 3px rgba(40, 167, 69, 0.1)';
            } else {
                confirmField.style.borderColor = '#e0e0e0';
                confirmField.style.boxShadow = 'none';
            }
        }

        async function saveProfileChanges() {
            const firstname = document.getElementById('firstname').value.trim();
            const lastname = document.getElementById('lastname').value.trim();
            
            if (!firstname || !lastname) {
                showAlert('Please fill in both first name and last name', 'warning');
                return;
            }
            
            // Declare variables in the function scope so they're accessible in finally block
            let originalText;
            let saveBtn;
            
            try {
                // Show loading state
                saveBtn = document.querySelector('#personal-info .btn-primary');
                originalText = saveBtn.textContent;
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                saveBtn.disabled = true;
                
                const response = await fetch(`${API_BASE_URL}/proxy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'updateProfile',
                        username: userData.username,
                        firstname: firstname,
                        lastname: lastname
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Update local user data
                    userData.firstname = firstname;
                    userData.lastname = lastname;
                    
                    // Update session and local storage
                    sessionStorage.setItem('userData', JSON.stringify(userData));
                    localStorage.setItem('userData', JSON.stringify(userData));
                    
                    // Update UI
                    loadProfileData();
                    document.getElementById('userName').textContent = `${firstname} ${lastname}`;
                    document.getElementById('welcomeName').textContent = firstname;
                    
                    showAlert('Profile updated successfully!', 'success');
                } else {
                    showAlert(result.message || 'Failed to update profile', 'danger');
                }
                
            } catch (error) {
                console.error('Error updating profile:', error);
                showAlert('Error updating profile. Please try again.', 'danger');
            } finally {
                // Restore button state - now originalText and saveBtn are accessible
                if (saveBtn && originalText) {
                    saveBtn.textContent = originalText;
                    saveBtn.disabled = false;
                }
            }
        }

        async function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Validation
            if (!currentPassword || !newPassword || !confirmPassword) {
                showAlert('Please fill in all password fields', 'warning');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showAlert('New password and confirmation do not match', 'warning');
                return;
            }
            
            const strength = checkPasswordStrength(newPassword);
            if (strength < 3) {
                showAlert('Please use a stronger password (meet at least 3 requirements)', 'warning');
                return;
            }
            
            // Additional password validation
            if (newPassword.length < 8) {
                showAlert('Password must be at least 8 characters long', 'warning');
                return;
            }
            
            if (!/[A-Z]/.test(newPassword)) {
                showAlert('Password must contain at least one uppercase letter', 'warning');
                return;
            }
            
            if (!/[a-z]/.test(newPassword)) {
                showAlert('Password must contain at least one lowercase letter', 'warning');
                return;
            }
            
            if (!/[0-9]/.test(newPassword)) {
                showAlert('Password must contain at least one number', 'warning');
                return;
            }
            
            if (!/[^A-Za-z0-9]/.test(newPassword)) {
                showAlert('Password must contain at least one special character', 'warning');
                return;
            }
            
            // Show loading state
            const changeBtn = document.querySelector('#change-password .btn-primary');
            const originalText = changeBtn.textContent;
            changeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Changing...';
            changeBtn.disabled = true;
            
            try {
                // Step 1: Verify current password
                const verifyResponse = await fetch(`${API_BASE_URL}/proxy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'verifyPassword',
                        username: userData.username,
                        password: currentPassword
                    })
                });
                
                const verifyResult = await verifyResponse.json();
                
                if (!verifyResult.success) {
                    showAlert('Current password is incorrect', 'danger');
                    changeBtn.textContent = originalText;
                    changeBtn.disabled = false;
                    return;
                }
                
                // Step 2: Update password
                const updateResponse = await fetch(`${API_BASE_URL}/proxy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'updatePassword',
                        username: userData.username,
                        newPassword: newPassword
                    })
                });
                
                const updateResult = await updateResponse.json();
                
                if (updateResult.success) {
                    resetPasswordForm();
                    showAlert('Password changed successfully!', 'success');
                } else {
                    showAlert(updateResult.message || 'Failed to change password', 'danger');
                }
                
            } catch (error) {
                console.error('Error changing password:', error);
                showAlert('Error changing password. Please try again.', 'danger');
            } finally {
                // Restore button state
                changeBtn.textContent = originalText;
                changeBtn.disabled = false;
            }
        }

        function resetProfileForm() {
            // Reload original user data
            loadProfileData();
            showAlert('Changes discarded', 'info');
        }

        // Enhanced reset password form function
        function resetPasswordForm() {
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            // Reset password strength indicator
            const strengthFill = document.getElementById('strengthFill');
            const strengthText = document.getElementById('strengthText');
            
            if (strengthFill && strengthText) {
                strengthFill.style.width = '0%';
                strengthFill.style.background = '#e0e0e0';
                strengthText.textContent = 'Password strength';
                strengthText.style.color = '#6c757d';
            }
            
            // Reset requirement indicators
            document.querySelectorAll('.password-requirements li').forEach(li => {
                li.classList.remove('valid');
            });
            
            // Reset border styles
            const confirmField = document.getElementById('confirmPassword');
            if (confirmField) {
                confirmField.style.borderColor = '#e0e0e0';
                confirmField.style.boxShadow = 'none';
            }
        }

        function loadProfileData() {
            // Load user data into profile form
            document.getElementById('firstname').value = userData.firstname || '';
            document.getElementById('lastname').value = userData.lastname || '';
            document.getElementById('username').value = userData.username || '';
            
            // Format birthdate to MM/DD/YYYY
            if (userData.birthdate) {
                const formattedBirthdate = formatBirthdateToMMDDYYYY(userData.birthdate);
                document.getElementById('birthdate').value = formattedBirthdate;
            } else {
                document.getElementById('birthdate').value = '';
            }
            
            document.getElementById('ministry').value = userData.ministry || '';
            document.getElementById('memberId').value = userData.memberId || '';
            document.getElementById('status').value = userData.status === 'verified' ? 'Verified' : 'Unverified';
            
            // Update profile header
            document.getElementById('profileName').textContent = `${userData.firstname} ${userData.lastname}`;
            document.getElementById('profileMinistry').textContent = userData.ministry;
            document.getElementById('profileMemberId').textContent = `Member ID: ${userData.memberId}`;
            
            // Update avatar
            const initials = (userData.firstname.charAt(0) + userData.lastname.charAt(0)).toUpperCase();
            document.getElementById('profileAvatar').textContent = initials;
            document.getElementById('userAvatar').textContent = initials;
            
            // Update status indicator
            const statusIndicator = document.getElementById('profileStatus');
            if (userData.status === 'verified') {
                statusIndicator.className = 'status-circle verified';
                statusIndicator.innerHTML = '<div class="status-tooltip">Verified</div>';
            } else {
                statusIndicator.className = 'status-circle unverified';
                statusIndicator.innerHTML = '<div class="status-tooltip">Unverified</div>';
            }
        }

        // Format birthdate to MM/DD/YYYY format
        function formatBirthdateToMMDDYYYY(dateString) {
            if (!dateString) return '';
            
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return dateString; // Return original if invalid
                
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const year = date.getFullYear();
                
                return `${month}/${day}/${year}`;
            } catch (error) {
                console.error('Error formatting birthdate:', error);
                return dateString;
            }
        }

        // Calendar Functions
        function initializeCalendar() {
            generateCalendar(currentDate);
            loadScheduleData();
        }

        function generateCalendar(date) {
        const calendarContainer = document.getElementById('calendarContainer');
        const monthNames = ["January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];
        
        // Update month header
        document.getElementById('currentMonth').textContent = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;
        
        // Get first day of month and number of days
        const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
        const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDay = firstDay.getDay(); // 0 = Sunday, 1 = Monday, etc.
        
        // Debug: Log schedule data
        console.log('Schedule data for calendar:', scheduleData);
        console.log('Current month:', date.getMonth() + 1, date.getFullYear());
        
        // Create calendar header
        let calendarHTML = `
            <div class="calendar-header">
                <div class="calendar-day-header">Sun</div>
                <div class="calendar-day-header">Mon</div>
                <div class="calendar-day-header">Tue</div>
                <div class="calendar-day-header">Wed</div>
                <div class="calendar-day-header">Thu</div>
                <div class="calendar-day-header">Fri</div>
                <div class="calendar-day-header">Sat</div>
            </div>
            <div class="calendar-grid">
        `;
        
        // Add empty cells for days before the first day of the month
        for (let i = 0; i < startingDay; i++) {
            const prevMonth = new Date(date.getFullYear(), date.getMonth(), 0 - i);
            calendarHTML += `
                <div class="calendar-day other-month">
                    <div class="calendar-day-number">${prevMonth.getDate()}</div>
                </div>
            `;
        }
        
        // Add days of the month
        for (let day = 1; day <= daysInMonth; day++) {
            const currentDay = new Date(date.getFullYear(), date.getMonth(), day);
            const dayOfWeek = currentDay.getDay();
            const dateString = formatDateForAPI(currentDay);
            const hasSchedule = checkIfDateHasSchedule(dateString);
            
            // Debug: Log specific dates
            if (hasSchedule) {
                console.log('Date with schedule:', dateString, 'has schedule:', hasSchedule);
            }
            
            calendarHTML += `
                <div class="calendar-day ${hasSchedule ? 'has-schedule' : ''}" onclick="showScheduleDetails('${dateString}')">
                    <div class="calendar-day-number">${day}</div>
                    ${hasSchedule ? '<div class="calendar-day-events">Scheduled</div>' : ''}
                </div>
            `;
        }
        
        // Calculate how many empty cells we need at the end
        const totalCells = 42; // 6 rows x 7 days
        const remainingCells = totalCells - (startingDay + daysInMonth);
        
        // Add empty cells for days after the last day of the month
        for (let i = 1; i <= remainingCells; i++) {
            calendarHTML += `
                <div class="calendar-day other-month">
                    <div class="calendar-day-number">${i}</div>
                </div>
            `;
        }
        
        calendarHTML += `</div>`;
        calendarContainer.innerHTML = calendarHTML;
        
        // Debug: Log total scheduled days found
        const scheduledDays = document.querySelectorAll('.calendar-day.has-schedule').length;
        console.log(`Found ${scheduledDays} days with schedules in ${monthNames[date.getMonth()]} ${date.getFullYear()}`);
    }

        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            generateCalendar(currentDate);
        }

        function switchCalendar(type) {
            currentCalendarType = type;
            
            // Update active button
            document.getElementById('pawBtn').classList.toggle('active', type === 'paw');
            document.getElementById('meetingsBtn').classList.toggle('active', type === 'meetings');
            
            // Regenerate calendar with new data
            generateCalendar(currentDate);
        }

        // Format date for API (YYYY-MM-DD)
        function formatDateForAPI(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function formatDateForDisplay(dateString) {
            // Format date for display (e.g., "Sunday, November 17, 2025")
            const date = new Date(dateString);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        function getScheduleData() {
        try {
            const ss = SpreadsheetApp.openById(SHEET_ID);
            const lineupSheet = ss.getSheetByName(SHEET_NAMES.PRAISE_WORSHIP_SONG);
            
            if (!lineupSheet) {
            Logger.log('Praise & Worship Song sheet not found');
            return createResponse(true, 'No schedule data available', []);
            }
            
            const dataRange = lineupSheet.getDataRange();
            const values = dataRange.getValues();
            
            // Check if there's any data beyond headers
            if (values.length <= 1) {
            Logger.log('No schedule data found in sheet (only headers)');
            return createResponse(true, 'No schedule data available', []);
            }
            
            // Skip header row
            const schedules = [];
            
            for (let i = 1; i < values.length; i++) {
            const row = values[i];
            
            // Check if this row has valid data (has ScheduleID)
            if (row[1] && row[1] !== '') { // Column B - ScheduleID
                const schedule = {
                scheduleId: row[1],           // B - ScheduleID
                songLeader: row[2] || '',     // C - Song Leader
                backups: [
                    row[3] || '',              // D - Backup 1
                    row[4] || '',              // E - Backup 2
                    row[5] || '',              // F - Backup 3
                    row[6] || '',              // G - Backup 4
                    row[7] || ''               // H - Backup 5
                ].filter(backup => backup !== ''), // Remove empty backups
                practiceDate: row[9] || '',  // J - Practice Day
                scheduleDate: row[8] || '',  // I - Schedule Day
                slowSongs: [],
                fastSongs: []
                };
                
                // Extract slow songs (columns K-AD)
                for (let j = 0; j < 5; j++) {
                const startCol = 10 + (j * 4); // K=10, O=14, S=18, W=22, AA=26
                const slowSong = {
                    title: row[startCol] || '',           // Slow Title
                    link: row[startCol + 1] || '',        // Slow Link
                    lyrics: row[startCol + 2] || '',      // Slow Lyrics
                    instructions: row[startCol + 3] || '' // Slow Instructions
                };
                
                // Only add song if it has a title
                if (slowSong.title && slowSong.title.trim() !== '') {
                    schedule.slowSongs.push(slowSong);
                }
                }
                
                // Extract fast songs (columns AE-AX)
                for (let j = 0; j < 5; j++) {
                const startCol = 30 + (j * 4); // AE=30, AI=34, AM=38, AQ=42, AU=46
                const fastSong = {
                    title: row[startCol] || '',           // Fast Title
                    link: row[startCol + 1] || '',        // Fast Link
                    lyrics: row[startCol + 2] || '',      // Fast Lyrics
                    instructions: row[startCol + 3] || '' // Fast Instructions
                };
                
                // Only add song if it has a title
                if (fastSong.title && fastSong.title.trim() !== '') {
                    schedule.fastSongs.push(fastSong);
                }
                }
                
                schedules.push(schedule);
            }
            }
            
            Logger.log('Retrieved ' + schedules.length + ' schedules');
            return createResponse(true, 'Schedule data retrieved successfully', schedules);
            
        } catch (error) {
            Logger.log('Get schedule data error: ' + error.toString());
            Logger.log('Error stack: ' + error.stack);
            return createResponse(false, 'Error retrieving schedule data: ' + error.toString(), []);
        }
        }

        async function loadScheduleData() {
        try {
            // Fetch schedule data from Google Sheets using POST
            const response = await fetch(`${API_BASE_URL}/proxy`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'getScheduleData'
                })
            });
            
            const result = await response.json();
            
            if (result.success) {
                // Clean the data by removing header row
                scheduleData = cleanScheduleData(result.data || []);
                console.log('Cleaned schedule data:', scheduleData);
                
                // Regenerate calendar to show schedule markers
                generateCalendar(currentDate);
            } else {
                console.error('Failed to load schedule data:', result.message);
                // For demo purposes, we'll use mock data
                scheduleData = getMockScheduleData();
                generateCalendar(currentDate);
            }
        } catch (error) {
            console.error('Error loading schedule data:', error);
            // For demo purposes, we'll use mock data
            scheduleData = getMockScheduleData();
            generateCalendar(currentDate);
        }
    }

        // Check if a date has an existing schedule
        function checkIfDateHasSchedule(dateString) {
            return existingScheduleData.some(schedule => {
                // Skip invalid schedules
                if (!schedule.scheduleId || schedule.scheduleId === 'ScheduleID') return false;
                
                // Format dates for comparison (YYYY-MM-DD)
                const scheduleDate = formatDateForComparison(schedule.scheduleDate);
                const checkDate = formatDateForComparison(dateString);
                
                return scheduleDate === checkDate;
            });
        }

        // Get schedule for a specific date
        function getScheduleForDate(dateString) {
            return existingScheduleData.find(schedule => {
                // Skip invalid schedules
                if (!schedule.scheduleId || schedule.scheduleId === 'ScheduleID') return false;
                
                // Format dates for comparison (YYYY-MM-DD)
                const scheduleDate = formatDateForComparison(schedule.scheduleDate);
                const checkDate = formatDateForComparison(dateString);
                
                return scheduleDate === checkDate;
            });
        }



        // Format date for comparison (YYYY-MM-DD)
        function formatDateForComparison(dateString) {
            if (!dateString) return '';
            
            try {
                // Handle both Date objects and string dates
                const date = new Date(dateString);
                
                // Check if date is valid
                if (isNaN(date.getTime())) {
                    console.warn('Invalid date:', dateString);
                    return '';
                }
                
                // Format as YYYY-MM-DD for consistent comparison
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                
                return `${year}-${month}-${day}`;
            } catch (error) {
                console.error('Error formatting date:', error);
                return '';
            }
        }

         // Improved Song Layout Function
        function showScheduleDetails(dateString) {
            const modal = document.getElementById('scheduleModal');
            const modalDate = document.getElementById('modalDate');
            const modalBody = document.getElementById('modalBody');
            
            // Set modal date title
            modalDate.textContent = formatDateForDisplay(dateString);
            
            // Get schedules for this date
            const schedules = getSchedulesForDate(dateString);
            
            if (schedules.length === 0) {
                modalBody.innerHTML = `
                    <div class="no-schedule">
                        <i class="fas fa-calendar-times"></i>
                        <h4>No Schedule Found</h4>
                        <p>There are no schedules for ${formatDateForDisplay(dateString)}</p>
                    </div>
                `;
            } else {
                let scheduleHTML = '';
                
                schedules.forEach((schedule, index) => {
                    scheduleHTML += `
                        <div class="schedule-card">
                            <div class="schedule-card-header">
                                <h4 class="schedule-card-title">Praise & Worship Schedule</h4>
                                <p class="schedule-card-subtitle">Schedule ID: ${schedule.scheduleId}</p>
                            </div>
                            <div class="schedule-card-body">
                                <div class="schedule-info">
                                    <div class="info-item">
                                        <div class="info-label">Practice Day</div>
                                        <div class="info-value">${formatDateForDisplay(schedule.practiceDate)}</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Schedule Day</div>
                                        <div class="info-value">${formatDateForDisplay(schedule.scheduleDate)}</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Song Leader</div>
                                        <div class="info-value">${schedule.songLeader}</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Backup Singers</div>
                                        <div class="info-value">${schedule.backups.filter(b => b).join(', ') || 'None'}</div>
                                    </div>
                                </div>
                                
                                <div class="lineup-section">
                                    <h5 class="lineup-section-title">Slow Songs</h5>
                                    <div class="song-list">
                                        ${schedule.slowSongs.filter(song => song.title).map((song, idx) => `
                                            <div class="song-item">
                                                <div class="song-header">
                                                    <h6 class="song-title">${song.title}</h6>
                                                    <div class="song-actions">
                                                        <button class="song-btn" onclick="toggleSongDetails('slow-${index}-${idx}', '${escapeHtml(song.title)}', '${song.link || ''}')">
                                                            <i class="fas fa-info-circle"></i> Details
                                                        </button>
                                                    </div>
                                                </div>
                                                ${song.link ? `
                                                    <div class="youtube-preview-container" id="youtube-slow-${index}-${idx}">
                                                        <!-- YouTube iframe will be loaded here -->
                                                    </div>
                                                ` : ''}
                                                <div class="song-details" id="slow-${index}-${idx}">
                                                    ${song.lyrics ? `
                                                        <div class="details-section">
                                                            <div class="details-label">Lyrics</div>
                                                            <div class="details-content">${song.lyrics}</div>
                                                        </div>
                                                    ` : ''}
                                                    ${song.instructions ? `
                                                        <div class="details-section">
                                                            <div class="details-label">Instructions</div>
                                                            <div class="details-content">${song.instructions}</div>
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        `).join('')}
                                        ${schedule.slowSongs.filter(song => song.title).length === 0 ? 
                                            '<p style="color: #6c757d; text-align: center; padding: 20px;">No slow songs scheduled</p>' : ''}
                                    </div>
                                </div>
                                
                                <div class="lineup-section">
                                    <h5 class="lineup-section-title">Fast Songs</h5>
                                    <div class="song-list">
                                        ${schedule.fastSongs.filter(song => song.title).map((song, idx) => `
                                            <div class="song-item">
                                                <div class="song-header">
                                                    <h6 class="song-title">${song.title}</h6>
                                                    <div class="song-actions">
                                                        <button class="song-btn" onclick="toggleSongDetails('fast-${index}-${idx}', '${escapeHtml(song.title)}', '${song.link || ''}')">
                                                            <i class="fas fa-info-circle"></i> Details
                                                        </button>
                                                    </div>
                                                </div>
                                                ${song.link ? `
                                                    <div class="youtube-preview-container" id="youtube-fast-${index}-${idx}">
                                                        <!-- YouTube iframe will be loaded here -->
                                                    </div>
                                                ` : ''}
                                                <div class="song-details" id="fast-${index}-${idx}">
                                                    ${song.lyrics ? `
                                                        <div class="details-section">
                                                            <div class="details-label">Lyrics</div>
                                                            <div class="details-content">${song.lyrics}</div>
                                                        </div>
                                                    ` : ''}
                                                    ${song.instructions ? `
                                                        <div class="details-section">
                                                            <div class="details-label">Instructions</div>
                                                            <div class="details-content">${song.instructions}</div>
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        `).join('')}
                                        ${schedule.fastSongs.filter(song => song.title).length === 0 ? 
                                            '<p style="color: #6c757d; text-align: center; padding: 20px;">No fast songs scheduled</p>' : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                modalBody.innerHTML = scheduleHTML;
                
                // Load YouTube embeds after the modal is displayed
                setTimeout(() => {
                    loadYouTubeEmbeds(schedules);
                }, 100);
            }
            
            modal.style.display = 'block';
        }

        // Function to load YouTube embeds with network awareness
        function loadYouTubeEmbeds(schedules) {
            schedules.forEach((schedule, scheduleIndex) => {
                // Load slow song YouTube embeds
                schedule.slowSongs.forEach((song, songIndex) => {
                    if (song.link) {
                        const containerId = `youtube-slow-${scheduleIndex}-${songIndex}`;
                        loadYouTubeEmbed(song.link, containerId);
                    }
                });
                
                // Load fast song YouTube embeds
                schedule.fastSongs.forEach((song, songIndex) => {
                    if (song.link) {
                        const containerId = `youtube-fast-${scheduleIndex}-${songIndex}`;
                        loadYouTubeEmbed(song.link, containerId);
                    }
                });
            });
        }


        // =============================================
        // WEEKLY SCHEDULE CALENDAR FUNCTIONS
        // =============================================

        // Weekly Schedule Calendar state (separate from Create Lineup calendar)
        let scheduleCurrentDate = new Date();
        let currentScheduleCalendarType = 'paw'; // 'paw' or 'meetings'
        let weeklyScheduleData = []; // Fixed variable name - no space!
        let isLoadingSchedule = false;

        // Initialize Weekly Schedule calendar when section is shown
        function initializeScheduleCalendar() {
            console.log('Initializing Weekly Schedule calendar...');
            showScheduleCalendarLoading();
            loadScheduleData();
        }

        function showScheduleCalendarLoading() {
            document.getElementById('scheduleCalendarLoading').style.display = 'block';
            document.getElementById('scheduleCalendarError').style.display = 'none';
            document.getElementById('scheduleCalendarContainer').style.display = 'none';
        }

        function showScheduleCalendarError() {
            document.getElementById('scheduleCalendarLoading').style.display = 'none';
            document.getElementById('scheduleCalendarError').style.display = 'block';
            document.getElementById('scheduleCalendarContainer').style.display = 'none';
        }

        function showScheduleCalendarContent() {
            document.getElementById('scheduleCalendarLoading').style.display = 'none';
            document.getElementById('scheduleCalendarError').style.display = 'none';
            document.getElementById('scheduleCalendarContainer').style.display = 'block';
        }

        async function loadScheduleData() {
            if (isLoadingSchedule) return;
            
            isLoadingSchedule = true;
            console.log('Loading Weekly Schedule data...');
            
            try {
                // Try to get data from Google Sheets
                const response = await fetch(`${API_BASE_URL}/proxy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'getScheduleData'
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('Weekly Schedule API response:', result);
                
                if (result.success && result.data) {
                    weeklyScheduleData = cleanScheduleData(result.data);
                    console.log('Cleaned Weekly Schedule data:', weeklyScheduleData);
                    showScheduleCalendarContent();
                    generateScheduleCalendar(scheduleCurrentDate);
                    generateUpcomingScheduleCards();
                    generateScheduleHistory();
                    displayBirthdayTodaySection();
                    showAlert('Schedule data loaded successfully!', 'success');
                } else {
                    throw new Error(result.message || 'No schedule data available');
                }
                
            } catch (error) {
                console.error('Error loading Weekly Schedule data:', error);
                
                // Fallback to mock data for demonstration
                console.log('Using mock data as fallback for Weekly Schedule...');
                weeklyScheduleData = getMockScheduleData();
                showScheduleCalendarContent();
                generateScheduleCalendar(scheduleCurrentDate);
                generateUpcomingScheduleCards();
                generateScheduleHistory();
                displayBirthdayTodaySection();
                showAlert('Using demo schedule data. Real data will load when connected.', 'warning');
            } finally {
                isLoadingSchedule = false;
            }
        }

        function refreshScheduleData() {
            console.log('Refreshing Weekly Schedule data...');
            showScheduleCalendarLoading();
            loadScheduleData();
        }

        function generateScheduleCalendar(date) {
            const calendarContainer = document.getElementById('scheduleCalendarContainer');
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];
            
            // Update month header
            document.getElementById('currentScheduleMonth').textContent = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;
            
            // Get first day of month and number of days
            const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
            const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay(); // 0 = Sunday, 1 = Monday, etc.
            
            console.log(`Generating Weekly Schedule calendar for ${monthNames[date.getMonth()]} ${date.getFullYear()}`);
            console.log(`Found ${weeklyScheduleData.length} total schedules`);
            
            // Create calendar header
            let calendarHTML = `
                <div class="calendar-header">
                    <div class="calendar-day-header">Sun</div>
                    <div class="calendar-day-header">Mon</div>
                    <div class="calendar-day-header">Tue</div>
                    <div class="calendar-day-header">Wed</div>
                    <div class="calendar-day-header">Thu</div>
                    <div class="calendar-day-header">Fri</div>
                    <div class="calendar-day-header">Sat</div>
                </div>
                <div class="calendar-grid">
            `;
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                const prevMonth = new Date(date.getFullYear(), date.getMonth(), 0 - i);
                calendarHTML += `
                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">${prevMonth.getDate()}</div>
                    </div>
                `;
            }
            
            // Add days of the month
            let scheduledDayCount = 0;
            for (let day = 1; day <= daysInMonth; day++) {
                const currentDay = new Date(date.getFullYear(), date.getMonth(), day);
                const dateString = formatDateForAPI(currentDay);
                const hasSchedule = checkIfDateHasWeeklySchedule(dateString);
                
                if (hasSchedule) {
                    scheduledDayCount++;
                    console.log(`Date ${dateString} has Weekly Schedule`);
                }
                
                calendarHTML += `
                    <div class="calendar-day ${hasSchedule ? 'has-schedule' : ''}" onclick="showWeeklyScheduleDetails('${dateString}')">
                        <div class="calendar-day-number">${day}</div>
                        ${hasSchedule ? '<div class="calendar-day-events">Scheduled</div>' : ''}
                    </div>
                `;
            }
            
            // Calculate how many empty cells we need at the end
            const totalCells = 42; // 6 rows x 7 days
            const remainingCells = totalCells - (startingDay + daysInMonth);
            
            // Add empty cells for days after the last day of the month
            for (let i = 1; i <= remainingCells; i++) {
                calendarHTML += `
                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">${i}</div>
                    </div>
                `;
            }
            
            calendarHTML += `</div>`;
            calendarContainer.innerHTML = calendarHTML;
            
            console.log(`Weekly Schedule calendar generated with ${scheduledDayCount} scheduled days`);
        }

        function changeScheduleMonth(direction) {
            scheduleCurrentDate.setMonth(scheduleCurrentDate.getMonth() + direction);
            generateScheduleCalendar(scheduleCurrentDate);
        }

        function switchScheduleCalendar(type) {
            currentScheduleCalendarType = type;
            
            // Update active button
            document.getElementById('schedulePawBtn').classList.toggle('active', type === 'paw');
            document.getElementById('scheduleMeetingsBtn').classList.toggle('active', type === 'meetings');
            
            // For now, we only have PAW data, but you can extend this for meetings
            if (type === 'meetings') {
                showAlert('Meetings calendar coming soon!', 'info');
                return;
            }
            
            // Regenerate calendar
            generateScheduleCalendar(scheduleCurrentDate);
            generateUpcomingScheduleCards();
            generateScheduleHistory();
        }

        function generateUpcomingScheduleCards() {
            const cardsContainer = document.getElementById('upcomingScheduleCards');
            if (!cardsContainer) return;
            
            // Get all upcoming schedules sorted by date
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const upcomingSchedules = weeklyScheduleData
                .filter(schedule => {
                    const scheduleDate = new Date(schedule.scheduleDate);
                    scheduleDate.setHours(0, 0, 0, 0);
                    return scheduleDate >= today;
                })
                .sort((a, b) => new Date(a.scheduleDate) - new Date(b.scheduleDate))
                .slice(0, 6); // Show top 6 upcoming
            
            if (upcomingSchedules.length === 0) {
                cardsContainer.innerHTML = `
                    <div class="upcoming-card-empty">
                        <div><i class="fas fa-calendar-times"></i></div>
                        <h4>No Upcoming Schedules</h4>
                        <p>There are no upcoming schedules at this time.</p>
                    </div>
                `;
                return;
            }
            
            let cardsHTML = '<div class="schedule-cards-container">';
            
            upcomingSchedules.forEach(schedule => {
                const scheduleDate = new Date(schedule.scheduleDate);
                const formattedDate = scheduleDate.toLocaleDateString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric'
                });
                const dayOfWeek = scheduleDate.toLocaleDateString('en-US', { weekday: 'long' });
                const songLeader = schedule.songLeader || 'Not assigned';
                const backups = schedule.backups && schedule.backups.length > 0 
                    ? schedule.backups.filter(b => b).join(', ') 
                    : 'None assigned';
                const dateString = formatDateForAPI(scheduleDate);
                
                cardsHTML += `
                    <div class="upcoming-card" onclick="showWeeklyScheduleDetails('${dateString}')" style="cursor: pointer;">
                        <div class="upcoming-card-date">
                            <div class="upcoming-card-date-day">${scheduleDate.getDate()}</div>
                            <div class="upcoming-card-date-time">${scheduleDate.toLocaleDateString('en-US', { month: 'short', year: '2-digit' })}</div>
                        </div>
                        <div class="upcoming-card-content">
                            <div class="upcoming-card-label">Scheduled Service</div>
                            <div class="upcoming-card-title">${dayOfWeek}</div>
                            <div class="upcoming-card-item">
                                <div class="upcoming-card-item-label">🎤 Song Leader</div>
                                <div class="upcoming-card-item-value">${songLeader}</div>
                            </div>
                            <div class="upcoming-card-item">
                                <div class="upcoming-card-item-label">🎵 Backup Singers</div>
                                <div class="upcoming-card-item-value">${backups}</div>
                            </div>
                            <div style="margin-top: 15px; text-align: center; color: var(--primary); font-size: 0.85rem; font-weight: 600;">
                                <i class="fas fa-click"></i> Click for details
                            </div>
                        </div>
                    </div>
                `;
            });
            
            cardsHTML += '</div>';
            cardsContainer.innerHTML = cardsHTML;
        }

        function generateScheduleHistory() {
            const historyContainer = document.getElementById('scheduleHistoryCards');
            const historySection = document.getElementById('scheduleHistorySection');
            if (!historyContainer) return;
            
            // Get all past schedules sorted by date (most recent first)
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const pastSchedules = weeklyScheduleData
                .filter(schedule => {
                    const scheduleDate = new Date(schedule.scheduleDate);
                    scheduleDate.setHours(0, 0, 0, 0);
                    return scheduleDate < today;
                })
                .sort((a, b) => new Date(b.scheduleDate) - new Date(a.scheduleDate))
                .slice(0, 6); // Show top 6 past schedules
            
            if (pastSchedules.length === 0) {
                historyContainer.innerHTML = `
                    <div class="schedule-history-empty">
                        <div><i class="fas fa-folder-open"></i></div>
                        <h4>No Schedule History</h4>
                        <p>There are no past schedules to display.</p>
                    </div>
                `;
                historySection.style.display = 'block';
                return;
            }
            
            historySection.style.display = 'block';
            let historyHTML = '<div class="schedule-history-cards">';
            
            pastSchedules.forEach(schedule => {
                const scheduleDate = new Date(schedule.scheduleDate);
                const dayOfWeek = scheduleDate.toLocaleDateString('en-US', { weekday: 'long' });
                const songLeader = schedule.songLeader || 'Not assigned';
                const backups = schedule.backups && schedule.backups.length > 0 
                    ? schedule.backups.filter(b => b).join(', ') 
                    : 'None assigned';
                const dateString = formatDateForAPI(scheduleDate);
                
                historyHTML += `
                    <div class="history-card" onclick="showWeeklyScheduleDetails('${dateString}')" style="cursor: pointer;">
                        <div class="history-card-date">
                            <div class="history-card-date-day">${scheduleDate.getDate()}</div>
                            <div class="history-card-date-time">${scheduleDate.toLocaleDateString('en-US', { month: 'short', year: '2-digit' })}</div>
                        </div>
                        <div class="history-card-content">
                            <div class="history-card-label">Past Service</div>
                            <div class="history-card-title">${dayOfWeek}</div>
                            <div class="history-card-item">
                                <div class="history-card-item-label">🎤 Song Leader</div>
                                <div class="history-card-item-value">${songLeader}</div>
                            </div>
                            <div class="history-card-item">
                                <div class="history-card-item-label">🎵 Backup Singers</div>
                                <div class="history-card-item-value">${backups}</div>
                            </div>
                            <div style="margin-top: 15px; text-align: center; color: #888; font-size: 0.85rem; font-weight: 600;">
                                <i class="fas fa-search"></i> View details
                            </div>
                        </div>
                    </div>
                `;
            });
            
            historyHTML += '</div>';
            historyContainer.innerHTML = historyHTML;
        }

        // Check if a date has an existing schedule (for Weekly Schedule only)
        function checkIfDateHasWeeklySchedule(dateString) {
            if (!weeklyScheduleData || weeklyScheduleData.length === 0) return false;
            
            return weeklyScheduleData.some(schedule => {
                if (!schedule.scheduleDate) return false;
                
                const scheduleDate = formatDateForComparison(schedule.scheduleDate);
                const practiceDate = formatDateForComparison(schedule.practiceDate);
                const checkDate = formatDateForComparison(dateString);
                
                return scheduleDate === checkDate || practiceDate === checkDate;
            });
        }

        // Get schedules for a specific date (for Weekly Schedule only)
        function getWeeklySchedulesForDate(dateString) {
            if (!weeklyScheduleData || weeklyScheduleData.length === 0) return [];
            
            return weeklyScheduleData.filter(schedule => {
                if (!schedule.scheduleDate) return false;
                
                const scheduleDate = formatDateForComparison(schedule.scheduleDate);
                const practiceDate = formatDateForComparison(schedule.practiceDate);
                const checkDate = formatDateForComparison(dateString);
                
                return scheduleDate === checkDate || practiceDate === checkDate;
            });
        }

        function showWeeklyScheduleDetails(dateString) {
            const modal = document.getElementById('scheduleModal');
            const modalDate = document.getElementById('modalDate');
            const modalBody = document.getElementById('modalBody');
            
            // Set modal date title
            modalDate.textContent = formatDateForDisplay(dateString);
            
            // Get schedules for this date
            const schedules = getWeeklySchedulesForDate(dateString);
            
            console.log(`Found ${schedules.length} Weekly Schedules for ${dateString}`);
            
            if (schedules.length === 0) {
                modalBody.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 3rem; color: #6c757d; margin-bottom: 20px;">
                            <i class="fas fa-calendar-times"></i>
                        </div>
                        <h4 style="color: #6c757d;">No Schedule Found</h4>
                        <p style="color: #6c757d;">There are no schedules for ${formatDateForDisplay(dateString)}</p>
                    </div>
                `;
            } else {
                let scheduleHTML = '';
                
                schedules.forEach((schedule, index) => {
                    const isPracticeDay = formatDateForComparison(schedule.practiceDate) === formatDateForComparison(dateString);
                    const dayType = isPracticeDay ? 'Practice' : 'Service';
                    
                    scheduleHTML += `
                        <div class="schedule-card">
                            <div class="schedule-card-header">
                                <h4 class="schedule-card-title">Praise & Worship ${dayType}</h4>
                                <p class="schedule-card-subtitle">Schedule ID: ${schedule.scheduleId}</p>
                            </div>
                            <div class="schedule-card-body">
                                <div class="schedule-info">
                                    <div class="info-item">
                                        <div class="info-label">Song Leader</div>
                                        <div class="info-value">${schedule.songLeader || 'Not assigned'}</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Backup Singers</div>
                                        <div class="info-value">${schedule.backups && schedule.backups.length > 0 ? schedule.backups.filter(b => b).join(', ') : 'None'}</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Practice Day</div>
                                        <div class="info-value">${formatDateForDisplay(schedule.practiceDate)}</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Schedule Day</div>
                                        <div class="info-value">${formatDateForDisplay(schedule.scheduleDate)}</div>
                                    </div>
                                </div>
                                
                                ${schedule.slowSongs && schedule.slowSongs.length > 0 ? `
                                <div class="lineup-section">
                                    <h5 class="lineup-section-title"><i class="fas fa-music"></i> Slow Songs (${schedule.slowSongs.filter(s => s.title).length})</h5>
                                    <div class="song-list">
                                        ${schedule.slowSongs.filter(song => song && song.title).map((song, idx) => `
                                            <div class="song-item">
                                                <div class="song-header">
                                                    <h6 class="song-title">${song.title}</h6>
                                                </div>
                                                ${song.link ? `
                                                    <div class="youtube-preview-container">
                                                        <iframe src="https://www.youtube.com/embed/${extractYouTubeId(song.link)}" 
                                                                frameborder="0" 
                                                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                                                allowfullscreen>
                                                        </iframe>
                                                    </div>
                                                ` : ''}
                                                ${song.lyrics || song.instructions ? `
                                                    <div class="song-details">
                                                        ${song.lyrics ? `
                                                            <div class="details-section">
                                                                <div class="details-label">Lyrics</div>
                                                                <div class="details-content">${song.lyrics}</div>
                                                            </div>
                                                        ` : ''}
                                                        ${song.instructions ? `
                                                            <div class="details-section">
                                                                <div class="details-label">Instructions</div>
                                                                <div class="details-content">${song.instructions}</div>
                                                            </div>
                                                        ` : ''}
                                                    </div>
                                                ` : ''}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${schedule.fastSongs && schedule.fastSongs.length > 0 ? `
                                <div class="lineup-section">
                                    <h5 class="lineup-section-title"><i class="fas fa-bolt"></i> Fast Songs (${schedule.fastSongs.filter(s => s.title).length})</h5>
                                    <div class="song-list">
                                        ${schedule.fastSongs.filter(song => song && song.title).map((song, idx) => `
                                            <div class="song-item">
                                                <div class="song-header">
                                                    <h6 class="song-title">${song.title}</h6>
                                                </div>
                                                ${song.link ? `
                                                    <div class="youtube-preview-container">
                                                        <iframe src="https://www.youtube.com/embed/${extractYouTubeId(song.link)}" 
                                                                frameborder="0" 
                                                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                                                allowfullscreen>
                                                        </iframe>
                                                    </div>
                                                ` : ''}
                                                ${song.lyrics || song.instructions ? `
                                                    <div class="song-details">
                                                        ${song.lyrics ? `
                                                            <div class="details-section">
                                                                <div class="details-label">Lyrics</div>
                                                                <div class="details-content">${song.lyrics}</div>
                                                            </div>
                                                        ` : ''}
                                                        ${song.instructions ? `
                                                            <div class="details-section">
                                                                <div class="details-label">Instructions</div>
                                                                <div class="details-content">${song.instructions}</div>
                                                            </div>
                                                        ` : ''}
                                                    </div>
                                                ` : ''}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                });
                
                modalBody.innerHTML = scheduleHTML;
            }
            
            modal.style.display = 'block';
        }

        function closeScheduleModal() {
            document.getElementById('scheduleModal').style.display = 'none';
            document.getElementById('youtubePlayerContainer').style.display = 'none';
        }

        // YouTube Lyrics Feature - Fetch and display song lyrics using Groq AI
        async function loadYoutubeLyricsForSong(songTitle, youtubeUrl = null) {
            try {
                const playerContainer = document.getElementById('youtubePlayerContainer');
                const youtubePlayer = document.getElementById('youtubePlayer');
                const lyricsContainer = document.getElementById('lyricsContainer');
                
                if (!playerContainer) return;
                
                // Show the player container
                playerContainer.style.display = 'block';
                
                // Load YouTube player if URL provided
                if (youtubeUrl) {
                    const videoId = extractYoutubeVideoId(youtubeUrl);
                    if (videoId) {
                        youtubePlayer.innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
                    }
                }
                
                // Show loading state for lyrics
                lyricsContainer.innerHTML = `
                    <div style="text-align: center; color: #666;">
                        <div style="font-size: 1.5rem; margin-bottom: 10px;">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                        <p>Fetching lyrics for: <strong>${songTitle}</strong></p>
                    </div>
                `;
                
                // Fetch lyrics from Groq AI
                const lyrics = await getLyricsFromGroqAI(songTitle);
                
                // Display lyrics
                lyricsContainer.innerHTML = `
                    <div style="padding: 10px 0;">
                        <div style="font-weight: 600; color: var(--primary); margin-bottom: 10px;">
                            ${songTitle}
                        </div>
                        <div style="white-space: pre-wrap; font-size: 0.85rem; line-height: 1.7; color: #444;">
                            ${lyrics || 'Lyrics not available'}
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading YouTube lyrics:', error);
                document.getElementById('lyricsContainer').innerHTML = `
                    <div style="text-align: center; color: #d9534f;">
                        <i class="fas fa-exclamation-circle" style="font-size: 1.5rem; margin-bottom: 10px; display: block;"></i>
                        <p>Unable to fetch lyrics</p>
                    </div>
                `;
            }
        }

        // Extract YouTube Video ID from various URL formats
        function extractYoutubeVideoId(url) {
            try {
                // Handle youtu.be/VIDEO_ID
                if (url.includes('youtu.be/')) {
                    return url.split('youtu.be/')[1].split('?')[0];
                }
                // Handle youtube.com/watch?v=VIDEO_ID
                if (url.includes('youtube.com/watch')) {
                    const urlObj = new URL(url);
                    return urlObj.searchParams.get('v');
                }
                // Handle youtube.com/embed/VIDEO_ID
                if (url.includes('youtube.com/embed/')) {
                    return url.split('youtube.com/embed/')[1].split('?')[0];
                }
                return null;
            } catch (error) {
                console.error('Error extracting YouTube video ID:', error);
                return null;
            }
        }

        // Get lyrics from Groq AI
        async function getLyricsFromGroqAI(songTitle) {
            try {
                const response = await fetch(GROQ_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${GROQ_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'openai/gpt-oss-120b',
                        messages: [
                            {
                                role: 'system',
                                content: `You are a music database AI assistant. Provide song lyrics accurately and completely. 

Guidelines:
1. Provide the chorus and main verses of the song
2. Keep the lyrics authentic and in the correct order
3. Format with line breaks between verses
4. If you don't know the exact lyrics, provide what you can or indicate it's unavailable
5. Do not make up lyrics for unknown songs`
                            },
                            {
                                role: 'user',
                                content: `Please provide the lyrics for the song: "${songTitle}". Give me the main verses and chorus.`
                            }
                        ],
                        max_tokens: 1000,
                        temperature: 0.5
                    })
                });

                const data = await response.json();
                if (data.choices && data.choices.length > 0) {
                    return data.choices[0].message.content;
                }
                return 'Lyrics not available';
            } catch (error) {
                console.error('Error fetching lyrics from Groq:', error);
                return 'Unable to fetch lyrics - connection error';
            }
        }

        // Birthday celebrants display functions
        // Helper function to extract month-day (MM-DD) from birthdate, ignoring year
        function getBirthdayMonthDay(birthdateString) {
            if (!birthdateString) return '';
            try {
                // Handle YYYY-MM-DD format
                if (birthdateString.includes('-')) {
                    const parts = birthdateString.split('-');
                    if (parts.length >= 3) {
                        return `${parts[1]}${parts[2]}`;  // MM + DD
                    }
                }
                // Handle MM/DD/YYYY format
                if (birthdateString.includes('/')) {
                    const parts = birthdateString.split('/');
                    if (parts.length >= 2) {
                        return `${parts[0].padStart(2, '0')}${parts[1].padStart(2, '0')}`;
                    }
                }
                return '';
            } catch (error) {
                console.error('Error extracting birthday month-day:', error, birthdateString);
                return '';
            }
        }

        async function getTodaysBirthdaysCelebrants() {
            const celebrants = [];
            const today = new Date();
            const todayMonth = String(today.getMonth() + 1).padStart(2, '0');
            const todayDay = String(today.getDate()).padStart(2, '0');
            const todayMMDD = todayMonth + todayDay;  // e.g., "1220" for December 20
            
            console.log('Checking for birthdays on:', todayMMDD);
            
            // First, load the birthdate cache if not already loaded
            if (!birthdateCacheLoaded) {
                await loadMemberBirthdateCache();
            }
            
            // Check logged-in user's birthdate
            if (userData && userData.birthdate) {
                const userMMDD = getBirthdayMonthDay(userData.birthdate);
                console.log('User birthdate:', userData.birthdate, '→ MMDD:', userMMDD);
                if (userMMDD === todayMMDD) {
                    const fullName = `${userData.firstname || ''} ${userData.lastname || ''}`.trim();
                    celebrants.push({
                        name: fullName || 'You',
                        initials: (userData.firstname || 'M')[0] + (userData.lastname || 'M')[0],
                        isSelf: true
                    });
                    console.log('✓ User has birthday today:', fullName);
                }
            }
            
            // Check ALL cached members (from Accounts sheet)
            console.log('Checking', Object.keys(memberBirthdateCache).length, 'cached members');
            for (const memberName in memberBirthdateCache) {
                if (memberName) {
                    const birthdate = memberBirthdateCache[memberName];
                    if (birthdate) {
                        const memberMMDD = getBirthdayMonthDay(birthdate);
                        if (memberMMDD === todayMMDD) {
                            // Don't duplicate if already added as self
                            const isDuplicate = celebrants.some(c => c.name === memberName);
                            if (!isDuplicate) {
                                celebrants.push({
                                    name: memberName,
                                    initials: memberName.split(' ').map(n => n[0]).join('').substring(0, 2),
                                    isSelf: false
                                });
                                console.log('✓ Found birthday celebrant:', memberName, 'birthdate:', birthdate);
                            }
                        }
                    }
                }
            }
            
            console.log('Total celebrants found:', celebrants.length);
            return celebrants;
        }

        async function getUpcomingBirthdaysCelebrants(daysAhead = 30) {
            const upcomingBirthdays = [];
            const today = new Date();
            
            // Load cache if not already loaded
            if (!birthdateCacheLoaded) {
                await loadMemberBirthdateCache();
            }
            
            // Check logged-in user's birthdate
            if (userData && userData.birthdate) {
                const userBirthday = calculateNextBirthday(userData.birthdate);
                const daysUntilBirthday = Math.floor((userBirthday - today) / (1000 * 60 * 60 * 24));
                
                if (daysUntilBirthday > 0 && daysUntilBirthday <= daysAhead) {
                    const fullName = `${userData.firstname || ''} ${userData.lastname || ''}`.trim();
                    upcomingBirthdays.push({
                        name: fullName || 'You',
                        birthdate: userData.birthdate,
                        daysUntil: daysUntilBirthday,
                        displayDate: formatBirthdateToMMDDYYYY(userData.birthdate),
                        isSelf: true
                    });
                }
            }
            
            // Check ALL cached members (from Accounts sheet)
            for (const memberName in memberBirthdateCache) {
                if (memberName) {
                    const birthdate = memberBirthdateCache[memberName];
                    if (birthdate) {
                        const nextBirthday = calculateNextBirthday(birthdate);
                        const daysUntilBirthday = Math.floor((nextBirthday - today) / (1000 * 60 * 60 * 24));
                        
                        if (daysUntilBirthday > 0 && daysUntilBirthday <= daysAhead) {
                            // Don't duplicate if already added as self
                            const isDuplicate = upcomingBirthdays.some(b => b.name === memberName);
                            if (!isDuplicate) {
                                upcomingBirthdays.push({
                                    name: memberName,
                                    birthdate: birthdate,
                                    daysUntil: daysUntilBirthday,
                                    displayDate: formatBirthdateToMMDDYYYY(birthdate),
                                    isSelf: false
                                });
                            }
                        }
                    }
                }
            }
            
            // Sort by days until birthday
            return upcomingBirthdays.sort((a, b) => a.daysUntil - b.daysUntil);
        }

        function calculateNextBirthday(birthdateString) {
            const birthdate = new Date(birthdateString);
            const today = new Date();
            
            let nextBirthday = new Date(today.getFullYear(), birthdate.getMonth(), birthdate.getDate());
            
            // If birthday has already passed this year, schedule for next year
            if (nextBirthday < today) {
                nextBirthday = new Date(today.getFullYear() + 1, birthdate.getMonth(), birthdate.getDate());
            }
            
            return nextBirthday;
        }

        // Cache for member birthdates
        let memberBirthdateCache = {};
        let birthdateCacheLoaded = false;

        async function getMemberBirthdate(memberName) {
            // Return from cache if already loaded
            if (birthdateCacheLoaded && memberBirthdateCache[memberName]) {
                return memberBirthdateCache[memberName];
            }
            
            // If cache not loaded yet, load it
            if (!birthdateCacheLoaded) {
                await loadMemberBirthdateCache();
            }
            
            return memberBirthdateCache[memberName] || null;
        }

        async function loadMemberBirthdateCache() {
            try {
                // Fetch all member birthdates from the server
                const response = await fetch(`${API_BASE_URL}/proxy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'getAllMemberBirthdates'
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success && result.data) {
                    // Build cache from returned data
                    result.data.forEach(member => {
                        if (member.fullName && member.birthdate) {
                            memberBirthdateCache[member.fullName] = member.birthdate;
                        }
                    });
                    
                    console.log(`Loaded ${Object.keys(memberBirthdateCache).length} member birthdates`);
                }
                
                birthdateCacheLoaded = true;
            } catch (error) {
                console.error('Error loading member birthdates:', error);
                birthdateCacheLoaded = true; // Mark as loaded even on error to prevent retries
            }
        }

        async function displayBirthdayTodaySection() {
            const greetingBox = document.getElementById('birthdayGreetingBox');
            const celebrantsContainer = document.getElementById('birthdayTodayCelerants');
            const upcomingContainer = document.getElementById('upcomingBirthdays');
            
            if (!celebrantsContainer || !upcomingContainer) return;
            
            // Get today's birthday celebrants
            const todaysCelebrants = await getTodaysBirthdaysCelebrants();
            
            // Show greeting message if it's the user's birthday
            if (greetingBox && todaysCelebrants.some(c => c.isSelf)) {
                greetingBox.innerHTML = `
                    <i class="fas fa-birthday-cake"></i> 
                    Happy Birthday! 🎉
                `;
                greetingBox.style.display = 'block';
            } else if (greetingBox) {
                greetingBox.style.display = 'none';
            }
            
            // Display today's celebrants
            if (todaysCelebrants.length === 0) {
                celebrantsContainer.innerHTML = `
                    <div class="no-birthday-celebrants">
                        <div><i class="fas fa-smile-wink"></i></div>
                        <p>No birthdays today, but every day is special!</p>
                    </div>
                `;
            } else {
                let celebrantsHTML = '';
                todaysCelebrants.forEach(celebrant => {
                    celebrantsHTML += `
                        <div class="birthday-card">
                            <div class="birthday-card-icon">
                                <i class="fas fa-birthday-cake"></i>
                            </div>
                            <div class="birthday-card-name">${celebrant.name}</div>
                            <div class="birthday-card-date">🎂 Today!</div>
                        </div>
                    `;
                });
                celebrantsContainer.innerHTML = celebrantsHTML;
            }
            
            // Display upcoming birthdays
            const upcomingBirthdays = await getUpcomingBirthdaysCelebrants(30);
            
            if (upcomingBirthdays.length === 0) {
                upcomingContainer.innerHTML = `
                    <div class="no-upcoming-birthdays">
                        <p>No upcoming birthdays in the next 30 days</p>
                    </div>
                `;
            } else {
                let upcomingHTML = '';
                upcomingBirthdays.forEach(birthday => {
                    const daysText = birthday.daysUntil === 1 ? 'Tomorrow' : `${birthday.daysUntil} days`;
                    upcomingHTML += `
                        <div class="upcoming-birthday-item">
                            <div class="upcoming-birthday-name">${birthday.name}</div>
                            <div class="upcoming-birthday-date">${birthday.displayDate.split('/').slice(0, 2).join('/')}</div>
                            <div class="upcoming-birthday-days">${daysText}</div>
                        </div>
                    `;
                });
                upcomingContainer.innerHTML = upcomingHTML;
            }
        }

        // Enhanced mock data for Weekly Schedule demonstration
        function getMockScheduleData() {
            const today = new Date();
            const nextSunday = new Date(today);
            nextSunday.setDate(today.getDate() + (7 - today.getDay())); // Next Sunday
            const nextSaturday = new Date(nextSunday);
            nextSaturday.setDate(nextSunday.getDate() - 1); // Saturday before
            
            const followingSunday = new Date(nextSunday);
            followingSunday.setDate(nextSunday.getDate() + 7);
            const followingSaturday = new Date(followingSunday);
            followingSaturday.setDate(followingSunday.getDate() - 1);
            
            return [
                {
                    scheduleId: 'SCH001',
                    songLeader: 'Psalm Gambe',
                    backups: ['Cathy Martinez', 'Tiffany Dañal', 'Geneveve España'],
                    practiceDate: nextSaturday.toISOString().split('T')[0],
                    scheduleDate: nextSunday.toISOString().split('T')[0],
                    slowSongs: [
                        {
                            title: 'Goodness of God',
                            link: 'https://www.youtube.com/watch?v=n_aZnV9nWnE',
                            lyrics: 'I love You Lord\nFor Your mercy never fails me\nAll my days, I\'ve been held in Your hands',
                            instructions: 'Start softly, build to powerful chorus'
                        },
                        {
                            title: 'What a Beautiful Name',
                            link: 'https://www.youtube.com/watch?v=nQWFzMvCfLE',
                            lyrics: 'You were the Word at the beginning\nOne with God the Lord Most High',
                            instructions: 'Emphasize the bridge section'
                        }
                    ],
                    fastSongs: [
                        {
                            title: 'Reckless Love',
                            link: 'https://www.youtube.com/watch?v=6xx0d3R2LoU',
                            lyrics: 'Before I spoke a word, You were singing over me\nYou have been so, so good to me',
                            instructions: 'Keep energy high throughout'
                        }
                    ]
                },
                {
                    scheduleId: 'SCH002',
                    songLeader: 'Geneveve España',
                    backups: ['Cathy Martinez', 'Merianne', 'Ezra'],
                    practiceDate: followingSaturday.toISOString().split('T')[0],
                    scheduleDate: followingSunday.toISOString().split('T')[0],
                    slowSongs: [
                        {
                            title: 'O Come to the Altar',
                            link: 'https://www.youtube.com/watch?v=-_a5uG6KkI8',
                            lyrics: 'Are you hurting and broken within?\nOverwhelmed by the weight of your sin?',
                            instructions: 'Build gradually to powerful finish'
                        }
                    ],
                    fastSongs: [
                        {
                            title: 'Do It Again',
                            link: 'https://www.youtube.com/watch?v=81gR_8_W8UY',
                            lyrics: 'Walking around these walls\nI thought by now they\'d fall',
                            instructions: 'Keep tempo steady'
                        },
                        {
                            title: 'Great Are You Lord',
                            link: 'https://www.youtube.com/watch?v=u-1fwZtKJSM',
                            lyrics: 'You give life, You are love\nYou bring light to the darkness',
                            instructions: 'Focus on harmonies in chorus'
                        }
                    ]
                }
            ];
        }

        // Function to load a single YouTube embed with network awareness
        function loadYouTubeEmbed(youtubeLink, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const videoId = extractYouTubeId(youtubeLink);
            
            if (!videoId) {
                container.innerHTML = '<div class="youtube-placeholder"><i class="fas fa-exclamation-triangle"></i> Invalid YouTube URL</div>';
                return;
            }
            
            // Check if we're online before trying to load YouTube
            if (!navigator.onLine) {
                container.innerHTML = `
                    <div class="youtube-placeholder">
                        <i class="fas fa-wifi-slash"></i>
                        <span>No Internet Connection</span>
                        <small>YouTube video unavailable</small>
                    </div>
                `;
                return;
            }
            
            // Check connection speed for slow connections
            checkConnectionSpeed().then(speed => {
                if (speed < 0.5) {
                    // Slow connection - show placeholder with option to load
                    container.innerHTML = `
                        <div class="youtube-placeholder">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Slow Connection Detected</span>
                            <small>Loading YouTube may be slow</small>
                            <button class="btn-primary" onclick="loadYouTubeVideo('${videoId}', '${containerId}')" style="margin-top: 10px; padding: 8px 15px;">
                                <i class="fas fa-play"></i> Load Video Anyway
                            </button>
                        </div>
                    `;
                } else {
                    // Good connection - load video directly
                    loadYouTubeVideo(videoId, containerId);
                }
            });
        }

        // Function to actually load the YouTube iframe
        function loadYouTubeVideo(videoId, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <iframe src="https://www.youtube.com/embed/${videoId}" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen
                        loading="lazy">
                </iframe>
            `;
        }

        // Initialize network status when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeNetworkStatus();
        });

        function closeModal() {
            document.getElementById('scheduleModal').style.display = 'none';
        }

        function toggleSongDetails(songId, songTitle, youtubeUrl) {
            const detailsElement = document.getElementById(songId);
            const isActive = detailsElement.classList.contains('active');
            
            // Toggle details visibility
            detailsElement.classList.toggle('active');
            
            // If opening details and we have a YouTube URL, auto-load lyrics
            if (!isActive && youtubeUrl && youtubeUrl.trim()) {
                // Extract video ID and auto-load lyrics
                const videoId = extractYoutubeVideoId(youtubeUrl);
                if (videoId) {
                    // Auto-load and display lyrics
                    loadYoutubeLyricsAutomatically(songTitle, youtubeUrl, songId);
                }
            }
        }
        
        // Auto-load lyrics when song details are opened
        async function loadYoutubeLyricsAutomatically(songTitle, youtubeUrl, songId) {
            try {
                // Get the song details container
                const detailsContainer = document.getElementById(songId);
                if (!detailsContainer) return;
                
                // Create lyrics panel if it doesn't exist
                let lyricsPanel = detailsContainer.querySelector('.auto-lyrics-panel');
                if (!lyricsPanel) {
                    lyricsPanel = document.createElement('div');
                    lyricsPanel.className = 'auto-lyrics-panel';
                    lyricsPanel.style.cssText = `
                        margin-top: 15px;
                        padding: 15px;
                        background: linear-gradient(135deg, #f0f5ff, #fff0f5);
                        border-radius: 8px;
                        border-left: 4px solid var(--primary);
                    `;
                    detailsContainer.appendChild(lyricsPanel);
                }
                
                // Show loading state
                lyricsPanel.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px; color: #666;">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>Fetching lyrics for "${escapeHtml(songTitle)}"...</span>
                    </div>
                `;
                
                // Fetch lyrics from Groq AI
                const lyrics = await getLyricsFromGroqAI(songTitle);
                
                // Display lyrics
                lyricsPanel.innerHTML = `
                    <div style="margin-bottom: 10px;">
                        <div style="font-weight: 600; color: var(--primary); margin-bottom: 8px; display: flex; align-items: center; gap: 6px;">
                            <i class="fas fa-music"></i> Lyrics for "${escapeHtml(songTitle)}"
                        </div>
                        <div style="white-space: pre-wrap; font-size: 0.9rem; line-height: 1.8; color: #444; max-height: 300px; overflow-y: auto; padding: 10px; background: white; border-radius: 6px;">
                            ${escapeHtml(lyrics)}
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error auto-loading lyrics:', error);
            }
        }

        function getSchedulesForDate(dateString) {
            if (currentCalendarType === 'paw') {
                return scheduleData.filter(schedule => {
                    // Skip header row
                    if (schedule.scheduleId === 'ScheduleID') return false;
                    
                    // Format dates for comparison
                    const scheduleDate = formatDateForComparison(schedule.scheduleDate);
                    const practiceDate = formatDateForComparison(schedule.practiceDate);
                    const checkDate = formatDateForComparison(dateString);
                    
                    return scheduleDate === checkDate || practiceDate === checkDate;
                });
            } else {
                // For meetings, return meetings data
                return [];
            }
        }

        // Clean schedule data (remove header rows and invalid data)
        function cleanScheduleData(data) {
            return data.filter(schedule => {
                // Remove header row and invalid schedules
                return schedule.scheduleId && 
                    schedule.scheduleId !== 'ScheduleID' && 
                    schedule.scheduleId !== '' &&
                    schedule.scheduleDate; // Must have a schedule date
            });
        }

        // Loading indicator functions
        function showLoading(message = 'Loading...') {
            // Remove existing loading indicator if any
            hideLoading();
            
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loadingIndicator';
            loadingDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 20px;
                border-radius: 8px;
                z-index: 10000;
                display: flex;
                align-items: center;
                gap: 10px;
            `;
            loadingDiv.innerHTML = `
                <i class="fas fa-spinner fa-spin"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(loadingDiv);
        }        

        function hideLoading() {
            const loadingIndicator = document.getElementById('loadingIndicator');
            if (loadingIndicator) {
                loadingIndicator.remove();
            }
        }




        function printCalendar() {
            window.print();
        }

        // Mock data for demonstration
        function getMockScheduleData() {
            return [
                {
                    scheduleId: '12345678',
                    songLeader: 'Psalm Gambe',
                    backups: ['Cathy', 'Tiffany', 'Geneveve'],
                    practiceDate: '2025-11-16',
                    scheduleDate: '2025-11-23',
                    slowSongs: [
                        {
                            title: 'Goodness of God',
                            link: 'https://www.youtube.com/watch?v=example1',
                            lyrics: 'I love You Lord\nFor Your mercy never fails me\nAll my days, I\'ve been held in Your hands',
                            instructions: 'Start softly, build to powerful chorus'
                        },
                        {
                            title: 'What a Beautiful Name',
                            link: 'https://www.youtube.com/watch?v=example2',
                            lyrics: 'You were the Word at the beginning\nOne with God the Lord Most High',
                            instructions: 'Emphasize the bridge section'
                        }
                    ],
                    fastSongs: [
                        {
                            title: 'Reckless Love',
                            link: 'https://www.youtube.com/watch?v=example3',
                            lyrics: 'Before I spoke a word, You were singing over me\nYou have been so, so good to me',
                            instructions: 'Keep energy high throughout'
                        },
                        {
                            title: 'Way Maker',
                            link: 'https://www.youtube.com/watch?v=example4',
                            lyrics: 'You are here, moving in our midst\nYou are here, working in this place',
                            instructions: 'Start with keyboard intro'
                        }
                    ]
                },
                {
                    scheduleId: '87654321',
                    songLeader: 'Geneveve España',
                    backups: ['Cathy', 'Merianne', 'Ezra'],
                    practiceDate: '2025-11-23',
                    scheduleDate: '2025-11-30',
                    slowSongs: [
                        {
                            title: 'O Come to the Altar',
                            link: 'https://www.youtube.com/watch?v=example5',
                            lyrics: 'Are you hurting and broken within?\nOverwhelmed by the weight of your sin?',
                            instructions: 'Build gradually to powerful finish'
                        }
                    ],
                    fastSongs: [
                        {
                            title: 'Do It Again',
                            link: 'https://www.youtube.com/watch?v=example6',
                            lyrics: 'Walking around these walls\nI thought by now they\'d fall',
                            instructions: 'Keep tempo steady'
                        },
                        {
                            title: 'Great Are You Lord',
                            link: 'https://www.youtube.com/watch?v=example7',
                            lyrics: 'You give life, You are love\nYou bring light to the darkness',
                            instructions: 'Focus on harmonies in chorus'
                        }
                    ]
                }
            ];
        }

        function initializeNetworkStatus() {
            const networkStatus = document.getElementById('networkStatus');
            const networkStatusText = document.getElementById('networkStatusText');
            
            // Check initial connection status
            updateNetworkStatus();
            
            // Listen for online/offline events
            window.addEventListener('online', updateNetworkStatus);
            window.addEventListener('offline', updateNetworkStatus);
            
            // Check connection speed periodically
            setInterval(checkConnectionSpeed, 30000); // Check every 30 seconds
        }
        
        function updateNetworkStatus() {
            const networkStatus = document.getElementById('networkStatus');
            const networkStatusText = document.getElementById('networkStatusText');
            
            if (navigator.onLine) {
                // Check if connection is slow
                checkConnectionSpeed().then(speed => {
                    if (speed < 0.5) { // Less than 0.5 Mbps
                        networkStatus.className = 'network-status slow';
                        networkStatusText.innerHTML = '<i class="fas fa-tachometer-alt"></i> Slow Connection';
                        networkStatus.style.display = 'block';
                        
                        // Auto-hide after 5 seconds
                        setTimeout(() => {
                            networkStatus.style.display = 'none';
                        }, 5000);
                    } else {
                        networkStatus.className = 'network-status online';
                        networkStatusText.innerHTML = '<i class="fas fa-wifi"></i> Online';
                        networkStatus.style.display = 'block';
                        
                        // Auto-hide after 3 seconds
                        setTimeout(() => {
                            networkStatus.style.display = 'none';
                        }, 3000);
                    }
                });
            } else {
                networkStatus.className = 'network-status offline';
                networkStatusText.innerHTML = '<i class="fas fa-wifi-slash"></i> Offline';
                networkStatus.style.display = 'block';
            }
        }
        
        function checkConnectionSpeed() {
            return new Promise((resolve) => {
                // Simple connection speed test by downloading a small image
                const startTime = Date.now();
                const image = new Image();
                const fileSize = 50000; // 50KB test file
                
                // Use a small image from a reliable CDN for testing
                image.src = 'https://placehold.co/100x100/cccccc/ffffff?text=Test&t=' + startTime;
                
                image.onload = function() {
                    const endTime = Date.now();
                    const duration = (endTime - startTime) / 1000; // in seconds
                    const bitsLoaded = fileSize * 8;
                    const speedMbps = (bitsLoaded / duration / (1024 * 1024)).toFixed(2);
                    resolve(parseFloat(speedMbps));
                };
                
                image.onerror = function() {
                    // If we can't load the test image, assume slow connection
                    resolve(0.1);
                };
                
                // Set a timeout in case the image takes too long to load
                setTimeout(() => {
                    resolve(0.1); // Assume slow connection if timeout
                }, 5000);
            });
        }

        function handleLyricsPaste(event) {
            // Let the paste happen normally first
            setTimeout(() => {
                const textarea = event.target;
                // The formatting should be preserved automatically with white-space: pre-wrap
                // But we can add any additional processing here if needed
            }, 0);
        }

        // Initialize all sections with coming soon content
        function initializeAllSections() {
            // Only initialize sections that don't have existing content
            // Announcements, home, attendance have static content and should not be overwritten
            const sections = ['praise-worship', 'media', 'dancers', 'ashers'];
            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    const titles = {
                        'attendance': 'Attendance Record',
                        'announcements': 'Announcements',
                        'praise-worship': 'Praise And Worship',
                        'media': 'Media Ministry',
                        'dancers': 'Dancers Ministry',
                        'ashers': 'Ashers Ministry'
                    };
                    
                    section.innerHTML = `
                        <h2 class="section-title">${titles[sectionId] || sectionId}</h2>
                        <div style="text-align: center; padding: 60px 20px;">
                            <div style="font-size: 4rem; margin-bottom: 20px; color: var(--primary);"><i class="fas fa-tools"></i></div>
                            <h3 style="color: var(--primary); margin-bottom: 15px; font-size: 1.5rem;">Features Coming Soon</h3>
                            <p style="color: #6c757d; margin-bottom: 25px; font-size: 1.1rem; line-height: 1.6;">
                                We're working hard to bring you amazing features for this section!<br>
                                Please be patient as we develop and test everything to ensure the best experience.
                            </p>
                            <div style="background: linear-gradient(135deg, rgba(146, 108, 21, 0.1), rgba(255, 195, 0, 0.1)); padding: 20px; border-radius: var(--border-radius); display: inline-block;">
                                <p style="color: var(--primary); font-weight: 600; margin: 0; font-size: 0.9rem;">
                                    <i class="fas fa-hammer"></i> Under Development by: <strong>Frank Gomez</strong>
                                </p>
                            </div>
                            <div style="margin-top: 30px; padding: 20px; background: white; border-radius: var(--border-radius); box-shadow: var(--shadow); max-width: 500px; margin-left: auto; margin-right: auto;">
                                <h4 style="color: var(--primary); margin-bottom: 15px;"><i class="fas fa-clipboard-list"></i> What to Expect:</h4>
                                <ul style="text-align: left; color: #6c757d; line-height: 1.8;">
                                    <li><i class="fas fa-check" style="color: var(--primary); margin-right: 8px;"></i>Enhanced user interface and experience</li>
                                    <li><i class="fas fa-check" style="color: var(--primary); margin-right: 8px;"></i>Real-time updates and notifications</li>
                                    <li><i class="fas fa-check" style="color: var(--primary); margin-right: 8px;"></i>Comprehensive ministry tools</li>
                                    <li><i class="fas fa-check" style="color: var(--primary); margin-right: 8px;"></i>Mobile-friendly design</li>
                                    <li><i class="fas fa-check" style="color: var(--primary); margin-right: 8px;"></i>And much more!</li>
                                </ul>
                            </div>
                        </div>
                    `;
                }
            });
        }

        // Close modals when clicking outside
        document.addEventListener('click', function(event) {
            const receiptModal = document.getElementById('receiptModal');
            const receiptContainer = document.getElementById('receiptContent');
            const scheduleModal = document.getElementById('scheduleModal');
            const modalContent = document.querySelector('.modal-content');
            const calendarModal = document.getElementById('calendarModal');
            const calendarModalContent = document.querySelector('.calendar-modal-content');
            
            if (event.target === receiptModal) {
                closeReceipt();
            }
            
            if (event.target === scheduleModal) {
                closeModal();
            }
            if (event.target === calendarModal) {
                closeCalendarModal();
            }
        });

        // Handle image loading errors
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('img, [style*="background-image"]').forEach(element => {
                if (element.tagName === 'IMG') {
                    element.onerror = function() {
                        console.warn('Failed to load image:', this.src);
                        this.style.display = 'none';
                    };
                } else {
                    // For elements with background-image
                    const checkBackgroundImage = function() {
                        const bgImage = getComputedStyle(this).backgroundImage;
                        if (bgImage.includes('url') && !bgImage.includes('gradient')) {
                            const img = new Image();
                            const url = bgImage.replace(/url\(['"]?(.*?)['"]?\)/i, "$1");
                            img.onerror = () => {
                                console.warn('Failed to load background image:', url);
                                this.style.backgroundImage = 'none';
                                this.style.backgroundColor = '#f8f9fa'; // Fallback color
                            };
                            img.src = url;
                        }
                    };
                    
                    // Check after a short delay to ensure styles are applied
                    setTimeout(() => checkBackgroundImage.call(element), 100);
                }
            });
        });

        // Check verification status function
        function checkVerificationStatus() {
            showAlert('Checking verification status...', 'info');
            // In a real implementation, this would call your backend API
            setTimeout(() => {
                showAlert('Your account is still pending verification. Please check back later.', 'warning');
            }, 1000);
        }

        // ===== SPIRITUAL ASSISTANT CHAT FUNCTIONS =====

        // Personalize the greeting message with user's name
        function personalizeGreeting() {
            const initialGreeting = document.getElementById('initialGreeting');
            
            // Get user name from various sources
            let userName = 'Friend';
            
            // Try userData global variable first
            if (typeof userData !== 'undefined' && userData && userData.firstname) {
                userName = userData.firstname;
            }
            // Try sessionStorage
            else if (sessionStorage.getItem('userData')) {
                try {
                    const storedData = JSON.parse(sessionStorage.getItem('userData'));
                    if (storedData && storedData.firstname) {
                        userName = storedData.firstname;
                    }
                } catch (e) {
                    console.log('Could not parse userData from sessionStorage');
                }
            }
            // Try localStorage
            else if (localStorage.getItem('userData')) {
                try {
                    const storedData = JSON.parse(localStorage.getItem('userData'));
                    if (storedData && storedData.firstname) {
                        userName = storedData.firstname;
                    }
                } catch (e) {
                    console.log('Could not parse userData from localStorage');
                }
            }
            
            console.log(`🎯 Personalizing greeting for: ${userName}`);
            
            if (initialGreeting) {
                initialGreeting.innerHTML = `
                    <div class="message-content">
                        <p>Hello <strong>${userName}</strong>! 👋 I'm your Spiritual Assistant. I'm here to help you reflect on life's challenges through the lens of biblical wisdom and scripture.</p>
                        <p style="margin-top: 10px; font-size: 0.95em; color: #888;">Ask me about any situation you're facing, ${userName}, and I'll help you find biblical guidance and relevant scriptures.</p>
                    </div>
                    <div class="message-time">Now</div>
                `;
            }
        }

        // Send user question and get AI spiritual guidance
        async function sendSpiritualQuestion() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            
            if (!message) {
                showAlert('Please ask a question or share your situation', 'warning');
                return;
            }

            // Display user message
            displayChatMessage(message, true);
            userInput.value = '';
            userInput.style.height = 'auto';

            // Show typing indicator
            const typingDiv = document.createElement('div');
            typingDiv.className = 'chat-message ai-message';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="message-content typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            document.getElementById('chatMessages').appendChild(typingDiv);
            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;

            try {
                // Get user's name from various sources
                let userName = 'Friend';
                
                if (typeof userData !== 'undefined' && userData && userData.firstname) {
                    userName = userData.firstname;
                } else if (sessionStorage.getItem('userData')) {
                    try {
                        const storedData = JSON.parse(sessionStorage.getItem('userData'));
                        if (storedData && storedData.firstname) {
                            userName = storedData.firstname;
                        }
                    } catch (e) {}
                } else if (localStorage.getItem('userData')) {
                    try {
                        const storedData = JSON.parse(localStorage.getItem('userData'));
                        if (storedData && storedData.firstname) {
                            userName = storedData.firstname;
                        }
                    } catch (e) {}
                }
                
                console.log(`💬 Processing question for user: ${userName}`);
                const aiResponse = await fetchSpiritualGuidance(message, userName);
                
                // Remove typing indicator
                const typing = document.getElementById('typingIndicator');
                if (typing) typing.remove();

                // Display AI response
                displayChatMessage(aiResponse, false);
                
            } catch (error) {
                console.error('❌ Error fetching spiritual guidance:', error);
                const typing = document.getElementById('typingIndicator');
                if (typing) typing.remove();

                const fallbackResponse = `I appreciate your question. While I'm having trouble retrieving guidance at the moment, I encourage you to:

1. **Pray** - Take your concerns directly to God in prayer
2. **Read Scripture** - Open your Bible and seek God's word
3. **Seek Counsel** - Talk to your pastor or spiritual mentor
4. **Trust God** - Remember that God cares about your situation

Romans 6:23 reminds us: "The wages of sin is death, but the gift of God is eternal life in Christ Jesus our Lord."

Please try again in a moment or reach out to your spiritual leaders.`;

                displayChatMessage(fallbackResponse, false);
            }
        }

        // Fetch spiritual guidance from Groq API
        async function fetchSpiritualGuidance(userMessage, userName = 'Friend') {
            const GROQ_API_KEY = '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';
            const GROQ_API_URL = 'https://api.groq.com/openai/v1/chat/completions';

            const systemPrompt = `You are a deeply compassionate and biblically-grounded spiritual advisor speaking personally with **${userName}**. Your role is to provide profound, detailed, comprehensive, and personalized spiritual guidance that is never incomplete or lacking. 

CORE PRINCIPLES:
1. **Show Deep Empathy** - Acknowledge ${userName}'s feelings with genuine compassion and understanding
2. **Connect to Scripture** - Weave relevant biblical passages naturally into your response with context
3. **Provide Biblical Perspective** - Help ${userName} see their situation through God's lens
4. **Offer Practical Wisdom** - Give actionable steps grounded in faith and scripture
5. **Encourage Prayer** - Gently guide ${userName} toward personal prayer and God's presence
6. **Recommend Professional Help** - For serious matters, suggest consulting spiritual leaders or counselors
7. **Complete Responses** - Always provide thorough, substantial answers that fully address the concern

DETAILED FORMATTING INSTRUCTIONS:
- Use **bold text** for emphasis on key spiritual concepts
- Use # for main sections, ## for subsections
- Format scripture as: **Book Chapter:Verse** (e.g., **Psalm 23:4**)
- Always explain what each scripture means in context of ${userName}'s situation
- Use numbered lists for steps or recommendations: 1. Step, 2. Step, etc.
- Use bullet points for key insights: - Key insight
- Include emojis thoughtfully to add visual warmth (💙 ✝️ 🙏 🕊️)
- Address ${userName} by name multiple times throughout

REQUIRED RESPONSE STRUCTURE - ALWAYS FOLLOW COMPLETELY:

# 💙 Understanding Your Heart, ${userName}
Begin with genuine empathy. Reflect back what you heard to show understanding. Validate their feelings.

## What I'm Hearing
A brief reflection of their situation showing you truly listened.

# ✝️ What Scripture Says
This is the biblical foundation section. Provide 2-3 relevant scriptures with:
- The scripture reference
- What it means
- How it applies to ${userName}'s specific situation

# 🙏 Spiritual Perspective
Explain the deeper spiritual truth relevant to their concern. Help ${userName} understand God's perspective.

# 🕊️ Practical Steps for ${userName}
Give 3-4 concrete, actionable steps that blend faith and practical wisdom specifically for ${userName}:
1. Specific action with why it matters
2. Specific action with biblical foundation
3. Specific action for daily practice
4. Specific action for community/support

# 💪 Encouragement from God's Promise
Offer hope rooted in God's character and promises. End with an inspiring scriptural truth that directly addresses ${userName}'s situation.

# 🤝 Next Steps & Closing
Suggest 1-2 ways ${userName} can deepen their spiritual practice or seek additional support.

Conclude with a warm, heartfelt closing blessing or encouragement that ties everything together and reminds ${userName} that God is with them.

TONE AND STYLE:
- Warm, personal, and deeply compassionate
- Scholarly enough to show biblical expertise but accessible and conversational
- Hope-filled and encouraging without being dismissive of struggles
- Non-judgmental and accepting of human weakness
- Always point toward God's love, grace, and redemptive power
- Make responses substantial, detailed, and thorough (aim for depth and completeness)
- NEVER leave responses feeling incomplete or unfinished
- Always have a clear, satisfying conclusion

CRITICAL REQUIREMENT: Every response must be complete and end clearly with a meaningful conclusion. Do not cut off mid-thought. Provide full, rounded responses that leave ${userName} feeling heard, guided, and encouraged.

Remember: ${userName} came to you with their heart. Respond with the fullness of God's love, wisdom, and grace. Every response should feel like a warm, complete embrace from a trusted spiritual mentor - never rushed or incomplete.`;
            

            try {
                const response = await fetch(GROQ_API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${GROQ_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'openai/gpt-oss-120b',
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: userMessage }
                        ],
                        temperature: 0.7,
                        max_tokens: 1200
                    })
                });

                if (!response.ok) {
                    console.error('⚠️ Groq API returned status', response.status);
                    throw new Error(`API error: ${response.statusText}`);
                }

                const data = await response.json();
                const aiMessage = data.choices[0].message.content;
                
                console.log('✨ SPIRITUAL GUIDANCE RECEIVED FROM GROQ');
                return aiMessage;

            } catch (error) {
                console.error('❌ Error fetching spiritual guidance from Groq:', error);
                throw error;
            }
        }

        // Display chat message in the chat window
        function displayChatMessage(message, isUserMessage) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${isUserMessage ? 'user-message' : 'ai-message'}`;

            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });

            // Format the message content
            let formattedMessage = message;
            
            messageDiv.innerHTML = `
                <div class="message-content">
                    ${formatMessageText(formattedMessage)}
                </div>
                <div class="message-time">${timeString}</div>
            `;

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Format message text with markdown-style formatting
        function formatMessageText(text) {
            let html = text;
            
            // Convert markdown-style bold (**text**) to actual bold
            html = html.replace(/\*\*([^*]+)\*\*/g, '<strong style="color: var(--primary); font-weight: 700;">$1</strong>');
            
            // Convert single asterisks (*text*) to italic
            html = html.replace(/\*([^*]+)\*/g, '<em style="color: var(--secondary); font-style: italic;">$1</em>');
            
            // Convert hashtag headers (# Title, ## Title) to styled headers
            html = html.replace(/^##\s+(.+)$/gm, '<h4 style="margin-top: 15px; margin-bottom: 10px; color: var(--primary); font-weight: 700; font-size: 1.02em; padding-left: 12px; border-left: 4px solid var(--primary);">$1</h4>');
            html = html.replace(/^#\s+(.+)$/gm, '<h3 style="margin-top: 18px; margin-bottom: 12px; color: var(--primary); font-weight: 700; font-size: 1.15em; border-bottom: 2px solid var(--primary); padding-bottom: 8px;">$1</h3>');
            
            // Format numbered lists with better styling
            html = html.replace(/^\d+\.\s+(.+)$/gm, '<div style="margin: 10px 0 10px 0; padding: 10px 15px; background: rgba(99, 110, 250, 0.08); border-left: 4px solid var(--primary); border-radius: 4px;"><strong style="color: var(--primary);">$1</strong></div>');
            
            // Format bullet points with better styling
            html = html.replace(/^[-•]\s+(.+)$/gm, '<div style="margin: 8px 0; padding-left: 20px; position: relative;"><span style="position: absolute; left: 0; color: var(--primary);">✓</span>$1</div>');
            
            // Split into paragraphs and process each
            const paragraphs = html.split(/\n\n+/);
            
            return paragraphs
                .map(para => {
                    if (!para.trim()) return '';
                    
                    // Check if it's a scripture reference (Book Chapter:Verse format with bold)
                    if (para.match(/^(.*?)<strong[^>]*>[\w\s0-9]+\s+\d+:\d+<\/strong>/)) {
                        return `<div class="scripture-reference" style="background: linear-gradient(135deg, rgba(139, 69, 19, 0.1) 0%, rgba(184, 134, 11, 0.1) 100%); border-left: 4px solid #b8860b; padding: 12px 15px; margin: 12px 0; border-radius: 4px; font-style: italic; line-height: 1.7;">${para.trim()}</div>`;
                    }
                    
                    // Check if it already contains HTML tags (headers, lists)
                    if (para.includes('<')) {
                        return `<div style="margin-bottom: 12px; line-height: 1.7;">${para}</div>`;
                    }
                    
                    // Regular paragraph with improved styling
                    return `<p style="margin-bottom: 12px; line-height: 1.8; color: #333;">${para.trim()}</p>`;
                })
                .join('');
        }

        // Auto-expand textarea as user types
        document.addEventListener('DOMContentLoaded', function() {
            const userInput = document.getElementById('userInput');
            if (userInput) {
                userInput.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = Math.min(this.scrollHeight, 120) + 'px';
                });

                // Allow Enter + Shift to send, just Enter to newline
                userInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendSpiritualQuestion();
                    }
                });
            }
        });

    </script>

    <!-- Flowise-style Chatbot -->
    <button class="flowise-button" id="flowiseButton" onclick="toggleFlowiseChat()" title="Open Bible Assistant">
        <img src="assets/LOGO.png" alt="Bible Assistant">
    </button>

    <div class="flowise-tooltip">Got questions? Ask me! 👋</div>

    <div class="flowise-chat-window" id="flowiseChatWindow">
        <div class="flowise-chat-header">
            <div class="flowise-chat-header-content">
                <img src="assets/LOGO.png" alt="Bible Assistant">
                <div class="flowise-chat-header-text">
                    <h3>Bible Assistant</h3>
                    <p>Always here to help</p>
                </div>
            </div>
            <button class="flowise-close-btn" onclick="closeFlowiseChat()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="flowise-messages" id="flowiseMessages">
            <div class="flowise-message ai">
                <div class="flowise-message-bubble">
                    👋 Hi There! I'm your Bible Assistant. Ask me anything about Scripture, church roles, or spiritual guidance. How can I help you today?
                </div>
            </div>
        </div>
        <div class="flowise-input-area">
            <input 
                type="text" 
                id="flowiseInput" 
                placeholder="Type your question..."
                onkeypress="if(event.key==='Enter') sendFlowiseMessage()">
            <button class="flowise-send-btn" onclick="sendFlowiseMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

</body>
</html>
