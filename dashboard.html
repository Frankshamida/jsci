<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Ministry Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="/assets/LOGO.png">
    <link rel="shortcut icon" type="image/x-icon" href="/assets/LOGO.png">
    <link rel="apple-touch-icon" href="assets/LOGO.png">
    <style>
    :root {
        --primary: #926C15;
        --secondary: #C9980B;
        --accent: #FFC300;
        --light-yellow: #FFD235;
        --bright-yellow: #FFE169;
        --light: #f8f9fa;
        --dark: #343a40;
        --success: #28a745;
        --danger: #dc3545;
        --border-radius: 12px;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s ease;
        --sidebar-width: 280px;
        --header-height: 80px;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
        background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
        min-height: 100vh;
        overflow-x: hidden;
    }

    .dashboard-container {
        display: flex;
        min-height: 100vh;
        position: relative;
    }

    /* Sidebar Styles */
    .sidebar {
        width: var(--sidebar-width);
        background: white;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        transition: var(--transition);
        z-index: 1000;
    }

    .sidebar-header {
        background: linear-gradient(135deg, var(--accent), var(--primary));
        padding: 20px 15px;
        text-align: center;
        color: white;
    }

    .logo {
        width: 80px;
        height: 80px;
        background-image: url('assets/LOGO.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        margin: 0 auto 10px;
        filter: drop-shadow(0px 4px 10px rgba(0,0,0,0.6));
    }

    .church-name {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 5px;
        font-family: 'Montserrat', sans-serif;
        text-shadow: 2px 2px 5px rgba(0,0,0,0.25);
    }

    .church-subtitle {
        font-size: 0.7rem;
        opacity: 0.9;
        font-family: 'Montserrat', sans-serif;
        letter-spacing: 5px;
        text-shadow: 2px 2px 5px rgba(0,0,0,0.25);
    }

    .user-info {
        background: rgba(255, 255, 255, 0.2);
        padding: 12px;
        border-radius: var(--border-radius);
        margin-top: 15px;
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .user-avatar-container {
        position: relative;
        width: 70px;
        height: 70px;
        flex-shrink: 0;
    }

    .user-avatar {
        width: 100%;
        height: 100%;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--primary);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .user-details {
        flex: 1;
    }

    .user-name {
        font-size: 1rem;
        font-weight: 600;
        color: white;
        margin: 0 0 3px 0;
    }

    .user-ministry {
        font-size: 0.75rem;
        opacity: 0.9;
        color: white;
        margin: 0;
    }

    .status-indicator {
        position: absolute;
        bottom: -2px;
        right: -2px;
        z-index: 10;
    }

    .status-circle {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        border: 2px solid white;
        position: relative;
        cursor: pointer;
        transition: var(--transition);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .status-circle:hover {
        transform: scale(1.2);
    }

    .status-circle.verified {
        background-color: var(--success);
    }

    .status-circle.unverified {
        background-color: var(--danger);
    }

    .status-tooltip {
        position: absolute;
        bottom: 100%;
        right: 0;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 6px 10px;
        border-radius: 6px;
        font-size: 0.7rem;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transition: var(--transition);
        z-index: 100;
        margin-bottom: 5px;
    }

    .status-circle:hover .status-tooltip {
        opacity: 1;
        transform: translateY(-3px);
    }

    .sidebar-menu {
        padding: 15px 0;
    }

    .menu-item {
        display: flex;
        align-items: center;
        padding: 12px 20px;
        color: var(--dark);
        text-decoration: none;
        transition: var(--transition);
        cursor: pointer;
        border-left: 4px solid transparent;
        font-size: 0.9rem;
    }

    .menu-item:hover {
        background: #f8f9fa;
        border-left-color: var(--primary);
    }

    .menu-item.active {
        background: linear-gradient(90deg, rgba(146, 108, 21, 0.1), transparent);
        border-left-color: var(--primary);
        color: var(--primary);
        font-weight: 600;
    }

    .menu-item.disabled {
        opacity: 0.5;
        cursor: not-allowed;
        pointer-events: none;
    }

    .menu-item.disabled:hover {
        background: transparent;
        border-left-color: transparent;
    }

    .menu-icon {
        font-size: 1.1rem;
        margin-right: 12px;
        width: 20px;
        text-align: center;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        color: transparent;
    }

    .logout-btn {
        position: absolute;
        bottom: 20px;
        left: 20px;
        right: 20px;
        padding: 10px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'Montserrat', sans-serif;
        font-size: 0.9rem;
    }

    .logout-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(146, 108, 21, 0.4);
    }

    /* Main Content Styles */
    .main-content {
        flex: 1;
        margin-left: var(--sidebar-width);
        padding: 20px;
        transition: var(--transition);
        overflow-x: hidden;
        width: 100%;
        box-sizing: border-box;
    }

    .content-header {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }

    .content-header-text {
        flex: 1;
        min-width: 250px;
    }

    .content-header h1 {
        color: var(--primary);
        margin-bottom: 5px;
        font-family: 'Montserrat', sans-serif;
        font-size: 1.5rem;
    }

    .content-header p {
        color: #6c757d;
        font-family: 'Montserrat', sans-serif;
        font-size: 0.9rem;
    }

    .notification-btn {
        position: relative;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        font-size: 1.3rem;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(146, 108, 21, 0.3);
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .notification-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(146, 108, 21, 0.4);
    }

    .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: bold;
        border: 2px solid white;
    }

    /* Notification Modal */
    .notification-modal {
        position: fixed;
        top: 0;
        right: -400px;
        width: 400px;
        height: 100vh;
        background: white;
        box-shadow: -4px 0 20px rgba(0, 0, 0, 0.2);
        z-index: 2000;
        transition: right 0.4s ease;
        overflow-y: auto;
        border-radius: 12px 0 0 12px;
    }

    .notification-modal.active {
        right: 0;
    }

    .notification-modal-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 1.3rem;
        font-weight: bold;
    }

    .notification-modal-close {
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        transition: var(--transition);
    }

    .notification-modal-close:hover {
        transform: scale(1.2);
    }

    .notification-modal-content {
        padding: 20px;
    }

    .notification-item {
        background: #f8f9fa;
        border-left: 4px solid var(--primary);
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 6px;
        transition: var(--transition);
    }

    .notification-item:hover {
        background: #e9ecef;
        transform: translateX(5px);
    }

    .notification-greeting-header {
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 8px;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .notification-greeting-text {
        color: #555;
        line-height: 1.5;
        margin-bottom: 8px;
        font-size: 0.95rem;
    }

    .notification-footer {
        display: flex;
        justify-content: space-between;
        font-size: 0.85rem;
        color: #999;
        margin-top: 8px;
        padding-top: 8px;
        border-top: 1px solid #e0e0e0;
    }

    .notification-no-items {
        text-align: center;
        padding: 40px 20px;
        color: #999;
    }

    .notification-no-items i {
        font-size: 2.5rem;
        margin-bottom: 10px;
        opacity: 0.3;
    }

    /* Common Card Styles */
    .card {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }

    .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(90deg, var(--primary), var(--accent));
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    .stat-card {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(90deg, var(--primary), var(--accent));
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .stat-icon {
        font-size: 2rem;
        margin-bottom: 10px;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        color: transparent;
    }

    .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 5px;
    }

    .stat-label {
        color: #6c757d;
        font-size: 0.85rem;
    }

    .content-section {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        margin-bottom: 15px;
        display: none;
        width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
        min-height: auto;
    }

    .content-section.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .section-title {
        color: var(--primary);
        font-size: 1.3rem;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #e0e0e0;
        font-family: 'Montserrat', sans-serif;
    }

    .section-title i {
        background: linear-gradient(135deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        color: transparent;
        margin-right: 10px;
    }

    .welcome-message {
        padding: 15px;
        background: linear-gradient(135deg, rgba(146, 108, 21, 0.1), rgba(255, 195, 0, 0.1));
        border-radius: 8px;
        margin-bottom: 15px;
    }

    .welcome-message h2 {
        color: var(--primary);
        margin-bottom: 8px;
        font-family: 'Montserrat', sans-serif;
        font-size: 1.3rem;
    }

    .first-time-welcome {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: var(--border-radius);
        margin-bottom: 20px;
        box-shadow: var(--shadow);
        text-align: center;
        animation: slideInUp 0.6s ease;
    }

    .first-time-welcome h2 {
        font-size: 1.5rem;
        margin-bottom: 10px;
        font-family: 'Montserrat', sans-serif;
    }

    .first-time-welcome p {
        font-size: 0.95rem;
        margin-bottom: 8px;
        opacity: 0.95;
    }

    @keyframes slideInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Verification Banner */
    .verification-banner {
        background: linear-gradient(135deg, #ffc107, #ff8c00);
        color: white;
        padding: 15px;
        border-radius: var(--border-radius);
        margin-bottom: 20px;
        text-align: center;
        box-shadow: var(--shadow);
    }

    .verification-banner h3 {
        margin-bottom: 8px;
        font-size: 1.1rem;
    }

    .verification-banner p {
        margin-bottom: 10px;
        opacity: 0.9;
        font-size: 0.9rem;
    }

    .refresh-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid white;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
        font-size: 0.85rem;
    }

    .refresh-btn:hover {
        background: white;
        color: #ff8c00;
    }

    /* Bible Verse Section */
    .bible-verse-container {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 20px;
        border-radius: var(--border-radius);
        margin-bottom: 20px;
        box-shadow: var(--shadow);
        position: relative;
        overflow: hidden;
    }

    .bible-verse-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.1"><text x="50%" y="50%" font-size="80" text-anchor="middle" dominant-baseline="middle" font-family="serif">✝</text></svg>');
        background-size: 150px;
        background-repeat: no-repeat;
        background-position: center;
    }

    .verse-of-the-day {
        font-size: 1rem;
        font-style: italic;
        margin-bottom: 10px;
        line-height: 1.5;
        position: relative;
        z-index: 1;
    }

    .verse-reference {
        font-size: 0.85rem;
        text-align: right;
        font-weight: 600;
        position: relative;
        z-index: 1;
    }

    .verse-explanation {
        margin-top: 10px;
        font-size: 0.85rem;
        opacity: 0.9;
        position: relative;
        z-index: 1;
    }

    .verse-language {
        margin-top: 8px;
        font-size: 0.8rem;
        opacity: 0.8;
        position: relative;
        z-index: 1;
    }

    /* Verse Controls - Version and Language Selector */
    .verse-controls {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        position: relative;
        z-index: 2;
    }

    .version-selector,
    .language-selector {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .version-selector label,
    .language-selector label {
        font-weight: 600;
        font-size: 0.9rem;
        color: white;
    }

    .version-btn,
    .language-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        font-size: 0.85rem;
        transition: all 0.3s ease;
    }

    .version-btn:hover,
    .language-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: white;
        transform: translateY(-2px);
    }

    .version-btn.active,
    .language-btn.active {
        background: white;
        color: var(--primary);
        border-color: white;
    }

    /* Inspiring Words Section - LIVE AI */
    .inspiring-words-section {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.3);
        font-size: 0.95rem;
        font-weight: 500;
        font-style: italic;
        position: relative;
        z-index: 1;
        min-height: 30px;
        transition: opacity 0.3s ease-in-out;
        opacity: 1;
    }

    /* Pulse animation for LIVE indicator */
    @keyframes pulse {
        0%, 100% { opacity: 0.8; }
        50% { opacity: 1; }
    }

    /* Fade in/out for word transitions */
    @keyframes fadeInOut {
        0%, 100% { opacity: 1; }
        45%, 55% { opacity: 0.7; }
    }

    /* Birthday Today Section Styles */
    .birthday-today-section {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        padding: 25px;
        margin-top: 25px;
        border-top: 5px solid #FF69B4;
    }

    .birthday-header {
        margin-bottom: 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }

    .birthday-header h2 {
        margin: 0;
        color: var(--dark);
        font-size: 1.4rem;
    }

    .birthday-greeting-box {
        background: linear-gradient(135deg, #FF69B4, #FF1493);
        color: white;
        padding: 12px 20px;
        border-radius: 25px;
        font-weight: 600;
        font-size: 0.95rem;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    .birthday-celebrants {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
    }

    .birthday-card {
        background: linear-gradient(135deg, #FFE5F0, #FFCCEB);
        border: 2px solid #FF69B4;
        border-radius: var(--border-radius);
        padding: 20px;
        text-align: center;
        transition: var(--transition);
        cursor: pointer;
    }

    .birthday-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(255, 105, 180, 0.3);
    }

    .birthday-card-icon {
        font-size: 2.5rem;
        margin-bottom: 10px;
    }

    .birthday-card-name {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 5px;
    }

    .birthday-card-date {
        font-size: 0.85rem;
        color: #FF1493;
        font-weight: 600;
    }

    .no-birthday-celebrants {
        text-align: center;
        padding: 30px;
        color: #6c757d;
    }

    .no-birthday-celebrants i {
        font-size: 2rem;
        margin-bottom: 10px;
        opacity: 0.5;
    }

    .upcoming-birthdays-section {
        border-top: 2px solid #e0e0e0;
        padding-top: 25px;
    }

    .upcoming-birthdays-section h3 {
        margin: 0 0 15px 0;
        color: var(--dark);
        font-size: 1.2rem;
    }

    .upcoming-birthdays {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 12px;
    }

    .upcoming-birthday-item {
        background: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 12px;
        text-align: center;
        transition: var(--transition);
    }

    .upcoming-birthday-item:hover {
        background: #fff;
        border-color: #FF69B4;
        box-shadow: 0 4px 12px rgba(255, 105, 180, 0.15);
    }

    .upcoming-birthday-name {
        font-weight: 700;
        color: var(--dark);
        font-size: 0.95rem;
        margin-bottom: 5px;
    }

    .upcoming-birthday-date {
        font-size: 0.8rem;
        color: #FF69B4;
        font-weight: 600;
    }

    .upcoming-birthday-days {
        font-size: 0.75rem;
        color: #6c757d;
        margin-top: 3px;
    }

    .no-upcoming-birthdays {
        text-align: center;
        padding: 20px;
        color: #6c757d;
        font-size: 0.9rem;
    }

    
    .mobile-menu-toggle {
        display: none;
        position: fixed;
        top: 15px;
        left: 15px;
        z-index: 1001;
        background: var(--primary);
        color: white;
        border: none;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        font-size: 1.3rem;
        cursor: pointer;
        box-shadow: var(--shadow);
    }

    .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
    }

    .table-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        min-width: 500px;
    }

    table th {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 10px;
        text-align: left;
        font-weight: 600;
        font-family: 'Montserrat', sans-serif;
        font-size: 0.9rem;
    }

    table td {
        padding: 10px;
        border-bottom: 1px solid #e0e0e0;
        font-family: 'Montserrat', sans-serif;
        font-size: 0.85rem;
    }

    table tr:hover {
        background: #f8f9fa;
    }

    .badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .badge-success {
        background: rgba(40, 167, 69, 0.1);
        color: var(--success);
    }

    .badge-warning {
        background: rgba(255, 193, 7, 0.1);
        color: #ffc107;
    }

    .badge-danger {
        background: rgba(220, 53, 69, 0.1);
        color: var(--danger);
    }

    /* Schedule Styles */
    .schedule-container {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
    }

    .schedule-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
    }

    .week-navigation {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .nav-btn {
        background: var(--primary);
        color: white;
        border: none;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        cursor: pointer;
        transition: var(--transition);
    }

    .nav-btn:hover {
        background: var(--secondary);
    }

    .schedule-actions {
        display: flex;
        gap: 10px;
    }

    .action-btn {
        background: white;
        border: 1px solid #ddd;
        padding: 8px 15px;
        border-radius: 6px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .action-btn:hover {
        background: #f8f9fa;
    }

    .schedule-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 15px;
        padding: 20px;
    }

    .day-card {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
    }

    .day-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 12px;
        font-weight: 600;
        text-align: center;
    }

    .day-events {
        padding: 15px;
    }

    .event-item {
        display: flex;
        gap: 10px;
        padding: 10px 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .event-item:last-child {
        border-bottom: none;
    }

    .event-time {
        font-weight: 600;
        color: var(--primary);
        min-width: 70px;
    }

    .event-details {
        flex: 1;
    }

    .event-title {
        font-weight: 600;
        margin-bottom: 3px;
    }

    .event-location {
        font-size: 0.85rem;
        color: #6c757d;
    }

    /* Announcement Styles */
    .announcements-container {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .announcement-card {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
        transition: var(--transition);
    }

    .announcement-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .announcement-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
    }

    .announcement-title {
        font-weight: 600;
        color: var(--primary);
        font-size: 1.1rem;
    }

    .announcement-date {
        color: #6c757d;
        font-size: 0.85rem;
    }

    .announcement-content {
        padding: 20px;
    }

    .announcement-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 20px;
        background: #f8f9fa;
        border-top: 1px solid #e0e0e0;
    }

    .announcement-author {
        font-weight: 600;
        color: var(--primary);
    }

    .announcement-priority {
        padding: 4px 10px;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .high-priority {
        background: rgba(220, 53, 69, 0.1);
        color: var(--danger);
    }

    .medium-priority {
        background: rgba(255, 193, 7, 0.1);
        color: #ffc107;
    }

    /* Birthday Greetings in Announcements */
    .birthday-greeting-card {
        background: linear-gradient(135deg, #fff8e1, #fff9c4);
        border: 2px solid #ffc107;
        border-radius: 12px;
        padding: 18px;
        margin-bottom: 15px;
        box-shadow: 0 4px 12px rgba(255, 195, 0, 0.15);
        transition: var(--transition);
    }

    .birthday-greeting-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 16px rgba(255, 195, 0, 0.25);
    }

    .birthday-greeting-header-section {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
    }

    .birthday-emoji {
        font-size: 2rem;
    }

    .birthday-greeting-info {
        flex: 1;
    }

    .birthday-greeting-name {
        font-weight: 700;
        color: #f57f17;
        font-size: 1.1rem;
        margin: 0;
    }

    .birthday-greeting-role {
        font-size: 0.85rem;
        color: #e67e22;
        margin: 3px 0 0 0;
        font-weight: 500;
    }

    .birthday-greeting-message {
        color: #555;
        line-height: 1.6;
        font-size: 0.95rem;
        background: rgba(255, 255, 255, 0.7);
        padding: 12px;
        border-radius: 8px;
        border-left: 3px solid #ff9800;
    }

    /* Upcoming Birthdays in Announcements */
    .upcoming-birthdays-container {
        background: white;
        border-radius: 12px;
        box-shadow: var(--shadow);
        overflow: hidden;
        margin-top: 20px;
    }

    .upcoming-birthdays-header {
        background: linear-gradient(135deg, rgba(63, 81, 181, 0.1), rgba(103, 58, 183, 0.1));
        padding: 15px 20px;
        border-bottom: 2px solid #6735b7;
    }

    .upcoming-birthdays-header h3 {
        margin: 0;
        color: #3f51b5;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .upcoming-birthday-list {
        padding: 15px;
    }

    .upcoming-birthday-row {
        display: grid;
        grid-template-columns: auto 1fr auto;
        gap: 15px;
        align-items: center;
        padding: 12px;
        border-bottom: 1px solid #f0f0f0;
        transition: var(--transition);
    }

    .upcoming-birthday-row:last-child {
        border-bottom: none;
    }

    .upcoming-birthday-row:hover {
        background: #f8f9fa;
    }

    .upcoming-birthday-icon {
        font-size: 24px;
    }

    .upcoming-birthday-details {
        flex: 1;
    }

    .upcoming-birthday-name {
        font-weight: 600;
        color: #333;
        margin: 0 0 4px 0;
    }

    .upcoming-birthday-info {
        font-size: 0.85rem;
        color: #777;
        margin: 0;
    }

    .upcoming-birthday-days-badge {
        background: linear-gradient(135deg, #3f51b5, #6735b7);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        white-space: nowrap;
    }

    /* Ministry Specific Styles */
    .ministry-welcome {
        background: linear-gradient(135deg, rgba(146, 108, 21, 0.1), rgba(255, 195, 0, 0.1));
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .ministry-welcome h3 {
        color: var(--primary);
        margin-bottom: 8px;
    }

    .ministry-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    /* Worship Sets Styles */
    .worship-sets {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
    }

    .set-card {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
        margin-top: 15px;
    }

    .set-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
    }

    .set-date {
        font-weight: 600;
        color: var(--primary);
    }

    .set-team {
        background: var(--primary);
        color: white;
        padding: 4px 10px;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .set-songs {
        padding: 15px;
    }

    .song-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .song-item:last-child {
        border-bottom: none;
    }

    .song-title {
        font-weight: 600;
    }

    .song-key {
        color: #6c757d;
        font-size: 0.85rem;
    }

    /* Media Tasks Styles */
    .media-tasks {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
    }

    .task-list {
        margin-top: 15px;
    }

    .task-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        border-bottom: 1px solid #f0f0f0;
    }

    .task-item:last-child {
        border-bottom: none;
    }

    .task-info {
        flex: 1;
    }

    .task-title {
        font-weight: 600;
        margin-bottom: 3px;
    }

    .task-details {
        font-size: 0.85rem;
        color: #6c757d;
    }

    .task-status {
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .confirmed {
        background: rgba(40, 167, 69, 0.1);
        color: var(--success);
    }

    .pending {
        background: rgba(255, 193, 7, 0.1);
        color: #ffc107;
    }

    .in-progress {
        background: rgba(0, 123, 255, 0.1);
        color: #007bff;
    }

    /* Rehearsal Styles */
    .rehearsal-schedule {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
    }

    .rehearsal-card {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
    }

    .rehearsal-date {
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 5px;
    }

    .rehearsal-time, .rehearsal-location {
        margin-bottom: 3px;
        color: #6c757d;
    }

    .rehearsal-focus {
        margin-top: 8px;
        font-weight: 600;
    }

    /* Usher Assignments Styles */
    .usher-assignments {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
    }

    .assignment-card {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
    }

    .assignment-location {
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 10px;
    }

    .assignment-team {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .team-member {
        background: #f8f9fa;
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 0.85rem;
    }

    .church-logo-section {
        text-align: center;
        margin-bottom: 30px;
        padding: 30px;
        background: linear-gradient(135deg, rgba(146, 108, 21, 0.1), rgba(255, 195, 0, 0.1));
        border-radius: var(--border-radius);
    }

    .church-logo-large {
        width: 300px;
        height: 300px;
        background-image: url('assets/LOGO2.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        margin: 0 auto 10px;
        filter: drop-shadow(0px 4px 15px rgba(0,0,0,0.3));
    }

    .church-background {
        max-width: 800px;
        margin: 0 auto;
        text-align: center;
    }

    .church-background h2 {
        color: var(--primary);
        margin-bottom: 15px;
        font-family: 'Montserrat', sans-serif;
    }

    .church-background p {
        color: #6c757d;
        line-height: 1.6;
        font-size: 1.1rem;
    }

    .pastors-section {
        margin: 40px 0;
        text-align: center;
    }

    .pastors-section h2 {
        color: var(--primary);
        margin-bottom: 30px;
        font-family: 'Montserrat', sans-serif;
    }

    .pastors-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 30px;
        margin-bottom: 20px;
    }

    .pastor-card {
        text-align: center;
    }

    .pastor-photo {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        margin: 0 auto 15px;
        background-size: cover;
        background-position: center;
        border: 4px solid var(--primary);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        transition: var(--transition);
    }

    .pastor-photo:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(146, 108, 21, 0.4);
    }

    .pastor-name {
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 5px;
        font-size: 0.95rem;
    }

    .pastor-title {
        color: #6c757d;
        font-size: 0.85rem;
    }

    .pastors-description {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        max-width: 600px;
        margin: 0 auto;
    }

    .pastors-description p {
        color: #6c757d;
        line-height: 1.6;
        margin: 0;
        font-style: italic;
    }

    /* Church Family Section */
    .church-family-section {
        margin: 40px 0;
        text-align: center;
    }

    .church-family-section h2 {
        color: var(--primary);
        margin-bottom: 20px;
        font-family: 'Montserrat', sans-serif;
    }

    .family-gathering-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
        margin-top: 20px;
    }

    .gathering-card {
        background: white;
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--shadow);
        transition: var(--transition);
        position: relative;
    }

    .gathering-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
    }

    .gathering-photo {
        width: 100%;
        height: 200px;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        transition: var(--transition);
    }

    .gathering-card:hover .gathering-photo {
        transform: scale(1.05);
    }

    .gathering-info {
        padding: 20px;
        text-align: left;
    }

    .gathering-title {
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 8px;
        font-size: 1.1rem;
        font-family: 'Montserrat', sans-serif;
    }

    .gathering-description {
        color: #6c757d;
        font-size: 0.9rem;
        line-height: 1.5;
        margin: 0;
    }

    /* Add overlay effect for better text readability */
    .gathering-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(to bottom, transparent 60%, rgba(0,0,0,0.1));
        opacity: 0;
        transition: var(--transition);
        pointer-events: none;
    }

    .gathering-card:hover::before {
        opacity: 1;
    }

    /* Profile Styles */
    .profile-container {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
        width: 100%;
        box-sizing: border-box;
        position: relative;
        z-index: 1;
        margin-bottom: 20px;
        display: block;
    }

    .profile-header {
        display: flex;
        align-items: center;
        padding: 30px;
        background: linear-gradient(135deg, rgba(146, 108, 21, 0.1), rgba(255, 195, 0, 0.1));
        gap: 25px;
        flex-wrap: wrap; /* ⬅️ Added for mobile responsiveness */
    }
    .profile-avatar {
        position: relative;
        flex-shrink: 0;
    }

    .avatar-large {
        width: 100px;
        height: 100px;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: bold;
        color: white;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }

    .avatar-status {
        position: absolute;
        bottom: 5px;
        right: 5px;
    }

    .profile-info h3 {
        color: var(--primary);
        font-size: 1.5rem;
        margin-bottom: 5px;
        font-family: 'Montserrat', sans-serif;
    }

    .profile-info p {
        color: #6c757d;
        margin-bottom: 3px;
    }

    .profile-tabs {
        display: flex;
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
    }

    .tab-btn {
        padding: 15px 25px;
        background: none;
        border: none;
        cursor: pointer;
        font-weight: 600;
        color: #6c757d;
        transition: var(--transition);
        border-bottom: 3px solid transparent;
    }

    .tab-btn:hover {
        color: var(--primary);
        background: rgba(146, 108, 21, 0.05);
    }

    .tab-btn.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
        background: white;
    }

    .profile-tab-content {
        display: none;
        padding: 30px;
        width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
    }

    .profile-tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
        width: 100%;
        box-sizing: border-box;
    }

    .profile-form,
    .password-form {
        width: 100%;
        box-sizing: border-box;
        max-width: 100%;
        overflow-x: hidden;
    }

    .form-group {
        margin-bottom: 20px;
        position: relative;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--dark);
    }

    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1rem;
        transition: var(--transition);
        background: white;
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(146, 108, 21, 0.1);
    }

    .form-control:disabled {
        background-color: #f8f9fa;
        color: #6c757d;
        cursor: not-allowed;
    }

    .password-toggle {
        position: absolute;
        right: 15px;
        top: 40px;
        cursor: pointer;
        color: #6c757d;
        transition: var(--transition);
    }

    .password-toggle:hover {
        color: var(--primary);
    }

    .form-actions {
        display: flex;
        gap: 15px;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #e0e0e0;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        flex: 1;
    }

    .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(146, 108, 21, 0.4);
    }

    .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }

    .btn-secondary {
        background: #6c757d;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        flex: 1;
    }

    .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
    }

    .password-strength {
        margin: 20px 0;
    }

    .strength-bar {
        width: 100%;
        height: 6px;
        background: #e0e0e0;
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 8px;
    }

    .strength-fill {
        height: 100%;
        width: 0%;
        border-radius: 3px;
        transition: var(--transition);
    }

    .strength-text {
        font-size: 0.85rem;
        color: #6c757d;
        text-align: center;
    }

    .password-requirements {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
    }

    .password-requirements p {
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--dark);
    }

    .password-requirements ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .password-requirements li {
        padding: 5px 0;
        color: #6c757d;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
    }

    .password-requirements li:before {
        content: '✗';
        margin-right: 8px;
        color: var(--danger);
    }

    .password-requirements li.valid:before {
        content: '✓';
        color: var(--success);
    }

    /* Create Lineup Styles */
    .lineup-container {
        background: white;
        padding: 30px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
    }

    .form-section {
        margin-bottom: 40px;
        padding-bottom: 30px;
        border-bottom: 2px solid #f0f0f0;
        display: flow-root;
        width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
    }

    .form-section:last-child {
        border-bottom: none;
    }

    .form-section h3 {
        color: var(--primary);
        margin-bottom: 20px;
        font-family: 'Montserrat', sans-serif;
        font-size: 1.2rem;
    }

    .form-section h3 i {
        margin-right: 10px;
    }

    /* Two-column layout for form inputs */
    .profile-form {
        width: 100%;
    }

    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 0;
        flex-wrap: wrap;
        width: 100%;
        box-sizing: border-box;
    }

    .form-column {
        flex: 1;
        min-width: 0;
    }

    .form-column.full-width {
        flex: 0 0 100%;
    }

    .song-row {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 4px solid var(--primary);
    }

    .backup-row {
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .backup-row select {
        flex: 1;
    }

    .btn-remove-backup {
        background: var(--danger);
        color: white;
        border: none;
        border-radius: 4px;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: var(--transition);
        flex-shrink: 0;
    }

    .btn-remove-backup:hover:not(:disabled) {
        background: #c82333;
        transform: translateY(-2px);
    }

    .btn-remove-backup:disabled {
        background: #6c757d;
        cursor: not-allowed;
        opacity: 0.6;
    }

    .preserve-formatting {
        white-space: pre-wrap;
        word-wrap: break-word;
        font-family: inherit;
        line-height: 1.5;
    }

    .youtube-preview {
        margin-top: 10px;
        border-radius: 8px;
        overflow: hidden;
        display: none;
    }

    .youtube-preview iframe {
        width: 100%;
        height: 200px;
        border: none;
    }

    .form-text {
        font-size: 0.85rem;
        color: #6c757d;
        margin-top: 5px;
    }

    .btn-danger {
        background: var(--danger);
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
        transition: var(--transition);
    }

    /* Receipt Modal Styles */
    .receipt-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 2000;
        backdrop-filter: blur(5px);
    }

    .receipt-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 20px;
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: modalSlideIn 0.4s ease-out;
    }

    @keyframes modalSlideIn {
        from {
            opacity: 0;
            transform: translate(-50%, -60%);
        }
        to {
            opacity: 1;
            transform: translate(-50%, -50%);
        }
    }

    .receipt-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary)) !important;
        background-image: linear-gradient(135deg, #926C15, #C9980B) !important;
        color: white;
        padding: 30px;
        text-align: center;
        border-radius: 20px 20px 0 0;
        position: relative;
    }

    [class*="gradient"] {
        background-image: inherit !important;
    }

    /* Ensure text contrast */
    .receipt-title,
    .receipt-subtitle,
    .receipt-section-title {
        color: inherit !important;
        text-shadow: inherit !important;
    }

    /* Remove any animations/transitions during capture */
    .html2canvas-container * {
        animation: none !important;
        transition: none !important;
    }

    .receipt-logo {
        width: 80px;
        height: 80px;
        background-image: url('assets/LOGO.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        margin: 0 auto 15px;
        filter: drop-shadow(0px 4px 10px rgba(0,0,0,0.6));
    }

    .receipt-title {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 5px;
        font-family: 'Montserrat', sans-serif;
        text-shadow: 2px 2px 5px rgba(0,0,0,0.25);
    }

    .receipt-subtitle {
        font-size: 1rem;
        opacity: 0.9;
        font-family: 'Montserrat', sans-serif;
        letter-spacing: 3px;
        text-shadow: 2px 2px 5px rgba(0,0,0,0.25);
    }

    .receipt-content {
        padding: 30px;
    }

    .receipt-section {
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 2px solid #f0f0f0;
    }

    .receipt-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }

    .receipt-section-title {
        color: var(--primary);
        font-size: 1.2rem;
        font-weight: 700;
        margin-bottom: 15px;
        font-family: 'Montserrat', sans-serif;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .receipt-section-title i {
        background: linear-gradient(135deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        color: transparent;
    }

    .receipt-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 10px;
    }

    .receipt-info-item {
        display: flex;
        flex-direction: column;
    }

    .receipt-label {
        font-size: 0.85rem;
        color: #6c757d;
        font-weight: 600;
        margin-bottom: 5px;
    }

    .receipt-value {
        font-size: 1rem;
        color: var(--dark);
        font-weight: 600;
    }

    .receipt-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .receipt-list-item {
        padding: 8px 0;
        border-bottom: 1px solid #f8f9fa;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .receipt-list-item:last-child {
        border-bottom: none;
    }

    .receipt-number {
        background: var(--primary);
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        font-weight: 700;
        flex-shrink: 0;
    }

    .receipt-song-title {
        font-weight: 600;
        color: var(--dark);
    }

    .receipt-note {
        background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 195, 0, 0.05));
        border-left: 4px solid #ffc107;
        padding: 20px;
        border-radius: 8px;
        margin-top: 20px;
    }

    .receipt-note-title {
        color: #856404;
        font-weight: 700;
        margin-bottom: 8px;
        font-size: 1rem;
    }

    .receipt-note-text {
        color: #856404;
        font-size: 0.9rem;
        line-height: 1.5;
        margin: 0;
    }

    .receipt-footer {
        background: #f8f9fa;
        padding: 25px 30px;
        border-radius: 0 0 20px 20px;
        border-top: 2px solid #e9ecef;
    }

    .receipt-actions {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 12px;
    }

    .receipt-btn {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        font-size: 0.9rem;
        -webkit-appearance: none !important;
        -moz-appearance: none !important;
        appearance: none !important;
    }

    .receipt-btn-edit {
        background: #6c757d;
        color: white;
    }

    .receipt-btn-edit:hover {
        background: #5a6268;
        transform: translateY(-2px);
    }

    .receipt-btn-save {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
    }

    .receipt-btn-save:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(146, 108, 21, 0.4);
    }

    .receipt-btn-confirm {
        background: var(--success);
        color: white;
    }

    .receipt-btn-confirm:hover {
        background: #218838;
        transform: translateY(-2px);
    }

    /* Calendar Styles */
    .calendar-container {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
        margin-top: 15px;
    }

    .calendar-header {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        font-weight: 600;
        text-align: center;
    }

    .calendar-day-header {
        padding: 12px 5px;
        font-size: 0.9rem;
        border-right: 1px solid rgba(255, 255, 255, 0.2);
    }

    .calendar-day-header:last-child {
        border-right: none;
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        grid-auto-rows: 1fr;
        min-height: 400px;
    }

    .calendar-day {
        border: 1px solid #e0e0e0;
        padding: 8px 5px;
        min-height: 80px;
        position: relative;
        cursor: pointer;
        transition: var(--transition);
        background: white;
    }

    .calendar-day:hover {
        background: #f8f9fa;
    }

    .calendar-day.other-month {
        background: #f8f9fa;
        color: #adb5bd;
    }

    .calendar-day.has-schedule {
        background: linear-gradient(135deg, rgba(146, 108, 21, 0.1), rgba(255, 195, 0, 0.1));
        border-left: 4px solid var(--primary);
    }

    .calendar-day.has-schedule::after {
        content: '';
        position: absolute;
        top: 5px;
        right: 5px;
        width: 8px;
        height: 8px;
        background: var(--primary);
        border-radius: 50%;
    }

    .calendar-day.selected {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        font-weight: bold;
    }

    .calendar-day.disabled {
        background: #f8f9fa;
        color: #adb5bd;
        cursor: not-allowed;
    }

    .calendar-day.disabled:hover {
        background: #f8f9fa;
    }

    .calendar-day-number {
        font-weight: 600;
        margin-bottom: 5px;
        font-size: 0.9rem;
    }

    .calendar-day-events {
        font-size: 0.7rem;
        color: var(--primary);
        font-weight: 500;
    }

    .calendar-type-selector {
        display: flex;
        gap: 5px;
    }

    .calendar-type-selector .action-btn {
        padding: 8px 12px;
        font-size: 0.85rem;
    }

    .calendar-type-selector .action-btn.active {
        background: var(--primary);
        color: white;
    }

    /* Schedule Modal Styles */
    .schedule-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        backdrop-filter: blur(5px);
    }

    .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 15px;
        width: 90%;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: modalSlideIn 0.4s ease-out;
    }

    .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 15px 15px 0 0;
        }
    .modal-header h3 {
            margin: 0;
            font-size: 1.3rem;
        }
    .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }
    .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

    .modal-body {
            padding: 25px;
        }
     .schedule-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .schedule-card-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .schedule-card-title {
            margin: 0 0 5px 0;
            font-size: 1.2rem;
        }

        .schedule-card-subtitle {
            margin: 0;
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .schedule-card-body {
            padding: 20px;
        }

        .schedule-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-size: 0.85rem;
            color: #6c757d;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1rem;
            color: var(--dark);
            font-weight: 600;
        }

    /* Upcoming Schedule Cards Styles */
    .upcoming-schedule-cards {
        padding: 20px;
        background: #f8f9fa;
    }

    .schedule-cards-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 12px;
    }

    .upcoming-card {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
        transition: var(--transition);
        border-left: 5px solid var(--primary);
        cursor: pointer;
    }

    .upcoming-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        border-left-color: var(--secondary);
    }

    .upcoming-card-date {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 10px 12px;
        text-align: center;
        font-weight: 600;
    }

    .upcoming-card-date-day {
        font-size: 1.4rem;
        font-weight: 700;
        line-height: 1;
    }

    .upcoming-card-date-time {
        font-size: 0.7rem;
        opacity: 0.9;
    }

    .upcoming-card-content {
        padding: 10px;
    }

    .upcoming-card-label {
        font-size: 0.65rem;
        color: #6c757d;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 3px;
    }

    .upcoming-card-title {
        font-size: 0.9rem;
        color: var(--dark);
        font-weight: 700;
        margin-bottom: 8px;
    }

    .upcoming-card-item {
        margin-bottom: 6px;
        padding-bottom: 6px;
        border-bottom: 1px solid #e0e0e0;
    }

    .upcoming-card-item:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
    }

    .upcoming-card-item-label {
        font-size: 0.65rem;
        color: #6c757d;
        font-weight: 600;
        margin-bottom: 2px;
    }

    .upcoming-card-item-value {
        font-size: 0.8rem;
        color: var(--dark);
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .upcoming-card-empty {
        text-align: center;
        padding: 40px 20px;
        color: #6c757d;
    }

    .upcoming-card-empty i {
        font-size: 2.5rem;
        color: #ddd;
        margin-bottom: 10px;
    }

    /* Schedule History Styles */
    .schedule-history-section {
        padding: 20px;
        background: #f0f0f0;
        border-top: 3px solid #e0e0e0;
    }

    .schedule-history-title {
        font-size: 1.3rem;
        color: var(--dark);
        font-weight: 700;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .schedule-history-cards {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .history-card {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
        transition: var(--transition);
        border-left: 5px solid #999;
        cursor: pointer;
        opacity: 0.85;
        display: grid;
        grid-template-columns: 140px 1fr;
    }

    .history-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        opacity: 1;
        border-left-color: var(--primary);
    }

    .history-card-date {
        background: linear-gradient(135deg, #8b8b8b, #6b6b6b);
        color: white;
        padding: 10px 12px;
        text-align: center;
        font-weight: 600;
    }

    .history-card-date-day {
        font-size: 1.4rem;
        font-weight: 700;
        line-height: 1;
    }

    .history-card-date-time {
        font-size: 0.7rem;
        opacity: 0.9;
    }

    .history-card-content {
        padding: 12px 15px;
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }

    .history-card-label {
        font-size: 0.65rem;
        color: #888;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0;
    }

    .history-card-title {
        font-size: 1rem;
        color: var(--primary);
        font-weight: 700;
        margin-bottom: 0;
    }

    .history-card-item {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
        display: flex;
        gap: 8px;
        align-items: center;
        flex: 1;
        min-width: 120px;
    }

    .history-card-item:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
    }

    .history-card-item-label {
        font-size: 0.65rem;
        color: #888;
        font-weight: 600;
        margin-bottom: 0;
    }

    .history-card-item-value {
        font-size: 0.85rem;
        color: var(--dark);
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .schedule-history-empty {
        text-align: center;
        padding: 40px 20px;
        color: #999;
    }

    .schedule-history-empty i {
        font-size: 2.5rem;
        color: #ddd;
        margin-bottom: 10px;
    }

    



    /* Network Status Indicator */
    .network-status {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 2000;
        padding: 12px 20px;
        border-radius: 8px;
        font-weight: 600;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
        display: none;
    }
    
    .network-status.online {
        background: #28a745;
        color: white;
    }
    
    .network-status.offline {
        background: #dc3545;
        color: white;
    }
    
    .network-status.slow {
        background: #ffc107;
        color: #212529;
    }
    
    /* Improved Song Layout Styles */
    .song-item {
        display: flex;
        flex-direction: column;
        gap: 15px;
        padding: 15px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        margin-bottom: 15px;
        background: #f8f9fa;
    }
    
    .song-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0;
    }
    
    .song-title {
        font-weight: 600;
        color: var(--primary);
        font-size: 1.1rem;
        margin: 0;
    }
    
    .youtube-preview-container {
        width: 100%;
        border-radius: 8px;
        overflow: hidden;
        margin: 10px 0;
    }
    
    .youtube-preview-container iframe {
        width: 100%;
        height: 200px;
        border: none;
    }
    
    .song-details {
        display: none;
        width: 100%;
    }
    
    .song-details.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }
    
    .details-section {
        margin-bottom: 15px;
    }
    
    .details-section:last-child {
        margin-bottom: 0;
    }
    
    .details-label {
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 5px;
        font-size: 0.9rem;
    }
    
    .details-content {
        background: white;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #e0e0e0;
        font-size: 0.9rem;
        line-height: 1.5;
        white-space: pre-line;
    }
    
    /* YouTube Placeholder for Slow/No Connection */
    .youtube-placeholder {
        width: 100%;
        height: 200px;
        background: #e9ecef;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #6c757d;
    }
    
    .youtube-placeholder i {
        font-size: 2rem;
        margin-bottom: 10px;
    }

    /* Calendar Modal Styles */
    .calendar-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        backdrop-filter: blur(5px);
    }

    .calendar-modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 15px;
        width: 90%;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: modalSlideIn 0.4s ease-out;
    }

    .calendar-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 25px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border-radius: 15px 15px 0 0;
    }

    .calendar-modal-header h3 {
        margin: 0;
        font-size: 1.3rem;
    }

    .calendar-close-btn {
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: var(--transition);
    }

    .calendar-close-btn:hover {
        background: rgba(255, 255, 255, 0.2);
    }

    .calendar-modal-body {
        padding: 25px;
    }

    /* Calendar Navigation */
    .calendar-navigation {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
    }

    .calendar-nav-btn {
        background: var(--primary);
        color: white;
        border: none;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        cursor: pointer;
        transition: var(--transition);
    }

    .calendar-nav-btn:hover {
        background: var(--secondary);
    }

    .calendar-nav-btn:disabled {
        background: #adb5bd;
        cursor: not-allowed;
    }

    .calendar-current-month {
        font-weight: 600;
        color: var(--primary);
        font-size: 1.1rem;
    }

    /* Date Input with Calendar Icon */
    .date-input-container {
        position: relative;
    }

    .date-input-container .calendar-icon {
        position: absolute;
        right: 15px;
        top: 40px;
        color: var(--primary);
        cursor: pointer;
        font-size: 1.1rem;
        transition: var(--transition);
    }

    .date-input-container .calendar-icon:hover {
        color: var(--secondary);
    }

    /* Schedule Details Styles */
    .schedule-details {
        margin-top: 20px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: var(--border-radius);
        display: none;
    }

    .schedule-details.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    .schedule-details-title {
        color: var(--primary);
        font-weight: 600;
        margin-bottom: 15px;
        font-size: 1.1rem;
    }

    .schedule-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 15px;
    }

    .schedule-info-item {
        display: flex;
        flex-direction: column;
    }

    .schedule-info-label {
        font-size: 0.85rem;
        color: #6c757d;
        font-weight: 600;
        margin-bottom: 5px;
    }

    .schedule-info-value {
        font-size: 1rem;
        color: var(--dark);
        font-weight: 600;
    }

    /* Form Fields Layout */
    .form-fields {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    /* Logout Modal Styles */
        .logout-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .logout-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.4s ease-out;
            overflow: hidden;
        }

        .logout-modal-header {
            padding: 25px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            text-align: center;
        }

        .logout-modal-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }

        .logout-modal-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 5px;
            font-family: 'Montserrat', sans-serif;
        }

        .logout-modal-subtitle {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .logout-modal-body {
            padding: 25px;
            text-align: center;
        }

        .logout-modal-message {
            color: #6c757d;
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 25px;
        }

        .logout-modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .logout-modal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            min-width: 120px;
            font-size: 0.95rem;
        }

        .logout-modal-cancel {
            background: #6c757d;
            color: white;
        }

        .logout-modal-cancel:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .logout-modal-confirm {
            background: linear-gradient(135deg, var(--danger), #c82333);
            color: white;
        }

        .logout-modal-confirm:hover {
            background: linear-gradient(135deg, #c82333, #a71e2a);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

    /* Print styles for receipt */
    @media print {
        body * {
            visibility: hidden;
        }
        .receipt-container,
        .receipt-container * {
            visibility: visible;
        }
        .receipt-container {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            max-width: 100%;
            box-shadow: none;
            margin: 0;
            padding: 0;
        }
        .receipt-actions {
            display: none;
        }
        .receipt-header {
            padding: 20px;
        }
        .receipt-content {
            padding: 20px;
        }
        .receipt-footer {
            padding: 20px;
        }
    }

    .btn-danger:hover {
        background: #c82333;
        transform: translateY(-2px);
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .sidebar {
            width: 250px;
        }
        
        .main-content {
            margin-left: 250px;
            width: 100%;
        }
    }

    @media (max-width: 900px) {
        .stats-container {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 768px) {
        .sidebar {
            transform: translateX(-100%);
            width: 280px;
        }

        .sidebar.active {
            transform: translateX(0);
        }

        .main-content {
            margin-left: 0;
            width: 100%;
            padding: 70px 15px 15px;
        }

        .mobile-menu-toggle {
            display: block;
        }

        .content-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .notification-btn {
            align-self: flex-end;
            margin-top: -10px;
        }

        .notification-modal {
            width: 100%;
            right: -100%;
            border-radius: 0;
        }

        .overlay.active {
            display: block;
        }

        .stats-container {
            grid-template-columns: 1fr;
        }

        .logout-btn {
            position: relative;
            bottom: auto;
            left: auto;
            right: auto;
            margin: 15px;
        }
        
        .content-header h1 {
            font-size: 1.3rem;
        }
        
        .content-header p {
            font-size: 0.85rem;
        }
        
        .section-title {
            font-size: 1.2rem;
        }
        
        .schedule-header {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }
        
        .schedule-grid {
            grid-template-columns: 1fr;
        }
        
        .announcement-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .announcement-footer {
            flex-direction: column;
            gap: 10px;
            align-items: flex-start;
        }
        
        .task-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .assignment-team {
            flex-direction: column;
            gap: 8px;
        }

        .content-layout {
            grid-template-columns: 1fr;
        }
        
        .pastors-grid {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }
        
        .pastor-photo {
            width: 100px;
            height: 100px;
        }
        
        .church-logo-large {
            width: 150px;
            height: 150px;
        }

        .family-gathering-grid {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .gathering-photo {
            height: 180px;
        }
        
        .gathering-info {
            padding: 15px;
        }

        /* Verse Controls Responsive */
        .verse-controls {
            flex-direction: column;
            gap: 12px;
        }

        .version-selector,
        .language-selector {
            flex-wrap: wrap;
        }

        .version-btn,
        .language-btn {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        /* Profile Responsive */
        .profile-header {
            flex-direction: column;
            text-align: center;
            padding: 20px;
        }
        
        .profile-tabs {
            flex-direction: column;
        }
        
        .tab-btn {
            padding: 12px 20px;
            text-align: center;
        }
        
        .profile-tab-content {
            padding: 20px;
        }
        
        .form-actions {
            flex-direction: column;
        }

        /* Form responsive */
        .form-row {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .form-column {
            flex: 0 0 100%;
            width: 100%;
            padding: 0;
            margin-bottom: 15px;
        }

        .form-column.full-width {
            flex: 0 0 100%;
            width: 100%;
        }

        /* Schedule History Responsive */
        .history-card {
            grid-template-columns: 1fr;
        }

        .history-card-content {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .history-card-item {
            flex-direction: column;
            align-items: flex-start;
            min-width: 100%;
        }

        /* Create Lineup Responsive */
        .lineup-container {
            padding: 20px;
        }
        
        .song-row {
            padding: 15px;
        }
        
        .form-section h3 {
            font-size: 1.1rem;
        }
        
        .backup-row {
            flex-direction: column;
            align-items: stretch;
        }
        
        .backup-row .btn-danger {
            align-self: flex-start;
        }

        .receipt-container {
            width: 95%;
            max-height: 95vh;
        }
        
        .receipt-header {
            padding: 20px;
        }
        
        .receipt-content {
            padding: 20px;
        }
        
        .receipt-info {
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .receipt-actions {
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .receipt-btn {
            padding: 15px 20px;
        }
        
        .form-fields {
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .calendar-day {
            min-height: 60px;
            padding: 5px 3px;
        }

        .calendar-day-number {
            font-size: 0.8rem;
        }

        .calendar-day-events {
            font-size: 0.65rem;
        }

        .modal-content {
            width: 95%;
        }

        .modal-header {
            padding: 15px 20px;
        }

        .modal-body {
            padding: 20px;
        }

        .schedule-info {
            grid-template-columns: 1fr;
        }

        .song-header {
            flex-direction: column;
            gap: 10px;
        }

        .song-actions {
            align-self: flex-start;
        }

        /* Calendar Modal Responsive */
        .calendar-modal-content {
            width: 95%;
        }

        .calendar-modal-header {
            padding: 15px 20px;
        }

        .calendar-modal-body {
            padding: 20px;
        }

        .calendar-navigation {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }

        .schedule-info-grid {
            grid-template-columns: 1fr;
        }

        .logout-modal-content {
        max-width: 350px;
        width: 85%;
        }

        .logout-modal-header {
            padding: 20px;
        }

        .logout-modal-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }

        .logout-modal-title {
            font-size: 1.2rem;
        }

        .logout-modal-subtitle {
            font-size: 0.85rem;
        }

        .logout-modal-body {
            padding: 20px;
        }

        .logout-modal-message {
            font-size: 0.95rem;
            margin-bottom: 20px;
        }

        .logout-modal-actions {
            flex-direction: column;
            gap: 10px;
        }

        .logout-modal-btn {
            min-width: 100%;
            padding: 14px 20px;
            font-size: 0.9rem;
        }
    }

    @media (max-width: 767px) {
        .lineup-container {
            padding: 15px;
        }
        
        .form-section {
            padding-bottom: 20px;
            margin-bottom: 25px;
        }
        
        .form-fields {
            grid-template-columns: 1fr !important;
            gap: 15px;
        }
        
        .song-row {
            padding: 15px;
        }
        
        .backup-row {
            flex-direction: column;
            align-items: stretch;
            gap: 8px;
        }
        
        .btn-remove-backup {
            align-self: flex-start;
            margin-top: 5px;
        }
        
        .form-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .form-actions button {
            width: 100%;
        }
        
        /* Ensure form controls are properly sized on mobile */
        .form-control {
            padding: 14px 12px;
            font-size: 16px; /* Prevents zoom on iOS */
        }
        
        /* Improve spacing for better mobile experience */
        .form-group {
            margin-bottom: 15px;
        }
        
        /* Make sure labels are properly sized */
        .form-group label {
            font-size: 0.9rem;
            margin-bottom: 6px;
        }
        
        /* Adjust section titles for mobile */
        .form-section h3 {
            font-size: 1.1rem;
            margin-bottom: 15px;
        }
        
        /* Improve button spacing */
        .btn-secondary, .btn-primary {
            padding: 14px 20px;
            font-size: 0.9rem;
        }
        
        /* Adjust YouTube preview for mobile */
        .youtube-preview iframe {
            height: 180px;
        }
    }

    @media (max-width: 480px) {
        .main-content {
            padding: 60px 10px 10px;
        }
        
        .content-header {
            padding: 15px;
        }
        
        .content-section {
            padding: 15px;
        }
        
        .first-time-welcome {
            padding: 20px;
        }
        
        .first-time-welcome h2 {
            font-size: 1.3rem;
        }
        
        .bible-verse-container {
            padding: 15px;
        }
        
        .verse-of-the-day {
            font-size: 0.95rem;
        }
        
        .stat-card {
            padding: 15px;
        }
        
        .stat-value {
            font-size: 1.3rem;
        }
        
        .welcome-message h2 {
            font-size: 1.2rem;
        }
        
        .family-gathering-grid {
            grid-template-columns: 1fr;
        }
        
        .gathering-photo {
            height: 160px;
        }
        
        .calendar-day {
            min-height: 50px;
        }

        .calendar-day-number {
            font-size: 0.75rem;
        }

        .calendar-day-events {
            display: none;
        }

        .schedule-header {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }

        .calendar-type-selector {
            width: 100%;
        }

        .calendar-type-selector .action-btn {
            flex: 1;
            text-align: center;
        }

        .lineup-container {
            padding: 12px;
        }
        
        .song-row {
            padding: 12px;
        }
        
        .form-section h3 {
            font-size: 1rem;
        }
        
        .form-control {
            padding: 12px 10px;
        }
        
        /* Stack the form actions more tightly */
        .form-actions {
            gap: 8px;
        }

        .logout-modal-content {
        max-width: 300px;
        width: 90%;
        }

        .logout-modal-header {
            padding: 18px;
        }

        .logout-modal-icon {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        .logout-modal-title {
            font-size: 1.1rem;
        }

        .logout-modal-subtitle {
            font-size: 0.8rem;
        }

        .logout-modal-body {
            padding: 18px;
        }

        .logout-modal-message {
            font-size: 0.9rem;
            margin-bottom: 18px;
        }

        .logout-modal-btn {
            padding: 12px 18px;
            font-size: 0.85rem;
        }

    }

    /* Spiritual Assistant Chat Styling */
    .disclaimer-banner {
        background: linear-gradient(135deg, #FFF3CD, #FFE5A3);
        border-left: 5px solid #FFC107;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 2px 8px rgba(255, 193, 7, 0.2);
    }

    .disclaimer-header {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 700;
        color: #856404;
        margin-bottom: 10px;
        font-size: 1.05rem;
    }

    .disclaimer-header i {
        font-size: 1.3rem;
        color: #FFC107;
    }

    .disclaimer-banner p {
        color: #856404;
        margin: 0;
        font-size: 0.95rem;
        line-height: 1.6;
    }

    .chat-container {
        display: flex;
        flex-direction: column;
        height: calc(100vh - 400px);
        background: white;
        border-radius: 12px;
        box-shadow: var(--shadow);
        overflow: hidden;
        min-height: 600px;
    }

    .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 25px;
        display: flex;
        flex-direction: column;
        gap: 15px;
        background: #f9f9f9;
    }

    .chat-message {
        display: flex;
        flex-direction: column;
        gap: 5px;
        max-width: 75%;
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .chat-message.user-message {
        align-self: flex-end;
    }

    .chat-message.ai-message {
        align-self: flex-start;
    }

    .message-content {
        padding: 15px 18px;
        border-radius: 12px;
        line-height: 1.6;
        word-wrap: break-word;
    }

    .user-message .message-content {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border-bottom-right-radius: 4px;
    }

    .ai-message .message-content {
        background: #ffffff;
        color: var(--dark);
        border: 1px solid #e0e0e0;
        border-bottom-left-radius: 4px;
    }

    .message-content p {
        margin: 0;
        font-size: 0.95rem;
    }

    .message-content p:not(:last-child) {
        margin-bottom: 10px;
    }

    .scripture-reference {
        background: #f0f0f0;
        padding: 10px 12px;
        border-left: 3px solid var(--primary);
        margin-top: 10px;
        border-radius: 4px;
        font-style: italic;
        color: #555;
        font-size: 0.9rem;
    }

    .message-time {
        font-size: 0.75rem;
        color: #999;
        padding: 0 5px;
    }

    .user-message .message-time {
        text-align: right;
    }

    .ai-message .message-time {
        text-align: left;
    }

    .chat-input-area {
        padding: 20px;
        background: white;
        border-top: 2px solid #f0f0f0;
    }

    .input-group {
        display: flex;
        gap: 12px;
        margin-bottom: 10px;
    }

    .chat-input {
        flex: 1;
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-size: 0.95rem;
        resize: none;
        transition: var(--transition);
    }

    .chat-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(146, 108, 21, 0.1);
    }

    .send-button {
        padding: 12px 25px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 8px;
        white-space: nowrap;
    }

    .send-button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(146, 108, 21, 0.3);
    }

    .send-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .send-button i {
        font-size: 0.95rem;
    }

    .input-hint {
        font-size: 0.85rem;
        color: #999;
        padding: 0 5px;
    }

    .typing-indicator {
        display: flex;
        gap: 4px;
        padding: 15px 18px;
    }

    .typing-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #ccc;
        animation: typingAnimation 1.4s infinite;
    }

    .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
    }

    .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
    }

    @keyframes typingAnimation {
        0%, 60%, 100% {
            opacity: 0.5;
            transform: translateY(0);
        }
        30% {
            opacity: 1;
            transform: translateY(-10px);
        }
    }

    /* Responsive Chat */
    @media (max-width: 768px) {
        .chat-container {
            height: calc(100vh - 350px);
            min-height: 400px;
        }

        .chat-message {
            max-width: 85%;
        }

        .disclaimer-banner {
            padding: 15px;
        }

        .chat-messages {
            padding: 15px;
        }

        .chat-input-area {
            padding: 15px;
        }
    }

</style>

</head>
<body>
    <div id="logoutModal" class="logout-modal">
        <div class="logout-modal-content">
            <div class="logout-modal-header">
                <div class="logout-modal-icon">
                    <i class="fas fa-sign-out-alt"></i>
                </div>
                <h3 class="logout-modal-title">Confirm Logout</h3>
                <p class="logout-modal-subtitle">Ministry Portal</p>
            </div>
            <div class="logout-modal-body">
                <p class="logout-modal-message">
                    Are you sure you want to logout from your account?
                </p>
                <div class="logout-modal-actions">
                    <button class="logout-modal-btn logout-modal-cancel" onclick="closeLogoutModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="logout-modal-btn logout-modal-confirm" onclick="confirmLogout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="networkStatus" class="network-status">
        <i class="fas fa-wifi"></i> <span id="networkStatusText">Connection Status</span>
    </div>

    <button class="mobile-menu-toggle" onclick="toggleSidebar()">☰</button>
    <div class="overlay" onclick="toggleSidebar()"></div>

    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo"></div>
                <div class="church-name">JOYFUL SOUND CHURCH</div>
                <div class="church-subtitle">INTERNATIONAL</div>
                
                <div class="user-info">
                    <div class="user-avatar-container">
                        <div class="user-avatar" id="userAvatar">
                            <div class="avatar-content">FG</div>
                        </div>
                        <div class="status-indicator" id="statusIndicator">
                            <!-- Status circle will be dynamically generated -->
                        </div>
                    </div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Frank Gomez</div>
                        <div class="user-ministry" id="userMinistry">Media Ministry</div>
                    </div>
                </div>
            </div>

            <nav class="sidebar-menu" id="sidebarMenu">
                <!-- Menu items will be dynamically generated based on user's ministry and status -->
            </nav>

            <button class="logout-btn" onclick="showLogoutModal()">
                <i class="fas fa-sign-out-alt" style="margin-right: 10px;"></i>
                Logout
            </button>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-header">
                <div class="content-header-text">
                    <h1 id="pageTitle">Welcome to Your Ministry Portal</h1>
                    <p id="pageSubtitle">Stay connected and inspired in your service</p>
                </div>
                <button class="notification-btn" onclick="toggleNotificationModal()" title="Birthday Notifications">
                    <i class="fas fa-bell"></i>
                    <div class="notification-badge" id="notificationBadge" style="display: none;">0</div>
                </button>
            </div>

            <!-- Notification Modal -->
            <div class="notification-modal" id="notificationModal">
                <div class="notification-modal-header">
                    <span><i class="fas fa-bell" style="margin-right: 10px;"></i>Birthday Greetings</span>
                    <button class="notification-modal-close" onclick="toggleNotificationModal()">&times;</button>
                </div>
                <div class="notification-modal-content" id="notificationModalContent">
                    <!-- Notification items will be populated here -->
                </div>
            </div>

            <!-- Verification Banner (shown only for unverified users) -->
            <div class="verification-banner" id="verificationBanner" style="display: none;">
                <h3><i class="fas fa-lock"></i> Account Pending Verification</h3>
                <p>Your account is currently under review. Please wait for administrator verification to access all features.</p>
                <p><strong>Friendly Reminder:</strong> Once an administrator verifies your account in the system, you'll gain full access to all ministry features!</p>
                <button class="refresh-btn" onclick="checkVerificationStatus()">
                    <i class="fas fa-sync-alt" style="margin-right: 5px;"></i>
                    Check Verification Status
                </button>
            </div>

            <!-- Home Section -->
            <section id="home" class="content-section active">
                <!-- First Time Welcome (shown only on first login for verified users) -->
                <div id="firstTimeWelcomeContainer" style="display: none;">
                    <div class="first-time-welcome">
                        <h2><i class="fas fa-glass-cheers"></i> Welcome to the Team, <span id="firstTimeName">Frank</span>!</h2>
                        <p>We're thrilled to have you join us in ministry!</p>
                        <p style="font-size: 0.9rem; margin-top: 15px; opacity: 0.9;">Here's your welcome verse as you begin this journey with us.</p>
                    </div>

                    <div class="bible-verse-container" id="welcomeVerseContainer">
                        <!-- Version Selector -->
                        <div class="verse-controls">
                            <div class="version-selector">
                                <label>Version:</label>
                                <button class="version-btn active" onclick="changeBibleVersion('niv')">NIV</button>
                                <button class="version-btn" onclick="changeBibleVersion('kjv')">KJV</button>
                                <button class="version-btn" onclick="changeBibleVersion('nkjv')">NKJV</button>
                                <button class="version-btn" onclick="changeBibleVersion('cev')">CEV</button>
                                <button class="version-btn" onclick="changeBibleVersion('nasb')">NASB</button>
                            </div>
                            <div class="language-selector">
                                <label>Language:</label>
                                <button class="language-btn active" onclick="changeVerseLanguage('english')">English</button>
                                <button class="language-btn" onclick="changeVerseLanguage('bisaya')">Bisaya</button>
                            </div>
                        </div>

                        <div class="verse-of-the-day" id="welcomeVerse">
                            Loading verse of the day...
                        </div>
                        <div class="verse-reference" id="welcomeVerseReference">Loading...</div>
                        <div class="verse-language" id="welcomeVerseLanguage">Language: English</div>
                    </div>
                </div>

                <!-- Regular Welcome (shown for returning verified users) -->
                <div id="regularWelcomeContainer" style="display: none;">
                    <div class="welcome-message">
                        <h2><i class="fas fa-hand-sparkles"></i> Welcome back, <span id="welcomeName">Frank</span>!</h2>
                        <p>Here's what's happening in your ministry today.</p>
                    </div>

                    <!-- Bible Verse of the Day -->
                    <div class="bible-verse-container">
                        <!-- Version Selector -->
                        <div class="verse-controls">
                            <div class="version-selector">
                                <label>Version:</label>
                                <button class="version-btn active" onclick="changeBibleVersion('niv')">NIV</button>
                                <button class="version-btn" onclick="changeBibleVersion('kjv')">KJV</button>
                                <button class="version-btn" onclick="changeBibleVersion('nkjv')">NKJV</button>
                                <button class="version-btn" onclick="changeBibleVersion('cev')">CEV</button>
                                <button class="version-btn" onclick="changeBibleVersion('nasb')">NASB</button>
                            </div>
                            <div class="language-selector">
                                <label>Language:</label>
                                <button class="language-btn active" onclick="changeVerseLanguage('english')">English</button>
                                <button class="language-btn" onclick="changeVerseLanguage('bisaya')">Bisaya</button>
                            </div>
                        </div>

                        <div class="verse-of-the-day" id="dailyVerse">
                            Loading verse of the day...
                        </div>
                        <div class="verse-reference" id="verseReference">Loading...</div>
                        <div class="verse-language" id="verseLanguage">Language: English</div>
                    </div>


                    <!-- Church Logo and Background Section -->
                    <div class="church-logo-section">
                        <div class="church-logo-large"></div>
                        <div class="church-background">
                            <h2>Joyful Sound Church International</h2>
                            <p>A vibrant community of believers dedicated to spreading God's love through worship, fellowship, and service. 
                            We are committed to ministering to hearts and transforming lives through the power of the Holy Spirit.</p>
                        </div>
                    </div>
                    <div class="content-layout">
                        <!-- Pastors Section -->
                        <div class="pastors-section">
                            <h2><i class="fas fa-crown"></i> Our Spiritual Leaders</h2>
                            <div class="pastors-grid">
                                <div class="pastor-card">
                                    <div class="pastor-photo" style="background-image: url('/assets/dr-weldon-pior.png'); background-color: #f8f9fa;"></div>
                                    <div class="pastor-name">Dr. Weldon Pior</div>
                                    <div class="pastor-title">Senior Pastor</div>
                                </div>
                                <div class="pastor-card">
                                    <div class="pastor-photo" style="background-image: url('assets/dr-dorothy-pior.png'); background-color: #f8f9fa;"></div>
                                    <div class="pastor-name">Dr. Dorothy Pior</div>
                                    <div class="pastor-title">Senior Pastor</div>
                                </div>
                                <div class="pastor-card">
                                    <div class="pastor-photo" style="background-image: url('assets/ptr-gracelyn-gambe.png'); background-color: #f8f9fa;"></div>
                                    <div class="pastor-name">Ptr. Gracelyn Gambe</div>
                                    <div class="pastor-title">Associate Pastor</div>
                                </div>
                                <div class="pastor-card">
                                    <div class="pastor-photo" style="background-image: url('assets/ptr-eldan-gambe.png'); background-color: #f8f9fa;"></div>
                                    <div class="pastor-name">Ptr. Eldan Gambe</div>
                                    <div class="pastor-title">Associate Pastor</div>
                                </div>
                                <div class="pastor-card">
                                    <div class="pastor-photo" style="background-image: url('assets/ptr-psalm-gambe.png'); background-color: #f8f9fa;"></div>
                                    <div class="pastor-name">Ptr. Psalm Gambe</div>
                                    <div class="pastor-title">Youth Pastor</div>
                                </div>
                            </div>
                            <div class="pastors-description">
                                <p>Our dedicated pastors serve with compassion and commitment, guiding our congregation with wisdom and love. They are devoted to nurturing spiritual growth and building a strong community of faith.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Church Family Section -->
                    <div class="church-family-section">
                        <h2><i class="fas fa-users"></i> Our Church Family Gatherings</h2>
                        <p style="color: #6c757d; margin-bottom: 20px;">Celebrating fellowship and community through our joyful gatherings and events</p>
                        
                        <div class="family-gathering-grid">
                            <div class="gathering-card">
                                <div class="gathering-photo" style="background-image: url('assets/worship-service.jpg'); background-color: #e9ecef;"></div>
                                <div class="gathering-info">
                                    <div class="gathering-title">Sunday Worship Service</div>
                                    <div class="gathering-description">Our church family united in powerful worship and biblical teaching every Sunday</div>
                                </div>
                            </div>
                            
                            <div class="gathering-card">
                                <div class="gathering-photo" style="background-image: url('assets/pastor-appreciation.jpg'); background-color: #e9ecef;"></div>
                                <div class="gathering-info">
                                    <div class="gathering-title">Pastor Appreciation</div>
                                    <div class="gathering-description">Honoring and celebrating our dedicated pastors for their faithful service and leadership</div>
                                </div>
                            </div>
                            
                            <div class="gathering-card">
                                <div class="gathering-photo" style="background-image: url('assets/youth-event.jpg'); background-color: #e9ecef;"></div>
                                <div class="gathering-info">
                                    <div class="gathering-title">Youth Ministry Event</div>
                                    <div class="gathering-description">Dynamic youth gatherings filled with fun, fellowship, and spiritual growth</div>
                                </div>
                            </div>
                            
                            <div class="gathering-card">
                                <div class="gathering-photo" style="background-image: url('assets/community-outreach.jpg'); background-color: #e9ecef;"></div>
                                <div class="gathering-info">
                                    <div class="gathering-title">Community Outreach</div>
                                    <div class="gathering-description">Extending God's love through practical service and evangelism in our community</div>
                                </div>
                            </div>
                            
                            <div class="gathering-card">
                                <div class="gathering-photo" style="background-image: url('assets/christian-leadership-conference.jpg'); background-color: #e9ecef;"></div>
                                <div class="gathering-info">
                                    <div class="gathering-title">Christian Leadership Conference</div>
                                    <div class="gathering-description">Equipping and empowering leaders for effective ministry and spiritual guidance</div>
                                </div>
                            </div>
                            
                            <div class="gathering-card">
                                <div class="gathering-photo" style="background-image: url('assets/baptism-service.jpg'); background-color: #e9ecef;"></div>
                                <div class="gathering-info">
                                    <div class="gathering-title">Baptism Service</div>
                                    <div class="gathering-description">Powerful moments of public declaration of faith through water baptism</div>
                                </div>
                            </div>

                            <div class="gathering-card">
                                <div class="gathering-photo" style="background-image: url('assets/friday-bible-study.jpg'); background-color: #e9ecef;"></div>
                                <div class="gathering-info">
                                    <div class="gathering-title">Friday Bible Study</div>
                                    <div class="gathering-description">In-depth Bible study and discussion for spiritual growth and deeper understanding</div>
                                </div>
                            </div>

                            <div class="gathering-card">
                                <div class="gathering-photo" style="background-image: url('assets/isom-training.jpg'); background-color: #e9ecef;"></div>
                                <div class="gathering-info">
                                    <div class="gathering-title">ISOM</div>
                                    <div class="gathering-description">International School of Ministry training for leadership development and ministry equipping</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Unverified User Content -->
                <div id="unverifiedContent" style="display: none;">
                    <div class="welcome-message">
                        <h2><i class="fas fa-hand-sparkles"></i> Welcome, <span id="unverifiedName">Frank</span>!</h2>
                        <p>Your account is currently pending verification. While you wait, here's an inspirational message for you.</p>
                    </div>

                    <div class="bible-verse-container">
                        <div class="verse-of-the-day">
                            "For I know the plans I have for you," declares the Lord, "plans to prosper you and not to harm you, plans to give you hope and a future."
                        </div>
                        <div class="verse-reference">Jeremiah 29:11</div>
                        <div class="verse-explanation">
                            God has wonderful plans for your ministry journey. While you wait for verification, trust in His timing and purpose for your life.
                        </div>
                    </div>

                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-hourglass-half"></i></div>
                            <div class="stat-value">Pending</div>
                            <div class="stat-label">Account Status</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-tasks"></i></div>
                            <div class="stat-value">1</div>
                            <div class="stat-label">Step Remaining</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-clock"></i></div>
                            <div class="stat-value">24-48h</div>
                            <div class="stat-label">Verification Time</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-phone-alt"></i></div>
                            <div class="stat-value">Contact</div>
                            <div class="stat-label">Administrator</div>
                        </div>
                    </div>

                    <div style="background: white; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow); margin-top: 20px;">
                        <h3 class="section-title"><i class="fas fa-info-circle"></i> What to Expect After Verification</h3>
                        <ul style="list-style-type: none; padding: 0;">
                            <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                <i class="fas fa-check" style="color: var(--primary); margin-right: 10px;"></i>
                                Full access to your ministry dashboard
                            </li>
                            <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                <i class="fas fa-check" style="color: var(--primary); margin-right: 10px;"></i>
                                Ability to view and manage schedules
                            </li>
                            <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                <i class="fas fa-check" style="color: var(--primary); margin-right: 10px;"></i>
                                Access to ministry resources and materials
                            </li>
                            <li style="padding: 8px 0;">
                                <i class="fas fa-check" style="color: var(--primary); margin-right: 10px;"></i>
                                Communication with your ministry team
                            </li>
                        </ul>
                    </div>
                </div>
            </section>

           <!-- Weekly Schedule Section -->
            <section id="weekly-schedule" class="content-section">
                <h2 class="section-title"><i class="fas fa-calendar-alt"></i> Weekly Schedule</h2>
                
                <div class="schedule-container">
                    <div class="schedule-header">
                        <div class="week-navigation">
                            <button class="nav-btn" onclick="changeScheduleMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                            <h3 id="currentScheduleMonth">November 2025</h3>
                            <button class="nav-btn" onclick="changeScheduleMonth(1)"><i class="fas fa-chevron-right"></i></button>
                        </div>
                        <div class="schedule-actions">
                            <div class="calendar-type-selector">
                                <button class="action-btn active" id="schedulePawBtn" onclick="switchScheduleCalendar('paw')">
                                    <i class="fas fa-music"></i> PAW
                                </button>
                                <button class="action-btn" id="scheduleMeetingsBtn" onclick="switchScheduleCalendar('meetings')">
                                    <i class="fas fa-users"></i> MEETINGS
                                </button>
                            </div>
                            <button class="action-btn" onclick="refreshScheduleData()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <!-- Loading Indicator -->
                    <div id="scheduleCalendarLoading" style="text-align: center; padding: 40px; display: none;">
                        <div style="font-size: 3rem; color: var(--primary); margin-bottom: 20px;">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                        <h3 style="color: var(--primary);">Loading Schedule Data...</h3>
                        <p style="color: #6c757d;">Please wait while we fetch the latest schedule information.</p>
                    </div>
                    
                    <!-- Error Message -->
                    <div id="scheduleCalendarError" style="text-align: center; padding: 40px; display: none;">
                        <div style="font-size: 3rem; color: var(--danger); margin-bottom: 20px;">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3 style="color: var(--danger);">Failed to Load Schedule</h3>
                        <p style="color: #6c757d; margin-bottom: 20px;">Unable to load schedule data. Please try again later.</p>
                        <button class="btn-primary" onclick="refreshScheduleData()">
                            <i class="fas fa-redo"></i> Try Again
                        </button>
                    </div>
                    
                    <!-- Schedule Calendar Container -->
                    <div class="calendar-container" id="scheduleCalendarContainer">
                        <!-- Schedule Calendar will be dynamically generated here -->
                    </div>
                    
                    <!-- Upcoming Schedule Cards -->
                    <div class="upcoming-schedule-cards" id="upcomingScheduleCards">
                        <!-- Schedule cards will be dynamically generated here -->
                    </div>
                    
                    <!-- Schedule History Cards -->
                    <div class="schedule-history-section" id="scheduleHistorySection">
                        <h3 class="schedule-history-title"><i class="fas fa-history"></i> Schedule History</h3>
                        <div class="schedule-history-cards" id="scheduleHistoryCards">
                            <!-- History cards will be dynamically generated here -->
                        </div>
                    </div>
                    
                    <!-- Schedule Details Modal -->
                    <div id="scheduleModal" class="schedule-modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3 id="modalDate">Schedule Details</h3>
                                <button class="close-btn" onclick="closeScheduleModal()">&times;</button>
                            </div>
                            <div class="modal-body" id="modalBody">
                                <!-- Schedule details will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Attendance Section -->
            <section id="attendance" class="content-section">
                <h2 class="section-title"><i class="fas fa-check-circle"></i> Attendance Record</h2>
                
                
            </section>

            <!-- Announcements Section -->
            <section id="announcements" class="content-section">
                <h2 class="section-title"><i class="fas fa-bullhorn"></i> Announcements & Birthday Greetings</h2>
                
                <!-- Birthday Greetings -->
                <div id="birthdayGreetingsContainer" style="margin-bottom: 30px;">
                    <!-- Birthday greetings with names and ministries will be displayed here -->
                </div>

                <!-- General Announcements -->
                <div class="announcements-container" id="announcementsContainer">
                    
                </div>

                <!-- Upcoming Birthdays Section -->
                <div id="upcomingBirthdaysContainer" style="margin-top: 30px;">
                    <!-- Upcoming birthdays will be displayed here -->
                </div>

                <!-- Birthday Today Section -->
                <div class="birthday-today-section" id="birthdayTodaySection" style="margin-top: 30px; display: none;">
                    <div class="birthday-header">
                        <h2><i class="fas fa-birthday-cake"></i> Birthday Celebrants Today</h2>
                        <div class="birthday-greeting-box" id="birthdayGreetingBox"></div>
                    </div>
                    <div class="birthday-celebrants" id="birthdayTodayCelerants">
                        <!-- Today's birthday celebrants will be displayed here -->
                    </div>
                </div>
            </section>

             <!-- Praise and Worship Section -->
            <section id="praise-worship" class="content-section">
                <h2 class="section-title"><i class="fas fa-music"></i> Praise and Worship Ministry</h2>
                
                <div class="ministry-welcome">
                    <h3>Welcome to the Praise and Worship Team!</h3>
                    <p>Your role is vital in creating an atmosphere where people can encounter God through worship.</p>
                </div>
                
                <div class="ministry-stats">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-microphone-alt"></i></div>
                        <div class="stat-value">8</div>
                        <div class="stat-label">Vocalists</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-guitar"></i></div>
                        <div class="stat-value">6</div>
                        <div class="stat-label">Musicians</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-calendar-alt"></i></div>
                        <div class="stat-value">4</div>
                        <div class="stat-label">Upcoming Sets</div>
                    </div>
                </div>
                
                <div class="worship-sets">
                    <h3>This Week's Worship Sets</h3>
                    <div class="set-card">
                        <div class="set-header">
                            <div class="set-date">Sunday, Nov 17</div>
                            <div class="set-team">Team A</div>
                        </div>
                        <div class="set-songs">
                            <div class="song-item">
                                <span class="song-title">Goodness of God</span>
                                <span class="song-key">Key: G</span>
                            </div>
                            <div class="song-item">
                                <span class="song-title">What a Beautiful Name</span>
                                <span class="song-key">Key: D</span>
                            </div>
                            <div class="song-item">
                                <span class="song-title">Reckless Love</span>
                                <span class="song-key">Key: C</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Media Ministry Section -->
            <section id="media" class="content-section">
                <h2 class="section-title"><i class="fas fa-film"></i> Media Ministry</h2>
                
                <div class="ministry-welcome">
                    <h3>Welcome to the Media Team!</h3>
                    <p>Your technical skills help spread the gospel through various media platforms.</p>
                </div>
                
                <div class="ministry-stats">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-video"></i></div>
                        <div class="stat-value">4</div>
                        <div class="stat-label">Camera Operators</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-volume-up"></i></div>
                        <div class="stat-value">3</div>
                        <div class="stat-label">Sound Engineers</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-laptop"></i></div>
                        <div class="stat-value">2</div>
                        <div class="stat-label">Livestream Techs</div>
                    </div>
                </div>
                
                <div class="media-tasks">
                    <h3>This Week's Assignments</h3>
                    <div class="task-list">
                        <div class="task-item">
                            <div class="task-info">
                                <div class="task-title">Sunday Service Coverage</div>
                                <div class="task-details">Camera 1: John | Camera 2: Sarah | Sound: Michael</div>
                            </div>
                            <div class="task-status confirmed">Confirmed</div>
                        </div>
                        
                        <div class="task-item">
                            <div class="task-info">
                                <div class="task-title">Equipment Maintenance</div>
                                <div class="task-details">Check all mics and cables</div>
                            </div>
                            <div class="task-status pending">Pending</div>
                        </div>
                        
                        <div class="task-item">
                            <div class="task-info">
                                <div class="task-title">Social Media Content</div>
                                <div class="task-details">Prepare clips from last sermon</div>
                            </div>
                            <div class="task-status in-progress">In Progress</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Dancers Ministry Section -->
            <section id="dancers" class="content-section">
                <h2 class="section-title"><i class="fas fa-user-friends"></i> Dancers Ministry</h2>
                
                <div class="ministry-welcome">
                    <h3>Welcome to the Dance Team!</h3>
                    <p>Your movements help tell the story of God's love and grace.</p>
                </div>
                
                <div class="ministry-stats">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-value">12</div>
                        <div class="stat-label">Dancers</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-user-tie"></i></div>
                        <div class="stat-value">3</div>
                        <div class="stat-label">Choreographers</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-calendar-alt"></i></div>
                        <div class="stat-value">2</div>
                        <div class="stat-label">Upcoming Performances</div>
                    </div>
                </div>
                
                <div class="rehearsal-schedule">
                    <h3>Rehearsal Schedule</h3>
                    <div class="rehearsal-card">
                        <div class="rehearsal-date">Tuesday, Nov 19</div>
                        <div class="rehearsal-time">6:00 PM - 8:00 PM</div>
                        <div class="rehearsal-location">Fellowship Hall</div>
                        <div class="rehearsal-focus">Christmas Program Routine</div>
                    </div>
                    
                    <div class="rehearsal-card">
                        <div class="rehearsal-date">Thursday, Nov 21</div>
                        <div class="rehearsal-time">6:00 PM - 8:00 PM</div>
                        <div class="rehearsal-location">Fellowship Hall</div>
                        <div class="rehearsal-focus">Sunday Special</div>
                    </div>
                </div>
            </section>

            <!-- Ashers Ministry Section -->
            <section id="ashers" class="content-section">
                <h2 class="section-title"><i class="fas fa-door-open"></i> Ashers Ministry</h2>
                
                <div class="ministry-welcome">
                    <h3>Welcome to the Ashers Team!</h3>
                    <p>Your welcoming presence and service create a warm environment for all who enter God's house.</p>
                </div>
                
                <div class="ministry-stats">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-user-friends"></i></div>
                        <div class="stat-value">15</div>
                        <div class="stat-label">Team Members</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-door-closed"></i></div>
                        <div class="stat-value">5</div>
                        <div class="stat-label">Entrances Covered</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-clipboard-list"></i></div>
                        <div class="stat-value">2</div>
                        <div class="stat-label">Teams This Week</div>
                    </div>
                </div>
                
                <div class="usher-assignments">
                    <h3>This Sunday's Assignments</h3>
                    <div class="assignment-card">
                        <div class="assignment-location">Main Entrance</div>
                        <div class="assignment-team">
                            <span class="team-member">James Wilson</span>
                            <span class="team-member">Lisa Chen</span>
                            <span class="team-member">Robert Johnson</span>
                        </div>
                    </div>
                    
                    <div class="assignment-card">
                        <div class="assignment-location">Side Entrance</div>
                        <div class="assignment-team">
                            <span class="team-member">Maria Garcia</span>
                            <span class="team-member">David Brown</span>
                        </div>
                    </div>
                    
                    <div class="assignment-card">
                        <div class="assignment-location">Welcome Desk</div>
                        <div class="assignment-team">
                            <span class="team-member">Sarah Williams</span>
                            <span class="team-member">Thomas Anderson</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Create Lineup Section with Enhanced Calendar -->
            <section id="create-lineup" class="content-section">
                <h2 class="section-title"><i class="fas fa-plus-circle"></i> Create Worship Lineup</h2>
                
                <div class="lineup-container">
                    <!-- Date Selection -->
                    <div class="form-section">
                        <h3><i class="fas fa-calendar-day"></i> Select Schedule Date</h3>
                        <div class="form-fields">
                            <div class="form-group date-input-container">
                                <label for="scheduleDate">Schedule Day *</label>
                                <input type="text" id="scheduleDate" class="form-control" placeholder="Click calendar to select date" readonly required>
                                <i class="fas fa-calendar-alt calendar-icon" onclick="openCalendarModal()"></i>
                                <small class="form-text">Select the date for this worship lineup</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="practiceDate">Practice Day *</label>
                                <input type="date" id="practiceDate" class="form-control" required>
                                <small class="form-text">Select practice date (Saturdays or Sundays only)</small>
                            </div>
                        </div>
                        
                        <!-- Schedule Details (shown when a booked date is selected) -->
                        <div class="schedule-details" id="scheduleDetails">
                            <h4 class="schedule-details-title"><i class="fas fa-info-circle"></i> Existing Schedule Details</h4>
                            <div class="schedule-info-grid">
                                <div class="schedule-info-item">
                                    <div class="schedule-info-label">Song Leader</div>
                                    <div class="schedule-info-value" id="existingSongLeader">-</div>
                                </div>
                                <div class="schedule-info-item">
                                    <div class="schedule-info-label">Backup Singers</div>
                                    <div class="schedule-info-value" id="existingBackupSingers">-</div>
                                </div>
                            </div>
                            <p style="color: var(--danger); font-weight: 600; margin: 0;">
                                <i class="fas fa-exclamation-triangle"></i> This date is already booked. Please select a different date.
                            </p>
                        </div>
                    </div>

                    <!-- Team Selection -->
                    <div class="form-section">
                        <h3><i class="fas fa-users"></i> Team Members</h3>
                        <div class="form-group">
                            <label for="songLeader">Song Leader *</label>
                            <select id="songLeader" class="form-control" required>
                                <option value="">Select Song Leader</option>
                                <option value="Psalm Gambe">Psalm Gambe</option>
                                <option value="Geneveve España">Geneveve España</option>
                                <option value="Cathy Martinez">Cathy Martinez</option>
                                <option value="Tiffany Dañal">Tiffany Dañal</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Backup Singers (Max 5)</label>
                            <div id="backupContainer">
                                <div class="backup-row">
                                    <select class="form-control backup-select" onchange="updateBackupOptions()">
                                        <option value="">Select Backup 1</option>
                                        <!-- Options will be populated dynamically -->
                                    </select>
                                    <button type="button" class="btn-remove-backup" onclick="removeBackupField(this)" disabled>
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <button type="button" class="btn-secondary" onclick="addBackupField()" id="addBackupBtn" style="margin-top: 10px;">
                                <i class="fas fa-plus"></i> Add Backup
                            </button>
                        </div>
                    </div>

                    <!-- Slow Songs Section -->
                    <div class="form-section">
                        <h3><i class="fas fa-music"></i> Slow Songs (Max 5)</h3>
                        <div id="slowSongsContainer">
                            <div class="song-row slow-song">
                                <div class="form-group">
                                    <label>Slow Song 1 Title *</label>
                                    <input type="text" class="form-control slow-title" placeholder="Enter song title" required>
                                </div>
                                <div class="form-group">
                                    <label>YouTube Link *</label>
                                    <input type="url" class="form-control slow-link" placeholder="https://www.youtube.com/watch?v=..." required>
                                    <div class="youtube-preview"></div>
                                </div>
                                <div class="form-group">
                                    <label>Lyrics (Optional)</label>
                                    <textarea class="form-control slow-lyrics preserve-formatting" placeholder="Enter song lyrics..." onpaste="handleLyricsPaste(event)"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Instructions (Optional)</label>
                                    <textarea class="form-control slow-instructions" placeholder="Any special instructions..."></textarea>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn-secondary" onclick="addSlowSong()" id="addSlowSongBtn" style="margin-top: 10px;">
                            <i class="fas fa-plus"></i> Add Slow Song
                        </button>
                    </div>

                    <!-- Fast Songs Section -->
                    <div class="form-section">
                        <h3><i class="fas fa-bolt"></i> Fast Songs (Max 5)</h3>
                        <div id="fastSongsContainer">
                            <div class="song-row fast-song">
                                <div class="form-group">
                                    <label>Fast Song 1 Title *</label>
                                    <input type="text" class="form-control fast-title" placeholder="Enter song title" required>
                                </div>
                                <div class="form-group">
                                    <label>YouTube Link *</label>
                                    <input type="url" class="form-control fast-link" placeholder="https://www.youtube.com/watch?v=..." required>
                                    <div class="youtube-preview"></div>
                                </div>
                                <div class="form-group">
                                    <label>Lyrics (Optional)</label>
                                    <textarea class="form-control fast-lyrics preserve-formatting" placeholder="Enter song lyrics..." onpaste="handleLyricsPaste(event)"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Instructions (Optional)</label>
                                    <textarea class="form-control fast-instructions" placeholder="Any special instructions..."></textarea>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn-secondary" onclick="addFastSong()" id="addFastSongBtn" style="margin-top: 10px;">
                            <i class="fas fa-plus"></i> Add Fast Song
                        </button>
                    </div>

                    <!-- Submit Button -->
                    <div class="form-actions" style="margin-top: 30px;">
                        <button type="button" class="btn-secondary" onclick="resetLineupForm()">Reset Form</button>
                        <button type="button" class="btn-primary" onclick="submitLineup()" id="submitLineupBtn">
                            <i class="fas fa-paper-plane"></i> Submit Lineup for Approval
                        </button>
                    </div>
                </div>
            </section>

            <!-- My Profile Section - FIXED -->
            <section id="my-profile" class="content-section">
                <div class="profile-container">
                    <h2 class="section-title"><i class="fas fa-user-circle"></i> My Profile</h2>
                    
                    <!-- Profile Header -->
                    <div class="profile-header">
                        <div class="profile-avatar">
                            <div class="avatar-large" id="profileAvatar">FG</div>
                            <div class="avatar-status">
                                <div class="status-circle verified" id="profileStatus"><div class="status-tooltip">Verified</div></div>
                            </div>
                        </div>
                        <div class="profile-info">
                            <h3 id="profileName">Frank Gomez</h3>
                            <p id="profileMinistry">Media</p>
                            <p id="profileMemberId">Member ID: 872879</p>
                        </div>
                    </div>

                    <!-- Profile Tabs Navigation -->
                    <div class="profile-tabs">
                        <button class="tab-btn active" onclick="openProfileTab('personal-info')">
                            <i class="fas fa-user"></i> Personal Information
                        </button>
                        <button class="tab-btn" onclick="openProfileTab('change-password')">
                            <i class="fas fa-lock"></i> Change Password
                        </button>
                    </div>

                    <!-- Personal Information Tab Content -->
                    <div id="personal-info" class="profile-tab-content active">
                        <div class="profile-form">
                            <div class="form-section">
                                <h3><i class="fas fa-info-circle"></i> Personal Details</h3>
                                
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="firstname">First Name</label>
                                            <input type="text" id="firstname" class="form-control" placeholder="First Name">
                                        </div>
                                    </div>

                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="lastname">Last Name</label>
                                            <input type="text" id="lastname" class="form-control" placeholder="Last Name">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3><i class="fas fa-shield-alt"></i> Account Information</h3>
                                
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="username">Username</label>
                                            <input type="text" id="username" class="form-control" placeholder="Username" disabled="">
                                        </div>
                                    </div>

                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="memberId">Member ID</label>
                                            <input type="text" id="memberId" class="form-control" placeholder="Member ID" disabled="">
                                        </div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-column full-width">
                                        <div class="form-group">
                                            <label for="status">Account Status</label>
                                            <input type="text" id="status" class="form-control" placeholder="Account Status" disabled="">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3><i class="fas fa-church"></i> Ministry Information</h3>
                                
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="ministry">Ministry</label>
                                            <input type="text" id="ministry" class="form-control" placeholder="Ministry" disabled="">
                                        </div>
                                    </div>

                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="birthdate">Birthdate</label>
                                            <input type="text" id="birthdate" class="form-control" placeholder="MM/DD/YYYY" disabled="">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Form Actions -->
                            <div class="form-actions">
                                <button type="button" class="btn-secondary" onclick="resetProfileForm()">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                                <button type="button" class="btn-primary" onclick="saveProfileChanges()">
                                    <i class="fas fa-save"></i> Save Changes
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Change Password Tab Content -->
                    <div id="change-password" class="profile-tab-content">
                        <div class="password-form">
                            <div class="form-section">
                                <h3><i class="fas fa-key"></i> Update Your Password</h3>
                                
                                <div class="form-row">
                                    <div class="form-column full-width">
                                        <div class="form-group">
                                            <label for="currentPassword">Current Password</label>
                                            <div style="position: relative;">
                                                <input type="password" id="currentPassword" class="form-control" placeholder="Enter current password">
                                                <div class="password-toggle" onclick="togglePasswordVisibility('currentPassword')">
                                                    <i class="fas fa-eye"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-column full-width">
                                        <div class="form-group">
                                            <label for="newPassword">New Password</label>
                                            <div style="position: relative;">
                                                <input type="password" id="newPassword" class="form-control" placeholder="Enter new password" oninput="checkPasswordStrength(this.value)">
                                                <div class="password-toggle" onclick="togglePasswordVisibility('newPassword')">
                                                    <i class="fas fa-eye"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-column full-width">
                                        <div class="form-group">
                                            <label for="confirmPassword">Confirm New Password</label>
                                            <div style="position: relative;">
                                                <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm new password" oninput="validatePasswordMatch(document.getElementById('newPassword').value, this.value)">
                                                <div class="password-toggle" onclick="togglePasswordVisibility('confirmPassword')">
                                                    <i class="fas fa-eye"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Password Strength Indicator -->
                            <div class="form-section">
                                <h3><i class="fas fa-chart-bar"></i> Password Strength</h3>
                                
                                <div class="password-strength" id="passwordStrength">
                                    <div class="strength-bar">
                                        <div class="strength-fill" id="strengthFill"></div>
                                    </div>
                                    <div class="strength-text" id="strengthText">Password strength: Weak</div>
                                </div>

                                <div class="password-requirements">
                                    <p><strong>Password Requirements:</strong></p>
                                    <ul>
                                        <li id="reqLength"><i class="fas fa-times"></i> At least 8 characters</li>
                                        <li id="reqUppercase"><i class="fas fa-times"></i> One uppercase letter (A-Z)</li>
                                        <li id="reqLowercase"><i class="fas fa-times"></i> One lowercase letter (a-z)</li>
                                        <li id="reqNumber"><i class="fas fa-times"></i> One number (0-9)</li>
                                        <li id="reqSpecial"><i class="fas fa-times"></i> One special character (!@#$%^&amp;*)</li>
                                    </ul>
                                </div>
                            </div>

                            <!-- Form Actions -->
                            <div class="form-actions">
                                <button type="button" class="btn-secondary" onclick="resetPasswordForm()">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                                <button type="button" class="btn-primary" onclick="changePassword()">
                                    <i class="fas fa-lock"></i> Change Password
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Spiritual Assistant Section -->
            <section id="spiritual-assistant" class="content-section">
                <h2 class="section-title"><i class="fas fa-heart"></i> Spiritual Assistant</h2>
                
                <div class="disclaimer-banner">
                    <div class="disclaimer-header">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Important Disclaimer</span>
                    </div>
                    <p>I am just your AI Spiritual Assistant. God and you between is the real communication. Please seek professional pastoral counsel for serious matters and always consult your spiritual leaders.</p>
                </div>
                
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                    <div class="chat-message ai-message" id="initialGreeting">
                                <p>Hello! 👋 I'm your Spiritual Assistant. I'm here to help you reflect on life's challenges through the lens of biblical wisdom and scripture.</p>
                                <p style="margin-top: 10px; font-size: 0.95em; color: #888;">Ask me about any situation you're facing, and I'll help you find biblical guidance and relevant scriptures.</p>
                            </div>
                            <div class="message-time">Just now</div>
                        </div>
                    </div>
                    
                    <div class="chat-input-area">
                        <div class="input-group">
                            <textarea 
                                id="userInput" 
                                class="chat-input" 
                                placeholder="Ask about your situation, concerns, or questions... (e.g., 'I'm struggling with anxiety' or 'How should I handle conflict?')"
                                rows="3"></textarea>
                            <button id="sendBtn" class="send-button" onclick="sendSpiritualQuestion()">
                                <i class="fas fa-paper-plane"></i> Ask
                            </button>
                        </div>
                        <div class="input-hint">💡 Tip: Be specific about your situation for more personalized biblical guidance</div>
                    </div>
                </div>
            </section>
        </main>    
        
        <!-- Receipt Modal -->
        <div id="receiptModal" class="receipt-modal">
            <div class="receipt-container" id="receiptContent">
                <div class="receipt-header">
                    <div class="receipt-logo"></div>
                    <div class="receipt-title">JOYFUL SOUND CHURCH</div>
                    <div class="receipt-subtitle">INTERNATIONAL</div>
                </div>
                
                <div class="receipt-content">
                    <div class="receipt-section">
                        <h3 class="receipt-section-title">
                            <i class="fas fa-file-invoice"></i>
                            Praise and Worship Lineup
                        </h3>
                        <div class="receipt-info">
                            <div class="receipt-info-item">
                                <div class="receipt-label">Schedule For</div>
                                <div class="receipt-value" id="receiptScheduleDate">-</div>
                            </div>
                            <div class="receipt-info-item">
                                <div class="receipt-label">Practice Day</div>
                                <div class="receipt-value" id="receiptPracticeDate">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="receipt-section">
                        <h3 class="receipt-section-title">
                            <i class="fas fa-users"></i>
                            Team Members
                        </h3>
                        <div class="receipt-info">
                            <div class="receipt-info-item">
                                <div class="receipt-label">Song Leader</div>
                                <div class="receipt-value" id="receiptSongLeader">-</div>
                            </div>
                            <div class="receipt-info-item">
                                <div class="receipt-label">Backup Singers</div>
                                <div class="receipt-value" id="receiptBackupCount">0</div>
                            </div>
                        </div>
                        <div id="receiptBackupList">
                            <!-- Backup list will be populated here -->
                        </div>
                    </div>
                    
                    <div class="receipt-section">
                        <h3 class="receipt-section-title">
                            <i class="fas fa-bolt"></i>
                            Fast Songs
                        </h3>
                        <ul class="receipt-list" id="receiptFastSongs">
                            <!-- Fast songs will be populated here -->
                        </ul>
                    </div>
                    
                    <div class="receipt-section">
                        <h3 class="receipt-section-title">
                            <i class="fas fa-music"></i>
                            Slow Songs
                        </h3>
                        <ul class="receipt-list" id="receiptSlowSongs">
                            <!-- Slow songs will be populated here -->
                        </ul>
                    </div>
                    
                    <div class="receipt-note">
                        <div class="receipt-note-title">
                            <i class="fas fa-exclamation-circle"></i>
                            Important Note
                        </div>
                        <p class="receipt-note-text">
                            Hello everyone! To make sure we can find a replacement, please let us know ahead of time if you can't make it to a practice or on the day of the event itself. Thanks so much!
                        </p>
                    </div>
                </div>
                
                <div class="receipt-footer">
                    <div class="receipt-actions">
                        <button class="receipt-btn receipt-btn-edit" onclick="editLineup()">
                            <i class="fas fa-edit"></i>
                            Edit
                        </button>
                        <button class="receipt-btn receipt-btn-save" onclick="saveReceiptAsImage()">
                            <i class="fas fa-download"></i>
                            Save Image
                        </button>
                        <button class="receipt-btn receipt-btn-confirm" onclick="confirmAndReset()">
                            <i class="fas fa-check"></i>
                            Confirm & Reset
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar Modal for Date Selection -->
        <div id="calendarModal" class="calendar-modal">
            <div class="calendar-modal-content">
                <div class="calendar-modal-header">
                    <h3>Select Schedule Date</h3>
                    <button class="calendar-close-btn" onclick="closeCalendarModal()">&times;</button>
                </div>
                <div class="calendar-modal-body">
                    <div class="calendar-navigation">
                        <button class="calendar-nav-btn" onclick="changeCalendarMonth(-1)">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <div class="calendar-current-month" id="calendarCurrentMonth">November 2025</div>
                        <button class="calendar-nav-btn" onclick="changeCalendarMonth(1)">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    
                    <div class="calendar-container" id="dateSelectionCalendar">
                        <!-- Calendar will be dynamically generated here -->
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn-primary" onclick="confirmDateSelection()" id="confirmDateBtn" disabled>
                            <i class="fas fa-check"></i> Confirm Date Selection
                        </button>
                        <button class="btn-secondary" onclick="closeCalendarModal()" style="margin-left: 10px;">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>

        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwXQOBKCBiRhFqI-tU440N6xysaQFjhR8Ktq5ti9Xfh8UeWRN_6yqDMUmyEccviLh8lYA/exec';

        const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
            ? 'http://localhost:3000/api' 
            : '/api';

        // STRONGER BACK BUTTON PREVENTION
        (function() {
            window.history.replaceState(null, null, window.location.href);
            window.history.pushState(null, null, window.location.href);
            window.addEventListener('popstate', function(event) {
                window.history.pushState(null, null, window.location.href);
                showAlert('You cannot go back while logged in. Please logout first.', 'warning');
            });
        })();

        // Check if user is logged in
        let userData = JSON.parse(sessionStorage.getItem('userData') || localStorage.getItem('userData') || '{}');
        
        if (!userData.firstname) {
            window.location.href = 'login.html';
        } else {
            initializeDashboard();
        }

        // Menu items configuration
        const menuItems = {
            common: [
                { id: 'home', icon: 'fas fa-home', label: 'Home' },
                { id: 'weekly-schedule', icon: 'fas fa-calendar-alt', label: 'Weekly Schedule' },
                { id: 'attendance', icon: 'fas fa-check-circle', label: 'Attendance' },
                { id: 'announcements', icon: 'fas fa-bullhorn', label: 'Announcements' },
                { id: 'spiritual-assistant', icon: 'fas fa-comments', label: 'Spiritual Assistant' },
                { id: 'my-profile', icon: 'fas fa-user-circle', label: 'My Profile' }
            ],
            "Media": [
                { id: 'media', icon: 'fas fa-film', label: 'Media' }
            ],
            "Praise And Worship": [
                { id: 'praise-worship', icon: 'fas fa-music', label: 'Praise And Worship' }
            ],
            "Dancers": [
                { id: 'dancers', icon: 'fas fa-user-friends', label: 'Dancers' }
            ],
            "Ashers": [
                { id: 'ashers', icon: 'fas fa-door-open', label: 'Ashers' }
            ]
        };

        // Create Lineup Variables
        let backupCount = 1;
        let slowSongCount = 1;
        let fastSongCount = 1;
        const backupOptions = ["Psalm", "Cathy", "Tiffany", "Geneveve", "Merianne", "Ezra", "Julie", "Jewel", "Abby", "Myka"];

        // Calendar state
        let currentDate = new Date();
        let currentCalendarType = 'paw'; // 'paw' or 'meetings'
        let scheduleData = [];

        // Live Bible Verse System with Daily Rotation
        let currentBibleVersion = 'niv'; // Default version (NIV)
        let currentVerseTranslation = 'english'; // Default language
        
        const bibleVersions = {
            'niv': 'New International Version',
            'kjv': 'King James Version',
            'nkjv': 'New King James Version',
            'cev': 'Contemporary English Version',
            'nasb': 'New American Standard Bible'
        };

        const supportedLanguages = {
            'english': 'English',
            'bisaya': 'Bisaya (Cebuano)'
        };

        // Daily verse references (will rotate based on date)
        const dailyVerseReferences = [
            'John 3:16',
            'Proverbs 3:5-6',
            'Ephesians 2:8',
            'Colossians 3:23',
            '1 Corinthians 15:58',
            'Psalm 23:1',
            'Romans 8:28',
            'Philippians 4:13',
            'Joshua 1:8',
            'Psalm 37:5'
        ];

        // Function to get verse of the day based on current date
        function getVersOfTheDayReference() {
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 86400000);
            return dailyVerseReferences[dayOfYear % dailyVerseReferences.length];
        }

        // Bible verse cache with multiple versions for AI-driven accuracy
        const bibleVerseCache = {
            'John 3:16': {
                'niv': 'For God so loved the world that he gave his one and only Son, that whoever believes in him shall not perish but have eternal life.',
                'kjv': 'For God so loved the world, that he gave his only begotten Son, that whosoever believeth in him should not perish, but have everlasting life.',
                'nkjv': 'For God so loved the world that He gave His only begotten Son, that whoever believes in Him should not perish but have everlasting life.',
                'cev': 'God loved the people of this world so much that he gave his only Son. Anyone who has faith in him will have eternal life and will never really die.',
                'nasb': 'For God so loved the world, that He gave His only begotten Son, that whoever believes in Him shall not perish, but have eternal life.'
            },
            'Proverbs 3:5-6': {
                'niv': 'Trust in the Lord with all your heart and lean not on your own understanding; in all your ways submit to him, and he will make your paths straight.',
                'kjv': 'Trust in the Lord with all thine heart; and lean not unto thine own understanding. In all thy ways acknowledge him, and he shall direct thy paths.',
                'nkjv': 'Trust in the Lord with all your heart, And lean not on your own understanding; In all your ways acknowledge Him, And He shall direct your paths.',
                'cev': 'With all your heart you must trust the Lord and not your own judgment. Always let him lead you, and he will show you which way to go.',
                'nasb': 'Trust in the Lord with all your heart And do not lean on your own understanding. In all your ways acknowledge Him, And He will make your paths straight.'
            },
            'Ephesians 2:8': {
                'niv': 'For it is by grace you have been saved, through faith—and this is not from yourselves, it is the gift of God—',
                'kjv': 'For by grace are ye saved through faith; and that not of yourselves: it is the gift of God:',
                'nkjv': 'For by grace you have been saved through faith, and that not of yourselves; it is the gift of God,',
                'cev': 'You were saved by faith in God, who treats us much better than we deserve. This is God\'s gift to you, and not anything you have done on your own.',
                'nasb': 'For by grace you have been saved through faith; and that not of yourselves, it is the gift of God;'
            },
            'Colossians 3:23': {
                'niv': 'Whatever you do, work at it with all your heart, as working for the Lord, not for human masters, since you know that you will receive an inheritance from the Lord as a reward. It is the Lord Christ you are serving.',
                'kjv': 'And whatsoever ye do, do it heartily, as to the Lord, and not unto men; Knowing that of the Lord ye shall receive the reward of the inheritance: for ye serve the Lord Christ.',
                'nkjv': 'And whatever you do, do it heartily, as to the Lord and not to men, knowing that from the Lord you will receive the reward of the inheritance; for you serve the Lord Christ.',
                'cev': 'In everything you do, work hard for your real Master, the Lord Christ. This is the best way to serve the Lord.',
                'nasb': 'Whatever you do, do your work heartily, as for the Lord rather than for men, knowing that from the Lord you will receive the reward of the inheritance. It is the Lord Christ whom you serve.'
            },
            '1 Corinthians 15:58': {
                'niv': 'Therefore, my dear brothers and sisters, stand firm. Let nothing move you. Always give yourselves fully to the work of the Lord, because you know that your labor in the Lord is not in vain.',
                'kjv': 'Therefore, my beloved brethren, be ye stedfast, unmoveable, always abounding in the work of the Lord, forasmuch as ye know that your labour is not in vain in the Lord.',
                'nkjv': 'Therefore, my beloved brethren, be steadfast, immovable, always abounding in the work of the Lord, knowing that your labor is not in vain in the Lord.',
                'cev': 'My dear friends, stand firm and don\'t be shaken. Always keep busy working for the Lord. You know that everything you do for him is worthwhile.',
                'nasb': 'Therefore, my beloved brethren, be steadfast, immovable, always abounding in the work of the Lord, knowing that your toil in the Lord is not in vain.'
            },
            'Psalm 23:1': {
                'niv': 'The Lord is my shepherd, I lack nothing. He makes me lie down in green pastures, he leads me beside quiet waters, he refreshes my soul.',
                'kjv': 'The Lord is my shepherd; I shall not want. He maketh me to lie down in green pastures: he leadeth me beside the still waters.',
                'nkjv': 'The Lord is my shepherd; I shall not want. He makes me to lie down in green pastures; He leads me beside the still waters.',
                'cev': 'You, Lord, are my shepherd. I will never be in need. You let me rest in fields of green grass. You lead me to streams of peaceful water,',
                'nasb': 'The Lord is my shepherd, I shall not want. He makes me lie down in green pastures; He leads me beside quiet waters. He restores my soul;'
            },
            'Romans 8:28': {
                'niv': 'And we know that in all things God works for the good of those who love him, who have been called according to his purpose.',
                'kjv': 'And we know that all things work together for good to them that love God, to them who are the called according to his purpose.',
                'nkjv': 'And we know that all things work together for good to those who love God, to those who are the called according to His purpose.',
                'cev': 'We know that God is always at work for the good of everyone who loves him. They are the ones God chose for his purpose,',
                'nasb': 'And we know that God causes all things to work together for good to those who love God, to those who are called according to His purpose.'
            },
            'Philippians 4:13': {
                'niv': 'I can do all this through Christ, who gives me strength.',
                'kjv': 'I can do all things through Christ which strengtheneth me.',
                'nkjv': 'I can do all things through Christ who strengthens me.',
                'cev': 'I can do everything through Christ, who gives me the strength I need.',
                'nasb': 'I can do all things through Him who strengthens me.'
            },
            'Joshua 1:8': {
                'niv': 'Keep this Book of the Law always on your lips; meditate on it day and night, so that you may be careful to do everything written in it. Then you will be prosperous and successful.',
                'kjv': 'This book of the law shall not depart out of thy mouth; but thou shalt meditate therein day and night, that thou mayest observe to do according to all that is written therein: for then thou shalt make thy way prosperous, and then thou shalt have good success.',
                'nkjv': 'This Book of the Law shall not depart from your mouth, but you shall meditate in it day and night, that you may observe to do according to all that is written in it. For then you will make your way prosperous, and then you will have good success.',
                'cev': 'Always remember what is written in the Book of the Law. Study it day and night, and make sure you follow everything that is written in it. If you do, you will be successful and prosperous.',
                'nasb': 'This book of the law shall not depart from your mouth, but you shall meditate on it day and night, so that you may be careful to do according to all that is written in it; for then you will make your way prosperous, and then you will have success.'
            },
            'Psalm 37:5': {
                'niv': 'Commit your way to the Lord; trust in him and he will do this: He will make your righteous reward shine like the dawn, your vindication like the noonday sun.',
                'kjv': 'Commit thy way unto the Lord; trust also in him; and he shall bring it to pass.',
                'nkjv': 'Commit your way to the Lord, Trust also in Him, And He shall bring it to pass.',
                'cev': 'Let the Lord have your way, and trust in him. He will help you.',
                'nasb': 'Commit your way to the Lord; Trust in Him also, And He will do it.'
            }
        };

        // Function to fetch Bible verse from cache with AI-driven version accuracy
        async function fetchBibleVerse(reference, version = 'niv') {
            try {
                // Check cache first for reliable, offline-capable access
                if (bibleVerseCache[reference] && bibleVerseCache[reference][version]) {
                    return {
                        text: bibleVerseCache[reference][version],
                        reference: reference,
                        version: bibleVersions[version] || 'Bible'
                    };
                }
                
                // Fallback to first available version if exact version not found
                if (bibleVerseCache[reference]) {
                    const availableVersion = Object.keys(bibleVerseCache[reference])[0];
                    return {
                        text: bibleVerseCache[reference][availableVersion],
                        reference: reference,
                        version: bibleVersions[availableVersion] || 'Bible'
                    };
                }
                
                // Ultimate fallback
                throw new Error('Verse not found in cache');
            } catch (error) {
                console.error('Error fetching Bible verse:', error);
                // Fallback verse - NIV version of John 3:16
                return {
                    text: 'For God so loved the world that he gave his one and only Son, that whoever believes in him shall not perish but have eternal life.',
                    reference: 'John 3:16',
                    version: 'New International Version (NIV)'
                };
            }
        }

        // Function to translate text to Bisaya using translation API
        async function translateToBisaya(text) {
            try {
                // Using Google Translate API via RapidAPI (more reliable)
                // Fallback to simple character-based approach if API fails
                const response = await fetch('https://api.mymemory.translated.net/get?q=' + encodeURIComponent(text) + '&langpair=en|ceb');
                const data = await response.json();
                
                if (data.responseStatus === 200 && data.responseData.translatedText) {
                    return data.responseData.translatedText;
                }
                
                // If translation fails, show message
                console.log('Translation service temporarily unavailable, showing original text');
                return text;
            } catch (error) {
                console.error('Error translating to Bisaya:', error);
                showAlert('⚠️ Translation service unavailable. Showing original text.', 'warning');
                return text;
            }
        }

        // Function to update verse display
        async function updateBibleVerse(elementIds = {}) {
            try {
                // Show loading state
                if (elementIds.verse && document.getElementById(elementIds.verse)) {
                    document.getElementById(elementIds.verse).textContent = '⏳ Loading verse...';
                }
                
                const verseRef = getVersOfTheDayReference();
                const verseData = await fetchBibleVerse(verseRef, currentBibleVersion);
                
                let verseText = verseData.text;
                
                // Show translation indicator
                if (currentVerseTranslation === 'bisaya') {
                    if (elementIds.verse && document.getElementById(elementIds.verse)) {
                        document.getElementById(elementIds.verse).textContent = '🔄 Translating to Bisaya...';
                    }
                    verseText = await translateToBisaya(verseText);
                }
                
                // Update all verse elements
                if (elementIds.verse && document.getElementById(elementIds.verse)) {
                    document.getElementById(elementIds.verse).textContent = '"' + verseText + '"';
                }
                if (elementIds.reference && document.getElementById(elementIds.reference)) {
                    document.getElementById(elementIds.reference).textContent = verseData.reference + ' (' + currentBibleVersion.toUpperCase() + ')';
                }
                if (elementIds.language && document.getElementById(elementIds.language)) {
                    document.getElementById(elementIds.language).textContent = 'Language: ' + supportedLanguages[currentVerseTranslation];
                }
            } catch (error) {
                console.error('Error updating Bible verse:', error);
                if (elementIds.verse && document.getElementById(elementIds.verse)) {
                    document.getElementById(elementIds.verse).textContent = '❌ Error loading verse. Please try again.';
                }
            }
        }

        // Function to change Bible version
        function changeBibleVersion(version) {
            currentBibleVersion = version;
            
            // Update active button state
            document.querySelectorAll('.version-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update both verse containers
            updateBibleVerse({ 
                verse: 'dailyVerse',
                reference: 'verseReference',
                language: 'verseLanguage'
            });
            
            // Also update welcome verse if it exists
            if (document.getElementById('welcomeVerse')) {
                updateBibleVerse({ 
                    verse: 'welcomeVerse',
                    reference: 'welcomeVerseReference',
                    language: 'welcomeVerseLanguage'
                });
            }
        }

        // Function to change verse language
        function changeVerseLanguage(language) {
            currentVerseTranslation = language;
            
            // Update active button state
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update both verse containers
            updateBibleVerse({ 
                verse: 'dailyVerse',
                reference: 'verseReference',
                language: 'verseLanguage'
            });
            
            // Also update welcome verse if it exists
            if (document.getElementById('welcomeVerse')) {
                updateBibleVerse({ 
                    verse: 'welcomeVerse',
                    reference: 'welcomeVerseReference',
                    language: 'welcomeVerseLanguage'
                });
            }
        }

        // Fetch birthdays from AppScript
        async function fetchAndDisplayBirthdays() {
            try {
                const url = SCRIPT_URL + '?action=getAllMemberBirthdates';
                console.log('Fetching birthdays from:', url);
                
                const response = await fetch(url);
                const result = await response.json();
                
                console.log('Birthday API response:', result);
                
                if (result.message === 'Ministry Portal API is running') {
                    console.warn('AppScript action not recognized. Make sure getAllMemberBirthdates is in handleGetRequest');
                    displayBirthdaySection([], []);
                    return;
                }
                
                if (result.success && result.data && Array.isArray(result.data)) {
                    const members = result.data;
                    console.log('✓ Retrieved', members.length, 'members with birthdates');
                    
                    const today = new Date();
                    const todayMonth = String(today.getMonth() + 1).padStart(2, '0');
                    const todayDay = String(today.getDate()).padStart(2, '0');
                    const todayKey = `${todayMonth}-${todayDay}`;
                    
                    // Find today's birthday celebrants
                    const todaysCelebrrants = members.filter(member => {
                        if (!member.birthdate) return false;
                        const [year, month, day] = member.birthdate.split('-');
                        const memberKey = `${month}-${day}`;
                        return memberKey === todayKey;
                    });
                    
                    // Find upcoming birthdays (next 30 days)
                    const upcomingBirthdays = getUpcomingBirthdays(members, 30);
                    
                    console.log('✓ Found', todaysCelebrrants.length, 'celebrants today');
                    console.log('✓ Found', upcomingBirthdays.length, 'upcoming birthdays');
                    
                    // Update notification badge
                    updateNotificationBadge(todaysCelebrrants.length);
                    
                    // Populate notification modal
                    populateNotificationModal(todaysCelebrrants);
                    
                    // Display birthday greetings in announcements section
                    displayBirthdayGreetingsInAnnouncements(todaysCelebrrants, upcomingBirthdays);
                    
                    // Display upcoming birthdays in announcements section
                    displayUpcomingBirthdaysInAnnouncements(upcomingBirthdays);
                    
                    // Display birthdays
                    displayBirthdaySection(todaysCelebrrants, upcomingBirthdays);
                } else {
                    console.error('Invalid response format:', result);
                    displayBirthdaySection([], []);
                    updateNotificationBadge(0);
                }
            } catch (error) {
                console.error('Error fetching birthdays:', error);
                displayBirthdaySection([], []);
            }
        }

        function getUpcomingBirthdays(members, daysAhead) {
            const today = new Date();
            const upcoming = [];

            members.forEach(member => {
                if (!member.birthdate) return;
                
                const [year, month, day] = member.birthdate.split('-');
                let birthdayThisYear = new Date(today.getFullYear(), parseInt(month) - 1, parseInt(day));
                
                // If birthday already passed this year, get next year's
                if (birthdayThisYear < today) {
                    birthdayThisYear = new Date(today.getFullYear() + 1, parseInt(month) - 1, parseInt(day));
                }
                
                const daysUntilBirthday = Math.ceil((birthdayThisYear - today) / (1000 * 60 * 60 * 24));
                
                if (daysUntilBirthday > 0 && daysUntilBirthday <= daysAhead) {
                    upcoming.push({
                        ...member,
                        daysUntilBirthday: daysUntilBirthday,
                        birthdayDate: birthdayThisYear
                    });
                }
            });
            
            return upcoming.sort((a, b) => a.daysUntilBirthday - b.daysUntilBirthday);
        }

        async function displayBirthdaySection(todaysCelebrrants, upcomingBirthdays) {
            const birthdayContainer = document.getElementById('birthdayTodayCelerants');
            if (!birthdayContainer) return;
            
            let html = '';
            
            // Display today's celebrants with AI wishes
            if (todaysCelebrrants && todaysCelebrrants.length > 0) {
                html += '<div style="margin-bottom: 25px;">';
                html += '<h3 style="color: var(--primary); margin-bottom: 15px; font-size: 1.2rem; font-weight: 700; display: flex; align-items: center; gap: 8px;"><i class="fas fa-birthday-cake"></i> Celebrating Today!</h3>';
                html += '<div style="display: grid; gap: 18px;">';
                
                todaysCelebrrants.forEach(member => {
                    const aiWish = generateBirthdayWish(member);
                    const bibleVerse = getRandomBirthdayVerse();
                    
                    html += `
                        <div style="background: white; border: 2px solid #FFD700; border-radius: 12px; padding: 18px; box-shadow: 0 2px 8px rgba(255, 215, 0, 0.2); position: relative;">
                            <div style="background: linear-gradient(135deg, #FFD700, #FFC700); padding: 12px; border-radius: 8px; margin-bottom: 15px; color: #333;">
                                <div style="display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 1.1rem;">
                                    <span style="font-size: 28px;">🎉</span>
                                    <div>
                                        <div>${member.fullName}</div>
                                        <div style="font-size: 0.85rem; font-weight: 500; opacity: 0.9;"><i class="fas fa-briefcase" style="margin-right: 5px;"></i>${member.ministry || 'Ministry Member'}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 12px;">
                                <div style="font-size: 0.85rem; color: #666; font-weight: 500; margin-bottom: 5px;">💭 Birthday Message</div>
                                <div style="color: #333; font-size: 0.95rem; line-height: 1.5; padding: 10px; background: #f8f9fa; border-radius: 6px; border-left: 3px solid var(--primary);">
                                    "${aiWish}"
                                </div>
                            </div>
                            
                            <div>
                                <div style="font-size: 0.85rem; color: #666; font-weight: 500; margin-bottom: 5px;">✨ Birthday Verse</div>
                                <div style="color: #555; font-size: 0.9rem; line-height: 1.6; padding: 10px; background: #f0f5ff; border-radius: 6px; border-left: 3px solid steelblue;">
                                    <div style="font-style: italic; margin-bottom: 6px;">"${bibleVerse.text}"</div>
                                    <div style="color: steelblue; font-weight: 500; font-size: 0.85rem;">— ${bibleVerse.reference}</div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            }
            
            // Display upcoming birthdays
            if (upcomingBirthdays && upcomingBirthdays.length > 0) {
                html += '<div>';
                html += '<h3 style="color: var(--primary); margin-bottom: 15px; font-size: 1.2rem; font-weight: 700; display: flex; align-items: center; gap: 8px;"><i class="fas fa-calendar-check"></i> Upcoming Birthdays</h3>';
                html += '<div style="display: grid; gap: 10px;">';
                
                upcomingBirthdays.forEach(member => {
                    const monthName = new Date(member.birthdayDate).toLocaleDateString('en-US', { month: 'short' });
                    const dayNum = new Date(member.birthdayDate).getDate();
                    const daysText = member.daysUntilBirthday === 1 ? '1 day away' : 'in ' + member.daysUntilBirthday + ' days';
                    
                    html += `
                        <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 12px 15px; display: grid; grid-template-columns: auto 1fr auto; gap: 12px; align-items: center; transition: all 0.3s ease;">
                            <div style="font-size: 28px;">🎂</div>
                            <div>
                                <div style="font-weight: 600; color: #333; font-size: 0.95rem;">${member.fullName}</div>
                                <div style="color: #777; font-size: 0.85rem;">
                                    <i class="fas fa-calendar-day"></i> ${monthName} ${dayNum}
                                </div>
                            </div>
                            <div style="background: linear-gradient(135deg, #e3f2fd, #f3e5f5); padding: 6px 12px; border-radius: 20px; font-weight: 600; color: var(--primary); font-size: 0.8rem; text-align: right; white-space: nowrap;">
                                ${daysText}
                            </div>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            }
            
            if ((!todaysCelebrrants || todaysCelebrrants.length === 0) && (!upcomingBirthdays || upcomingBirthdays.length === 0)) {
                html = `
                    <div style="text-align: center; padding: 30px 20px; color: #999; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;">📅</div>
                        <p style="font-size: 1rem; font-weight: 500; margin: 0;">No birthdays today or upcoming within 30 days</p>
                    </div>
                `;
            }
            
            birthdayContainer.innerHTML = html;
        }

        function generateBirthdayWish(member) {
            const wishes = [
                `Wishing ${member.firstname} a blessed birthday filled with God's grace and love. Your dedication in ${member.ministry} is truly inspiring!`,
                `Happy birthday, ${member.firstname}! May God shower you with blessings and continue to guide your ministry with wisdom and strength.`,
                `Today we celebrate ${member.firstname}! Thank you for your faithful service in ${member.ministry}. Wishing you joy, health, and God's continued blessings.`,
                `${member.firstname}, on your special day, we thank God for you and your wonderful contributions to ${member.ministry}. Have a blessed birthday!`,
                `Celebrating ${member.firstname} today! May your birthday be filled with joy, surrounded by love, as you continue serving faithfully in ${member.ministry}.`,
                `Happy birthday, ${member.firstname}! Your commitment to ${member.ministry} is a blessing to all of us. Wishing you a wonderful year ahead!`,
                `On this special day, we honor ${member.firstname} for their service in ${member.ministry}. May God bless you abundantly on your birthday!`
            ];
            return wishes[Math.floor(Math.random() * wishes.length)];
        }

        function getRandomBirthdayVerse() {
            const birthdayVerses = [
                { text: 'May the Lord bless you and protect you. May the Lord smile on you and be gracious to you. May the Lord show you his favor and give you his peace.', reference: 'Numbers 6:24-26 (NCV)' },
                { text: 'The Lord is my light and my salvation—whom shall I fear? The Lord is the stronghold of my life—of whom shall I be afraid?', reference: 'Psalm 27:1 (NIV)' },
                { text: 'You, Lord, keep my lamp burning; my God turns my darkness into light.', reference: 'Psalm 18:28 (NIV)' },
                { text: 'This is the day the Lord has made; let us rejoice and be glad.', reference: 'Psalm 118:24 (NIV)' },
                { text: 'For you created my inmost being; you knit me together in my mother\'s womb. I praise you because I am fearfully and wonderfully made.', reference: 'Psalm 139:13-14 (NIV)' },
                { text: 'I have told you these things, so that in me you may have peace. In this world you will have trouble. But take heart! I have overcome the world.', reference: 'John 16:33 (NIV)' },
                { text: 'And we know that in all things God works for the good of those who love him, who have been called according to his purpose.', reference: 'Romans 8:28 (NIV)' },
                { text: 'May you be blessed by the Lord, the Maker of heaven and earth.', reference: 'Psalm 115:15 (NIV)' }
            ];
            return birthdayVerses[Math.floor(Math.random() * birthdayVerses.length)];
        }

        // Notification Functions
        let allBirthdayNotifications = [];

        function toggleNotificationModal() {
            const modal = document.getElementById('notificationModal');
            modal.classList.toggle('active');
        }

        function updateNotificationBadge(count) {
            const badge = document.getElementById('notificationBadge');
            if (count > 0) {
                badge.textContent = count;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        function populateNotificationModal(todaysCelebrrants) {
            const modalContent = document.getElementById('notificationModalContent');
            let html = '';

            if (!todaysCelebrrants || todaysCelebrrants.length === 0) {
                html = `
                    <div class="notification-no-items">
                        <div><i class="fas fa-gift"></i></div>
                        <p>No birthday notifications today. Check back tomorrow!</p>
                    </div>
                `;
            } else {
                todaysCelebrrants.forEach(member => {
                    const greeting = generateBirthdayWish(member);
                    html += `
                        <div class="notification-item">
                            <div class="notification-greeting-header">
                                <span style="font-size: 1.3rem;">🎉</span>
                                <span>${member.fullName}</span>
                            </div>
                            <div style="margin-bottom: 8px; font-size: 0.85rem; color: var(--primary); font-weight: 600;">
                                <i class="fas fa-briefcase" style="margin-right: 5px;"></i>${member.ministry || 'Ministry Member'}
                            </div>
                            <div class="notification-greeting-text">
                                "${greeting}"
                            </div>
                            <div class="notification-footer">
                                <span><i class="fas fa-calendar"></i> Today's Birthday</span>
                            </div>
                        </div>
                    `;
                });
            }

            modalContent.innerHTML = html;
        }

        function displayBirthdayGreetingsInAnnouncements(todaysCelebrrants, upcomingBirthdays) {
            const greetingsContainer = document.getElementById('birthdayGreetingsContainer');
            if (!greetingsContainer) return;

            let html = '';

            // Display today's birthday greetings
            if (todaysCelebrrants && todaysCelebrrants.length > 0) {
                todaysCelebrrants.forEach(member => {
                    const greeting = generateBirthdayWish(member);
                    html += `
                        <div class="birthday-greeting-card">
                            <div class="birthday-greeting-header-section">
                                <div class="birthday-emoji">🎂</div>
                                <div class="birthday-greeting-info">
                                    <p class="birthday-greeting-name">${member.fullName}</p>
                                    <p class="birthday-greeting-role">
                                        <i class="fas fa-users"></i> ${member.ministry || 'Ministry Member'}
                                    </p>
                                </div>
                            </div>
                            <div class="birthday-greeting-message">
                                <i class="fas fa-quote-left" style="margin-right: 5px; opacity: 0.5;"></i>${greeting}
                            </div>
                        </div>
                    `;
                });
            }

            greetingsContainer.innerHTML = html;
        }

        function displayUpcomingBirthdaysInAnnouncements(upcomingBirthdays) {
            const container = document.getElementById('upcomingBirthdaysContainer');
            if (!container) return;

            let html = '';

            if (upcomingBirthdays && upcomingBirthdays.length > 0) {
                html = `
                    <div class="upcoming-birthdays-container">
                        <div class="upcoming-birthdays-header">
                            <h3><i class="fas fa-calendar-check"></i> Upcoming Birthdays</h3>
                        </div>
                        <div class="upcoming-birthday-list">
                `;

                upcomingBirthdays.forEach(member => {
                    const monthName = new Date(member.birthdayDate).toLocaleDateString('en-US', { month: 'short' });
                    const dayNum = new Date(member.birthdayDate).getDate();
                    const daysText = member.daysUntilBirthday === 1 ? '1 day away' : 'in ' + member.daysUntilBirthday + ' days';

                    html += `
                        <div class="upcoming-birthday-row">
                            <div class="upcoming-birthday-icon">🎁</div>
                            <div class="upcoming-birthday-details">
                                <p class="upcoming-birthday-name">${member.fullName}</p>
                                <p class="upcoming-birthday-info">
                                    <i class="fas fa-calendar-day"></i> ${monthName} ${dayNum}
                                </p>
                            </div>
                            <div class="upcoming-birthday-days-badge">
                                ${daysText}
                            </div>
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        async function initializeDashboard() {
            // Initialize user data display first (before checking status from server)
            const initials = (userData.firstname.charAt(0) + userData.lastname.charAt(0)).toUpperCase();
            document.getElementById('userAvatar').textContent = initials;
            document.getElementById('userName').textContent = `${userData.firstname} ${userData.lastname}`;
            document.getElementById('userMinistry').textContent = userData.ministry;
            document.getElementById('welcomeName').textContent = userData.firstname;
            document.getElementById('firstTimeName').textContent = userData.firstname;
            document.getElementById('unverifiedName').textContent = userData.firstname;
            
            // Check if this is first login
            const loginCount = parseInt(localStorage.getItem(`loginCount_${userData.username}`) || '0');
            const isFirstLogin = loginCount === 0;
            
            // Increment login count
            localStorage.setItem(`loginCount_${userData.username}`, String(loginCount + 1));
            
            // Fetch the actual status from the server BEFORE setting up the UI
            await fetchAndSetUserStatus(isFirstLogin);
            
            // Initialize Bible verse of the day
            await updateBibleVerse({ 
                verse: 'dailyVerse',
                reference: 'verseReference',
                language: 'verseLanguage'
            });
            
            // Fetch and display birthdays
            await fetchAndDisplayBirthdays();
            
            // Initialize all sections
            initializeAllSections();
        }

        async function fetchAndSetUserStatus(isFirstLogin) {
            try {
                console.log('Fetching verification status for:', userData.username);
                
                // For demo purposes, we'll simulate a verified user
                // In a real implementation, this would call your backend API
                setTimeout(() => {
                    const serverStatus = 'verified'; // Simulated status
                    userData.status = serverStatus;
                    
                    // Save updated user data
                    sessionStorage.setItem('userData', JSON.stringify(userData));
                    localStorage.setItem('userData', JSON.stringify(userData));
                    
                    // Update UI with the correct status
                    updateUIByStatus(isFirstLogin);
                }, 500);
                
            } catch (error) {
                console.error('Error checking verification status:', error);
                userData.status = 'unverified';
                updateUIByStatus(isFirstLogin);
            }
        }

        function updateUIByStatus(isFirstLogin) {
            const status = userData.status || 'unverified';
            
            console.log('Updating UI with status:', status);
            
            // Update status indicator
            updateStatusIndicator(status);
            
            // Update verification banner
            if (status === 'verified') {
                document.getElementById('verificationBanner').style.display = 'none';
                
                // Show verified content
                document.getElementById('unverifiedContent').style.display = 'none';
                
                if (isFirstLogin) {
                    document.getElementById('firstTimeWelcomeContainer').style.display = 'block';
                    document.getElementById('regularWelcomeContainer').style.display = 'none';
                    loadWelcomeVerse(userData.ministry);
                } else {
                    document.getElementById('firstTimeWelcomeContainer').style.display = 'none';
                    document.getElementById('regularWelcomeContainer').style.display = 'block';
                    // Load daily verse from Groq API with inspiring words
                    loadDailyVerseWithGroq(userData.ministry);
                }
                
            } else {
                document.getElementById('verificationBanner').style.display = 'block';
                
                // Show unverified content
                document.getElementById('firstTimeWelcomeContainer').style.display = 'none';
                document.getElementById('regularWelcomeContainer').style.display = 'none';
                document.getElementById('unverifiedContent').style.display = 'block';
            }
            
            // Generate sidebar menu with current status
            generateSidebarMenu(userData.ministry, status);
        }

        function updateStatusIndicator(status) {
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = status === 'verified' ? 'Verified' : 'Unverified';
            const statusClass = status === 'verified' ? 'verified' : 'unverified';
            
            statusIndicator.innerHTML = `
                <div class="status-circle ${statusClass}">
                    <div class="status-tooltip">${statusText}</div>
                </div>
            `;
        }

        function generateSidebarMenu(ministry, status) {
            const sidebarMenu = document.getElementById('sidebarMenu');
            sidebarMenu.innerHTML = '';
            
            const isVerified = status === 'verified';
            const isSongLeader = userData.username && userData.username.includes('@songlead');
            
            // Add common menu items
            menuItems.common.forEach(item => {
                const menuItem = document.createElement('a');
                
                // Check if item should be disabled (only for unverified status)
                const shouldDisable = !isVerified && item.id !== 'home';
                
                menuItem.className = 'menu-item' + (item.id === 'home' ? ' active' : '');
                if (shouldDisable) {
                    menuItem.className += ' disabled';
                }
                
                menuItem.onclick = function() {
                    if (shouldDisable) {
                        showAlert('🔒 Please wait for account verification to access this feature', 'warning');
                    } else {
                        showSection(item.id);
                    }
                };
                
                menuItem.innerHTML = `
                    <span class="menu-icon"><i class="${item.icon}"></i></span>
                    <span>${item.label}</span>
                    ${shouldDisable ? '<span style="margin-left: auto; font-size: 0.7rem; color: #ffc107;"><i class="fas fa-lock"></i></span>' : ''}
                `;
                sidebarMenu.appendChild(menuItem);
            });
            
            // Add Create Lineup button for song leaders
            if (isSongLeader && isVerified) {
                const lineupItem = document.createElement('a');
                lineupItem.className = 'menu-item';
                lineupItem.onclick = function() { showSection('create-lineup'); };
                lineupItem.innerHTML = `
                    <span class="menu-icon"><i class="fas fa-plus-circle"></i></span>
                    <span>Create Lineup</span>
                `;
                sidebarMenu.appendChild(lineupItem);
            }
            
            // Add ministry-specific menu item
            if (menuItems[ministry]) {
                menuItems[ministry].forEach(item => {
                    const menuItem = document.createElement('a');
                    menuItem.className = 'menu-item' + (isVerified ? '' : ' disabled');
                    menuItem.onclick = function() {
                        if (isVerified) {
                            showSection(item.id);
                        } else {
                            showAlert('🔒 Please wait for account verification to access this feature', 'warning');
                        }
                    };
                    menuItem.innerHTML = `
                        <span class="menu-icon"><i class="${item.icon}"></i></span>
                        <span>${item.label}</span>
                        ${!isVerified ? '<span style="margin-left: auto; font-size: 0.7rem; color: #ffc107;"><i class="fas fa-lock"></i></span>' : ''}
                    `;
                    sidebarMenu.appendChild(menuItem);
                });
            }
        }

        // Load daily verse - now uses cached accurate verses
        function loadDailyVerse(ministry) {
            // This is now handled by initializeDashboard -> updateBibleVerse
            // No longer needed as verse system is unified
        }

        // Groq API configuration for daily verses and inspiring words
        const GROQ_API_KEY = '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';
        const GROQ_API_URL = 'https://api.groq.com/openai/v1/chat/completions';

        // Fetch daily verse from Groq API - LIVE AI with Context Awareness
        // **GUARANTEED FRESH VERSE EVERY DAY - NOT HARDCODED**
        async function fetchDailyVerseFromGroq() {
            try {
                // Check cache ONLY if it's the same calendar day
                const cacheKey = 'dailyVerseCache';
                const cachedData = localStorage.getItem(cacheKey);
                const today = new Date().toDateString();
                const currentHour = new Date().getHours();

                // If cache exists AND date matches AND we're not at midnight boundary, use cached
                if (cachedData) {
                    const cache = JSON.parse(cachedData);
                    // STRICT: Only use cache if exact same day AND verse exists
                    if (cache.date === today && cache.verse && cache.verse.verse) {
                        console.log('✓ Using CACHED verse from ' + cache.fetchedAt + ' (Same day)');
                        return cache.verse;
                    }
                }

                // Cache expired or doesn't match today → FETCH FRESH LIVE VERSE
                console.log('🔄 FETCHING FRESH LIVE VERSE FROM GROQ AI...');
                
                // Get user's ministry context for personalized verses
                const userMinistry = userData.ministry || 'Praise And Worship';
                const dayOfWeek = new Date().toLocaleDateString('en-US', { weekday: 'long' });
                const monthDay = new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric' });
                
                // ADVANCED PROMPT - Changes based on actual date to ensure variance
                const advancedPrompt = `TODAY IS: ${dayOfWeek}, ${monthDay} (${today})

You are a spiritual advisor providing UNIQUE daily Bible verses for ministry workers. 
This verse MUST be DIFFERENT from yesterday's verse.

CONTEXT:
- Person's Ministry: ${userMinistry}
- Day of Week: ${dayOfWeek}
- Date: ${monthDay}

GENERATE ONE FRESH Bible verse that:
1. Has NEVER been used before this date
2. Relates specifically to their ministry (${userMinistry})
3. Is perfectly encouraging for ${dayOfWeek}
4. Provides actionable inspiration for today
5. Is authentic and deeply meaningful

Format EXACTLY as: VERSE_TEXT|BOOK_CHAPTER_VERSE|PERSONAL_EXPLANATION

Be creative, authentic, and DIFFERENT. Don't repeat common verses.`;

                // Fetch BRAND NEW verse from Groq API with advanced prompting
                const response = await fetch(GROQ_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${GROQ_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'openai/gpt-oss-120b',  // Correct Groq model
                        messages: [
                            {
                                role: 'system',
                                content: 'You are a profound spiritual guide who generates UNIQUE daily Bible verses. NEVER generate the same verse twice. Be creative, authentic, and deeply inspiring. Generate real Bible verses, not made-up ones.'
                            },
                            {
                                role: 'user',
                                content: advancedPrompt
                            }
                        ],
                        temperature: 0.85,
                        max_tokens: 400
                    })
                });

                if (!response.ok) {
                    console.warn(`⚠️ Groq API returned status ${response.status}, generating new attempt...`);
                    throw new Error(`API error: ${response.statusText}`);
                }

                const data = await response.json();
                const content = data.choices[0].message.content;
                
                console.log('📖 ✨ LIVE AI GENERATED FRESH VERSE ✨');
                console.log('   ' + content.substring(0, 100) + '...');
                
                // Parse the response with better error handling
                const parts = content.split('|').map(p => p.trim());
                const verse = {
                    verse: parts[0] || 'Trust in the Lord with all your heart and lean not on your own understanding.',
                    reference: parts[1] || 'Proverbs 3:5-6',
                    explanation: parts[2] || 'Put your faith in God\'s guidance for your ministry today.',
                    isLive: true,  // Mark as live AI-generated
                    generatedDate: today,
                    generatedTime: new Date().toLocaleTimeString(),
                    isNew: true  // This is a NEW verse generated today
                };

                // Cache the verse with strict date validation
                const cacheData = {
                    date: today,
                    verse: verse,
                    fetchedAt: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' }),
                    ministry: userMinistry,
                    dayOfWeek: dayOfWeek,
                    expiresAt: new Date(new Date().getTime() + 24 * 60 * 60 * 1000).toDateString()  // Expires tomorrow
                };
                
                localStorage.setItem(cacheKey, JSON.stringify(cacheData));
                
                console.log('✅ FRESH VERSE CACHED (Expires tomorrow at midnight)');
                return verse;
            } catch (error) {
                console.error('❌ Error fetching live verse from Groq:', error);
                // Return fallback verse on error
                return {
                    verse: 'For we are God\'s handiwork, created in Christ Jesus to do good works, which God prepared in advance for us to do.',
                    reference: 'Ephesians 2:10',
                    explanation: 'You are uniquely created and equipped for your ministry role. God has prepared good works specifically for you to accomplish through your service.',
                    isLive: false
                };
            }
        }

        // Fetch inspiring words from Groq API - LIVE Dynamic AI
        // **GUARANTEED FRESH AFFIRMATIONS EVERY DAY - NOT HARDCODED**
        async function fetchInspiringWords() {
            try {
                // Check cache ONLY if it's the same calendar day
                const cacheKey = 'inspiringWordsCache';
                const cachedData = localStorage.getItem(cacheKey);
                const today = new Date().toDateString();

                if (cachedData) {
                    const cache = JSON.parse(cachedData);
                    // STRICT: Only use cache if exact same day AND words exist
                    if (cache.date === today && cache.words && cache.words.length > 0) {
                        console.log('✓ Using CACHED affirmations from ' + cache.generatedAt + ' (Same day)');
                        return cache.words;
                    }
                }

                // Cache expired or doesn't match today → FETCH FRESH LIVE WORDS
                console.log('🔄 GENERATING FRESH LIVE AFFIRMATIONS WITH AI...');

                // Get current time for time-based personalization
                const hour = new Date().getHours();
                let timePhrase = 'this morning';
                if (hour >= 12 && hour < 17) timePhrase = 'this afternoon';
                if (hour >= 17) timePhrase = 'this evening';

                const dayOfWeek = new Date().toLocaleDateString('en-US', { weekday: 'long' });
                const monthDay = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

                // DYNAMIC AI PROMPT - Includes actual date to ensure variance
                const dynamicPrompt = `TODAY IS: ${dayOfWeek}, ${monthDay} (${today})
TIME OF DAY: ${timePhrase}

You are an inspiring life coach specializing in Christian ministry encouragement.

GENERATE 5 BRAND NEW, UNIQUE affirmations for ${userData.ministry || 'a ministry worker'} ${timePhrase}.

IMPORTANT: These affirmations MUST:
1. Be COMPLETELY NEW (never used before)
2. Be DIFFERENT from typical generic quotes
3. Be SHORT (max 15 words each)
4. Be ACTIONABLE and encouraging  
5. Relate specifically to serving in ministry
6. Sound genuine, not generic or robotic
7. Vary in style and approach

Format: AFFIRMATION_1|AFFIRMATION_2|AFFIRMATION_3|AFFIRMATION_4|AFFIRMATION_5

Create fresh, authentic affirmations that will actually inspire this ministry worker TODAY.`;

                // Fetch BRAND NEW words from Groq API
                const response = await fetch(GROQ_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${GROQ_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'openai/gpt-oss-120b',  // Correct Groq model
                        messages: [
                            {
                                role: 'system',
                                content: 'You are an inspiring life coach specializing in Christian ministry encouragement. Generate UNIQUE, fresh affirmations that energize ministry workers. NEVER generate the same affirmations twice. Be creative, specific, and deeply meaningful.'
                            },
                            {
                                role: 'user',
                                content: dynamicPrompt
                            }
                        ],
                        temperature: 0.85,
                        max_tokens: 350
                    })
                });

                if (!response.ok) {
                    console.warn(`⚠️ Groq API returned status ${response.status}`);
                    throw new Error(`API error: ${response.statusText}`);
                }

                const data = await response.json();
                const content = data.choices[0].message.content;
                
                // Parse and clean the response
                const words = content
                    .split('|')
                    .map(w => w.trim())
                    .filter(w => w.length > 0 && !w.startsWith('Example') && !w.includes('AFFIRMATION') && !w.toLowerCase().includes('format'))
                    .slice(0, 5);  // Get max 5 words

                if (words.length === 0) {
                    throw new Error('No words parsed from response');
                }

                console.log(`💫 ✨ LIVE AI GENERATED ${words.length} FRESH AFFIRMATIONS ✨`);
                words.forEach((w, i) => console.log(`   ${i+1}. ${w}`));

                // Cache the words with strict date validation
                const cacheData = {
                    date: today,
                    words: words,
                    generatedAt: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' }),
                    timeOfDay: timePhrase,
                    dayOfWeek: dayOfWeek,
                    expiresAt: new Date(new Date().getTime() + 24 * 60 * 60 * 1000).toDateString()  // Expires tomorrow
                };
                
                localStorage.setItem(cacheKey, JSON.stringify(cacheData));

                console.log('✅ FRESH AFFIRMATIONS CACHED (Expires tomorrow at midnight)');
                return words;
            } catch (error) {
                console.error('❌ Error fetching inspiring words from Groq:', error);
                // Return fallback words on error
                return [
                    '🌟 Your service matters and transforms lives.',
                    '✨ God is working through you right now.',
                    '💪 Every moment of faithfulness counts forever.',
                    '🙏 You are exactly where God needs you.',
                    '⚡ Your anointing makes ordinary things extraordinary.'
                ];
            }
        }

        // Load daily verse with Groq API - now uses unified updateBibleVerse system
        async function loadDailyVerseWithGroq(ministry) {
            // Verse display is now handled by unified updateBibleVerse() function
            // which supports all versions and languages automatically
            // This function is kept for backward compatibility but does nothing
        }

        // Display rotating inspiring words with LIVE AI indicator
        async function displayInspiringWords() {
            const container = document.getElementById('dailyVerse').parentElement;
            
            // Check if inspiring words container already exists
            let inspiringWordsDiv = document.getElementById('inspiringWordsSection');
            if (!inspiringWordsDiv) {
                inspiringWordsDiv = document.createElement('div');
                inspiringWordsDiv.id = 'inspiringWordsSection';
                inspiringWordsDiv.className = 'inspiring-words-section';
                container.appendChild(inspiringWordsDiv);
            }

            // Show loading state while fetching
            inspiringWordsDiv.innerHTML = '<span style="opacity: 0.6;">✨ Loading live affirmations...</span>';
            inspiringWordsDiv.style.minHeight = '30px';

            const words = await fetchInspiringWords();
            
            // Display rotating words (change every 6 seconds with smooth transition)
            let currentWordIndex = 0;
            
            function rotateWords() {
                if (words.length > 0) {
                    // Add fade animation
                    inspiringWordsDiv.style.opacity = '0.5';
                    setTimeout(() => {
                        inspiringWordsDiv.textContent = `✨ ${words[currentWordIndex]}`;
                        inspiringWordsDiv.style.opacity = '1';
                        currentWordIndex = (currentWordIndex + 1) % words.length;
                    }, 200);
                }
            }

            // Show first word immediately
            inspiringWordsDiv.textContent = `✨ ${words[0]}`;
            inspiringWordsDiv.style.opacity = '1';
            currentWordIndex = 1;
            
            // Rotate every 6 seconds
            const rotationInterval = setInterval(() => {
                rotateWords();
            }, 6000);

            // Add indicator badge showing it's live AI
            const liveIndicator = document.createElement('span');
            liveIndicator.style.cssText = `
                font-size: 0.65rem;
                margin-left: 8px;
                padding: 2px 6px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 3px;
                vertical-align: super;
                animation: pulse 2s infinite;
            `;
            liveIndicator.textContent = '● LIVE AI';
            
            // Only add if not already present
            if (!inspiringWordsDiv.querySelector('[style*="LIVE AI"]')) {
                inspiringWordsDiv.appendChild(liveIndicator);
            }

            // Store interval ID for cleanup if needed
            inspiringWordsDiv.dataset.rotationInterval = rotationInterval;
        }

        function loadWelcomeVerse(ministry) {
            // For first-time users, the verse is now loaded via the unified updateBibleVerse system
            // which is called in initializeDashboard for both welcome and daily verses
            // This function is kept for backward compatibility but does nothing
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        // Close notification modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('notificationModal');
            const btn = document.querySelector('.notification-btn');
            
            if (modal && btn && !modal.contains(event.target) && !btn.contains(event.target)) {
                modal.classList.remove('active');
            }
        });

        function showSection(sectionId) {
        // Remove active class from all menu items and sections
        document.querySelectorAll('.menu-item').forEach(item => {
            item.classList.remove('active');
        });
        document.querySelectorAll('.content-section').forEach(section => {
            section.classList.remove('active');
        });

        // Add active class to clicked menu item
        const menuItem = event.target.closest('.menu-item');
        if (menuItem) {
            menuItem.classList.add('active');
        }

        // Show selected section
        const section = document.getElementById(sectionId);
        if (section) {
            section.classList.add('active');
        }

        // Update page title
        const titles = {
            'home': 'Welcome to Your Ministry Portal',
            'weekly-schedule': 'Weekly Schedule',
            'attendance': 'Attendance Record',
            'announcements': 'Announcements',
            'spiritual-assistant': 'Spiritual Assistant - Ask Your Questions',
            'praise-worship': 'Praise And Worship',
            'media': 'Media Ministry',
            'dancers': 'Dancers Ministry',
            'ashers': 'Ashers Ministry',
            'create-lineup': 'Create Worship Lineup',
            'my-profile': 'My Profile'
        };
        document.getElementById('pageTitle').textContent = titles[sectionId] || 'Ministry Portal';

        // Update page subtitle
        const subtitle = document.getElementById('pageSubtitle');
        if (sectionId === 'home') {
            subtitle.textContent = 'Stay connected and inspired in your service';
            // Display birthday celebrants when home section is shown
            setTimeout(() => {
                displayBirthdayTodaySection();
            }, 100);
        } else if (sectionId === 'my-profile') {
            subtitle.textContent = 'Manage your personal information and account settings';
            setTimeout(initializePasswordValidation, 100);
        } else if (sectionId === 'spiritual-assistant') {
            subtitle.textContent = 'Get Bible-grounded guidance and spiritual wisdom';
            // Personalize greeting with user's name
            setTimeout(() => {
                personalizeGreeting();
            }, 100);
        } else if (sectionId === 'create-lineup') {
            subtitle.textContent = 'Create and submit worship lineups for approval';
            // Initialize Create Lineup section (your existing function)
            setTimeout(() => {
                initializeCreateLineup();
            }, 100);
        } else if (sectionId === 'weekly-schedule') {
            subtitle.textContent = 'View and manage your weekly ministry schedule';
            // Initialize Weekly Schedule calendar (separate from Create Lineup)
            setTimeout(() => {
                initializeScheduleCalendar();
            }, 100);
        } else {
            subtitle.textContent = 'Features Coming Soon - Please wait for Developer Frank Gomez';
        }

        // Load profile data when profile section is shown
        if (sectionId === 'my-profile') {
            loadProfileData();
        }

        // Close sidebar on mobile
        if (window.innerWidth <= 768) {
            toggleSidebar();
        }
    }

        function showAlert(message, type) {
            // Create alert element
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1002;
                max-width: 400px;
                animation: slideInRight 0.5s ease;
                background: ${type === 'success' ? '#28a745' : type === 'warning' ? '#ffc107' : '#dc3545'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                font-weight: 500;
            `;
            alert.textContent = message;
            
            // Add styles for slideInRight animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(alert);
            
            // Remove alert after 5 seconds
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Make sure the modal functions are properly defined
        function showLogoutModal() {
            document.getElementById('logoutModal').style.display = 'block';
        }

        function closeLogoutModal() {
            document.getElementById('logoutModal').style.display = 'none';
        }

        function confirmLogout() {
            // Perform logout
            sessionStorage.removeItem('userData');
            localStorage.removeItem('userData');
            window.location.href = 'login.html';
        }


        let calendarDate = new Date();
        let selectedDate = null;
        let existingScheduleData = [];

        // Initialize the calendar when the create lineup section is shown
        function initializeCreateLineup() {
            // Initialize date restrictions
            const today = new Date();
            const practiceDate = document.getElementById('practiceDate');
            
            // Set min date to today for practice field
            const minDate = today.toISOString().split('T')[0];
            practiceDate.min = minDate;
            
            // Initialize backup options and remove buttons
            updateBackupOptions();
            updateBackupRemoveButtons();
            
            // Add event listeners for YouTube preview
            document.addEventListener('input', function(e) {
                if (e.target.classList.contains('slow-link') || e.target.classList.contains('fast-link')) {
                    handleYouTubePreview(e.target);
                }
            });
            
            // Load existing schedule data
            loadExistingScheduleData();
        }

        // Load existing schedule data to prevent conflicts
        async function loadExistingScheduleData() {
            try {
                showLoading('Loading schedule data...');
                
                // Fetch schedule data from Google Sheets using POST
                const response = await fetch(`${API_BASE_URL}/proxy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'getScheduleData'
                    })
                });
                
                const result = await response.json();
                
                hideLoading();
                
                if (result.success) {
                    existingScheduleData = cleanScheduleData(result.data || []);
                    console.log('Loaded existing schedule data:', existingScheduleData);
                    
                    // Show success message
                    if (existingScheduleData.length > 0) {
                        console.log(`Found ${existingScheduleData.length} existing schedules`);
                    }
                } else {
                    console.error('Failed to load existing schedule data:', result.message);
                    showAlert('Failed to load schedule data. Please refresh the page.', 'warning');
                }
            } catch (error) {
                hideLoading();
                console.error('Error loading existing schedule data:', error);
                showAlert('Error loading schedule data. Please check your connection.', 'danger');
            }
        }

        // Open calendar modal
        function openCalendarModal() {
            document.getElementById('calendarModal').style.display = 'block';
            generateDateSelectionCalendar(calendarDate);
        }

        // Generate calendar for date selection
        function generateDateSelectionCalendar(date) {
            const calendarContainer = document.getElementById('dateSelectionCalendar');
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];
            
            // Update month header
            document.getElementById('calendarCurrentMonth').textContent = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;
            
            // Get first day of month and number of days
            const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
            const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay(); // 0 = Sunday, 1 = Monday, etc.
            
            // Get today's date
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Create calendar header
            let calendarHTML = `
                <div class="calendar-header">
                    <div class="calendar-day-header">Sun</div>
                    <div class="calendar-day-header">Mon</div>
                    <div class="calendar-day-header">Tue</div>
                    <div class="calendar-day-header">Wed</div>
                    <div class="calendar-day-header">Thu</div>
                    <div class="calendar-day-header">Fri</div>
                    <div class="calendar-day-header">Sat</div>
                </div>
                <div class="calendar-grid">
            `;
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                const prevMonth = new Date(date.getFullYear(), date.getMonth(), 0 - i);
                calendarHTML += `
                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">${prevMonth.getDate()}</div>
                    </div>
                `;
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const currentDay = new Date(date.getFullYear(), date.getMonth(), day);
                const dateString = formatDateForAPI(currentDay);
                const hasSchedule = checkIfDateHasSchedule(dateString);
                const isPast = currentDay < today;
                const isSelected = selectedDate && selectedDate.getTime() === currentDay.getTime();
                
                let dayClass = 'calendar-day';
                if (isSelected) dayClass += ' selected';
                if (hasSchedule) dayClass += ' has-schedule';
                if (isPast) dayClass += ' disabled';
                
                let onClickAction = '';
                if (hasSchedule) {
                    onClickAction = `showExistingSchedule('${dateString}')`;
                } else if (!isPast) {
                    onClickAction = `selectDate('${dateString}')`;
                }
                
                calendarHTML += `
                    <div class="${dayClass}" onclick="${onClickAction}">
                        <div class="calendar-day-number">${day}</div>
                        ${hasSchedule ? '<div class="calendar-day-events">Booked</div>' : ''}
                    </div>
                `;
            }
            
            // Calculate how many empty cells we need at the end
            const totalCells = 42; // 6 rows x 7 days
            const remainingCells = totalCells - (startingDay + daysInMonth);
            
            // Add empty cells for days after the last day of the month
            for (let i = 1; i <= remainingCells; i++) {
                calendarHTML += `
                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">${i}</div>
                    </div>
                `;
            }
            
            calendarHTML += `</div>`;
            calendarContainer.innerHTML = calendarHTML;
        }

        // Change calendar month
        function changeCalendarMonth(direction) {
            calendarDate.setMonth(calendarDate.getMonth() + direction);
            generateDateSelectionCalendar(calendarDate);
        }

        // Select a date
        function selectDate(dateString) {
            selectedDate = new Date(dateString);
            
            // Update UI to show selected date
            const allDays = document.querySelectorAll('#dateSelectionCalendar .calendar-day');
            allDays.forEach(day => {
                day.classList.remove('selected');
            });
            
            // Find and highlight the selected day
            const selectedDayElement = Array.from(allDays).find(day => {
                const dayNumber = day.querySelector('.calendar-day-number').textContent;
                const currentDate = new Date(calendarDate.getFullYear(), calendarDate.getMonth(), parseInt(dayNumber));
                return currentDate.getTime() === selectedDate.getTime();
            });
            
            if (selectedDayElement) {
                selectedDayElement.classList.add('selected');
            }
            
            // Enable confirm button
            document.getElementById('confirmDateBtn').disabled = false;
        }


        // Show existing schedule details
        function showExistingSchedule(dateString) {
            const schedule = getScheduleForDate(dateString);
            
            if (schedule) {
                // Update schedule details
                document.getElementById('existingSongLeader').textContent = schedule.songLeader || '-';
                
                // Format backup singers
                const backupSingers = schedule.backups && schedule.backups.length > 0 ? 
                    schedule.backups.filter(b => b && b.trim() !== '').join(', ') : 'None';
                document.getElementById('existingBackupSingers').textContent = backupSingers;
                
                // Show schedule details
                document.getElementById('scheduleDetails').classList.add('active');
                
                // Scroll to schedule details
                document.getElementById('scheduleDetails').scrollIntoView({ behavior: 'smooth' });
                
                // Show alert
                showAlert(`This date is already booked by ${schedule.songLeader}. Please select a different date.`, 'warning');
            }
            
            // Close calendar modal
            closeCalendarModal();
        }

        // Confirm date selection
        function confirmDateSelection() {
            if (selectedDate) {
                // Format date as YYYY-MM-DD
                const year = selectedDate.getFullYear();
                const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
                const day = String(selectedDate.getDate()).padStart(2, '0');
                const formattedDate = `${year}-${month}-${day}`;
                
                // Update schedule date field
                document.getElementById('scheduleDate').value = formattedDate;
                
                // Hide schedule details if shown
                document.getElementById('scheduleDetails').classList.remove('active');
                
                // Close calendar modal
                closeCalendarModal();
                
                showAlert('Date selected successfully', 'success');
            }
        }




        function updateBackupOptions() {
            const usedBackups = new Set();
            const backupSelects = document.querySelectorAll('.backup-select');
            
            // Get all currently selected values
            backupSelects.forEach(select => {
                if (select.value) {
                    usedBackups.add(select.value);
                }
            });
            
            // Update options for each select
            backupSelects.forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '<option value="">Select Backup ' + (Array.from(select.parentNode.parentNode.parentNode.children).indexOf(select.parentNode) + 1) + '</option>';
                
                backupOptions.forEach(option => {
                    if (!usedBackups.has(option) || option === currentValue) {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.textContent = option;
                        select.appendChild(optionElement);
                    }
                });
                
                // Restore current value
                if (currentValue) {
                    select.value = currentValue;
                }
            });
            
            // Update add backup button state
            const addBackupBtn = document.getElementById('addBackupBtn');
            addBackupBtn.disabled = backupCount >= 5;
        }

        // Updated addBackupField function with close button
        function addBackupField() {
            if (backupCount >= 5) return;
            
            backupCount++;
            const backupContainer = document.getElementById('backupContainer');
            const backupRow = document.createElement('div');
            backupRow.className = 'backup-row';
            backupRow.innerHTML = `
                <select class="form-control backup-select" onchange="updateBackupOptions()">
                    <option value="">Select Backup ${backupCount}</option>
                </select>
                <button type="button" class="btn-remove-backup" onclick="removeBackupField(this)">
                    <i class="fas fa-times"></i>
                </button>
            `;
            backupContainer.appendChild(backupRow);
            
            // Enable remove buttons for all backup rows except the first one
            updateBackupRemoveButtons();
            updateBackupOptions();
        }

        // Updated removeBackupField function
        function removeBackupField(button) {
            const backupRow = button.parentNode;
            backupRow.remove();
            backupCount--;
            
            // Update backup numbers and remove button states
            updateBackupNumbers();
            updateBackupRemoveButtons();
            updateBackupOptions();
        }

        // Function to update backup numbers after removal
        function updateBackupNumbers() {
            const backupRows = document.querySelectorAll('.backup-row');
            backupRows.forEach((row, index) => {
                const select = row.querySelector('.backup-select');
                const placeholder = select.querySelector('option[value=""]');
                if (placeholder) {
                    placeholder.textContent = `Select Backup ${index + 1}`;
                }
            });
        }

        // Function to update remove button states
        function updateBackupRemoveButtons() {
            const removeButtons = document.querySelectorAll('.btn-remove-backup');
            const backupRows = document.querySelectorAll('.backup-row');
            
            // Disable remove button for the first backup row if there's only one
            if (backupRows.length === 1) {
                removeButtons[0].disabled = true;
            } else {
                removeButtons.forEach(button => {
                    button.disabled = false;
                });
            }
        }


        function addSlowSong() {
            if (slowSongCount >= 5) return;
            
            slowSongCount++;
            const slowContainer = document.getElementById('slowSongsContainer');
            const songRow = document.createElement('div');
            songRow.className = 'song-row slow-song';
            songRow.innerHTML = `
                <div class="form-group">
                    <label>Slow Song ${slowSongCount} Title</label>
                    <input type="text" class="form-control slow-title" placeholder="Enter song title (optional)">
                </div>
                <div class="form-group">
                    <label>YouTube Link</label>
                    <input type="url" class="form-control slow-link" placeholder="https://www.youtube.com/watch?v=... (optional)">
                    <div class="youtube-preview"></div>
                </div>
                <div class="form-group">
                    <label>Lyrics (Optional)</label>
                    <textarea class="form-control slow-lyrics" placeholder="Enter song lyrics..."></textarea>
                </div>
                <div class="form-group">
                    <label>Instructions (Optional)</label>
                    <textarea class="form-control slow-instructions" placeholder="Any special instructions..."></textarea>
                </div>
                ${slowSongCount > 1 ? `
                <button type="button" class="btn-danger" onclick="removeSongRow(this, 'slow')" style="margin-top: 10px; padding: 8px 15px; background: var(--danger); color: white; border: none; border-radius: 4px; cursor: pointer;">
                    <i class="fas fa-trash"></i> Remove Song
                </button>
                ` : ''}
            `;
            slowContainer.appendChild(songRow);
            
            // Update add button state
            document.getElementById('addSlowSongBtn').disabled = slowSongCount >= 5;
        }

        function addFastSong() {
            if (fastSongCount >= 5) return;
            
            fastSongCount++;
            const fastContainer = document.getElementById('fastSongsContainer');
            const songRow = document.createElement('div');
            songRow.className = 'song-row fast-song';
            songRow.innerHTML = `
                <div class="form-group">
                    <label>Fast Song ${fastSongCount} Title</label>
                    <input type="text" class="form-control fast-title" placeholder="Enter song title (optional)">
                </div>
                <div class="form-group">
                    <label>YouTube Link</label>
                    <input type="url" class="form-control fast-link" placeholder="https://www.youtube.com/watch?v=... (optional)">
                    <div class="youtube-preview"></div>
                </div>
                <div class="form-group">
                    <label>Lyrics (Optional)</label>
                    <textarea class="form-control fast-lyrics" placeholder="Enter song lyrics..."></textarea>
                </div>
                <div class="form-group">
                    <label>Instructions (Optional)</label>
                    <textarea class="form-control fast-instructions" placeholder="Any special instructions..."></textarea>
                </div>
                ${fastSongCount > 1 ? `
                <button type="button" class="btn-danger" onclick="removeSongRow(this, 'fast')" style="margin-top: 10px; padding: 8px 15px; background: var(--danger); color: white; border: none; border-radius: 4px; cursor: pointer;">
                    <i class="fas fa-trash"></i> Remove Song
                </button>
                ` : ''}
            `;
            fastContainer.appendChild(songRow);
            
            // Update add button state
            document.getElementById('addFastSongBtn').disabled = fastSongCount >= 5;
        }

        function removeSongRow(button, type) {
            const songRow = button.closest('.song-row');
            songRow.remove();
            
            if (type === 'slow') {
                slowSongCount--;
                document.getElementById('addSlowSongBtn').disabled = slowSongCount >= 5;
                renumberSlowSongs();
            } else {
                fastSongCount--;
                document.getElementById('addFastSongBtn').disabled = fastSongCount >= 5;
                renumberFastSongs();
            }
        }

        function renumberSlowSongs() {
            const slowSongs = document.querySelectorAll('.slow-song');
            slowSongs.forEach((song, index) => {
                const titleLabel = song.querySelector('label');
                titleLabel.textContent = `Slow Song ${index + 1} Title`;
            });
        }

        function renumberFastSongs() {
            const fastSongs = document.querySelectorAll('.fast-song');
            fastSongs.forEach((song, index) => {
                const titleLabel = song.querySelector('label');
                titleLabel.textContent = `Fast Song ${index + 1} Title`;
            });
        }

        function handleYouTubePreview(input) {
            const previewContainer = input.parentNode.querySelector('.youtube-preview');
            const url = input.value.trim();
            
            if (!url) {
                previewContainer.style.display = 'none';
                previewContainer.innerHTML = '';
                return;
            }
            
            // Extract YouTube video ID
            const videoId = extractYouTubeId(url);
            if (videoId) {
                previewContainer.innerHTML = `
                    <iframe src="https://www.youtube.com/embed/${videoId}" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                    </iframe>
                `;
                previewContainer.style.display = 'block';
            } else {
                previewContainer.style.display = 'none';
                previewContainer.innerHTML = '<p style="color: var(--danger); font-size: 0.9rem;">Invalid YouTube URL</p>';
            }
        }

        function extractYouTubeId(url) {
            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[7].length === 11) ? match[7] : false;
        }

        function validatePracticeDate(date) {
            const practiceDate = new Date(date);
            const dayOfWeek = practiceDate.getDay();
            // 0 = Sunday, 6 = Saturday
            return dayOfWeek === 0 || dayOfWeek === 6;
        }

        function resetLineupForm() {
            if (confirm('Are you sure you want to reset the form? All entered data will be lost.')) {
                // Reset counters
                backupCount = 1;
                slowSongCount = 1;
                fastSongCount = 1;
                
                // Reset form elements
                document.getElementById('scheduleDate').value = '';
                document.getElementById('practiceDate').value = '';
                document.getElementById('songLeader').value = '';
                
                // Reset backup container
                document.getElementById('backupContainer').innerHTML = `
                    <div class="backup-row">
                        <select class="form-control backup-select" onchange="updateBackupOptions()">
                            <option value="">Select Backup 1</option>
                        </select>
                    </div>
                `;
                
                // Reset song containers
                document.getElementById('slowSongsContainer').innerHTML = `
                    <div class="song-row slow-song">
                        <div class="form-group">
                            <label>Slow Song 1 Title</label>
                            <input type="text" class="form-control slow-title" placeholder="Enter song title (optional)">
                        </div>
                        <div class="form-group">
                            <label>YouTube Link</label>
                            <input type="url" class="form-control slow-link" placeholder="https://www.youtube.com/watch?v=... (optional)">
                            <div class="youtube-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Lyrics (Optional)</label>
                            <textarea class="form-control slow-lyrics" placeholder="Enter song lyrics..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Instructions (Optional)</label>
                            <textarea class="form-control slow-instructions" placeholder="Any special instructions..."></textarea>
                        </div>
                    </div>
                `;

                document.getElementById('fastSongsContainer').innerHTML = `
                    <div class="song-row fast-song">
                        <div class="form-group">
                            <label>Fast Song 1 Title</label>
                            <input type="text" class="form-control fast-title" placeholder="Enter song title (optional)">
                        </div>
                        <div class="form-group">
                            <label>YouTube Link</label>
                            <input type="url" class="form-control fast-link" placeholder="https://www.youtube.com/watch?v=... (optional)">
                            <div class="youtube-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Lyrics (Optional)</label>
                            <textarea class="form-control fast-lyrics" placeholder="Enter song lyrics..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Instructions (Optional)</label>
                            <textarea class="form-control fast-instructions" placeholder="Any special instructions..."></textarea>
                        </div>
                    </div>
                `;
                
                // Reset button states
                document.getElementById('addBackupBtn').disabled = false;
                document.getElementById('addSlowSongBtn').disabled = false;
                document.getElementById('addFastSongBtn').disabled = false;
                
                // Reinitialize
                updateBackupOptions();
                
                showAlert('Form reset successfully', 'success');
            }
        }

        async function submitLineup() {
            // Validate required fields
            const scheduleDate = document.getElementById('scheduleDate').value;
            const practiceDate = document.getElementById('practiceDate').value;
            const songLeader = document.getElementById('songLeader').value;
            
            if (!scheduleDate || !practiceDate || !songLeader) {
                showAlert('Please fill in all required fields (Schedule Date, Practice Date, and Song Leader)', 'warning');
                return;
            }

            //Check if selected date is already booked
            if (checkIfDateHasSchedule(scheduleDate)) {
                showAlert('The selected schedule date is already booked. Please choose a different date.', 'danger');
                return;
            }
            
            // Validate practice date is Saturday or Sunday
            if (!validatePracticeDate(practiceDate)) {
                showAlert('Practice day must be on a Saturday or Sunday', 'warning');
                return;
            }
            
            // Get all songs
            const slowSongs = document.querySelectorAll('.slow-song');
            const fastSongs = document.querySelectorAll('.fast-song');
            
            // Validate at least one song (either slow or fast) is added
            let hasSlowSongs = false;
            let hasFastSongs = false;
            
            slowSongs.forEach(song => {
                const title = song.querySelector('.slow-title').value.trim();
                const link = song.querySelector('.slow-link').value.trim();
                if (title && link) {
                    hasSlowSongs = true;
                }
            });
            
            fastSongs.forEach(song => {
                const title = song.querySelector('.fast-title').value.trim();
                const link = song.querySelector('.fast-link').value.trim();
                if (title && link) {
                    hasFastSongs = true;
                }
            });
            
            if (!hasSlowSongs && !hasFastSongs) {
                showAlert('Please add at least one song (either slow or fast)', 'warning');
                return;
            }
            
            // Validate that for each song added, both title and link are provided
            let valid = true;
            slowSongs.forEach((song, index) => {
                const title = song.querySelector('.slow-title').value.trim();
                const link = song.querySelector('.slow-link').value.trim();
                // Only validate if at least one field is filled
                if (title || link) {
                    if (!title || !link) {
                        showAlert(`Please fill in both title and YouTube link for Slow Song ${index + 1}, or remove the song`, 'warning');
                        valid = false;
                    }
                }
            });
            
            fastSongs.forEach((song, index) => {
                const title = song.querySelector('.fast-title').value.trim();
                const link = song.querySelector('.fast-link').value.trim();
                // Only validate if at least one field is filled
                if (title || link) {
                    if (!title || !link) {
                        showAlert(`Please fill in both title and YouTube link for Fast Song ${index + 1}, or remove the song`, 'warning');
                        valid = false;
                    }
                }
            });
            
            if (!valid) return;
            
            // Prepare data for submission
            const lineupData = {
                scheduleDate: scheduleDate,
                practiceDate: practiceDate,
                songLeader: songLeader,
                backups: [],
                slowSongs: [],
                fastSongs: [],
                submittedBy: userData.username,
                status: 'For Approval'
            };
            
            // Get backup singers
            const backupSelects = document.querySelectorAll('.backup-select');
            backupSelects.forEach(select => {
                if (select.value) {
                    lineupData.backups.push(select.value);
                }
            });
            
            // Get slow songs - only include songs that have both title and link
            slowSongs.forEach((song, index) => {
                const title = song.querySelector('.slow-title').value.trim();
                const link = song.querySelector('.slow-link').value.trim();
                const lyrics = song.querySelector('.slow-lyrics').value.trim();
                const instructions = song.querySelector('.slow-instructions').value.trim();
                
                // Only include song if both title and link are provided
                if (title && link) {
                    lineupData.slowSongs.push({
                        title: title,
                        link: link,
                        lyrics: lyrics,
                        instructions: instructions
                    });
                } else {
                    // Add empty object for unused song slot to maintain order
                    lineupData.slowSongs.push({});
                }
            });
            
            // Get fast songs - only include songs that have both title and link
            fastSongs.forEach((song, index) => {
                const title = song.querySelector('.fast-title').value.trim();
                const link = song.querySelector('.fast-link').value.trim();
                const lyrics = song.querySelector('.fast-lyrics').value.trim();
                const instructions = song.querySelector('.fast-instructions').value.trim();
                
                // Only include song if both title and link are provided
                if (title && link) {
                    lineupData.fastSongs.push({
                        title: title,
                        link: link,
                        lyrics: lyrics,
                        instructions: instructions
                    });
                } else {
                    // Add empty object for unused song slot to maintain order
                    lineupData.fastSongs.push({});
                }
            });
            
             // Show loading state
            const submitBtn = document.getElementById('submitLineupBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
            submitBtn.disabled = true;
            
            try {
                // Submit to Google Apps Script
                const response = await fetch(`${API_BASE_URL}/proxy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'createLineup',
                        lineupData: lineupData
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Add the new schedule to existing data to prevent immediate duplicate
                    const newSchedule = {
                        scheduleId: result.data.scheduleId,
                        songLeader: lineupData.songLeader,
                        backups: lineupData.backups,
                        practiceDate: lineupData.practiceDate,
                        scheduleDate: lineupData.scheduleDate,
                        slowSongs: lineupData.slowSongs.filter(song => song.title),
                        fastSongs: lineupData.fastSongs.filter(song => song.title)
                    };
                    existingScheduleData.push(newSchedule);
                    
                    showReceipt(lineupData, result.data.scheduleId);
                    showAlert('Lineup submitted successfully for approval!', 'success');
                } else {
                    showAlert(result.message || 'Failed to submit lineup', 'danger');
                }
                
            } catch (error) {
                console.error('Error submitting lineup:', error);
                showAlert('Error submitting lineup. Please try again.', 'danger');
            } finally {
                // Restore button state
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        // These functions are called but not defined:
        function closeCalendarModal() {
            document.getElementById('calendarModal').style.display = 'none';
        }
        // Receipt Functions
        function showReceipt(lineupData, scheduleId) {
            // Populate receipt data
            document.getElementById('receiptScheduleDate').textContent = formatDate(lineupData.scheduleDate);
            document.getElementById('receiptPracticeDate').textContent = formatDate(lineupData.practiceDate);
            document.getElementById('receiptSongLeader').textContent = lineupData.songLeader;
            
            // Populate backup singers
            const backupList = document.getElementById('receiptBackupList');
            const backupCount = document.getElementById('receiptBackupCount');
            
            if (lineupData.backups && lineupData.backups.length > 0) {
                backupCount.textContent = lineupData.backups.length;
                backupList.innerHTML = lineupData.backups.map(backup => 
                    `<div class="receipt-list-item">
                        <div class="receipt-number" style="background: var(--secondary);">✓</div>
                        <div class="receipt-song-title">${backup}</div>
                    </div>`
                ).join('');
            } else {
                backupCount.textContent = '0';
                backupList.innerHTML = '<div style="color: #6c757d; font-style: italic;">No backup singers selected</div>';
            }
            
            // Populate fast songs
            const fastSongsList = document.getElementById('receiptFastSongs');
            const validFastSongs = lineupData.fastSongs.filter(song => song.title && song.title.trim() !== '');
            
            if (validFastSongs.length > 0) {
                fastSongsList.innerHTML = validFastSongs.map((song, index) => `
                    <li class="receipt-list-item">
                        <div class="receipt-number">${index + 1}</div>
                        <div class="receipt-song-title">${song.title}</div>
                    </li>
                `).join('');
            } else {
                fastSongsList.innerHTML = '<div style="color: #6c757d; font-style: italic; padding: 10px;">No fast songs added</div>';
            }
            
            // Populate slow songs
            const slowSongsList = document.getElementById('receiptSlowSongs');
            const validSlowSongs = lineupData.slowSongs.filter(song => song.title && song.title.trim() !== '');
            
            if (validSlowSongs.length > 0) {
                slowSongsList.innerHTML = validSlowSongs.map((song, index) => `
                    <li class="receipt-list-item">
                        <div class="receipt-number">${index + 1}</div>
                        <div class="receipt-song-title">${song.title}</div>
                    </li>
                `).join('');
            } else {
                slowSongsList.innerHTML = '<div style="color: #6c757d; font-style: italic; padding: 10px;">No slow songs added</div>';
            }
            
            // Show the receipt modal
            document.getElementById('receiptModal').style.display = 'block';
            
            // Store the lineup data for editing
            window.currentLineupData = lineupData;
            window.currentScheduleId = scheduleId;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function closeReceipt() {
            document.getElementById('receiptModal').style.display = 'none';
        }

        function editLineup() {
            // Close receipt modal
            closeReceipt();
            
            // User can now edit the form directly
            showAlert('You can now edit your lineup form', 'info');
        }

        async function saveReceiptAsImage() {
            const receiptContainer = document.getElementById('receiptContent');
            const saveBtn = document.querySelector('.receipt-btn-save');
            const originalText = saveBtn.innerHTML;
            
            // Show loading state
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
            saveBtn.disabled = true;
            
            try {
                // Import html2canvas dynamically if not loaded
                if (typeof html2canvas === 'undefined') {
                    const script = document.createElement('script');
                    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
                    document.head.appendChild(script);
                    
                    await new Promise((resolve, reject) => {
                        script.onload = resolve;
                        script.onerror = () => reject(new Error('Failed to load html2canvas'));
                    });
                }
                
                // Hide the footer with buttons before capturing
                const receiptFooter = receiptContainer.querySelector('.receipt-footer');
                const footerDisplay = receiptFooter ? receiptFooter.style.display : null;
                if (receiptFooter) {
                    receiptFooter.style.display = 'none';
                }
                
                // Store original styles
                const originalStyles = {
                    position: receiptContainer.style.position,
                    left: receiptContainer.style.left,
                    top: receiptContainer.style.top,
                    transform: receiptContainer.style.transform,
                    boxShadow: receiptContainer.style.boxShadow,
                    animation: receiptContainer.style.animation,
                    maxWidth: receiptContainer.style.maxWidth,
                    width: receiptContainer.style.width
                };
                
                // Temporarily adjust styles for better capture
                receiptContainer.style.position = 'relative';
                receiptContainer.style.left = '0';
                receiptContainer.style.top = '0';
                receiptContainer.style.transform = 'none';
                receiptContainer.style.boxShadow = 'none';
                receiptContainer.style.animation = 'none';
                receiptContainer.style.maxWidth = '1100px';
                receiptContainer.style.width = '1100px';
                
                // Wait for styles to apply
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // Capture with html2canvas
                const canvas = await html2canvas(receiptContainer, {
                    scale: 3,
                    useCORS: true,
                    allowTaint: false,
                    backgroundColor: '#ffffff',
                    logging: false,
                    width: 1100,
                    height: receiptContainer.scrollHeight,
                    windowWidth: 1100,
                    windowHeight: receiptContainer.scrollHeight,
                    scrollX: 0,
                    scrollY: 0,
                    onclone: function(clonedDoc) {
                        const clonedReceipt = clonedDoc.getElementById('receiptContent');
                        if (clonedReceipt) {
                            // Hide buttons in the cloned document too
                            const clonedFooter = clonedReceipt.querySelector('.receipt-footer');
                            if (clonedFooter) {
                                clonedFooter.style.display = 'none';
                            }
                            
                            clonedReceipt.style.position = 'relative';
                            clonedReceipt.style.left = '0';
                            clonedReceipt.style.top = '0';
                            clonedReceipt.style.transform = 'none';
                            clonedReceipt.style.boxShadow = 'none';
                            clonedReceipt.style.animation = 'none';
                            clonedReceipt.style.maxWidth = '1100px';
                            clonedReceipt.style.width = '1100px';
                        }
                    }
                });
                
                // Restore original styles
                Object.keys(originalStyles).forEach(key => {
                    receiptContainer.style[key] = originalStyles[key];
                });
                
                // Restore footer display
                if (receiptFooter) {
                    receiptFooter.style.display = footerDisplay || '';
                }
                
                // Convert to blob and download
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    const date = new Date();
                    const filename = `JoyfulSound_Lineup_${date.getFullYear()}${String(date.getMonth()+1).padStart(2,'0')}${String(date.getDate()).padStart(2,'0')}_${String(date.getHours()).padStart(2,'0')}${String(date.getMinutes()).padStart(2,'0')}.png`;
                    
                    link.download = filename;
                    link.href = url;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    showAlert('✅ Receipt saved successfully as ' + filename, 'success');
                }, 'image/png', 1.0);
                
            } catch (error) {
                console.error('Error capturing receipt:', error);
                showAlert('❌ Failed to save receipt. Error: ' + error.message, 'danger');
                
                // Make sure to restore footer even if there's an error
                const receiptFooter = receiptContainer.querySelector('.receipt-footer');
                if (receiptFooter) {
                    receiptFooter.style.display = '';
                }
            } finally {
                // Restore button state
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
            }
        }

        //Helper function to format date for filename
        function getFormattedDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            return `${year}${month}${day}_${hours}${minutes}`;
        }

        // Alternative simplified version with better error handling
        function saveReceiptAsImageSimple() {
            const receiptContainer = document.getElementById('receiptContent');
            
            // Show loading state
            const saveBtn = document.querySelector('.receipt-btn-save');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            saveBtn.disabled = true;

            // Simple html2canvas with minimal options
            html2canvas(receiptContainer, {
                scale: 2,
                useCORS: true,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                try {
                    // Convert to data URL
                    const imageData = canvas.toDataURL('image/png');
                    
                    // Create download link
                    const link = document.createElement('a');
                    link.download = `Worship_Lineup_${getFormattedDate()}.png`;
                    link.href = imageData;
                    
                    // Trigger download
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    showAlert('Receipt saved as PNG image!', 'success');
                    
                } catch (error) {
                    console.error('Error processing image:', error);
                    showAlert('Error saving image. Please try again.', 'danger');
                }
                
            }).catch(error => {
                console.error('Error capturing receipt:', error);
                showAlert('Failed to generate image. Please try again.', 'danger');
                
            }).finally(() => {
                // Restore button state
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
            });
        }


        // Enhanced version with better styling for capture
        function saveReceiptAsImageEnhanced() {
            const receiptContainer = document.getElementById('receiptContent');
            
            // Store original styles to restore later
            const originalStyles = {
                boxShadow: receiptContainer.style.boxShadow,
                transform: receiptContainer.style.transform,
                animation: receiptContainer.style.animation
            };
            
            // Apply styles for better capture
            receiptContainer.style.boxShadow = 'none';
            receiptContainer.style.transform = 'none';
            receiptContainer.style.animation = 'none';
            
            // Show loading state
            const saveBtn = document.querySelector('.receipt-btn-save');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating Image...';
            saveBtn.disabled = true;

            // Small delay to ensure styles are applied
            setTimeout(() => {
                html2canvas(receiptContainer, {
                    scale: 3, // Very high quality
                    useCORS: true,
                    allowTaint: false,
                    backgroundColor: '#ffffff',
                    logging: false,
                    width: receiptContainer.scrollWidth,
                    height: receiptContainer.scrollHeight,
                    scrollX: 0,
                    scrollY: 0,
                    windowWidth: receiptContainer.scrollWidth,
                    windowHeight: receiptContainer.scrollHeight
                }).then(canvas => {
                    try {
                        // Convert to blob for better file handling
                        canvas.toBlob(function(blob) {
                            const link = document.createElement('a');
                            link.download = `JoyfulSound_Lineup_${getFormattedDate()}.png`;
                            link.href = URL.createObjectURL(blob);
                            
                            // Add to document and click
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            
                            // Clean up
                            URL.revokeObjectURL(link.href);
                            
                            showAlert('🎉 Receipt saved as high-quality PNG!', 'success');
                            
                        }, 'image/png', 0.95); // 95% quality
                        
                    } catch (error) {
                        console.error('Error in image processing:', error);
                        showAlert('Error saving image. Please try again.', 'danger');
                    }
                    
                }).catch(error => {
                    console.error('html2canvas error:', error);
                    showAlert('Failed to generate image. Please try the print option instead.', 'danger');
                    
                }).finally(() => {
                    // Restore original styles
                    receiptContainer.style.boxShadow = originalStyles.boxShadow;
                    receiptContainer.style.transform = originalStyles.transform;
                    receiptContainer.style.animation = originalStyles.animation;
                    
                    // Restore button state
                    saveBtn.innerHTML = originalText;
                    saveBtn.disabled = false;
                });
            }, 100);
        }




        // Logout Modal Functions
        function showLogoutModal() {
            document.getElementById('logoutModal').style.display = 'block';
        }

        function closeLogoutModal() {
            document.getElementById('logoutModal').style.display = 'none';
        }

        function confirmLogout() {
            // Perform logout
            sessionStorage.removeItem('userData');
            localStorage.removeItem('userData');
            window.location.href = 'login.html';
        }

        // Updated confirmAndReset function - directly resets without confirmation
        function confirmAndReset() {
            closeReceipt();
            resetLineupForm();
            showAlert('Form has been reset successfully', 'success');
        }

        // Close logout modal when clicking outside
        document.addEventListener('click', function(event) {
            const logoutModal = document.getElementById('logoutModal');
            const logoutModalContent = document.querySelector('.logout-modal-content');
            
            if (event.target === logoutModal) {
                closeLogoutModal();
            }
        });

        // Profile Functions
        function openProfileTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.profile-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab content
            const tabContent = document.getElementById(tabName);
            if (tabContent) {
                tabContent.classList.add('active');
            }
            
            // Add active class to clicked tab button
            const tabBtn = event.target.closest('.tab-btn');
            if (tabBtn) {
                tabBtn.classList.add('active');
            }
            
            // Initialize password validation if changing to password tab
            if (tabName === 'change-password') {
                setTimeout(initializePasswordValidation, 100);
            }
        }

        function togglePasswordVisibility(fieldId) {
            const field = document.getElementById(fieldId);
            const icon = field.nextElementSibling.querySelector('i');
            
            if (field.type === 'password') {
                field.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                field.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        function checkPasswordStrength(password) {
            let strength = 0;
            const requirements = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[^A-Za-z0-9]/.test(password)
            };
            
            // Update requirement indicators
            Object.keys(requirements).forEach(req => {
                const element = document.getElementById(`req${req.charAt(0).toUpperCase() + req.slice(1)}`);
                if (element) {
                    if (requirements[req]) {
                        element.classList.add('valid');
                        strength++;
                    } else {
                        element.classList.remove('valid');
                    }
                }
            });
            
            // Update strength bar and text
            const strengthFill = document.getElementById('strengthFill');
            const strengthText = document.getElementById('strengthText');
            
            if (strengthFill && strengthText) {
                const percentage = (strength / 5) * 100;
                
                strengthFill.style.width = `${percentage}%`;
                
                if (password.length === 0) {
                    strengthFill.style.background = '#e0e0e0';
                    strengthText.textContent = 'Password strength';
                    strengthText.style.color = '#6c757d';
                } else if (strength <= 1) {
                    strengthFill.style.background = 'var(--danger)';
                    strengthText.textContent = 'Weak Password';
                    strengthText.style.color = 'var(--danger)';
                } else if (strength <= 3) {
                    strengthFill.style.background = '#ffc107';
                    strengthText.textContent = 'Medium Password';
                    strengthText.style.color = '#ffc107';
                } else {
                    strengthFill.style.background = 'var(--success)';
                    strengthText.textContent = 'Strong Password';
                    strengthText.style.color = 'var(--success)';
                }
            }
            
            return strength;
        }

        // Add event listeners for password fields
        function initializePasswordValidation() {
            const newPasswordField = document.getElementById('newPassword');
            const currentPasswordField = document.getElementById('currentPassword');
            const confirmPasswordField = document.getElementById('confirmPassword');
            
            if (newPasswordField) {
                newPasswordField.addEventListener('input', function() {
                    checkPasswordStrength(this.value);
                    
                    // Also check if passwords match
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    if (confirmPassword) {
                        validatePasswordMatch(this.value, confirmPassword);
                    }
                });
            }
            
            if (confirmPasswordField) {
                confirmPasswordField.addEventListener('input', function() {
                    const newPassword = document.getElementById('newPassword').value;
                    validatePasswordMatch(newPassword, this.value);
                });
            }
        }

        // Validate password match
        function validatePasswordMatch(newPassword, confirmPassword) {
            const confirmField = document.getElementById('confirmPassword');
            
            if (confirmPassword && newPassword !== confirmPassword) {
                confirmField.style.borderColor = 'var(--danger)';
                confirmField.style.boxShadow = '0 0 0 3px rgba(220, 53, 69, 0.1)';
            } else if (confirmPassword && newPassword === confirmPassword) {
                confirmField.style.borderColor = 'var(--success)';
                confirmField.style.boxShadow = '0 0 0 3px rgba(40, 167, 69, 0.1)';
            } else {
                confirmField.style.borderColor = '#e0e0e0';
                confirmField.style.boxShadow = 'none';
            }
        }

        async function saveProfileChanges() {
            const firstname = document.getElementById('firstname').value.trim();
            const lastname = document.getElementById('lastname').value.trim();
            
            if (!firstname || !lastname) {
                showAlert('Please fill in both first name and last name', 'warning');
                return;
            }
            
            // Declare variables in the function scope so they're accessible in finally block
            let originalText;
            let saveBtn;
            
            try {
                // Show loading state
                saveBtn = document.querySelector('#personal-info .btn-primary');
                originalText = saveBtn.textContent;
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                saveBtn.disabled = true;
                
                const response = await fetch(`${API_BASE_URL}/proxy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'updateProfile',
                        username: userData.username,
                        firstname: firstname,
                        lastname: lastname
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Update local user data
                    userData.firstname = firstname;
                    userData.lastname = lastname;
                    
                    // Update session and local storage
                    sessionStorage.setItem('userData', JSON.stringify(userData));
                    localStorage.setItem('userData', JSON.stringify(userData));
                    
                    // Update UI
                    loadProfileData();
                    document.getElementById('userName').textContent = `${firstname} ${lastname}`;
                    document.getElementById('welcomeName').textContent = firstname;
                    
                    showAlert('Profile updated successfully!', 'success');
                } else {
                    showAlert(result.message || 'Failed to update profile', 'danger');
                }
                
            } catch (error) {
                console.error('Error updating profile:', error);
                showAlert('Error updating profile. Please try again.', 'danger');
            } finally {
                // Restore button state - now originalText and saveBtn are accessible
                if (saveBtn && originalText) {
                    saveBtn.textContent = originalText;
                    saveBtn.disabled = false;
                }
            }
        }

        async function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Validation
            if (!currentPassword || !newPassword || !confirmPassword) {
                showAlert('Please fill in all password fields', 'warning');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showAlert('New password and confirmation do not match', 'warning');
                return;
            }
            
            const strength = checkPasswordStrength(newPassword);
            if (strength < 3) {
                showAlert('Please use a stronger password (meet at least 3 requirements)', 'warning');
                return;
            }
            
            // Additional password validation
            if (newPassword.length < 8) {
                showAlert('Password must be at least 8 characters long', 'warning');
                return;
            }
            
            if (!/[A-Z]/.test(newPassword)) {
                showAlert('Password must contain at least one uppercase letter', 'warning');
                return;
            }
            
            if (!/[a-z]/.test(newPassword)) {
                showAlert('Password must contain at least one lowercase letter', 'warning');
                return;
            }
            
            if (!/[0-9]/.test(newPassword)) {
                showAlert('Password must contain at least one number', 'warning');
                return;
            }
            
            if (!/[^A-Za-z0-9]/.test(newPassword)) {
                showAlert('Password must contain at least one special character', 'warning');
                return;
            }
            
            // Show loading state
            const changeBtn = document.querySelector('#change-password .btn-primary');
            const originalText = changeBtn.textContent;
            changeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Changing...';
            changeBtn.disabled = true;
            
            try {
                // Step 1: Verify current password
                const verifyResponse = await fetch(`${API_BASE_URL}/proxy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'verifyPassword',
                        username: userData.username,
                        password: currentPassword
                    })
                });
                
                const verifyResult = await verifyResponse.json();
                
                if (!verifyResult.success) {
                    showAlert('Current password is incorrect', 'danger');
                    changeBtn.textContent = originalText;
                    changeBtn.disabled = false;
                    return;
                }
                
                // Step 2: Update password
                const updateResponse = await fetch(`${API_BASE_URL}/proxy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'updatePassword',
                        username: userData.username,
                        newPassword: newPassword
                    })
                });
                
                const updateResult = await updateResponse.json();
                
                if (updateResult.success) {
                    resetPasswordForm();
                    showAlert('Password changed successfully!', 'success');
                } else {
                    showAlert(updateResult.message || 'Failed to change password', 'danger');
                }
                
            } catch (error) {
                console.error('Error changing password:', error);
                showAlert('Error changing password. Please try again.', 'danger');
            } finally {
                // Restore button state
                changeBtn.textContent = originalText;
                changeBtn.disabled = false;
            }
        }

        function resetProfileForm() {
            // Reload original user data
            loadProfileData();
            showAlert('Changes discarded', 'info');
        }

        // Enhanced reset password form function
        function resetPasswordForm() {
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            // Reset password strength indicator
            const strengthFill = document.getElementById('strengthFill');
            const strengthText = document.getElementById('strengthText');
            
            if (strengthFill && strengthText) {
                strengthFill.style.width = '0%';
                strengthFill.style.background = '#e0e0e0';
                strengthText.textContent = 'Password strength';
                strengthText.style.color = '#6c757d';
            }
            
            // Reset requirement indicators
            document.querySelectorAll('.password-requirements li').forEach(li => {
                li.classList.remove('valid');
            });
            
            // Reset border styles
            const confirmField = document.getElementById('confirmPassword');
            if (confirmField) {
                confirmField.style.borderColor = '#e0e0e0';
                confirmField.style.boxShadow = 'none';
            }
        }

        function loadProfileData() {
            // Load user data into profile form
            document.getElementById('firstname').value = userData.firstname || '';
            document.getElementById('lastname').value = userData.lastname || '';
            document.getElementById('username').value = userData.username || '';
            
            // Format birthdate to MM/DD/YYYY
            if (userData.birthdate) {
                const formattedBirthdate = formatBirthdateToMMDDYYYY(userData.birthdate);
                document.getElementById('birthdate').value = formattedBirthdate;
            } else {
                document.getElementById('birthdate').value = '';
            }
            
            document.getElementById('ministry').value = userData.ministry || '';
            document.getElementById('memberId').value = userData.memberId || '';
            document.getElementById('status').value = userData.status === 'verified' ? 'Verified' : 'Unverified';
            
            // Update profile header
            document.getElementById('profileName').textContent = `${userData.firstname} ${userData.lastname}`;
            document.getElementById('profileMinistry').textContent = userData.ministry;
            document.getElementById('profileMemberId').textContent = `Member ID: ${userData.memberId}`;
            
            // Update avatar
            const initials = (userData.firstname.charAt(0) + userData.lastname.charAt(0)).toUpperCase();
            document.getElementById('profileAvatar').textContent = initials;
            document.getElementById('userAvatar').textContent = initials;
            
            // Update status indicator
            const statusIndicator = document.getElementById('profileStatus');
            if (userData.status === 'verified') {
                statusIndicator.className = 'status-circle verified';
                statusIndicator.innerHTML = '<div class="status-tooltip">Verified</div>';
            } else {
                statusIndicator.className = 'status-circle unverified';
                statusIndicator.innerHTML = '<div class="status-tooltip">Unverified</div>';
            }
        }

        // Format birthdate to MM/DD/YYYY format
        function formatBirthdateToMMDDYYYY(dateString) {
            if (!dateString) return '';
            
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return dateString; // Return original if invalid
                
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const year = date.getFullYear();
                
                return `${month}/${day}/${year}`;
            } catch (error) {
                console.error('Error formatting birthdate:', error);
                return dateString;
            }
        }

        // Calendar Functions
        function initializeCalendar() {
            generateCalendar(currentDate);
            loadScheduleData();
        }

        function generateCalendar(date) {
        const calendarContainer = document.getElementById('calendarContainer');
        const monthNames = ["January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];
        
        // Update month header
        document.getElementById('currentMonth').textContent = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;
        
        // Get first day of month and number of days
        const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
        const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDay = firstDay.getDay(); // 0 = Sunday, 1 = Monday, etc.
        
        // Debug: Log schedule data
        console.log('Schedule data for calendar:', scheduleData);
        console.log('Current month:', date.getMonth() + 1, date.getFullYear());
        
        // Create calendar header
        let calendarHTML = `
            <div class="calendar-header">
                <div class="calendar-day-header">Sun</div>
                <div class="calendar-day-header">Mon</div>
                <div class="calendar-day-header">Tue</div>
                <div class="calendar-day-header">Wed</div>
                <div class="calendar-day-header">Thu</div>
                <div class="calendar-day-header">Fri</div>
                <div class="calendar-day-header">Sat</div>
            </div>
            <div class="calendar-grid">
        `;
        
        // Add empty cells for days before the first day of the month
        for (let i = 0; i < startingDay; i++) {
            const prevMonth = new Date(date.getFullYear(), date.getMonth(), 0 - i);
            calendarHTML += `
                <div class="calendar-day other-month">
                    <div class="calendar-day-number">${prevMonth.getDate()}</div>
                </div>
            `;
        }
        
        // Add days of the month
        for (let day = 1; day <= daysInMonth; day++) {
            const currentDay = new Date(date.getFullYear(), date.getMonth(), day);
            const dayOfWeek = currentDay.getDay();
            const dateString = formatDateForAPI(currentDay);
            const hasSchedule = checkIfDateHasSchedule(dateString);
            
            // Debug: Log specific dates
            if (hasSchedule) {
                console.log('Date with schedule:', dateString, 'has schedule:', hasSchedule);
            }
            
            calendarHTML += `
                <div class="calendar-day ${hasSchedule ? 'has-schedule' : ''}" onclick="showScheduleDetails('${dateString}')">
                    <div class="calendar-day-number">${day}</div>
                    ${hasSchedule ? '<div class="calendar-day-events">Scheduled</div>' : ''}
                </div>
            `;
        }
        
        // Calculate how many empty cells we need at the end
        const totalCells = 42; // 6 rows x 7 days
        const remainingCells = totalCells - (startingDay + daysInMonth);
        
        // Add empty cells for days after the last day of the month
        for (let i = 1; i <= remainingCells; i++) {
            calendarHTML += `
                <div class="calendar-day other-month">
                    <div class="calendar-day-number">${i}</div>
                </div>
            `;
        }
        
        calendarHTML += `</div>`;
        calendarContainer.innerHTML = calendarHTML;
        
        // Debug: Log total scheduled days found
        const scheduledDays = document.querySelectorAll('.calendar-day.has-schedule').length;
        console.log(`Found ${scheduledDays} days with schedules in ${monthNames[date.getMonth()]} ${date.getFullYear()}`);
    }

        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            generateCalendar(currentDate);
        }

        function switchCalendar(type) {
            currentCalendarType = type;
            
            // Update active button
            document.getElementById('pawBtn').classList.toggle('active', type === 'paw');
            document.getElementById('meetingsBtn').classList.toggle('active', type === 'meetings');
            
            // Regenerate calendar with new data
            generateCalendar(currentDate);
        }

        // Format date for API (YYYY-MM-DD)
        function formatDateForAPI(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function formatDateForDisplay(dateString) {
            // Format date for display (e.g., "Sunday, November 17, 2025")
            const date = new Date(dateString);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        function getScheduleData() {
        try {
            const ss = SpreadsheetApp.openById(SHEET_ID);
            const lineupSheet = ss.getSheetByName(SHEET_NAMES.PRAISE_WORSHIP_SONG);
            
            if (!lineupSheet) {
            Logger.log('Praise & Worship Song sheet not found');
            return createResponse(true, 'No schedule data available', []);
            }
            
            const dataRange = lineupSheet.getDataRange();
            const values = dataRange.getValues();
            
            // Check if there's any data beyond headers
            if (values.length <= 1) {
            Logger.log('No schedule data found in sheet (only headers)');
            return createResponse(true, 'No schedule data available', []);
            }
            
            // Skip header row
            const schedules = [];
            
            for (let i = 1; i < values.length; i++) {
            const row = values[i];
            
            // Check if this row has valid data (has ScheduleID)
            if (row[1] && row[1] !== '') { // Column B - ScheduleID
                const schedule = {
                scheduleId: row[1],           // B - ScheduleID
                songLeader: row[2] || '',     // C - Song Leader
                backups: [
                    row[3] || '',              // D - Backup 1
                    row[4] || '',              // E - Backup 2
                    row[5] || '',              // F - Backup 3
                    row[6] || '',              // G - Backup 4
                    row[7] || ''               // H - Backup 5
                ].filter(backup => backup !== ''), // Remove empty backups
                practiceDate: row[9] || '',  // J - Practice Day
                scheduleDate: row[8] || '',  // I - Schedule Day
                slowSongs: [],
                fastSongs: []
                };
                
                // Extract slow songs (columns K-AD)
                for (let j = 0; j < 5; j++) {
                const startCol = 10 + (j * 4); // K=10, O=14, S=18, W=22, AA=26
                const slowSong = {
                    title: row[startCol] || '',           // Slow Title
                    link: row[startCol + 1] || '',        // Slow Link
                    lyrics: row[startCol + 2] || '',      // Slow Lyrics
                    instructions: row[startCol + 3] || '' // Slow Instructions
                };
                
                // Only add song if it has a title
                if (slowSong.title && slowSong.title.trim() !== '') {
                    schedule.slowSongs.push(slowSong);
                }
                }
                
                // Extract fast songs (columns AE-AX)
                for (let j = 0; j < 5; j++) {
                const startCol = 30 + (j * 4); // AE=30, AI=34, AM=38, AQ=42, AU=46
                const fastSong = {
                    title: row[startCol] || '',           // Fast Title
                    link: row[startCol + 1] || '',        // Fast Link
                    lyrics: row[startCol + 2] || '',      // Fast Lyrics
                    instructions: row[startCol + 3] || '' // Fast Instructions
                };
                
                // Only add song if it has a title
                if (fastSong.title && fastSong.title.trim() !== '') {
                    schedule.fastSongs.push(fastSong);
                }
                }
                
                schedules.push(schedule);
            }
            }
            
            Logger.log('Retrieved ' + schedules.length + ' schedules');
            return createResponse(true, 'Schedule data retrieved successfully', schedules);
            
        } catch (error) {
            Logger.log('Get schedule data error: ' + error.toString());
            Logger.log('Error stack: ' + error.stack);
            return createResponse(false, 'Error retrieving schedule data: ' + error.toString(), []);
        }
        }

        async function loadScheduleData() {
        try {
            // Fetch schedule data from Google Sheets using POST
            const response = await fetch(`${API_BASE_URL}/proxy`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'getScheduleData'
                })
            });
            
            const result = await response.json();
            
            if (result.success) {
                // Clean the data by removing header row
                scheduleData = cleanScheduleData(result.data || []);
                console.log('Cleaned schedule data:', scheduleData);
                
                // Regenerate calendar to show schedule markers
                generateCalendar(currentDate);
            } else {
                console.error('Failed to load schedule data:', result.message);
                // For demo purposes, we'll use mock data
                scheduleData = getMockScheduleData();
                generateCalendar(currentDate);
            }
        } catch (error) {
            console.error('Error loading schedule data:', error);
            // For demo purposes, we'll use mock data
            scheduleData = getMockScheduleData();
            generateCalendar(currentDate);
        }
    }

        // Check if a date has an existing schedule
        function checkIfDateHasSchedule(dateString) {
            return existingScheduleData.some(schedule => {
                // Skip invalid schedules
                if (!schedule.scheduleId || schedule.scheduleId === 'ScheduleID') return false;
                
                // Format dates for comparison (YYYY-MM-DD)
                const scheduleDate = formatDateForComparison(schedule.scheduleDate);
                const checkDate = formatDateForComparison(dateString);
                
                return scheduleDate === checkDate;
            });
        }

        // Get schedule for a specific date
        function getScheduleForDate(dateString) {
            return existingScheduleData.find(schedule => {
                // Skip invalid schedules
                if (!schedule.scheduleId || schedule.scheduleId === 'ScheduleID') return false;
                
                // Format dates for comparison (YYYY-MM-DD)
                const scheduleDate = formatDateForComparison(schedule.scheduleDate);
                const checkDate = formatDateForComparison(dateString);
                
                return scheduleDate === checkDate;
            });
        }



        // Format date for comparison (YYYY-MM-DD)
        function formatDateForComparison(dateString) {
            if (!dateString) return '';
            
            try {
                // Handle both Date objects and string dates
                const date = new Date(dateString);
                
                // Check if date is valid
                if (isNaN(date.getTime())) {
                    console.warn('Invalid date:', dateString);
                    return '';
                }
                
                // Format as YYYY-MM-DD for consistent comparison
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                
                return `${year}-${month}-${day}`;
            } catch (error) {
                console.error('Error formatting date:', error);
                return '';
            }
        }

         // Improved Song Layout Function
        function showScheduleDetails(dateString) {
            const modal = document.getElementById('scheduleModal');
            const modalDate = document.getElementById('modalDate');
            const modalBody = document.getElementById('modalBody');
            
            // Set modal date title
            modalDate.textContent = formatDateForDisplay(dateString);
            
            // Get schedules for this date
            const schedules = getSchedulesForDate(dateString);
            
            if (schedules.length === 0) {
                modalBody.innerHTML = `
                    <div class="no-schedule">
                        <i class="fas fa-calendar-times"></i>
                        <h4>No Schedule Found</h4>
                        <p>There are no schedules for ${formatDateForDisplay(dateString)}</p>
                    </div>
                `;
            } else {
                let scheduleHTML = '';
                
                schedules.forEach((schedule, index) => {
                    scheduleHTML += `
                        <div class="schedule-card">
                            <div class="schedule-card-header">
                                <h4 class="schedule-card-title">Praise & Worship Schedule</h4>
                                <p class="schedule-card-subtitle">Schedule ID: ${schedule.scheduleId}</p>
                            </div>
                            <div class="schedule-card-body">
                                <div class="schedule-info">
                                    <div class="info-item">
                                        <div class="info-label">Practice Day</div>
                                        <div class="info-value">${formatDateForDisplay(schedule.practiceDate)}</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Schedule Day</div>
                                        <div class="info-value">${formatDateForDisplay(schedule.scheduleDate)}</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Song Leader</div>
                                        <div class="info-value">${schedule.songLeader}</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Backup Singers</div>
                                        <div class="info-value">${schedule.backups.filter(b => b).join(', ') || 'None'}</div>
                                    </div>
                                </div>
                                
                                <div class="lineup-section">
                                    <h5 class="lineup-section-title">Slow Songs</h5>
                                    <div class="song-list">
                                        ${schedule.slowSongs.filter(song => song.title).map((song, idx) => `
                                            <div class="song-item">
                                                <div class="song-header">
                                                    <h6 class="song-title">${song.title}</h6>
                                                    <div class="song-actions">
                                                        <button class="song-btn" onclick="toggleSongDetails('slow-${index}-${idx}')">
                                                            <i class="fas fa-info-circle"></i> Details
                                                        </button>
                                                    </div>
                                                </div>
                                                ${song.link ? `
                                                    <div class="youtube-preview-container" id="youtube-slow-${index}-${idx}">
                                                        <!-- YouTube iframe will be loaded here -->
                                                    </div>
                                                ` : ''}
                                                <div class="song-details" id="slow-${index}-${idx}">
                                                    ${song.lyrics ? `
                                                        <div class="details-section">
                                                            <div class="details-label">Lyrics</div>
                                                            <div class="details-content">${song.lyrics}</div>
                                                        </div>
                                                    ` : ''}
                                                    ${song.instructions ? `
                                                        <div class="details-section">
                                                            <div class="details-label">Instructions</div>
                                                            <div class="details-content">${song.instructions}</div>
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        `).join('')}
                                        ${schedule.slowSongs.filter(song => song.title).length === 0 ? 
                                            '<p style="color: #6c757d; text-align: center; padding: 20px;">No slow songs scheduled</p>' : ''}
                                    </div>
                                </div>
                                
                                <div class="lineup-section">
                                    <h5 class="lineup-section-title">Fast Songs</h5>
                                    <div class="song-list">
                                        ${schedule.fastSongs.filter(song => song.title).map((song, idx) => `
                                            <div class="song-item">
                                                <div class="song-header">
                                                    <h6 class="song-title">${song.title}</h6>
                                                    <div class="song-actions">
                                                        <button class="song-btn" onclick="toggleSongDetails('fast-${index}-${idx}')">
                                                            <i class="fas fa-info-circle"></i> Details
                                                        </button>
                                                    </div>
                                                </div>
                                                ${song.link ? `
                                                    <div class="youtube-preview-container" id="youtube-fast-${index}-${idx}">
                                                        <!-- YouTube iframe will be loaded here -->
                                                    </div>
                                                ` : ''}
                                                <div class="song-details" id="fast-${index}-${idx}">
                                                    ${song.lyrics ? `
                                                        <div class="details-section">
                                                            <div class="details-label">Lyrics</div>
                                                            <div class="details-content">${song.lyrics}</div>
                                                        </div>
                                                    ` : ''}
                                                    ${song.instructions ? `
                                                        <div class="details-section">
                                                            <div class="details-label">Instructions</div>
                                                            <div class="details-content">${song.instructions}</div>
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        `).join('')}
                                        ${schedule.fastSongs.filter(song => song.title).length === 0 ? 
                                            '<p style="color: #6c757d; text-align: center; padding: 20px;">No fast songs scheduled</p>' : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                modalBody.innerHTML = scheduleHTML;
                
                // Load YouTube embeds after the modal is displayed
                setTimeout(() => {
                    loadYouTubeEmbeds(schedules);
                }, 100);
            }
            
            modal.style.display = 'block';
        }

        // Function to load YouTube embeds with network awareness
        function loadYouTubeEmbeds(schedules) {
            schedules.forEach((schedule, scheduleIndex) => {
                // Load slow song YouTube embeds
                schedule.slowSongs.forEach((song, songIndex) => {
                    if (song.link) {
                        const containerId = `youtube-slow-${scheduleIndex}-${songIndex}`;
                        loadYouTubeEmbed(song.link, containerId);
                    }
                });
                
                // Load fast song YouTube embeds
                schedule.fastSongs.forEach((song, songIndex) => {
                    if (song.link) {
                        const containerId = `youtube-fast-${scheduleIndex}-${songIndex}`;
                        loadYouTubeEmbed(song.link, containerId);
                    }
                });
            });
        }


        // =============================================
        // WEEKLY SCHEDULE CALENDAR FUNCTIONS
        // =============================================

        // Weekly Schedule Calendar state (separate from Create Lineup calendar)
        let scheduleCurrentDate = new Date();
        let currentScheduleCalendarType = 'paw'; // 'paw' or 'meetings'
        let weeklyScheduleData = []; // Fixed variable name - no space!
        let isLoadingSchedule = false;

        // Initialize Weekly Schedule calendar when section is shown
        function initializeScheduleCalendar() {
            console.log('Initializing Weekly Schedule calendar...');
            showScheduleCalendarLoading();
            loadScheduleData();
        }

        function showScheduleCalendarLoading() {
            document.getElementById('scheduleCalendarLoading').style.display = 'block';
            document.getElementById('scheduleCalendarError').style.display = 'none';
            document.getElementById('scheduleCalendarContainer').style.display = 'none';
        }

        function showScheduleCalendarError() {
            document.getElementById('scheduleCalendarLoading').style.display = 'none';
            document.getElementById('scheduleCalendarError').style.display = 'block';
            document.getElementById('scheduleCalendarContainer').style.display = 'none';
        }

        function showScheduleCalendarContent() {
            document.getElementById('scheduleCalendarLoading').style.display = 'none';
            document.getElementById('scheduleCalendarError').style.display = 'none';
            document.getElementById('scheduleCalendarContainer').style.display = 'block';
        }

        async function loadScheduleData() {
            if (isLoadingSchedule) return;
            
            isLoadingSchedule = true;
            console.log('Loading Weekly Schedule data...');
            
            try {
                // Try to get data from Google Sheets
                const response = await fetch(`${API_BASE_URL}/proxy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'getScheduleData'
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('Weekly Schedule API response:', result);
                
                if (result.success && result.data) {
                    weeklyScheduleData = cleanScheduleData(result.data);
                    console.log('Cleaned Weekly Schedule data:', weeklyScheduleData);
                    showScheduleCalendarContent();
                    generateScheduleCalendar(scheduleCurrentDate);
                    generateUpcomingScheduleCards();
                    generateScheduleHistory();
                    displayBirthdayTodaySection();
                    showAlert('Schedule data loaded successfully!', 'success');
                } else {
                    throw new Error(result.message || 'No schedule data available');
                }
                
            } catch (error) {
                console.error('Error loading Weekly Schedule data:', error);
                
                // Fallback to mock data for demonstration
                console.log('Using mock data as fallback for Weekly Schedule...');
                weeklyScheduleData = getMockScheduleData();
                showScheduleCalendarContent();
                generateScheduleCalendar(scheduleCurrentDate);
                generateUpcomingScheduleCards();
                generateScheduleHistory();
                displayBirthdayTodaySection();
                showAlert('Using demo schedule data. Real data will load when connected.', 'warning');
            } finally {
                isLoadingSchedule = false;
            }
        }

        function refreshScheduleData() {
            console.log('Refreshing Weekly Schedule data...');
            showScheduleCalendarLoading();
            loadScheduleData();
        }

        function generateScheduleCalendar(date) {
            const calendarContainer = document.getElementById('scheduleCalendarContainer');
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];
            
            // Update month header
            document.getElementById('currentScheduleMonth').textContent = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;
            
            // Get first day of month and number of days
            const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
            const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay(); // 0 = Sunday, 1 = Monday, etc.
            
            console.log(`Generating Weekly Schedule calendar for ${monthNames[date.getMonth()]} ${date.getFullYear()}`);
            console.log(`Found ${weeklyScheduleData.length} total schedules`);
            
            // Create calendar header
            let calendarHTML = `
                <div class="calendar-header">
                    <div class="calendar-day-header">Sun</div>
                    <div class="calendar-day-header">Mon</div>
                    <div class="calendar-day-header">Tue</div>
                    <div class="calendar-day-header">Wed</div>
                    <div class="calendar-day-header">Thu</div>
                    <div class="calendar-day-header">Fri</div>
                    <div class="calendar-day-header">Sat</div>
                </div>
                <div class="calendar-grid">
            `;
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                const prevMonth = new Date(date.getFullYear(), date.getMonth(), 0 - i);
                calendarHTML += `
                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">${prevMonth.getDate()}</div>
                    </div>
                `;
            }
            
            // Add days of the month
            let scheduledDayCount = 0;
            for (let day = 1; day <= daysInMonth; day++) {
                const currentDay = new Date(date.getFullYear(), date.getMonth(), day);
                const dateString = formatDateForAPI(currentDay);
                const hasSchedule = checkIfDateHasWeeklySchedule(dateString);
                
                if (hasSchedule) {
                    scheduledDayCount++;
                    console.log(`Date ${dateString} has Weekly Schedule`);
                }
                
                calendarHTML += `
                    <div class="calendar-day ${hasSchedule ? 'has-schedule' : ''}" onclick="showWeeklyScheduleDetails('${dateString}')">
                        <div class="calendar-day-number">${day}</div>
                        ${hasSchedule ? '<div class="calendar-day-events">Scheduled</div>' : ''}
                    </div>
                `;
            }
            
            // Calculate how many empty cells we need at the end
            const totalCells = 42; // 6 rows x 7 days
            const remainingCells = totalCells - (startingDay + daysInMonth);
            
            // Add empty cells for days after the last day of the month
            for (let i = 1; i <= remainingCells; i++) {
                calendarHTML += `
                    <div class="calendar-day other-month">
                        <div class="calendar-day-number">${i}</div>
                    </div>
                `;
            }
            
            calendarHTML += `</div>`;
            calendarContainer.innerHTML = calendarHTML;
            
            console.log(`Weekly Schedule calendar generated with ${scheduledDayCount} scheduled days`);
        }

        function changeScheduleMonth(direction) {
            scheduleCurrentDate.setMonth(scheduleCurrentDate.getMonth() + direction);
            generateScheduleCalendar(scheduleCurrentDate);
        }

        function switchScheduleCalendar(type) {
            currentScheduleCalendarType = type;
            
            // Update active button
            document.getElementById('schedulePawBtn').classList.toggle('active', type === 'paw');
            document.getElementById('scheduleMeetingsBtn').classList.toggle('active', type === 'meetings');
            
            // For now, we only have PAW data, but you can extend this for meetings
            if (type === 'meetings') {
                showAlert('Meetings calendar coming soon!', 'info');
                return;
            }
            
            // Regenerate calendar
            generateScheduleCalendar(scheduleCurrentDate);
            generateUpcomingScheduleCards();
            generateScheduleHistory();
        }

        function generateUpcomingScheduleCards() {
            const cardsContainer = document.getElementById('upcomingScheduleCards');
            if (!cardsContainer) return;
            
            // Get all upcoming schedules sorted by date
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const upcomingSchedules = weeklyScheduleData
                .filter(schedule => {
                    const scheduleDate = new Date(schedule.scheduleDate);
                    scheduleDate.setHours(0, 0, 0, 0);
                    return scheduleDate >= today;
                })
                .sort((a, b) => new Date(a.scheduleDate) - new Date(b.scheduleDate))
                .slice(0, 6); // Show top 6 upcoming
            
            if (upcomingSchedules.length === 0) {
                cardsContainer.innerHTML = `
                    <div class="upcoming-card-empty">
                        <div><i class="fas fa-calendar-times"></i></div>
                        <h4>No Upcoming Schedules</h4>
                        <p>There are no upcoming schedules at this time.</p>
                    </div>
                `;
                return;
            }
            
            let cardsHTML = '<div class="schedule-cards-container">';
            
            upcomingSchedules.forEach(schedule => {
                const scheduleDate = new Date(schedule.scheduleDate);
                const formattedDate = scheduleDate.toLocaleDateString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric'
                });
                const dayOfWeek = scheduleDate.toLocaleDateString('en-US', { weekday: 'long' });
                const songLeader = schedule.songLeader || 'Not assigned';
                const backups = schedule.backups && schedule.backups.length > 0 
                    ? schedule.backups.filter(b => b).join(', ') 
                    : 'None assigned';
                const dateString = formatDateForAPI(scheduleDate);
                
                cardsHTML += `
                    <div class="upcoming-card" onclick="showWeeklyScheduleDetails('${dateString}')" style="cursor: pointer;">
                        <div class="upcoming-card-date">
                            <div class="upcoming-card-date-day">${scheduleDate.getDate()}</div>
                            <div class="upcoming-card-date-time">${scheduleDate.toLocaleDateString('en-US', { month: 'short', year: '2-digit' })}</div>
                        </div>
                        <div class="upcoming-card-content">
                            <div class="upcoming-card-label">Scheduled Service</div>
                            <div class="upcoming-card-title">${dayOfWeek}</div>
                            <div class="upcoming-card-item">
                                <div class="upcoming-card-item-label">🎤 Song Leader</div>
                                <div class="upcoming-card-item-value">${songLeader}</div>
                            </div>
                            <div class="upcoming-card-item">
                                <div class="upcoming-card-item-label">🎵 Backup Singers</div>
                                <div class="upcoming-card-item-value">${backups}</div>
                            </div>
                            <div style="margin-top: 15px; text-align: center; color: var(--primary); font-size: 0.85rem; font-weight: 600;">
                                <i class="fas fa-click"></i> Click for details
                            </div>
                        </div>
                    </div>
                `;
            });
            
            cardsHTML += '</div>';
            cardsContainer.innerHTML = cardsHTML;
        }

        function generateScheduleHistory() {
            const historyContainer = document.getElementById('scheduleHistoryCards');
            const historySection = document.getElementById('scheduleHistorySection');
            if (!historyContainer) return;
            
            // Get all past schedules sorted by date (most recent first)
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const pastSchedules = weeklyScheduleData
                .filter(schedule => {
                    const scheduleDate = new Date(schedule.scheduleDate);
                    scheduleDate.setHours(0, 0, 0, 0);
                    return scheduleDate < today;
                })
                .sort((a, b) => new Date(b.scheduleDate) - new Date(a.scheduleDate))
                .slice(0, 6); // Show top 6 past schedules
            
            if (pastSchedules.length === 0) {
                historyContainer.innerHTML = `
                    <div class="schedule-history-empty">
                        <div><i class="fas fa-folder-open"></i></div>
                        <h4>No Schedule History</h4>
                        <p>There are no past schedules to display.</p>
                    </div>
                `;
                historySection.style.display = 'block';
                return;
            }
            
            historySection.style.display = 'block';
            let historyHTML = '<div class="schedule-history-cards">';
            
            pastSchedules.forEach(schedule => {
                const scheduleDate = new Date(schedule.scheduleDate);
                const dayOfWeek = scheduleDate.toLocaleDateString('en-US', { weekday: 'long' });
                const songLeader = schedule.songLeader || 'Not assigned';
                const backups = schedule.backups && schedule.backups.length > 0 
                    ? schedule.backups.filter(b => b).join(', ') 
                    : 'None assigned';
                const dateString = formatDateForAPI(scheduleDate);
                
                historyHTML += `
                    <div class="history-card" onclick="showWeeklyScheduleDetails('${dateString}')" style="cursor: pointer;">
                        <div class="history-card-date">
                            <div class="history-card-date-day">${scheduleDate.getDate()}</div>
                            <div class="history-card-date-time">${scheduleDate.toLocaleDateString('en-US', { month: 'short', year: '2-digit' })}</div>
                        </div>
                        <div class="history-card-content">
                            <div class="history-card-label">Past Service</div>
                            <div class="history-card-title">${dayOfWeek}</div>
                            <div class="history-card-item">
                                <div class="history-card-item-label">🎤 Song Leader</div>
                                <div class="history-card-item-value">${songLeader}</div>
                            </div>
                            <div class="history-card-item">
                                <div class="history-card-item-label">🎵 Backup Singers</div>
                                <div class="history-card-item-value">${backups}</div>
                            </div>
                            <div style="margin-top: 15px; text-align: center; color: #888; font-size: 0.85rem; font-weight: 600;">
                                <i class="fas fa-search"></i> View details
                            </div>
                        </div>
                    </div>
                `;
            });
            
            historyHTML += '</div>';
            historyContainer.innerHTML = historyHTML;
        }

        // Check if a date has an existing schedule (for Weekly Schedule only)
        function checkIfDateHasWeeklySchedule(dateString) {
            if (!weeklyScheduleData || weeklyScheduleData.length === 0) return false;
            
            return weeklyScheduleData.some(schedule => {
                if (!schedule.scheduleDate) return false;
                
                const scheduleDate = formatDateForComparison(schedule.scheduleDate);
                const practiceDate = formatDateForComparison(schedule.practiceDate);
                const checkDate = formatDateForComparison(dateString);
                
                return scheduleDate === checkDate || practiceDate === checkDate;
            });
        }

        // Get schedules for a specific date (for Weekly Schedule only)
        function getWeeklySchedulesForDate(dateString) {
            if (!weeklyScheduleData || weeklyScheduleData.length === 0) return [];
            
            return weeklyScheduleData.filter(schedule => {
                if (!schedule.scheduleDate) return false;
                
                const scheduleDate = formatDateForComparison(schedule.scheduleDate);
                const practiceDate = formatDateForComparison(schedule.practiceDate);
                const checkDate = formatDateForComparison(dateString);
                
                return scheduleDate === checkDate || practiceDate === checkDate;
            });
        }

        function showWeeklyScheduleDetails(dateString) {
            const modal = document.getElementById('scheduleModal');
            const modalDate = document.getElementById('modalDate');
            const modalBody = document.getElementById('modalBody');
            
            // Set modal date title
            modalDate.textContent = formatDateForDisplay(dateString);
            
            // Get schedules for this date
            const schedules = getWeeklySchedulesForDate(dateString);
            
            console.log(`Found ${schedules.length} Weekly Schedules for ${dateString}`);
            
            if (schedules.length === 0) {
                modalBody.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 3rem; color: #6c757d; margin-bottom: 20px;">
                            <i class="fas fa-calendar-times"></i>
                        </div>
                        <h4 style="color: #6c757d;">No Schedule Found</h4>
                        <p style="color: #6c757d;">There are no schedules for ${formatDateForDisplay(dateString)}</p>
                    </div>
                `;
            } else {
                let scheduleHTML = '';
                
                schedules.forEach((schedule, index) => {
                    const isPracticeDay = formatDateForComparison(schedule.practiceDate) === formatDateForComparison(dateString);
                    const dayType = isPracticeDay ? 'Practice' : 'Service';
                    
                    scheduleHTML += `
                        <div class="schedule-card">
                            <div class="schedule-card-header">
                                <h4 class="schedule-card-title">Praise & Worship ${dayType}</h4>
                                <p class="schedule-card-subtitle">Schedule ID: ${schedule.scheduleId}</p>
                            </div>
                            <div class="schedule-card-body">
                                <div class="schedule-info">
                                    <div class="info-item">
                                        <div class="info-label">Song Leader</div>
                                        <div class="info-value">${schedule.songLeader || 'Not assigned'}</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Backup Singers</div>
                                        <div class="info-value">${schedule.backups && schedule.backups.length > 0 ? schedule.backups.filter(b => b).join(', ') : 'None'}</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Practice Day</div>
                                        <div class="info-value">${formatDateForDisplay(schedule.practiceDate)}</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Schedule Day</div>
                                        <div class="info-value">${formatDateForDisplay(schedule.scheduleDate)}</div>
                                    </div>
                                </div>
                                
                                ${schedule.slowSongs && schedule.slowSongs.length > 0 ? `
                                <div class="lineup-section">
                                    <h5 class="lineup-section-title"><i class="fas fa-music"></i> Slow Songs (${schedule.slowSongs.filter(s => s.title).length})</h5>
                                    <div class="song-list">
                                        ${schedule.slowSongs.filter(song => song && song.title).map((song, idx) => `
                                            <div class="song-item">
                                                <div class="song-header">
                                                    <h6 class="song-title">${song.title}</h6>
                                                </div>
                                                ${song.link ? `
                                                    <div class="youtube-preview-container">
                                                        <iframe src="https://www.youtube.com/embed/${extractYouTubeId(song.link)}" 
                                                                frameborder="0" 
                                                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                                                allowfullscreen>
                                                        </iframe>
                                                    </div>
                                                ` : ''}
                                                ${song.lyrics || song.instructions ? `
                                                    <div class="song-details">
                                                        ${song.lyrics ? `
                                                            <div class="details-section">
                                                                <div class="details-label">Lyrics</div>
                                                                <div class="details-content">${song.lyrics}</div>
                                                            </div>
                                                        ` : ''}
                                                        ${song.instructions ? `
                                                            <div class="details-section">
                                                                <div class="details-label">Instructions</div>
                                                                <div class="details-content">${song.instructions}</div>
                                                            </div>
                                                        ` : ''}
                                                    </div>
                                                ` : ''}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${schedule.fastSongs && schedule.fastSongs.length > 0 ? `
                                <div class="lineup-section">
                                    <h5 class="lineup-section-title"><i class="fas fa-bolt"></i> Fast Songs (${schedule.fastSongs.filter(s => s.title).length})</h5>
                                    <div class="song-list">
                                        ${schedule.fastSongs.filter(song => song && song.title).map((song, idx) => `
                                            <div class="song-item">
                                                <div class="song-header">
                                                    <h6 class="song-title">${song.title}</h6>
                                                </div>
                                                ${song.link ? `
                                                    <div class="youtube-preview-container">
                                                        <iframe src="https://www.youtube.com/embed/${extractYouTubeId(song.link)}" 
                                                                frameborder="0" 
                                                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                                                allowfullscreen>
                                                        </iframe>
                                                    </div>
                                                ` : ''}
                                                ${song.lyrics || song.instructions ? `
                                                    <div class="song-details">
                                                        ${song.lyrics ? `
                                                            <div class="details-section">
                                                                <div class="details-label">Lyrics</div>
                                                                <div class="details-content">${song.lyrics}</div>
                                                            </div>
                                                        ` : ''}
                                                        ${song.instructions ? `
                                                            <div class="details-section">
                                                                <div class="details-label">Instructions</div>
                                                                <div class="details-content">${song.instructions}</div>
                                                            </div>
                                                        ` : ''}
                                                    </div>
                                                ` : ''}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                });
                
                modalBody.innerHTML = scheduleHTML;
            }
            
            modal.style.display = 'block';
        }

        function closeScheduleModal() {
            document.getElementById('scheduleModal').style.display = 'none';
        }

        // Birthday celebrants display functions
        // Helper function to extract month-day (MM-DD) from birthdate, ignoring year
        function getBirthdayMonthDay(birthdateString) {
            if (!birthdateString) return '';
            try {
                // Handle YYYY-MM-DD format
                if (birthdateString.includes('-')) {
                    const parts = birthdateString.split('-');
                    if (parts.length >= 3) {
                        return `${parts[1]}${parts[2]}`;  // MM + DD
                    }
                }
                // Handle MM/DD/YYYY format
                if (birthdateString.includes('/')) {
                    const parts = birthdateString.split('/');
                    if (parts.length >= 2) {
                        return `${parts[0].padStart(2, '0')}${parts[1].padStart(2, '0')}`;
                    }
                }
                return '';
            } catch (error) {
                console.error('Error extracting birthday month-day:', error, birthdateString);
                return '';
            }
        }

        async function getTodaysBirthdaysCelebrants() {
            const celebrants = [];
            const today = new Date();
            const todayMonth = String(today.getMonth() + 1).padStart(2, '0');
            const todayDay = String(today.getDate()).padStart(2, '0');
            const todayMMDD = todayMonth + todayDay;  // e.g., "1220" for December 20
            
            console.log('Checking for birthdays on:', todayMMDD);
            
            // First, load the birthdate cache if not already loaded
            if (!birthdateCacheLoaded) {
                await loadMemberBirthdateCache();
            }
            
            // Check logged-in user's birthdate
            if (userData && userData.birthdate) {
                const userMMDD = getBirthdayMonthDay(userData.birthdate);
                console.log('User birthdate:', userData.birthdate, '→ MMDD:', userMMDD);
                if (userMMDD === todayMMDD) {
                    const fullName = `${userData.firstname || ''} ${userData.lastname || ''}`.trim();
                    celebrants.push({
                        name: fullName || 'You',
                        initials: (userData.firstname || 'M')[0] + (userData.lastname || 'M')[0],
                        isSelf: true
                    });
                    console.log('✓ User has birthday today:', fullName);
                }
            }
            
            // Check ALL cached members (from Accounts sheet)
            console.log('Checking', Object.keys(memberBirthdateCache).length, 'cached members');
            for (const memberName in memberBirthdateCache) {
                if (memberName) {
                    const birthdate = memberBirthdateCache[memberName];
                    if (birthdate) {
                        const memberMMDD = getBirthdayMonthDay(birthdate);
                        if (memberMMDD === todayMMDD) {
                            // Don't duplicate if already added as self
                            const isDuplicate = celebrants.some(c => c.name === memberName);
                            if (!isDuplicate) {
                                celebrants.push({
                                    name: memberName,
                                    initials: memberName.split(' ').map(n => n[0]).join('').substring(0, 2),
                                    isSelf: false
                                });
                                console.log('✓ Found birthday celebrant:', memberName, 'birthdate:', birthdate);
                            }
                        }
                    }
                }
            }
            
            console.log('Total celebrants found:', celebrants.length);
            return celebrants;
        }

        async function getUpcomingBirthdaysCelebrants(daysAhead = 30) {
            const upcomingBirthdays = [];
            const today = new Date();
            
            // Load cache if not already loaded
            if (!birthdateCacheLoaded) {
                await loadMemberBirthdateCache();
            }
            
            // Check logged-in user's birthdate
            if (userData && userData.birthdate) {
                const userBirthday = calculateNextBirthday(userData.birthdate);
                const daysUntilBirthday = Math.floor((userBirthday - today) / (1000 * 60 * 60 * 24));
                
                if (daysUntilBirthday > 0 && daysUntilBirthday <= daysAhead) {
                    const fullName = `${userData.firstname || ''} ${userData.lastname || ''}`.trim();
                    upcomingBirthdays.push({
                        name: fullName || 'You',
                        birthdate: userData.birthdate,
                        daysUntil: daysUntilBirthday,
                        displayDate: formatBirthdateToMMDDYYYY(userData.birthdate),
                        isSelf: true
                    });
                }
            }
            
            // Check ALL cached members (from Accounts sheet)
            for (const memberName in memberBirthdateCache) {
                if (memberName) {
                    const birthdate = memberBirthdateCache[memberName];
                    if (birthdate) {
                        const nextBirthday = calculateNextBirthday(birthdate);
                        const daysUntilBirthday = Math.floor((nextBirthday - today) / (1000 * 60 * 60 * 24));
                        
                        if (daysUntilBirthday > 0 && daysUntilBirthday <= daysAhead) {
                            // Don't duplicate if already added as self
                            const isDuplicate = upcomingBirthdays.some(b => b.name === memberName);
                            if (!isDuplicate) {
                                upcomingBirthdays.push({
                                    name: memberName,
                                    birthdate: birthdate,
                                    daysUntil: daysUntilBirthday,
                                    displayDate: formatBirthdateToMMDDYYYY(birthdate),
                                    isSelf: false
                                });
                            }
                        }
                    }
                }
            }
            
            // Sort by days until birthday
            return upcomingBirthdays.sort((a, b) => a.daysUntil - b.daysUntil);
        }

        function calculateNextBirthday(birthdateString) {
            const birthdate = new Date(birthdateString);
            const today = new Date();
            
            let nextBirthday = new Date(today.getFullYear(), birthdate.getMonth(), birthdate.getDate());
            
            // If birthday has already passed this year, schedule for next year
            if (nextBirthday < today) {
                nextBirthday = new Date(today.getFullYear() + 1, birthdate.getMonth(), birthdate.getDate());
            }
            
            return nextBirthday;
        }

        // Cache for member birthdates
        let memberBirthdateCache = {};
        let birthdateCacheLoaded = false;

        async function getMemberBirthdate(memberName) {
            // Return from cache if already loaded
            if (birthdateCacheLoaded && memberBirthdateCache[memberName]) {
                return memberBirthdateCache[memberName];
            }
            
            // If cache not loaded yet, load it
            if (!birthdateCacheLoaded) {
                await loadMemberBirthdateCache();
            }
            
            return memberBirthdateCache[memberName] || null;
        }

        async function loadMemberBirthdateCache() {
            try {
                // Fetch all member birthdates from the server
                const response = await fetch(`${API_BASE_URL}/proxy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'getAllMemberBirthdates'
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success && result.data) {
                    // Build cache from returned data
                    result.data.forEach(member => {
                        if (member.fullName && member.birthdate) {
                            memberBirthdateCache[member.fullName] = member.birthdate;
                        }
                    });
                    
                    console.log(`Loaded ${Object.keys(memberBirthdateCache).length} member birthdates`);
                }
                
                birthdateCacheLoaded = true;
            } catch (error) {
                console.error('Error loading member birthdates:', error);
                birthdateCacheLoaded = true; // Mark as loaded even on error to prevent retries
            }
        }

        async function displayBirthdayTodaySection() {
            const greetingBox = document.getElementById('birthdayGreetingBox');
            const celebrantsContainer = document.getElementById('birthdayTodayCelerants');
            const upcomingContainer = document.getElementById('upcomingBirthdays');
            
            if (!celebrantsContainer || !upcomingContainer) return;
            
            // Get today's birthday celebrants
            const todaysCelebrants = await getTodaysBirthdaysCelebrants();
            
            // Show greeting message if it's the user's birthday
            if (greetingBox && todaysCelebrants.some(c => c.isSelf)) {
                greetingBox.innerHTML = `
                    <i class="fas fa-birthday-cake"></i> 
                    Happy Birthday! 🎉
                `;
                greetingBox.style.display = 'block';
            } else if (greetingBox) {
                greetingBox.style.display = 'none';
            }
            
            // Display today's celebrants
            if (todaysCelebrants.length === 0) {
                celebrantsContainer.innerHTML = `
                    <div class="no-birthday-celebrants">
                        <div><i class="fas fa-smile-wink"></i></div>
                        <p>No birthdays today, but every day is special!</p>
                    </div>
                `;
            } else {
                let celebrantsHTML = '';
                todaysCelebrants.forEach(celebrant => {
                    celebrantsHTML += `
                        <div class="birthday-card">
                            <div class="birthday-card-icon">
                                <i class="fas fa-birthday-cake"></i>
                            </div>
                            <div class="birthday-card-name">${celebrant.name}</div>
                            <div class="birthday-card-date">🎂 Today!</div>
                        </div>
                    `;
                });
                celebrantsContainer.innerHTML = celebrantsHTML;
            }
            
            // Display upcoming birthdays
            const upcomingBirthdays = await getUpcomingBirthdaysCelebrants(30);
            
            if (upcomingBirthdays.length === 0) {
                upcomingContainer.innerHTML = `
                    <div class="no-upcoming-birthdays">
                        <p>No upcoming birthdays in the next 30 days</p>
                    </div>
                `;
            } else {
                let upcomingHTML = '';
                upcomingBirthdays.forEach(birthday => {
                    const daysText = birthday.daysUntil === 1 ? 'Tomorrow' : `${birthday.daysUntil} days`;
                    upcomingHTML += `
                        <div class="upcoming-birthday-item">
                            <div class="upcoming-birthday-name">${birthday.name}</div>
                            <div class="upcoming-birthday-date">${birthday.displayDate.split('/').slice(0, 2).join('/')}</div>
                            <div class="upcoming-birthday-days">${daysText}</div>
                        </div>
                    `;
                });
                upcomingContainer.innerHTML = upcomingHTML;
            }
        }

        // Enhanced mock data for Weekly Schedule demonstration
        function getMockScheduleData() {
            const today = new Date();
            const nextSunday = new Date(today);
            nextSunday.setDate(today.getDate() + (7 - today.getDay())); // Next Sunday
            const nextSaturday = new Date(nextSunday);
            nextSaturday.setDate(nextSunday.getDate() - 1); // Saturday before
            
            const followingSunday = new Date(nextSunday);
            followingSunday.setDate(nextSunday.getDate() + 7);
            const followingSaturday = new Date(followingSunday);
            followingSaturday.setDate(followingSunday.getDate() - 1);
            
            return [
                {
                    scheduleId: 'SCH001',
                    songLeader: 'Psalm Gambe',
                    backups: ['Cathy Martinez', 'Tiffany Dañal', 'Geneveve España'],
                    practiceDate: nextSaturday.toISOString().split('T')[0],
                    scheduleDate: nextSunday.toISOString().split('T')[0],
                    slowSongs: [
                        {
                            title: 'Goodness of God',
                            link: 'https://www.youtube.com/watch?v=n_aZnV9nWnE',
                            lyrics: 'I love You Lord\nFor Your mercy never fails me\nAll my days, I\'ve been held in Your hands',
                            instructions: 'Start softly, build to powerful chorus'
                        },
                        {
                            title: 'What a Beautiful Name',
                            link: 'https://www.youtube.com/watch?v=nQWFzMvCfLE',
                            lyrics: 'You were the Word at the beginning\nOne with God the Lord Most High',
                            instructions: 'Emphasize the bridge section'
                        }
                    ],
                    fastSongs: [
                        {
                            title: 'Reckless Love',
                            link: 'https://www.youtube.com/watch?v=6xx0d3R2LoU',
                            lyrics: 'Before I spoke a word, You were singing over me\nYou have been so, so good to me',
                            instructions: 'Keep energy high throughout'
                        }
                    ]
                },
                {
                    scheduleId: 'SCH002',
                    songLeader: 'Geneveve España',
                    backups: ['Cathy Martinez', 'Merianne', 'Ezra'],
                    practiceDate: followingSaturday.toISOString().split('T')[0],
                    scheduleDate: followingSunday.toISOString().split('T')[0],
                    slowSongs: [
                        {
                            title: 'O Come to the Altar',
                            link: 'https://www.youtube.com/watch?v=-_a5uG6KkI8',
                            lyrics: 'Are you hurting and broken within?\nOverwhelmed by the weight of your sin?',
                            instructions: 'Build gradually to powerful finish'
                        }
                    ],
                    fastSongs: [
                        {
                            title: 'Do It Again',
                            link: 'https://www.youtube.com/watch?v=81gR_8_W8UY',
                            lyrics: 'Walking around these walls\nI thought by now they\'d fall',
                            instructions: 'Keep tempo steady'
                        },
                        {
                            title: 'Great Are You Lord',
                            link: 'https://www.youtube.com/watch?v=u-1fwZtKJSM',
                            lyrics: 'You give life, You are love\nYou bring light to the darkness',
                            instructions: 'Focus on harmonies in chorus'
                        }
                    ]
                }
            ];
        }

        // Function to load a single YouTube embed with network awareness
        function loadYouTubeEmbed(youtubeLink, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const videoId = extractYouTubeId(youtubeLink);
            
            if (!videoId) {
                container.innerHTML = '<div class="youtube-placeholder"><i class="fas fa-exclamation-triangle"></i> Invalid YouTube URL</div>';
                return;
            }
            
            // Check if we're online before trying to load YouTube
            if (!navigator.onLine) {
                container.innerHTML = `
                    <div class="youtube-placeholder">
                        <i class="fas fa-wifi-slash"></i>
                        <span>No Internet Connection</span>
                        <small>YouTube video unavailable</small>
                    </div>
                `;
                return;
            }
            
            // Check connection speed for slow connections
            checkConnectionSpeed().then(speed => {
                if (speed < 0.5) {
                    // Slow connection - show placeholder with option to load
                    container.innerHTML = `
                        <div class="youtube-placeholder">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Slow Connection Detected</span>
                            <small>Loading YouTube may be slow</small>
                            <button class="btn-primary" onclick="loadYouTubeVideo('${videoId}', '${containerId}')" style="margin-top: 10px; padding: 8px 15px;">
                                <i class="fas fa-play"></i> Load Video Anyway
                            </button>
                        </div>
                    `;
                } else {
                    // Good connection - load video directly
                    loadYouTubeVideo(videoId, containerId);
                }
            });
        }

        // Function to actually load the YouTube iframe
        function loadYouTubeVideo(videoId, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <iframe src="https://www.youtube.com/embed/${videoId}" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen
                        loading="lazy">
                </iframe>
            `;
        }

        // Initialize network status when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeNetworkStatus();
        });

        function closeModal() {
            document.getElementById('scheduleModal').style.display = 'none';
        }

        function toggleSongDetails(songId) {
            const detailsElement = document.getElementById(songId);
            detailsElement.classList.toggle('active');
        }

        function getSchedulesForDate(dateString) {
            if (currentCalendarType === 'paw') {
                return scheduleData.filter(schedule => {
                    // Skip header row
                    if (schedule.scheduleId === 'ScheduleID') return false;
                    
                    // Format dates for comparison
                    const scheduleDate = formatDateForComparison(schedule.scheduleDate);
                    const practiceDate = formatDateForComparison(schedule.practiceDate);
                    const checkDate = formatDateForComparison(dateString);
                    
                    return scheduleDate === checkDate || practiceDate === checkDate;
                });
            } else {
                // For meetings, return meetings data
                return [];
            }
        }

        // Clean schedule data (remove header rows and invalid data)
        function cleanScheduleData(data) {
            return data.filter(schedule => {
                // Remove header row and invalid schedules
                return schedule.scheduleId && 
                    schedule.scheduleId !== 'ScheduleID' && 
                    schedule.scheduleId !== '' &&
                    schedule.scheduleDate; // Must have a schedule date
            });
        }

        // Loading indicator functions
        function showLoading(message = 'Loading...') {
            // Remove existing loading indicator if any
            hideLoading();
            
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loadingIndicator';
            loadingDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 20px;
                border-radius: 8px;
                z-index: 10000;
                display: flex;
                align-items: center;
                gap: 10px;
            `;
            loadingDiv.innerHTML = `
                <i class="fas fa-spinner fa-spin"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(loadingDiv);
        }        

        function hideLoading() {
            const loadingIndicator = document.getElementById('loadingIndicator');
            if (loadingIndicator) {
                loadingIndicator.remove();
            }
        }




        function printCalendar() {
            window.print();
        }

        // Mock data for demonstration
        function getMockScheduleData() {
            return [
                {
                    scheduleId: '12345678',
                    songLeader: 'Psalm Gambe',
                    backups: ['Cathy', 'Tiffany', 'Geneveve'],
                    practiceDate: '2025-11-16',
                    scheduleDate: '2025-11-23',
                    slowSongs: [
                        {
                            title: 'Goodness of God',
                            link: 'https://www.youtube.com/watch?v=example1',
                            lyrics: 'I love You Lord\nFor Your mercy never fails me\nAll my days, I\'ve been held in Your hands',
                            instructions: 'Start softly, build to powerful chorus'
                        },
                        {
                            title: 'What a Beautiful Name',
                            link: 'https://www.youtube.com/watch?v=example2',
                            lyrics: 'You were the Word at the beginning\nOne with God the Lord Most High',
                            instructions: 'Emphasize the bridge section'
                        }
                    ],
                    fastSongs: [
                        {
                            title: 'Reckless Love',
                            link: 'https://www.youtube.com/watch?v=example3',
                            lyrics: 'Before I spoke a word, You were singing over me\nYou have been so, so good to me',
                            instructions: 'Keep energy high throughout'
                        },
                        {
                            title: 'Way Maker',
                            link: 'https://www.youtube.com/watch?v=example4',
                            lyrics: 'You are here, moving in our midst\nYou are here, working in this place',
                            instructions: 'Start with keyboard intro'
                        }
                    ]
                },
                {
                    scheduleId: '87654321',
                    songLeader: 'Geneveve España',
                    backups: ['Cathy', 'Merianne', 'Ezra'],
                    practiceDate: '2025-11-23',
                    scheduleDate: '2025-11-30',
                    slowSongs: [
                        {
                            title: 'O Come to the Altar',
                            link: 'https://www.youtube.com/watch?v=example5',
                            lyrics: 'Are you hurting and broken within?\nOverwhelmed by the weight of your sin?',
                            instructions: 'Build gradually to powerful finish'
                        }
                    ],
                    fastSongs: [
                        {
                            title: 'Do It Again',
                            link: 'https://www.youtube.com/watch?v=example6',
                            lyrics: 'Walking around these walls\nI thought by now they\'d fall',
                            instructions: 'Keep tempo steady'
                        },
                        {
                            title: 'Great Are You Lord',
                            link: 'https://www.youtube.com/watch?v=example7',
                            lyrics: 'You give life, You are love\nYou bring light to the darkness',
                            instructions: 'Focus on harmonies in chorus'
                        }
                    ]
                }
            ];
        }

        function initializeNetworkStatus() {
            const networkStatus = document.getElementById('networkStatus');
            const networkStatusText = document.getElementById('networkStatusText');
            
            // Check initial connection status
            updateNetworkStatus();
            
            // Listen for online/offline events
            window.addEventListener('online', updateNetworkStatus);
            window.addEventListener('offline', updateNetworkStatus);
            
            // Check connection speed periodically
            setInterval(checkConnectionSpeed, 30000); // Check every 30 seconds
        }
        
        function updateNetworkStatus() {
            const networkStatus = document.getElementById('networkStatus');
            const networkStatusText = document.getElementById('networkStatusText');
            
            if (navigator.onLine) {
                // Check if connection is slow
                checkConnectionSpeed().then(speed => {
                    if (speed < 0.5) { // Less than 0.5 Mbps
                        networkStatus.className = 'network-status slow';
                        networkStatusText.innerHTML = '<i class="fas fa-tachometer-alt"></i> Slow Connection';
                        networkStatus.style.display = 'block';
                        
                        // Auto-hide after 5 seconds
                        setTimeout(() => {
                            networkStatus.style.display = 'none';
                        }, 5000);
                    } else {
                        networkStatus.className = 'network-status online';
                        networkStatusText.innerHTML = '<i class="fas fa-wifi"></i> Online';
                        networkStatus.style.display = 'block';
                        
                        // Auto-hide after 3 seconds
                        setTimeout(() => {
                            networkStatus.style.display = 'none';
                        }, 3000);
                    }
                });
            } else {
                networkStatus.className = 'network-status offline';
                networkStatusText.innerHTML = '<i class="fas fa-wifi-slash"></i> Offline';
                networkStatus.style.display = 'block';
            }
        }
        
        function checkConnectionSpeed() {
            return new Promise((resolve) => {
                // Simple connection speed test by downloading a small image
                const startTime = Date.now();
                const image = new Image();
                const fileSize = 50000; // 50KB test file
                
                // Use a small image from a reliable CDN for testing
                image.src = 'https://placehold.co/100x100/cccccc/ffffff?text=Test&t=' + startTime;
                
                image.onload = function() {
                    const endTime = Date.now();
                    const duration = (endTime - startTime) / 1000; // in seconds
                    const bitsLoaded = fileSize * 8;
                    const speedMbps = (bitsLoaded / duration / (1024 * 1024)).toFixed(2);
                    resolve(parseFloat(speedMbps));
                };
                
                image.onerror = function() {
                    // If we can't load the test image, assume slow connection
                    resolve(0.1);
                };
                
                // Set a timeout in case the image takes too long to load
                setTimeout(() => {
                    resolve(0.1); // Assume slow connection if timeout
                }, 5000);
            });
        }

        function handleLyricsPaste(event) {
            // Let the paste happen normally first
            setTimeout(() => {
                const textarea = event.target;
                // The formatting should be preserved automatically with white-space: pre-wrap
                // But we can add any additional processing here if needed
            }, 0);
        }

        // Initialize all sections with coming soon content
        function initializeAllSections() {
            // Only initialize sections that don't have existing content
            // Announcements, home, attendance have static content and should not be overwritten
            const sections = ['praise-worship', 'media', 'dancers', 'ashers'];
            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    const titles = {
                        'attendance': 'Attendance Record',
                        'announcements': 'Announcements',
                        'praise-worship': 'Praise And Worship',
                        'media': 'Media Ministry',
                        'dancers': 'Dancers Ministry',
                        'ashers': 'Ashers Ministry'
                    };
                    
                    section.innerHTML = `
                        <h2 class="section-title">${titles[sectionId] || sectionId}</h2>
                        <div style="text-align: center; padding: 60px 20px;">
                            <div style="font-size: 4rem; margin-bottom: 20px; color: var(--primary);"><i class="fas fa-tools"></i></div>
                            <h3 style="color: var(--primary); margin-bottom: 15px; font-size: 1.5rem;">Features Coming Soon</h3>
                            <p style="color: #6c757d; margin-bottom: 25px; font-size: 1.1rem; line-height: 1.6;">
                                We're working hard to bring you amazing features for this section!<br>
                                Please be patient as we develop and test everything to ensure the best experience.
                            </p>
                            <div style="background: linear-gradient(135deg, rgba(146, 108, 21, 0.1), rgba(255, 195, 0, 0.1)); padding: 20px; border-radius: var(--border-radius); display: inline-block;">
                                <p style="color: var(--primary); font-weight: 600; margin: 0; font-size: 0.9rem;">
                                    <i class="fas fa-hammer"></i> Under Development by: <strong>Frank Gomez</strong>
                                </p>
                            </div>
                            <div style="margin-top: 30px; padding: 20px; background: white; border-radius: var(--border-radius); box-shadow: var(--shadow); max-width: 500px; margin-left: auto; margin-right: auto;">
                                <h4 style="color: var(--primary); margin-bottom: 15px;"><i class="fas fa-clipboard-list"></i> What to Expect:</h4>
                                <ul style="text-align: left; color: #6c757d; line-height: 1.8;">
                                    <li><i class="fas fa-check" style="color: var(--primary); margin-right: 8px;"></i>Enhanced user interface and experience</li>
                                    <li><i class="fas fa-check" style="color: var(--primary); margin-right: 8px;"></i>Real-time updates and notifications</li>
                                    <li><i class="fas fa-check" style="color: var(--primary); margin-right: 8px;"></i>Comprehensive ministry tools</li>
                                    <li><i class="fas fa-check" style="color: var(--primary); margin-right: 8px;"></i>Mobile-friendly design</li>
                                    <li><i class="fas fa-check" style="color: var(--primary); margin-right: 8px;"></i>And much more!</li>
                                </ul>
                            </div>
                        </div>
                    `;
                }
            });
        }

        // Close modals when clicking outside
        document.addEventListener('click', function(event) {
            const receiptModal = document.getElementById('receiptModal');
            const receiptContainer = document.getElementById('receiptContent');
            const scheduleModal = document.getElementById('scheduleModal');
            const modalContent = document.querySelector('.modal-content');
            const calendarModal = document.getElementById('calendarModal');
            const calendarModalContent = document.querySelector('.calendar-modal-content');
            
            if (event.target === receiptModal) {
                closeReceipt();
            }
            
            if (event.target === scheduleModal) {
                closeModal();
            }
            if (event.target === calendarModal) {
                closeCalendarModal();
            }
        });

        // Handle image loading errors
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('img, [style*="background-image"]').forEach(element => {
                if (element.tagName === 'IMG') {
                    element.onerror = function() {
                        console.warn('Failed to load image:', this.src);
                        this.style.display = 'none';
                    };
                } else {
                    // For elements with background-image
                    const checkBackgroundImage = function() {
                        const bgImage = getComputedStyle(this).backgroundImage;
                        if (bgImage.includes('url') && !bgImage.includes('gradient')) {
                            const img = new Image();
                            const url = bgImage.replace(/url\(['"]?(.*?)['"]?\)/i, "$1");
                            img.onerror = () => {
                                console.warn('Failed to load background image:', url);
                                this.style.backgroundImage = 'none';
                                this.style.backgroundColor = '#f8f9fa'; // Fallback color
                            };
                            img.src = url;
                        }
                    };
                    
                    // Check after a short delay to ensure styles are applied
                    setTimeout(() => checkBackgroundImage.call(element), 100);
                }
            });
        });

        // Check verification status function
        function checkVerificationStatus() {
            showAlert('Checking verification status...', 'info');
            // In a real implementation, this would call your backend API
            setTimeout(() => {
                showAlert('Your account is still pending verification. Please check back later.', 'warning');
            }, 1000);
        }

        // ===== SPIRITUAL ASSISTANT CHAT FUNCTIONS =====

        // Personalize the greeting message with user's name
        function personalizeGreeting() {
            const initialGreeting = document.getElementById('initialGreeting');
            
            // Get user name from various sources
            let userName = 'Friend';
            
            // Try userData global variable first
            if (typeof userData !== 'undefined' && userData && userData.firstname) {
                userName = userData.firstname;
            }
            // Try sessionStorage
            else if (sessionStorage.getItem('userData')) {
                try {
                    const storedData = JSON.parse(sessionStorage.getItem('userData'));
                    if (storedData && storedData.firstname) {
                        userName = storedData.firstname;
                    }
                } catch (e) {
                    console.log('Could not parse userData from sessionStorage');
                }
            }
            // Try localStorage
            else if (localStorage.getItem('userData')) {
                try {
                    const storedData = JSON.parse(localStorage.getItem('userData'));
                    if (storedData && storedData.firstname) {
                        userName = storedData.firstname;
                    }
                } catch (e) {
                    console.log('Could not parse userData from localStorage');
                }
            }
            
            console.log(`🎯 Personalizing greeting for: ${userName}`);
            
            if (initialGreeting) {
                initialGreeting.innerHTML = `
                    <div class="message-content">
                        <p>Hello <strong>${userName}</strong>! 👋 I'm your Spiritual Assistant. I'm here to help you reflect on life's challenges through the lens of biblical wisdom and scripture.</p>
                        <p style="margin-top: 10px; font-size: 0.95em; color: #888;">Ask me about any situation you're facing, ${userName}, and I'll help you find biblical guidance and relevant scriptures.</p>
                    </div>
                    <div class="message-time">Now</div>
                `;
            }
        }

        // Send user question and get AI spiritual guidance
        async function sendSpiritualQuestion() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            
            if (!message) {
                showAlert('Please ask a question or share your situation', 'warning');
                return;
            }

            // Display user message
            displayChatMessage(message, true);
            userInput.value = '';
            userInput.style.height = 'auto';

            // Show typing indicator
            const typingDiv = document.createElement('div');
            typingDiv.className = 'chat-message ai-message';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="message-content typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            document.getElementById('chatMessages').appendChild(typingDiv);
            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;

            try {
                // Get user's name from various sources
                let userName = 'Friend';
                
                if (typeof userData !== 'undefined' && userData && userData.firstname) {
                    userName = userData.firstname;
                } else if (sessionStorage.getItem('userData')) {
                    try {
                        const storedData = JSON.parse(sessionStorage.getItem('userData'));
                        if (storedData && storedData.firstname) {
                            userName = storedData.firstname;
                        }
                    } catch (e) {}
                } else if (localStorage.getItem('userData')) {
                    try {
                        const storedData = JSON.parse(localStorage.getItem('userData'));
                        if (storedData && storedData.firstname) {
                            userName = storedData.firstname;
                        }
                    } catch (e) {}
                }
                
                console.log(`💬 Processing question for user: ${userName}`);
                const aiResponse = await fetchSpiritualGuidance(message, userName);
                
                // Remove typing indicator
                const typing = document.getElementById('typingIndicator');
                if (typing) typing.remove();

                // Display AI response
                displayChatMessage(aiResponse, false);
                
            } catch (error) {
                console.error('❌ Error fetching spiritual guidance:', error);
                const typing = document.getElementById('typingIndicator');
                if (typing) typing.remove();

                const fallbackResponse = `I appreciate your question. While I'm having trouble retrieving guidance at the moment, I encourage you to:

1. **Pray** - Take your concerns directly to God in prayer
2. **Read Scripture** - Open your Bible and seek God's word
3. **Seek Counsel** - Talk to your pastor or spiritual mentor
4. **Trust God** - Remember that God cares about your situation

Romans 6:23 reminds us: "The wages of sin is death, but the gift of God is eternal life in Christ Jesus our Lord."

Please try again in a moment or reach out to your spiritual leaders.`;

                displayChatMessage(fallbackResponse, false);
            }
        }

        // Fetch spiritual guidance from Groq API
        async function fetchSpiritualGuidance(userMessage, userName = 'Friend') {
            const GROQ_API_KEY = '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';
            const GROQ_API_URL = 'https://api.groq.com/openai/v1/chat/completions';

            const systemPrompt = `You are a compassionate and biblical spiritual advisor speaking with **${userName}**. Your role is to:
1. Listen to ${userName}'s concerns and life situations with empathy
2. Relate their situations to biblical principles and scriptures
3. Provide scripture references (always include the book, chapter, and verse)
4. Offer spiritual wisdom grounded in the Bible
5. Always encourage prayer and seeking God's guidance
6. Remind ${userName} to consult with their spiritual leaders for serious matters

IMPORTANT FORMATTING INSTRUCTIONS:
- Use **asterisks** to highlight important points or concepts
- Use # hashtags for section headers (# Section Name)
- Format numbered lists as: 1. Point, 2. Point, 3. Point
- Use bullet points for key ideas: - Key idea
- Always include scripture references in this format: Book Chapter:Verse
- Personalize your response by addressing ${userName} by name

Response Structure:
# Acknowledgment
Start with empathy for ${userName}'s situation and acknowledge their concern by name

# Biblical Perspective
Explain the biblical principles relevant to their concern

# Scripture Guidance
Include 1-3 relevant scriptures with explanations

# Practical Advice
Give actionable spiritual guidance tailored for ${userName}

# Encouragement
End with hope and encouragement to trust God's will, addressing ${userName} personally

Keep responses compassionate, non-judgmental, and focused on God's love and grace. Make sure to acknowledge ${userName} throughout your response.`;

            try {
                const response = await fetch(GROQ_API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${GROQ_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'openai/gpt-oss-120b',
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: userMessage }
                        ],
                        temperature: 0.7,
                        max_tokens: 600
                    })
                });

                if (!response.ok) {
                    console.error('⚠️ Groq API returned status', response.status);
                    throw new Error(`API error: ${response.statusText}`);
                }

                const data = await response.json();
                const aiMessage = data.choices[0].message.content;
                
                console.log('✨ SPIRITUAL GUIDANCE RECEIVED FROM GROQ');
                return aiMessage;

            } catch (error) {
                console.error('❌ Error fetching spiritual guidance from Groq:', error);
                throw error;
            }
        }

        // Display chat message in the chat window
        function displayChatMessage(message, isUserMessage) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${isUserMessage ? 'user-message' : 'ai-message'}`;

            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });

            // Format the message content
            let formattedMessage = message;
            
            messageDiv.innerHTML = `
                <div class="message-content">
                    ${formatMessageText(formattedMessage)}
                </div>
                <div class="message-time">${timeString}</div>
            `;

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Format message text with markdown-style formatting
        function formatMessageText(text) {
            let html = text;
            
            // Convert markdown-style bold (**text**) to actual bold
            html = html.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
            
            // Convert single asterisks (*text*) to italic
            html = html.replace(/\*([^*]+)\*/g, '<em>$1</em>');
            
            // Convert hashtag headers (# Title) to h3 tags
            html = html.replace(/^#+\s+(.+)$/gm, '<h3 style="margin-top: 12px; margin-bottom: 8px; color: #2c3e50; font-weight: 700; font-size: 1.05em;">$1</h3>');
            
            // Format numbered lists
            html = html.replace(/^\d+\.\s+(.+)$/gm, '<div style="margin: 8px 0 8px 20px; padding-left: 10px; border-left: 2px solid var(--primary);"><strong>$1</strong></div>');
            
            // Format bullet points
            html = html.replace(/^[-•]\s+(.+)$/gm, '<div style="margin: 6px 0 6px 20px;">• $1</div>');
            
            // Split into paragraphs and process each
            const paragraphs = html.split(/\n\n+/);
            
            return paragraphs
                .map(para => {
                    if (!para.trim()) return '';
                    
                    // Check if it's a scripture reference (Book Chapter:Verse format)
                    if (para.match(/^[\w\s0-9]+\s+\d+:\d+/)) {
                        return `<div class="scripture-reference">${para.trim()}</div>`;
                    }
                    
                    // Check if it already contains HTML tags (headers, lists)
                    if (para.includes('<')) {
                        return `<div>${para}</div>`;
                    }
                    
                    // Regular paragraph
                    return `<p style="margin-bottom: 10px; line-height: 1.6;">${para.trim()}</p>`;
                })
                .join('');
        }

        // Auto-expand textarea as user types
        document.addEventListener('DOMContentLoaded', function() {
            const userInput = document.getElementById('userInput');
            if (userInput) {
                userInput.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = Math.min(this.scrollHeight, 120) + 'px';
                });

                // Allow Enter + Shift to send, just Enter to newline
                userInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendSpiritualQuestion();
                    }
                });
            }
        });

    </script>
</body>
</html>
